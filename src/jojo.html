<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2018-08-17 Fri 04:21 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>jojo</title>
<meta name="generator" content="Org-mode" />
<link rel="stylesheet" href="../css/org-page.css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">jojo</h1>
<div id="table-of-contents">
<h2>overview</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org5ed036c">prolog</a>
<ul>
<li><a href="#org53a55e0">include</a></li>
<li><a href="#org488fe55">about namespace</a></li>
</ul>
</li>
<li><a href="#orgbd2315c">datatype</a>
<ul>
<li><a href="#org5727d9e">forward declaration</a></li>
<li><a href="#org3dcfb9c">datatype</a></li>
<li><a href="#orgfce0997">obj_t</a></li>
<li><a href="#orge1ee61d">jo_t</a></li>
<li><a href="#org9bc03b3">env_t</a></li>
<li><a href="#org1919755">box_t</a></li>
<li><a href="#orgf24bda0">jojo_t</a></li>
<li><a href="#orgf263ea3">frame_t</a></li>
</ul>
</li>
<li><a href="#orge3c9125">utility</a>
<ul>
<li><a href="#org510cadd">string</a>
<ul>
<li><a href="#orgd1d1aa0">string_split</a></li>
<li><a href="#orga084aa2">string_vector_join</a></li>
</ul>
</li>
<li><a href="#org4ca5897">vector_rest</a></li>
<li><a href="#org41f2ea7">name_vector</a>
<ul>
<li><a href="#org3d2fd4a">name_vector_repr</a></li>
</ul>
</li>
<li><a href="#orgc840eec">bind</a>
<ul>
<li><a href="#orgff329d6">bind_eq</a></li>
</ul>
</li>
<li><a href="#org8ba013e">bind_vector</a>
<ul>
<li><a href="#org23f8656">bind_vector_repr</a></li>
<li><a href="#org78dade3">number_of_obj_in_bind_vector</a></li>
<li><a href="#org1a57b2e">bind_vector_insert_obj</a></li>
<li><a href="#org60717b4">bind_vector_merge_obj_vector</a></li>
<li><a href="#org5550dd5">bind_vector_insert_obj_with_name</a></li>
<li><a href="#org5dd8a6f">bind_vector_merge_obj_map</a></li>
<li><a href="#org96cc1b3">bind_vector_from_name_vector</a></li>
<li><a href="#orgf2a17e8">bind_vector_eq</a></li>
</ul>
</li>
<li><a href="#orge345a26">obj_vector</a>
<ul>
<li><a href="#org89fad28">pick_up_obj_vector</a></li>
</ul>
</li>
<li><a href="#org1e1495f">local_scope</a>
<ul>
<li><a href="#org7d5686f">local_scope_eq</a></li>
<li><a href="#org386144b">local_scope_extend</a></li>
<li><a href="#orge7ca504">local_scope_repr</a></li>
</ul>
</li>
<li><a href="#org3e7c870">obj_map</a>
<ul>
<li><a href="#org1cb9a3">obj_map_eq</a></li>
<li><a href="#org1d26921">obj_map_repr</a></li>
<li><a href="#orgbd68bb3">name_vector_obj_map_lack</a></li>
<li><a href="#org587e476">name_vector_obj_map_arity_lack</a></li>
<li><a href="#org3897ce8">pick_up_obj_map_and_merge</a></li>
<li><a href="#orgb9316bb">name_vector_and_obj_map_repr</a></li>
<li><a href="#orga53fc6e">obj_map_merge</a></li>
</ul>
</li>
<li><a href="#org8b24077">name</a>
<ul>
<li><a href="#org3d1b291">name_t2c</a></li>
<li><a href="#orgff75370">name_t2p</a></li>
<li><a href="#org7668429">name_c2t</a></li>
<li><a href="#orgc9881f3">name_p2t</a></li>
</ul>
</li>
<li><a href="#org1428c10">frame</a>
<ul>
<li><a href="#orgc0b7a52">new_frame_from_jojo</a></li>
<li><a href="#org32738c">new_frame_from_jo_vector</a></li>
</ul>
</li>
<li><a href="#orgcecab16">local_ref</a>
<ul>
<li><a href="#orgac4eeba">local_ref_map_extend</a></li>
</ul>
</li>
<li><a href="#org3e10214">assert</a>
<ul>
<li><a href="#orgc863d2">assert_pop_eq</a></li>
<li><a href="#org36eeede">assert_tos_eq</a></li>
<li><a href="#org561ee30">assert_stack_size</a></li>
</ul>
</li>
<li><a href="#orgd98047c">num</a>
<ul>
<li><a href="#orgd210263">s2n</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org4e902e8">obj</a>
<ul>
<li><a href="#orgbc9d4bb">obj_t::~obj_t</a></li>
<li><a href="#orgffe4862">obj_t::repr</a></li>
<li><a href="#org4174173">obj_t::eq</a></li>
<li><a href="#org5f86e81">obj_t::apply</a></li>
<li><a href="#orgde7dd72">obj_t::apply_to_arg_dict</a></li>
<li><a href="#org4a44c8e">define</a></li>
<li><a href="#org343a60d">obj_eq</a></li>
<li><a href="#org6bf0bd7">find_obj_from_name</a></li>
</ul>
</li>
<li><a href="#orgbec793b">jo</a>
<ul>
<li><a href="#org7bdb016">jo_t::copy</a></li>
<li><a href="#orgf940b12">jo_t::~jo_t</a></li>
<li><a href="#orga4ca3ea">jo_t::exe</a></li>
<li><a href="#org6651b8c">jo_t::repr</a></li>
</ul>
</li>
<li><a href="#org70a8282">env</a>
<ul>
<li><a href="#org6c92c5d">box</a>
<ul>
<li><a href="#org3d6f20f">box_t::box_t</a></li>
<li><a href="#org38e32f5">boxing</a></li>
<li><a href="#orga1a77fa">name_of_box</a></li>
</ul>
</li>
<li><a href="#org796c03b">jojo</a>
<ul>
<li><a href="#orgb6fe25a">jojo_t::jojo_t</a></li>
<li><a href="#org2197559">jojo_t::~jojo_t</a></li>
<li><a href="#orgdfd41ca">jojo_append</a></li>
<li><a href="#orgeed0cce">jojo_repr</a></li>
</ul>
</li>
<li><a href="#org6c053db">frame</a>
<ul>
<li><a href="#org73699a5">frame_t::frame_t</a></li>
<li><a href="#org2b9f8e0">jojo_print</a></li>
<li><a href="#org953b660">jojo_print_with_index</a></li>
<li><a href="#org127ec61">frame_report</a></li>
</ul>
</li>
<li><a href="#org91c317a">tag</a>
<ul>
<li><a href="#org8f933d5">tag_name_p</a></li>
<li><a href="#org38b4bf5">tagging</a></li>
<li><a href="#orgdbc1672">box_of_tag</a></li>
<li><a href="#org54476f1">name_of_tag</a></li>
<li><a href="#orgc1767a9">null_tagged_box</a></li>
<li><a href="#org68508f5">make_tagged_box_vector</a></li>
<li><a href="#org1ae54cb">preserved_tag</a></li>
<li><a href="#org6cfac5e">about preserved tags</a></li>
<li><a href="#orga709f43">init_tagged_box_vector</a></li>
</ul>
</li>
<li><a href="#orge958815">env_t::env_t</a></li>
<li><a href="#org3321b2e">env_t::step</a></li>
<li><a href="#org775b212">env_t::run</a></li>
<li><a href="#orgb3117c7">env_t::box_map_report</a></li>
<li><a href="#org659de1c">env_t::frame_stack_report</a></li>
<li><a href="#org35f723d">env_t::obj_stack_report</a></li>
<li><a href="#org5c508c3">env_t::report</a></li>
<li><a href="#org14bb1bd">env_t::run_with_base</a></li>
<li><a href="#org15b16df">env_t::double_report</a></li>
<li><a href="#org2315851">env_t::step_and_report</a></li>
</ul>
</li>
<li><a href="#orga166454">closure</a>
<ul>
<li><a href="#org19ba3b1">closure_o</a></li>
<li><a href="#orgd725af1">closure_o::closure_o</a></li>
<li><a href="#org9023d4a">make_closure</a></li>
<li><a href="#orgb8f8e39">closure_o::apply</a></li>
<li><a href="#org884e458">closure_o::eq</a></li>
<li><a href="#org2446fee">closure_p</a></li>
<li><a href="#org27d4fe3">closure_o::repr</a></li>
</ul>
</li>
<li><a href="#org90224a9">type</a>
<ul>
<li><a href="#org172152a">type_o</a></li>
<li><a href="#org2df24a1">type_o::type_o</a></li>
<li><a href="#orgab0eeb9">make_type</a></li>
<li><a href="#orgbcb91b7">as_type</a></li>
<li><a href="#org2a70919">type_o::repr</a></li>
<li><a href="#org78fd222">type_o::eq</a></li>
<li><a href="#org8fb22df">find_type_from_prefix</a></li>
<li><a href="#orgfcaa212">assign</a></li>
<li><a href="#orge2a826a">assign_type</a></li>
<li><a href="#org46b94dc">define_type</a></li>
<li><a href="#org17ef715">type_of</a></li>
</ul>
</li>
<li><a href="#org8b6632d">data</a>
<ul>
<li><a href="#orgb9d2828">data_o</a></li>
<li><a href="#org3bf266a">data_o::data_o</a></li>
<li><a href="#org6244c1f">make_data</a></li>
<li><a href="#org860a31a">data_o::eq</a></li>
<li><a href="#org4e2954d">data_o::repr</a></li>
<li><a href="#org7d7dca1">assign_data</a></li>
</ul>
</li>
<li><a href="#orgc9a2f27">bool</a>
<ul>
<li><a href="#org3deae55">true_c</a></li>
<li><a href="#org91aa8f0">true_p</a></li>
<li><a href="#orgaac8bc2">false_c</a></li>
<li><a href="#org34bc033">false_p</a></li>
<li><a href="#orga381ee8">make_bool</a></li>
<li><a href="#orgd2662cd">bool_p</a></li>
</ul>
</li>
<li><a href="#orgc4f269b">data_pred</a>
<ul>
<li><a href="#org61a9cc8">data_pred_o</a></li>
<li><a href="#org24b93cf">data_pred_o::data_pred_o</a></li>
<li><a href="#orgcf2875a">data_pred_o::apply</a></li>
<li><a href="#org1eb96a9">data_pred_o::eq</a></li>
<li><a href="#org959e2bb">data_pred_o::repr</a></li>
<li><a href="#orgbc81c33">assign_data_pred</a></li>
<li><a href="#org262ec69">define_data_pred</a></li>
</ul>
</li>
<li><a href="#orgcece13a">data_cons</a>
<ul>
<li><a href="#org72325c6">data_cons_o</a></li>
<li><a href="#org4a8696f">data_cons_o::data_cons_o</a></li>
<li><a href="#orgefb707e">make_data_cons</a></li>
<li><a href="#orgdc3370f">data_cons_o::apply</a></li>
<li><a href="#orgb3ec846">data_cons_o::eq</a></li>
<li><a href="#org66ed25a">data_cons_p</a></li>
<li><a href="#orgffa930f">data_cons_o::repr</a></li>
<li><a href="#orgace1a6">assign_data_cons</a></li>
</ul>
</li>
<li><a href="#orgdcd1579">prim</a>
<ul>
<li><a href="#org797776d">prim_fn</a></li>
<li><a href="#org3d1e48a">prim_o</a></li>
<li><a href="#org6ada691">prim_o::prim_o</a></li>
<li><a href="#orgba0ff0c">make_prim</a></li>
<li><a href="#orgc00b49f">prim_p</a></li>
<li><a href="#org6959ad5">prim_o::repr</a></li>
<li><a href="#org20b3ca5">prim_o::eq</a></li>
<li><a href="#org33b8e7d">prim_o::apply</a></li>
<li><a href="#orgd64f998">sig_t</a></li>
<li><a href="#org4ad4e79">name_of_sig</a></li>
<li><a href="#org66ae3a">name_vector_of_sig</a></li>
<li><a href="#orgb0be286">define_prim</a></li>
</ul>
</li>
<li><a href="#org7f0907c">num</a>
<ul>
<li><a href="#org3dd25b4">num_o</a></li>
<li><a href="#org564757c">num_o::num_o</a></li>
<li><a href="#org8d661e0">make_num</a></li>
<li><a href="#org6c5242f">num_o::repr</a></li>
<li><a href="#orgcd202cc">as_num</a></li>
<li><a href="#orgc734984">num_o::eq</a></li>
<li><a href="#org1b08fda">num_p</a></li>
</ul>
</li>
<li><a href="#orgd93d469">str</a>
<ul>
<li><a href="#orgd6b021">str_o</a></li>
<li><a href="#org7d5cba1">str_o::str_o</a></li>
<li><a href="#orga2e2063">make_str</a></li>
<li><a href="#orgd315c06">str_o::repr</a></li>
<li><a href="#org547f9e8">as_str</a></li>
<li><a href="#org696f4d6">str_o::eq</a></li>
<li><a href="#orgd300e2c">str_p</a></li>
<li><a href="#org20a87eb">str_length</a></li>
<li><a href="#org893d3c9">str_append</a></li>
<li><a href="#org69752cc">str_slice</a></li>
<li><a href="#orgf7ed09d">str_ref</a></li>
<li><a href="#orgd746831">str_head</a></li>
<li><a href="#org9a27c04">str_rest</a></li>
</ul>
</li>
<li><a href="#orgdfbc3ce">sym</a>
<ul>
<li><a href="#orgb8a88f2">sym_o</a></li>
<li><a href="#orgc90bc25">sym_o::sym_o</a></li>
<li><a href="#orgbb9a151">make_sym</a></li>
<li><a href="#orgdf932b0">sym_o::repr</a></li>
<li><a href="#orga842dc7">as_sym</a></li>
<li><a href="#org5ce645f">sym_o::eq</a></li>
<li><a href="#org3ff0cae">sym_p</a></li>
<li><a href="#org91f2835">sym_length</a></li>
<li><a href="#org52930b0">sym_append</a></li>
<li><a href="#orgd38141b">sym_slice</a></li>
<li><a href="#orgf8427d2">sym_ref</a></li>
<li><a href="#orgcc63a0f">sym_head</a></li>
<li><a href="#org6d587ae">sym_rest</a></li>
</ul>
</li>
<li><a href="#orgfd5f57f">list</a>
<ul>
<li><a href="#orgb041fb8">null_c</a></li>
<li><a href="#orgdae5013">null_p</a></li>
<li><a href="#org80aa940">cons_c</a></li>
<li><a href="#orge4ab6b2">cons_p</a></li>
<li><a href="#orge5691da">car</a></li>
<li><a href="#org904c6c4">cdr</a></li>
<li><a href="#orgd88da93">list_p</a></li>
<li><a href="#org4a62764">list_size</a></li>
<li><a href="#orge2ef11b">list_length</a></li>
<li><a href="#org33249aa">list_reverse</a></li>
<li><a href="#org4b54d9">list_append</a></li>
<li><a href="#org9794203">unit_list</a></li>
</ul>
</li>
<li><a href="#orgb01c34f">vect</a>
<ul>
<li><a href="#orga14a0b2">vect_o</a></li>
<li><a href="#org5b31e76">vect_o::vect_o</a></li>
<li><a href="#orgc707ee6">make_vect</a></li>
<li><a href="#orgfb7aef3">as_vect</a></li>
<li><a href="#orge00d80b">vect_eq</a></li>
<li><a href="#orgd045e2a">vect_o::eq</a></li>
<li><a href="#org1e89820">vect_o::repr</a></li>
<li><a href="#org46dc64a">vect_p</a></li>
<li><a href="#org76f5bd5">list_to_vect</a></li>
<li><a href="#org61082f4">vect_to_list</a></li>
<li><a href="#org257dd4c">vect_length</a></li>
<li><a href="#orgf9a5186">vect_append</a></li>
<li><a href="#orgf57507f">vect_slice</a></li>
<li><a href="#org1453638">vect_ref</a></li>
<li><a href="#orga947782">vect_head</a></li>
<li><a href="#orgb7eda18">vect_rest</a></li>
<li><a href="#org81055e6">vect_reverse</a></li>
<li><a href="#orga3bb5e4">unit_vect</a></li>
</ul>
</li>
<li><a href="#orgeabf00d">maybe</a>
<ul>
<li><a href="#org7d253ad">nothing_c</a></li>
<li><a href="#org7fcf28c">nothing_p</a></li>
<li><a href="#org75da0a6">just_c</a></li>
<li><a href="#orgd88e4c3">just_p</a></li>
<li><a href="#orgd8ac480">value_of_just</a></li>
<li><a href="#org238a688">maybe_p</a></li>
</ul>
</li>
<li><a href="#org6247cd7">dict</a>
<ul>
<li><a href="#org38537f5">dict_o</a></li>
<li><a href="#org8d4dbff">dict_o::dict_o</a></li>
<li><a href="#org90e63da">make_dict</a></li>
<li><a href="#orgea1b05e">as_dict</a></li>
<li><a href="#org18aa7f1">dict_o::eq</a></li>
<li><a href="#org20fad28">dict_o::repr</a></li>
<li><a href="#org81f1a63">dict_p</a></li>
<li><a href="#orgd1a12e8">list_to_dict</a></li>
<li><a href="#org3b00750">dict_to_list</a></li>
<li><a href="#org80b489c">dict_to_flat_list</a></li>
<li><a href="#org926196">dict_length</a></li>
<li><a href="#org84150b8">dict_key_list</a></li>
<li><a href="#org229fa7a">dict_value_list</a></li>
<li><a href="#org3ecdc45">dict_insert</a></li>
<li><a href="#org5444dcf">dict_merge</a></li>
<li><a href="#org808b67d">dict_find</a></li>
</ul>
</li>
<li><a href="#org3e1248a">scan</a>
<ul>
<li><a href="#org19d9884">space_char_p</a></li>
<li><a href="#orgee23726">delimiter_char_p</a></li>
<li><a href="#org1b73f23">semicolon_char_p</a></li>
<li><a href="#orgc97a221">newline_char_p</a></li>
<li><a href="#org5428822">string_from_char</a></li>
<li><a href="#org1588e96">doublequote_char_p</a></li>
<li><a href="#orgd809921">find_word_length</a></li>
<li><a href="#org999f79a">find_string_length</a></li>
<li><a href="#org5a45fd9">find_comment_length</a></li>
<li><a href="#org4b3f8ab">scan_word_vector</a></li>
<li><a href="#orgd3ff936">test_scan</a></li>
</ul>
</li>
<li><a href="#org8d583f9">sexp</a>
<ul>
<li><a href="#org618a90d"><span class="done _note_">[note]</span> about literal in quote</a></li>
<li><a href="#org8e2279f">word_vector_to_word_list &#x2013; drop `,`</a></li>
<li><a href="#orgd6fe89e">scan_word_list</a></li>
<li><a href="#org295fa0f">bar_word_p</a></li>
<li><a href="#org5a55d4a">ket_word_p</a></li>
<li><a href="#orgc547f4e">quote_word_p</a></li>
<li><a href="#org4d9be62">unquote_word_p</a></li>
<li><a href="#org605b015">bar_word_to_ket_word</a></li>
<li><a href="#org7669d60">word_list_head_with_bar_ket_counter</a></li>
<li><a href="#org1fab9cd">word_list_head</a></li>
<li><a href="#org4c9a6e">word_list_rest_with_bar_ket_counter</a></li>
<li><a href="#org86fd214">word_list_rest</a></li>
<li><a href="#orgd8a702">word_list_drop_ket</a></li>
<li><a href="#org547c968">string_string_p</a></li>
<li><a href="#org5b12937">string_string_to_string</a></li>
<li><a href="#org54256e2">num_string_p</a></li>
<li><a href="#orgd5f3908">sexp_list_to_vect</a></li>
<li><a href="#org126475a">sexp_list_prefix_assign_with_last_sexp</a></li>
<li><a href="#orgea23460">sexp_list_prefix_assign</a></li>
<li><a href="#org4d2e1b2">sexp_list_assign_to_pair</a></li>
<li><a href="#org86d02ac">sexp_list_to_dict</a></li>
<li><a href="#orgf90b097"><span class="done _note_">[note]</span> about sexp</a></li>
<li><a href="#org28851f2">parse_sexp</a></li>
<li><a href="#org6c15e3d">parse_sexp_list</a></li>
<li><a href="#orgaa5ab02">sexp_repr</a></li>
<li><a href="#org2c39170">sexp_list_repr</a></li>
</ul>
</li>
<li><a href="#org6d3e213">system</a>
<ul>
<li><a href="#orgc43fbff">system_env_find</a></li>
<li><a href="#orgee78dcf">dollar_string_p</a></li>
<li><a href="#org62e083b">dollar_string_to_name</a></li>
<li><a href="#org5282b90">expend_path</a></li>
</ul>
</li>
<li><a href="#org1b3d323">module</a>
<ul>
<li><a href="#org3479c7e">module_o</a></li>
<li><a href="#org120c16d">module_o::module_o</a></li>
<li><a href="#orgdb03a99"><span class="todo _todo_">[todo]</span> eq_env_p</a></li>
<li><a href="#org56429e1">module_o::eq</a></li>
<li><a href="#org770aa83">module_o::repr</a></li>
</ul>
</li>
<li><a href="#org255feb2">compile</a>
<ul>
<li><a href="#orge5e2ad0">forward declaration</a></li>
<li><a href="#org430bc26">lit_compile</a>
<ul>
<li><a href="#orgf8374fb">lit_jo</a>
<ul>
<li><a href="#orgb6eabdd">lit_jo_t</a></li>
<li><a href="#org5dc2a81">lit_jo_t::lit_jo_t</a></li>
<li><a href="#orgb5c4993">lit_jo_t::copy</a></li>
<li><a href="#org2865b96">lit_jo_t::exe</a></li>
<li><a href="#org4a34911">lit_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#org74ac6e">lit_compile</a></li>
</ul>
</li>
<li><a href="#org42852a4">field_symbol_compile</a>
<ul>
<li><a href="#orge31a3cd">field_jo</a>
<ul>
<li><a href="#org42e9ca4">field_jo_t</a></li>
<li><a href="#org995790a">field_jo_t::field_jo_t</a></li>
<li><a href="#org16f209e">field_jo_t::copy</a></li>
<li><a href="#orgf0ecd55">field_jo_t::exe</a></li>
<li><a href="#org6461c59">field_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#org21d71ae">field_symbol_p</a></li>
<li><a href="#org924eb83">field_symbol_compile</a></li>
</ul>
</li>
<li><a href="#org2673b6c">dot_symbol_compile</a>
<ul>
<li><a href="#org17b3f1c">dot_symbol_p</a></li>
<li><a href="#orgcd8bb4c">dot_symbol_compile</a></li>
</ul>
</li>
<li><a href="#org2eaa371">ref_compile</a>
<ul>
<li><a href="#org2d7020d">ref_jo</a>
<ul>
<li><a href="#orga500adb">ref_jo_t</a></li>
<li><a href="#orgaff17f8">ref_jo_t::ref_jo_t</a></li>
<li><a href="#org81cf622">ref_jo_t::copy</a></li>
<li><a href="#org3181104">ref_jo_t::exe</a></li>
<li><a href="#org111788a">ref_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#org3df0804">local_ref_jo</a>
<ul>
<li><a href="#orgab649a1">local_ref_jo_t</a></li>
<li><a href="#org44ef000">local_ref_jo_t::local_ref_jo_t</a></li>
<li><a href="#orga0d5224">local_ref_jo_t::copy</a></li>
<li><a href="#orgd8a9512">local_ref_jo_t::exe</a></li>
<li><a href="#org2a67b3e">local_ref_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#org716d89f">ref_compile</a></li>
</ul>
</li>
<li><a href="#orgc70cfb9">symbol_compile</a></li>
<li><a href="#orgae3f752">vect_compile</a>
<ul>
<li><a href="#org700841c">collect_vect_jo</a>
<ul>
<li><a href="#org20be62c">collect_vect_jo_t</a></li>
<li><a href="#org5e50bac">collect_vect_jo_t::collect_vect_jo_t</a></li>
<li><a href="#org8a5c772">collect_vect_jo_t::copy</a></li>
<li><a href="#org64384eb">collect_vect_jo_t::exe</a></li>
<li><a href="#org382de1d">collect_vect_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#orgf1dfc22">vect_compile</a></li>
</ul>
</li>
<li><a href="#org13e524e">dict_compile</a>
<ul>
<li><a href="#orga96bda5">collect_dict_jo</a>
<ul>
<li><a href="#orga2a1333">collect_dict_jo_t</a></li>
<li><a href="#org6b18cea">collect_dict_jo_t::collect_dict_jo_t</a></li>
<li><a href="#orgc18d860">collect_dict_jo_t::copy</a></li>
<li><a href="#orga3b218f">collect_dict_jo_t::exe</a></li>
<li><a href="#org2f2c8c2">collect_dict_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#orgb9d2d3e">dict_compile</a></li>
</ul>
</li>
<li><a href="#org9cdcf30">keyword_compile</a>
<ul>
<li><a href="#orga409583">keyword</a>
<ul>
<li><a href="#org9e4470d">keyword_fn</a></li>
<li><a href="#orga7464da">keyword_o</a></li>
<li><a href="#org7edefc8">keyword_o::keyword_o</a></li>
<li><a href="#orgfac6653">keyword_o::eq</a></li>
<li><a href="#orgdf9b77f">keyword_p</a></li>
<li><a href="#org40f51cf">define_keyword</a></li>
<li><a href="#orgd028fc4">keyword_sexp_p</a></li>
<li><a href="#org50285b6">keyword_fn_from_name</a></li>
</ul>
</li>
<li><a href="#org3770d55">keyword_compile</a></li>
</ul>
</li>
<li><a href="#org15fb0c7">macro_compile</a>
<ul>
<li><a href="#org6cf06f">macro</a>
<ul>
<li><a href="#org1583a5f">macro_o</a></li>
<li><a href="#orge1a1154">macro_o::macro_o</a></li>
<li><a href="#org6c18f61">make_macro</a></li>
<li><a href="#org23f6af">macro_p</a></li>
<li><a href="#orgb5f9da7">as_macro</a></li>
<li><a href="#org93768f1">macro_o::eq</a></li>
<li><a href="#org982efc6">forward declaration of sexp_eval</a></li>
<li><a href="#org9fa6a33">macro_sexp_p</a></li>
<li><a href="#org5a0a71e">macro_eval</a></li>
<li><a href="#org7babf49">define_prim_macro</a></li>
</ul>
</li>
<li><a href="#org6d0a4d2">macro_compile</a></li>
</ul>
</li>
<li><a href="#org318c9e0">call_compile</a>
<ul>
<li><a href="#org8679de3">apply_jo</a>
<ul>
<li><a href="#org836dae8">apply_jo_t</a></li>
<li><a href="#org7d86038">apply_jo_t::apply_jo_t</a></li>
<li><a href="#org5d5bdf0">apply_jo_t::copy</a></li>
<li><a href="#org4707048">apply_jo_t::exe</a></li>
<li><a href="#org3bb23b">apply_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#orgeabfd7c">arity_of_body</a></li>
<li><a href="#org96f8be1">call_compile</a></li>
</ul>
</li>
<li><a href="#orgc595d3a">call_with_arg_dict_compile</a>
<ul>
<li><a href="#org79b5246">apply_to_arg_dict_jo</a>
<ul>
<li><a href="#orgbce206a">apply_to_arg_dict_jo_t</a></li>
<li><a href="#orgc1b210">apply_to_arg_dict_jo_t::copy</a></li>
<li><a href="#orgd024227">apply_to_arg_dict_jo_t::exe</a></li>
<li><a href="#org31c7d37">apply_to_arg_dict_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#org77ab709">apply_to_arg_dict</a>
<ul>
<li><a href="#org8d9609e">closure_o::apply_to_arg_dict</a></li>
<li><a href="#org18ca2f8">prim_o::apply_to_arg_dict</a></li>
<li><a href="#org952ca9d">data_cons_o::apply_to_arg_dict</a></li>
</ul>
</li>
<li><a href="#orgc4c8836">call_with_arg_dict_sexp_p</a></li>
<li><a href="#orgda217bf">call_with_arg_dict_compile</a></li>
</ul>
</li>
<li><a href="#orgcbacaef">sexp_compile</a></li>
<li><a href="#org782e18c">sexp_list_compile</a></li>
</ul>
</li>
<li><a href="#org9397074">run</a>
<ul>
<li><a href="#org3427d59">top_keyword</a>
<ul>
<li><a href="#org7cd8cd9">top_keyword_fn</a></li>
<li><a href="#org8e85f99">top_keyword_o</a></li>
<li><a href="#orge584764">top_keyword_o::top_keyword_o</a></li>
<li><a href="#org5bb57b2">top_keyword_o::eq</a></li>
<li><a href="#org2db80b9">top_keyword_p</a></li>
<li><a href="#orgea131f1">define_top_keyword</a></li>
<li><a href="#org3aa3b23">top_keyword_sexp_p</a></li>
<li><a href="#orgadf9bf3">top_keyword_fn_from_name</a></li>
</ul>
</li>
<li><a href="#org7ba13c4">jojo_run</a></li>
<li><a href="#org83970cc">jojo_eval</a></li>
<li><a href="#org7d019ce">jojo_run_in_new_frame</a></li>
<li><a href="#orgac74c57">jojo_eval_in_new_frame</a></li>
<li><a href="#orged0311a">sexp_run</a></li>
<li><a href="#orgf263bd4">sexp_list_run</a></li>
<li><a href="#orgdd447e9">sexp_eval</a></li>
<li><a href="#orgc07a754">top_sexp_run</a></li>
<li><a href="#orgadc840e">top_sexp_list_run</a></li>
<li><a href="#org1fdeafd">code_run</a></li>
<li><a href="#org3a603ae">code_from_module_path</a></li>
<li><a href="#orgdcd1862">respect_current_dir</a></li>
<li><a href="#org4954a55">respect_module_path</a></li>
<li><a href="#orga640290">env_from_module_path</a></li>
</ul>
</li>
<li><a href="#org33d735e">(=)</a>
<ul>
<li><a href="#org18eca1a">prefix_of_string</a></li>
<li><a href="#org1ec6551">name_of_string</a></li>
<li><a href="#org6c63b6e">(= &lt;name&gt; (data &#x2026;))</a>
<ul>
<li><a href="#orgb29e543">assign_data_p</a></li>
<li><a href="#org5f4ccb6">tk_assign_data</a></li>
</ul>
</li>
<li><a href="#org3e3cd90">(= &lt;name&gt; (data &lt;: [&#x2026;] &#x2026;))</a>
<ul>
<li><a href="#org653ceb">assign_data_inherit_p</a></li>
<li><a href="#orgdc38030">tagging_name_vect</a></li>
<li><a href="#orgf50af37"><span class="todo _todo_">[todo]</span> tk_assign_data_inherit</a></li>
</ul>
</li>
<li><a href="#org2bc18d1">(= &lt;name&gt; (data :&gt; [&#x2026;] &#x2026;))</a>
<ul>
<li><a href="#orgf9bb96d">assign_data_union_p</a></li>
<li><a href="#orgac49034"><span class="todo _todo_">[todo]</span> tk_assign_data_union</a></li>
</ul>
</li>
<li><a href="#org637166c">(= (&lt;name&gt; &#x2026;) &#x2026;)</a>
<ul>
<li><a href="#org458dd26">assign_lambda_sugar_p</a></li>
<li><a href="#org2a9781d">assign_lambda_desugar</a></li>
</ul>
</li>
<li><a href="#orgb497a29">(= &lt;name&gt; &#x2026;)</a>
<ul>
<li><a href="#org6d3155c">sexp_substitute_recur</a></li>
<li><a href="#org7606b90">sexp_patch_this</a></li>
<li><a href="#org90edd04">tk_assign_value</a></li>
</ul>
</li>
<li><a href="#org2f556e5">tk_assign</a></li>
</ul>
</li>
<li><a href="#orgfea8956">stack</a>
<ul>
<li><a href="#org9e3406e">stack_word_p</a></li>
</ul>
</li>
<li><a href="#org1c15f24">syntax</a>
<ul>
<li><a href="#org4d939f2">(lambda)</a>
<ul>
<li><a href="#orgbe76844">lambda_jo</a>
<ul>
<li><a href="#org4bdb212">lambda_jo_t</a></li>
<li><a href="#orgb0682e9">lambda_jo_t::lambda_jo_t</a></li>
<li><a href="#org9d0ff12">lambda_jo_t::copy</a></li>
<li><a href="#org20a1f6">lambda_jo_t::exe</a></li>
<li><a href="#org7249e3">lambda_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#org26d1599">body_patch_drop</a></li>
<li><a href="#orgc4cc90d">obj_vector_to_name_vector</a></li>
<li><a href="#org7478ee2">k_lambda</a></li>
</ul>
</li>
<li><a href="#org5919095">(macro)</a>
<ul>
<li><a href="#org3ed4244">macro_maker_jo</a>
<ul>
<li><a href="#orgc244b64">macro_maker_jo_t</a></li>
<li><a href="#org622580">macro_maker_jo_t::copy</a></li>
<li><a href="#org8e17ce5">macro_maker_jo_t::exe</a></li>
<li><a href="#org60bab9">macro_maker_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#orgb7e318f">k_macro</a></li>
</ul>
</li>
<li><a href="#orgeeda417">(case)</a>
<ul>
<li><a href="#orga20b9e8">case_jo</a>
<ul>
<li><a href="#orga209b4b">case_jo_t</a></li>
<li><a href="#orgeae4213">case_jo_t::case_jo_t</a></li>
<li><a href="#org7ec14ea">case_jo_t::has_default_jojo_p</a></li>
<li><a href="#org58b823f">case_jo_t::copy</a></li>
<li><a href="#orgfaa25d5">case_jo_t::exe</a></li>
<li><a href="#org7539bde"><span class="todo _todo_">[todo]</span> case_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#orgf837f29">case_compile</a></li>
<li><a href="#orgcdd5aab">k_case</a></li>
</ul>
</li>
<li><a href="#org2cdfc00">(quote)</a>
<ul>
<li><a href="#org954e94">sexp_qoute_compile</a></li>
<li><a href="#org8debba1">k_quote</a></li>
</ul>
</li>
<li><a href="#org329a3fc">(*) &#x2013; literal list</a>
<ul>
<li><a href="#orgacb039">collect_list_jo</a>
<ul>
<li><a href="#org9bea9b0">collect_list_jo_t</a></li>
<li><a href="#org5bae854">collect_list_jo_t::collect_list_jo_t</a></li>
<li><a href="#org7291f76">collect_list_jo_t::copy</a></li>
<li><a href="#orgb4fcb88">collect_list_jo_t::exe</a></li>
<li><a href="#orga7bb35a">collect_list_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#org8af0aab">k_list</a></li>
</ul>
</li>
<li><a href="#orgfdeb9e0">(note)</a>
<ul>
<li><a href="#org6e7c259">k_note</a></li>
</ul>
</li>
<li><a href="#org37791e6">(assert)</a>
<ul>
<li><a href="#orgc099777">assert_jo</a>
<ul>
<li><a href="#orgc5709cc">assert_jo_t</a></li>
<li><a href="#org90aba89">assert_jo_t::assert_jo_t</a></li>
<li><a href="#orgdb34876">assert_jo_t::copy</a></li>
<li><a href="#org88d1493">assert_jo_t::exe</a></li>
<li><a href="#org8135219">assert_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#org398651a">k_assert</a></li>
</ul>
</li>
<li><a href="#orgaaf7e0d">(if)</a>
<ul>
<li><a href="#orgc7aae2e">if_jo</a>
<ul>
<li><a href="#orgd36ea3f">if_jo_t</a></li>
<li><a href="#org9f19719">if_jo_t::if_jo_t</a></li>
<li><a href="#org1cb15b7">if_jo_t::copy</a></li>
<li><a href="#org748deb7">if_jo_t::exe</a></li>
<li><a href="#orgc52d9f6">if_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#org36b34de">k_if</a></li>
</ul>
</li>
<li><a href="#org90c2b21">(when)</a>
<ul>
<li><a href="#orgc979cd8">when_jo</a>
<ul>
<li><a href="#org1dfc491">when_jo_t</a></li>
<li><a href="#org536c11f">when_jo_t::when_jo_t</a></li>
<li><a href="#org72f628f">when_jo_t::copy</a></li>
<li><a href="#org27ada03">when_jo_t::exe</a></li>
<li><a href="#org54eb208">when_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#orgb226c15">k_when</a></li>
</ul>
</li>
<li><a href="#org682010c">(begin)</a>
<ul>
<li><a href="#orge084e9d">k_begin</a></li>
</ul>
</li>
<li><a href="#org301b6c1">(let)</a>
<ul>
<li><a href="#orgd03d358">m_let</a></li>
</ul>
</li>
<li><a href="#org1168bb3">(quasiquote)</a>
<ul>
<li><a href="#orgf69ef9e">sexp_quote_and_unquote</a></li>
<li><a href="#orgd41a2ed">sexp_list_quote_and_unquote</a></li>
<li><a href="#org2188656">m_quasiquote</a></li>
</ul>
</li>
<li><a href="#org2752ede">(and)</a>
<ul>
<li><a href="#org10c6bde">sexp_list_and</a></li>
<li><a href="#orgb04335c">m_and</a></li>
</ul>
</li>
<li><a href="#orgdc03720">(or)</a>
<ul>
<li><a href="#org3f7525d">sexp_list_or</a></li>
<li><a href="#org8be4ec">m_or</a></li>
</ul>
</li>
<li><a href="#orgb1bf678">(cond)</a>
<ul>
<li><a href="#org6a956c0">vect_list_cond</a></li>
<li><a href="#org59a1e76">m_cond</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgb4f5976">expose</a>
<ul>
<li><a href="#org4d6b60d">def_type</a></li>
<li><a href="#orgbcc702e">expose_type</a></li>
<li><a href="#org16a3c96">expose_bool</a></li>
<li><a href="#org8dd4c6c">expose_num</a>
<ul>
<li><a href="#orgc8e5d4b">expose_num_predicate</a></li>
<li><a href="#orgc6c0787">expose_num_1</a></li>
<li><a href="#org497248e">expose_num_2</a></li>
<li><a href="#org8658b38">expose_num_3</a></li>
<li><a href="#orgbe7b183">expose_num_trigonometry</a></li>
<li><a href="#org853351b">expose_num</a></li>
</ul>
</li>
<li><a href="#org4cde990">expose_str</a></li>
<li><a href="#org476aeb">expose_sym</a></li>
<li><a href="#org2f18f0b">expose_list</a>
<ul>
<li><a href="#org8c3474d">jj_cons_c</a></li>
<li><a href="#org51d0aba">expose_list</a></li>
</ul>
</li>
<li><a href="#org35c92e5">expose_vect</a></li>
<li><a href="#org8975f1c">expose_maybe</a>
<ul>
<li><a href="#org5f27a91">jj_just_c</a></li>
<li><a href="#org6b5b3f6">expose_maybe</a></li>
</ul>
</li>
<li><a href="#org30ee25b">expose_dict</a></li>
<li><a href="#orgebf8c93">expose_sexp</a></li>
<li><a href="#orge2834f">expose_top_keyword</a></li>
<li><a href="#org130cc14">expose_keyword</a></li>
<li><a href="#org180fb6f">expose_system</a></li>
<li><a href="#orga79ecab">expose_module</a>
<ul>
<li><a href="#org70b1595">jj_import</a></li>
<li><a href="#orgc9426d">expose_module</a></li>
</ul>
</li>
<li><a href="#org23f3c74">expose_stack</a></li>
<li><a href="#org4528bec">expose_syntax</a></li>
<li><a href="#org7349576">expose_misc</a></li>
<li><a href="#org9ce71bb">expose_core</a></li>
</ul>
</li>
<li><a href="#orgd823735">epilog</a>
<ul>
<li><a href="#orge18b0f9">test</a>
<ul>
<li><a href="#org4788bc5">test_step</a></li>
<li><a href="#org7bfa6fe">test_data</a></li>
<li><a href="#orge6bb0ed">test_apply</a></li>
<li><a href="#org9173357">test_lambda_curry</a></li>
<li><a href="#org9466a">test_data_cons</a></li>
<li><a href="#org776c12b">test_data_cons_curry</a></li>
<li><a href="#orgf5ee42">test_prim</a></li>
</ul>
</li>
<li><a href="#orge526538">test_all</a></li>
<li><a href="#orge00f67d">the_story_begins</a></li>
<li><a href="#org636930c">main</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org5ed036c" class="outline-2">
<h2 id="org5ed036c">prolog</h2>
<div class="outline-text-2" id="text-org5ed036c">
</div><div id="outline-container-org53a55e0" class="outline-3">
<h3 id="org53a55e0">include</h3>
<div class="outline-text-3" id="text-org53a55e0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;iostream&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;fstream&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;sstream&gt;</span>

<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;algorithm&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;functional&gt;</span>

<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;cassert&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;memory&gt;</span>

<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;vector&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;array&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;map&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;set&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;stack&gt;</span>

<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;cmath&gt;</span>

<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;filesystem&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org488fe55" class="outline-3">
<h3 id="org488fe55">about namespace</h3>
<div class="outline-text-3" id="text-org488fe55">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #F0DFAF; font-weight: bold;">namespace</span> <span style="color: #BFEBBF;">std</span>;

<span style="color: #F0DFAF; font-weight: bold;">namespace</span> <span style="color: #BFEBBF;">fs</span> = filesystem;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgbd2315c" class="outline-2">
<h2 id="orgbd2315c">datatype</h2>
<div class="outline-text-2" id="text-orgbd2315c">
</div><div id="outline-container-org5727d9e" class="outline-3">
<h3 id="org5727d9e">forward declaration</h3>
<div class="outline-text-3" id="text-org5727d9e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">obj_t</span>;
<span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">jo_t</span>;
<span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">env_t</span>;
<span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">box_t</span>;
<span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">jojo_t</span>;
<span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">frame_t</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org3dcfb9c" class="outline-3">
<h3 id="org3dcfb9c">datatype</h3>
<div class="outline-text-3" id="text-org3dcfb9c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">name_t</span> = string;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">tag_t</span> = size_t;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">tag_vector_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">tag_t</span>&gt;;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">name_vector_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">name_t</span>&gt;;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">name_stack_t</span> = <span style="color: #7CB8BB;">stack</span> &lt;<span style="color: #7CB8BB;">name_t</span>&gt;;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">bind_t</span> = <span style="color: #7CB8BB;">pair</span> &lt;<span style="color: #7CB8BB;">name_t</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;&gt;;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">bind_vector_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">bind_t</span>&gt;; <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">index from end</span>
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">local_scope_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">bind_vector_t</span>&gt;; <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">index from end</span>
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">jo_vector_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">jo_t</span> *&gt;;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">obj_map_t</span> = <span style="color: #7CB8BB;">map</span> &lt;<span style="color: #7CB8BB;">name_t</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;&gt;;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">obj_vector_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;&gt;;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">box_map_t</span> = <span style="color: #7CB8BB;">map</span> &lt;<span style="color: #7CB8BB;">name_t</span>, <span style="color: #7CB8BB;">box_t</span> *&gt;;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">obj_stack_t</span> = <span style="color: #7CB8BB;">stack</span> &lt;<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;&gt;;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">frame_stack_t</span> = <span style="color: #7CB8BB;">stack</span> &lt;<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">frame_t</span>&gt;&gt;;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">jojo_map_t</span> = <span style="color: #7CB8BB;">map</span> &lt;<span style="color: #7CB8BB;">tag_t</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;&gt;;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">string_vector_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">string</span>&gt; ;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">local_ref_t</span> = <span style="color: #7CB8BB;">pair</span> &lt;<span style="color: #7CB8BB;">size_t</span>, <span style="color: #7CB8BB;">size_t</span>&gt;;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">local_ref_map_t</span> = <span style="color: #7CB8BB;">map</span> &lt;<span style="color: #7CB8BB;">name_t</span>, <span style="color: #7CB8BB;">local_ref_t</span>&gt;;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">path_t</span> = <span style="color: #BFEBBF;">fs</span>::path;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">num_t</span> = <span style="color: #7CB8BB;">double</span>;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">tagged_box_t</span> = <span style="color: #7CB8BB;">pair</span> &lt;<span style="color: #7CB8BB;">name_t</span>, <span style="color: #7CB8BB;">box_t</span> *&gt;;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">tagged_box_vector_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">tagged_box_t</span>&gt;;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">tag_map_t</span> = <span style="color: #7CB8BB;">map</span> &lt;<span style="color: #7CB8BB;">name_t</span>, <span style="color: #7CB8BB;">tag_t</span>&gt;;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">symbol</span> = string;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfce0997" class="outline-3">
<h3 id="orgfce0997">obj_t</h3>
<div class="outline-text-3" id="text-orgfce0997">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag</span>;
    <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>;
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> ~<span style="color: #93E0E3;">obj_t</span> ();
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>);
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">apply_to_arg_dict</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orge1ee61d" class="outline-3">
<h3 id="orge1ee61d">jo_t</h3>
<div class="outline-text-3" id="text-orge1ee61d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> ~<span style="color: #93E0E3;">jo_t</span> ();
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org9bc03b3" class="outline-3">
<h3 id="org9bc03b3">env_t</h3>
<div class="outline-text-3" id="text-org9bc03b3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">env_t</span>
{
    <span style="color: #7CB8BB;">box_map_t</span> <span style="color: #DFAF8F;">box_map</span>;
    <span style="color: #7CB8BB;">obj_stack_t</span> <span style="color: #DFAF8F;">obj_stack</span>;
    <span style="color: #7CB8BB;">frame_stack_t</span> <span style="color: #DFAF8F;">frame_stack</span>;
    <span style="color: #7CB8BB;">tagged_box_vector_t</span> <span style="color: #DFAF8F;">tagged_box_vector</span>;
    <span style="color: #7CB8BB;">tag_map_t</span> <span style="color: #DFAF8F;">tag_map</span>;
    <span style="color: #7CB8BB;">path_t</span> <span style="color: #DFAF8F;">current_dir</span>;
    <span style="color: #7CB8BB;">path_t</span> <span style="color: #DFAF8F;">module_path</span>;
    <span style="color: #93E0E3;">env_t</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">step</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">run</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">box_map_report</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">frame_stack_report</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">obj_stack_report</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">report</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">run_with_base</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">base</span>);
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">double_report</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">step_and_report</span> ();
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org1919755" class="outline-3">
<h3 id="org1919755">box_t</h3>
<div class="outline-text-3" id="text-org1919755">
<ul class="org-ul">
<li><p>box will be used as shared raw pointer.</p></li>

<li><p>the consequence is module reload is not allowed.</p></li></ul>

<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">box_t</span>
{
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>;
    <span style="color: #7CB8BB;">bool</span> <span style="color: #DFAF8F;">empty_p</span>;
    <span style="color: #93E0E3;">box_t</span> ();
};
</pre>
</div>
</div>

<div id="outline-container-orgf24bda0" class="outline-3">
<h3 id="orgf24bda0">jojo_t</h3>
<div class="outline-text-3" id="text-orgf24bda0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">jojo_t</span>
{
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span>;
    <span style="color: #93E0E3;">jojo_t</span> (<span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span>);
    ~<span style="color: #93E0E3;">jojo_t</span> ();
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf263ea3" class="outline-3">
<h3 id="orgf263ea3">frame_t</h3>
<div class="outline-text-3" id="text-orgf263ea3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">frame_t</span>
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span>;
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>;
    <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>;
    <span style="color: #93E0E3;">frame_t</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>, <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>);
};
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orge3c9125" class="outline-2">
<h2 id="orge3c9125">utility</h2>
<div class="outline-text-2" id="text-orge3c9125">
</div><div id="outline-container-org510cadd" class="outline-3">
<h3 id="org510cadd">string</h3>
<div class="outline-text-3" id="text-org510cadd">
</div><div id="outline-container-orgd1d1aa0" class="outline-4">
<h4 id="orgd1d1aa0">string_split</h4>
<div class="outline-text-4" id="text-orgd1d1aa0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">template</span> &lt;<span style="color: #F0DFAF; font-weight: bold;">typename</span> <span style="color: #7CB8BB;">Out</span>&gt;
<span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">string_split</span> (<span style="color: #F0DFAF; font-weight: bold;">const</span> <span style="color: #7CB8BB;">string</span> &amp;<span style="color: #DFAF8F;">s</span>, <span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">delim</span>, <span style="color: #7CB8BB;">Out</span> <span style="color: #DFAF8F;">result</span>)
{
    <span style="color: #7CB8BB;">stringstream</span> <span style="color: #DFAF8F;">ss</span> (s);
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">item</span>;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (getline (ss, item, delim)) {
        *(result++) = item;
    }
}

<span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">string</span>&gt;
<span style="color: #93E0E3;">string_split</span> (<span style="color: #F0DFAF; font-weight: bold;">const</span> <span style="color: #7CB8BB;">string</span> &amp;<span style="color: #DFAF8F;">s</span>, <span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">delim</span>)
{
    <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">string</span>&gt; <span style="color: #DFAF8F;">elems</span>;
    string_split (s, delim, back_inserter (elems));
    <span style="color: #F0DFAF; font-weight: bold;">return</span> elems;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga084aa2" class="outline-4">
<h4 id="orga084aa2">string_vector_join</h4>
<div class="outline-text-4" id="text-orga084aa2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">string_vector_join</span> (<span style="color: #7CB8BB;">string_vector_t</span> <span style="color: #DFAF8F;">string_vector</span>, <span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span> = <span style="color: #CC9393;">""</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">s</span>: string_vector) {
        str += s;
        str += c;
    }
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> str.empty ()) str.pop_back ();
    <span style="color: #F0DFAF; font-weight: bold;">return</span> str;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4ca5897" class="outline-3">
<h3 id="org4ca5897">vector_rest</h3>
<div class="outline-text-3" id="text-org4ca5897">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">template</span> &lt;<span style="color: #F0DFAF; font-weight: bold;">typename</span> <span style="color: #7CB8BB;">T</span>&gt;
<span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">T</span>&gt;
<span style="color: #93E0E3;">vector_rest</span> (<span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">T</span>&gt; <span style="color: #DFAF8F;">v</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = v.size ();
    assert (size &gt;= 1);
    <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">T</span>&gt; <span style="color: #DFAF8F;">result</span> = {};
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = v.begin () + 1;
         it != v.end ();
         it++) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = *it;
        result.push_back (obj);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> result;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org41f2ea7" class="outline-3">
<h3 id="org41f2ea7">name_vector</h3>
<div class="outline-text-3" id="text-org41f2ea7">
</div><div id="outline-container-org3d2fd4a" class="outline-4">
<h4 id="org3d2fd4a">name_vector_repr</h4>
<div class="outline-text-4" id="text-org3d2fd4a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">name_vector_repr</span> (<span style="color: #7CB8BB;">name_vector_t</span> &amp;<span style="color: #DFAF8F;">name_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (name_vector.size () == 0) {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"["</span>;
        repr += <span style="color: #CC9393;">"]"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"["</span>;
        <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span>: name_vector) {
            repr += name;
            repr += <span style="color: #CC9393;">" "</span>;
        }
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> repr.empty ()) repr.pop_back ();
        repr += <span style="color: #CC9393;">"]"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc840eec" class="outline-3">
<h3 id="orgc840eec">bind</h3>
<div class="outline-text-3" id="text-orgc840eec">
</div><div id="outline-container-orgff329d6" class="outline-4">
<h4 id="orgff329d6">bind_eq</h4>
<div class="outline-text-4" id="text-orgff329d6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">bind_eq</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">bind_t</span> &amp;<span style="color: #DFAF8F;">lhs</span>,
    <span style="color: #7CB8BB;">bind_t</span> &amp;<span style="color: #DFAF8F;">rhs</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lhs.first != rhs.first) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> lhs.second-&gt;eq (env, rhs.second);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8ba013e" class="outline-3">
<h3 id="org8ba013e">bind_vector</h3>
<div class="outline-text-3" id="text-org8ba013e">
</div><div id="outline-container-org23f8656" class="outline-4">
<h4 id="org23f8656">bind_vector_repr</h4>
<div class="outline-text-4" id="text-org23f8656">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">bind_vector_repr</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">bind_vector_t</span> <span style="color: #DFAF8F;">bind_vector</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = bind_vector.rbegin ();
         it != bind_vector.rend ();
         it++) {
        repr += <span style="color: #CC9393;">"("</span>;
        repr += to_string (distance (bind_vector.rbegin (), it));
        repr += <span style="color: #CC9393;">" "</span>;
        repr += it-&gt;first;
        repr += <span style="color: #CC9393;">" = "</span>;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (obj == <span style="color: #BFEBBF;">nullptr</span>)
            repr += <span style="color: #CC9393;">"_"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">else</span>
            repr += obj-&gt;repr (env);
        repr += <span style="color: #CC9393;">") "</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org78dade3" class="outline-4">
<h4 id="org78dade3">number_of_obj_in_bind_vector</h4>
<div class="outline-text-4" id="text-org78dade3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">size_t</span>
<span style="color: #93E0E3;">number_of_obj_in_bind_vector</span> (<span style="color: #7CB8BB;">bind_vector_t</span> &amp;<span style="color: #DFAF8F;">bind_vector</span>)
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">sum</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = bind_vector.begin ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = bind_vector.end ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++)
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (it-&gt;second)
            sum++;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> sum;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1a57b2e" class="outline-4">
<h4 id="org1a57b2e">bind_vector_insert_obj</h4>
<div class="outline-text-4" id="text-org1a57b2e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">bind_vector_insert_obj</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">bind_vector_t</span> &amp;<span style="color: #DFAF8F;">bind_vector</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = bind_vector.rbegin ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = bind_vector.rend ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++) {
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (it-&gt;second == <span style="color: #BFEBBF;">nullptr</span>) {
            it-&gt;second = obj;
            <span style="color: #F0DFAF; font-weight: bold;">return</span>;
        }
    }
    cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : bind_vector_insert_obj"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    cout &lt;&lt; <span style="color: #CC9393;">"  the bind_vector is filled"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    exit (1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org60717b4" class="outline-4">
<h4 id="org60717b4">bind_vector_merge_obj_vector</h4>
<div class="outline-text-4" id="text-org60717b4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bind_vector_t</span>
<span style="color: #93E0E3;">bind_vector_merge_obj_vector</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">bind_vector_t</span> &amp;<span style="color: #DFAF8F;">old_bind_vector</span>,
    <span style="color: #7CB8BB;">obj_vector_t</span> &amp;<span style="color: #DFAF8F;">obj_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bind_vector</span> = old_bind_vector;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span>: obj_vector)
        bind_vector_insert_obj (env, bind_vector, obj);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> bind_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5550dd5" class="outline-4">
<h4 id="org5550dd5">bind_vector_insert_obj_with_name</h4>
<div class="outline-text-4" id="text-org5550dd5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">bind_vector_insert_obj_with_name</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">bind_vector_t</span> &amp;<span style="color: #DFAF8F;">bind_vector</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>,
    <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = bind_vector.rbegin ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = bind_vector.rend ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++) {
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (it-&gt;first == name) {
            it-&gt;second = obj;
            <span style="color: #F0DFAF; font-weight: bold;">return</span>;
        }
    }
    cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : bind_vector_insert_obj_with_name"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    cout &lt;&lt; <span style="color: #CC9393;">"  name not found in the bind_vector"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    cout &lt;&lt; <span style="color: #CC9393;">"  name : "</span> &lt;&lt; name &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    cout &lt;&lt; <span style="color: #CC9393;">"  bind_vector : "</span>
         &lt;&lt; bind_vector_repr (env, bind_vector) &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    exit (1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5dd8a6f" class="outline-4">
<h4 id="org5dd8a6f">bind_vector_merge_obj_map</h4>
<div class="outline-text-4" id="text-org5dd8a6f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bind_vector_t</span>
<span style="color: #93E0E3;">bind_vector_merge_obj_map</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">bind_vector_t</span> &amp;<span style="color: #DFAF8F;">old_bind_vector</span>,
    <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bind_vector</span> = old_bind_vector;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: obj_map) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = kv.first;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = kv.second;
        bind_vector_insert_obj_with_name (
            env,
            bind_vector,
            obj,
            name);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> bind_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org96cc1b3" class="outline-4">
<h4 id="org96cc1b3">bind_vector_from_name_vector</h4>
<div class="outline-text-4" id="text-org96cc1b3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bind_vector_t</span>
<span style="color: #93E0E3;">bind_vector_from_name_vector</span> (<span style="color: #7CB8BB;">name_vector_t</span> &amp;<span style="color: #DFAF8F;">name_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bind_vector</span> = bind_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = name_vector.rbegin ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = name_vector.rend ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++)
        bind_vector.push_back (make_pair (*it, <span style="color: #BFEBBF;">nullptr</span>));
    <span style="color: #F0DFAF; font-weight: bold;">return</span> bind_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf2a17e8" class="outline-4">
<h4 id="orgf2a17e8">bind_vector_eq</h4>
<div class="outline-text-4" id="text-orgf2a17e8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">bind_vector_eq</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">bind_vector_t</span> &amp;<span style="color: #DFAF8F;">lhs</span>,
    <span style="color: #7CB8BB;">bind_vector_t</span> &amp;<span style="color: #DFAF8F;">rhs</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lhs.size () != rhs.size ()) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = lhs.size ();
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (index &lt; size) {
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> bind_eq (env, lhs [index], rhs [index]))
            <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
        index++;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge345a26" class="outline-3">
<h3 id="orge345a26">obj_vector</h3>
<div class="outline-text-3" id="text-orge345a26">
</div><div id="outline-container-org89fad28" class="outline-4">
<h4 id="org89fad28">pick_up_obj_vector</h4>
<div class="outline-text-4" id="text-org89fad28">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">obj_vector_t</span>
<span style="color: #93E0E3;">pick_up_obj_vector</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">counter</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_vector</span> = obj_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (counter &gt; 0) {
        counter--;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
        obj_vector.push_back (obj);
        env.obj_stack.pop ();
    }
    reverse (obj_vector.begin (),
             obj_vector.end ());
    <span style="color: #F0DFAF; font-weight: bold;">return</span> obj_vector;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1e1495f" class="outline-3">
<h3 id="org1e1495f">local_scope</h3>
<div class="outline-text-3" id="text-org1e1495f">
</div><div id="outline-container-org7d5686f" class="outline-4">
<h4 id="org7d5686f">local_scope_eq</h4>
<div class="outline-text-4" id="text-org7d5686f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">local_scope_eq</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">lhs</span>,
    <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">rhs</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lhs.size () != rhs.size ()) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = lhs.size ();
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (index &lt; size) {
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> bind_vector_eq (env, lhs [index], rhs [index]))
            <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
        index++;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org386144b" class="outline-4">
<h4 id="org386144b">local_scope_extend</h4>
<div class="outline-text-4" id="text-org386144b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">local_scope_t</span>
<span style="color: #93E0E3;">local_scope_extend</span> (
    <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">old_local_scope</span>,
    <span style="color: #7CB8BB;">bind_vector_t</span> <span style="color: #DFAF8F;">bind_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_scope</span> = old_local_scope;
    local_scope.push_back (bind_vector);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> local_scope;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge7ca504" class="outline-4">
<h4 id="orge7ca504">local_scope_repr</h4>
<div class="outline-text-4" id="text-orge7ca504">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">local_scope_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
    repr += <span style="color: #CC9393;">"  - ["</span>;
    repr += to_string (local_scope.size ());
    repr += <span style="color: #CC9393;">"] "</span>;
    repr += <span style="color: #CC9393;">"local_scope - "</span>;
    repr += <span style="color: #CC9393;">"\n"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = local_scope.rbegin ();
         it != local_scope.rend ();
         it++) {
        repr += <span style="color: #CC9393;">"    "</span>;
        repr += to_string (distance (local_scope.rbegin (), it));
        repr += <span style="color: #CC9393;">" "</span>;
        repr += bind_vector_repr (env, *it);
        repr += <span style="color: #CC9393;">"\n"</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3e7c870" class="outline-3">
<h3 id="org3e7c870">obj_map</h3>
<div class="outline-text-3" id="text-org3e7c870">
</div><div id="outline-container-org1cb9a3" class="outline-4">
<h4 id="org1cb9a3">obj_map_eq</h4>
<div class="outline-text-4" id="text-org1cb9a3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">obj_map_eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">lhs</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">rhs</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lhs.size () != rhs.size ()) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: lhs) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = kv.first;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = rhs.find (name);
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (it == rhs.end ()) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> kv.second-&gt;eq (env, it-&gt;second)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1d26921" class="outline-4">
<h4 id="org1d26921">obj_map_repr</h4>
<div class="outline-text-4" id="text-org1d26921">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">obj_map_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: obj_map) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = kv.first;
        repr += name;
        repr += <span style="color: #CC9393;">" = "</span>;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = kv.second;
        repr += obj-&gt;repr (env);
        repr += <span style="color: #CC9393;">" "</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> repr.empty ()) repr.pop_back ();
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbd68bb3" class="outline-4">
<h4 id="orgbd68bb3">name_vector_obj_map_lack</h4>
<div class="outline-text-4" id="text-orgbd68bb3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_vector_t</span>
<span style="color: #93E0E3;">name_vector_obj_map_lack</span> (
    <span style="color: #7CB8BB;">name_vector_t</span> &amp;<span style="color: #DFAF8F;">old_name_vector</span>,
    <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = name_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span>: old_name_vector) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = obj_map.find (name);
        <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">not found == lack</span>
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (it == obj_map.end ())
            name_vector.push_back (name);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> name_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org587e476" class="outline-4">
<h4 id="org587e476">name_vector_obj_map_arity_lack</h4>
<div class="outline-text-4" id="text-org587e476">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_vector_t</span>
<span style="color: #93E0E3;">name_vector_obj_map_arity_lack</span> (
    <span style="color: #7CB8BB;">name_vector_t</span> &amp;<span style="color: #DFAF8F;">old_name_vector</span>,
    <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>,
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = name_vector_obj_map_lack
        (old_name_vector, obj_map);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack</span> = name_vector.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">counter</span> = lack - arity;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (counter &gt; 0) {
        counter--;
        name_vector.pop_back ();
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> name_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3897ce8" class="outline-4">
<h4 id="org3897ce8">pick_up_obj_map_and_merge</h4>
<div class="outline-text-4" id="text-org3897ce8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">obj_map_t</span>
<span style="color: #93E0E3;">pick_up_obj_map_and_merge</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">name_vector_t</span> &amp;<span style="color: #DFAF8F;">lack_name_vector</span>,
    <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">old_obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = old_obj_map;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = lack_name_vector.rbegin ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = lack_name_vector.rend ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++) {
        <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span> = *it;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
        env.obj_stack.pop ();
        obj_map [name] = obj;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> obj_map;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb9316bb" class="outline-4">
<h4 id="orgb9316bb">name_vector_and_obj_map_repr</h4>
<div class="outline-text-4" id="text-orgb9316bb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">name_vector_and_obj_map_repr</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">name_vector_t</span> &amp;<span style="color: #DFAF8F;">name_vector</span>,
    <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">name</span>: name_vector) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = obj_map.find (name);
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (it == obj_map.end ()) {
            repr += name;
            repr += <span style="color: #CC9393;">" = _ "</span>;
        }
    }
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: obj_map) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = kv.first;
        repr += name;
        repr += <span style="color: #CC9393;">" = "</span>;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = kv.second;
        repr += obj-&gt;repr (env);
        repr += <span style="color: #CC9393;">" "</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> repr.empty ()) repr.pop_back ();
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga53fc6e" class="outline-4">
<h4 id="orga53fc6e">obj_map_merge</h4>
<div class="outline-text-4" id="text-orga53fc6e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">obj_map_t</span>
<span style="color: #93E0E3;">obj_map_merge</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">ante</span>,
    <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">succ</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = obj_map_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: ante) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = kv.first;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = kv.second;
        obj_map [name] = obj;
    }
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: succ) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = kv.first;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = kv.second;
        obj_map [name] = obj;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> obj_map;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8b24077" class="outline-3">
<h3 id="org8b24077">name</h3>
<div class="outline-text-3" id="text-org8b24077">
</div><div id="outline-container-org3d1b291" class="outline-4">
<h4 id="org3d1b291">name_t2c</h4>
<div class="outline-text-4" id="text-org3d1b291">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_t</span>
<span style="color: #93E0E3;">name_t2c</span> (<span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">type_name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = type_name;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = name.size ();
    assert (size &gt; 2);
    assert (name [size - 1] == <span style="color: #DCDCCC; background-color: #3F3F3F;">'t</span><span style="color: #D0BF8F; font-weight: bold;">'</span>);
    assert (name [size - 2] == <span style="color: #DCDCCC; background-color: #3F3F3F;">'-</span><span style="color: #D0BF8F; font-weight: bold;">'</span>);
    name.pop_back ();
    name += <span style="color: #DCDCCC; background-color: #3F3F3F;">'c</span><span style="color: #D0BF8F; font-weight: bold;">'</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> name;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgff75370" class="outline-4">
<h4 id="orgff75370">name_t2p</h4>
<div class="outline-text-4" id="text-orgff75370">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_t</span>
<span style="color: #93E0E3;">name_t2p</span> (<span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">type_name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = type_name;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = name.size ();
    assert (size &gt; 2);
    assert (name [size - 1] == <span style="color: #DCDCCC; background-color: #3F3F3F;">'t</span><span style="color: #D0BF8F; font-weight: bold;">'</span>);
    assert (name [size - 2] == <span style="color: #DCDCCC; background-color: #3F3F3F;">'-</span><span style="color: #D0BF8F; font-weight: bold;">'</span>);
    name.pop_back ();
    name += <span style="color: #DCDCCC; background-color: #3F3F3F;">'p</span><span style="color: #D0BF8F; font-weight: bold;">'</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> name;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7668429" class="outline-4">
<h4 id="org7668429">name_c2t</h4>
<div class="outline-text-4" id="text-org7668429">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_t</span>
<span style="color: #93E0E3;">name_c2t</span> (<span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">data_name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = data_name;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = name.size ();
    assert (size &gt; 2);
    assert (name [size - 1] == <span style="color: #DCDCCC; background-color: #3F3F3F;">'c</span><span style="color: #D0BF8F; font-weight: bold;">'</span>);
    assert (name [size - 2] == <span style="color: #DCDCCC; background-color: #3F3F3F;">'-</span><span style="color: #D0BF8F; font-weight: bold;">'</span>);
    name.pop_back ();
    name += <span style="color: #DCDCCC; background-color: #3F3F3F;">'t</span><span style="color: #D0BF8F; font-weight: bold;">'</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> name;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc9881f3" class="outline-4">
<h4 id="orgc9881f3">name_p2t</h4>
<div class="outline-text-4" id="text-orgc9881f3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_t</span>
<span style="color: #93E0E3;">name_p2t</span> (<span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">pred_name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = pred_name;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = name.size ();
    assert (size &gt; 2);
    assert (name [size - 1] == <span style="color: #DCDCCC; background-color: #3F3F3F;">'p</span><span style="color: #D0BF8F; font-weight: bold;">'</span>);
    assert (name [size - 2] == <span style="color: #DCDCCC; background-color: #3F3F3F;">'-</span><span style="color: #D0BF8F; font-weight: bold;">'</span>);
    name.pop_back ();
    name += <span style="color: #DCDCCC; background-color: #3F3F3F;">'t</span><span style="color: #D0BF8F; font-weight: bold;">'</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> name;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1428c10" class="outline-3">
<h3 id="org1428c10">frame</h3>
<div class="outline-text-3" id="text-org1428c10">
</div><div id="outline-container-orgc0b7a52" class="outline-4">
<h4 id="orgc0b7a52">new_frame_from_jojo</h4>
<div class="outline-text-4" id="text-orgc0b7a52">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">frame_t</span>&gt;
<span style="color: #93E0E3;">new_frame_from_jojo</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">frame_t</span>&gt;
        (jojo, <span style="color: #7CB8BB;">local_scope_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org32738c" class="outline-4">
<h4 id="org32738c">new_frame_from_jo_vector</h4>
<div class="outline-text-4" id="text-org32738c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">frame_t</span>&gt;
<span style="color: #93E0E3;">new_frame_from_jo_vector</span> (<span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">frame_t</span>&gt;
        (jojo, <span style="color: #7CB8BB;">local_scope_t</span> ());
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgcecab16" class="outline-3">
<h3 id="orgcecab16">local_ref</h3>
<div class="outline-text-3" id="text-orgcecab16">
</div><div id="outline-container-orgac4eeba" class="outline-4">
<h4 id="orgac4eeba">local_ref_map_extend</h4>
<div class="outline-text-4" id="text-orgac4eeba">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">local_ref_map_t</span>
<span style="color: #93E0E3;">local_ref_map_extend</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">old_local_ref_map</span>,
    <span style="color: #7CB8BB;">name_vector_t</span> &amp;<span style="color: #DFAF8F;">name_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_ref_map</span> = local_ref_map_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: old_local_ref_map) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = kv.first;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">old_local_ref</span> = kv.second;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_ref</span> = local_ref_t ();
        local_ref.first = old_local_ref.first + 1;
        local_ref.second = old_local_ref.second;
        local_ref_map.insert (make_pair (name, local_ref));
    }
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = name_vector.size ();
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (index &lt; size) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = name_vector [index];
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_ref</span> = local_ref_t ();
        local_ref.first = 0;
        local_ref.second = index;
        local_ref_map.insert (make_pair (name, local_ref));
        index++;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> local_ref_map;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3e10214" class="outline-3">
<h3 id="org3e10214">assert</h3>
<div class="outline-text-3" id="text-org3e10214">
</div><div id="outline-container-orgc863d2" class="outline-4">
<h4 id="orgc863d2">assert_pop_eq</h4>
<div class="outline-text-4" id="text-orgc863d2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">assert_pop_eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = env.obj_stack.top ();
    assert (obj-&gt;eq (env, that));
    env.obj_stack.pop ();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org36eeede" class="outline-4">
<h4 id="org36eeede">assert_tos_eq</h4>
<div class="outline-text-4" id="text-org36eeede">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">assert_tos_eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = env.obj_stack.top ();
    assert (obj-&gt;eq (env, that));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org561ee30" class="outline-4">
<h4 id="org561ee30">assert_stack_size</h4>
<div class="outline-text-4" id="text-org561ee30">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">assert_stack_size</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">size</span>)
{
    assert (env.obj_stack.size () == size);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd98047c" class="outline-3">
<h3 id="orgd98047c">num</h3>
<div class="outline-text-3" id="text-orgd98047c">
</div><div id="outline-container-orgd210263" class="outline-4">
<h4 id="orgd210263">s2n</h4>
<div class="outline-text-4" id="text-orgd210263">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">num_t</span> <span style="color: #93E0E3;">s2n</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">s</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> stod (s);
}
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org4e902e8" class="outline-2">
<h2 id="org4e902e8">obj</h2>
<div class="outline-text-2" id="text-org4e902e8">
</div><div id="outline-container-orgbc9d4bb" class="outline-3">
<h3 id="orgbc9d4bb">obj_t::~obj_t</h3>
<div class="outline-text-3" id="text-orgbc9d4bb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">obj_t</span>::~<span style="color: #93E0E3;">obj_t</span> ()
{
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">all classes that will be derived from</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">should have a virtual or protected destructor,</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">otherwise deleting an instance via a pointer</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">to a base class results in undefined behavior.</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgffe4862" class="outline-3">
<h3 id="orgffe4862">obj_t::repr</h3>
<div class="outline-text-3" id="text-orgffe4862">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_t</span>
<span style="color: #93E0E3;">name_of_tag</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag</span>);

<span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">obj_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"#&lt;"</span> + name_of_tag (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag) + <span style="color: #CC9393;">"&gt;"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4174173" class="outline-3">
<h3 id="org4174173">obj_t::eq</h3>
<div class="outline-text-3" id="text-org4174173">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">obj_t</span>::<span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : obj_t::eq"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  eq is not implemented for  : "</span>;
        cout &lt;&lt; obj-&gt;tag &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5f86e81" class="outline-3">
<h3 id="org5f86e81">obj_t::apply</h3>
<div class="outline-text-3" id="text-org5f86e81">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">obj_t</span>::<span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>)
{
    cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : obj_t::apply"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    cout &lt;&lt; <span style="color: #CC9393;">"  applying non applicable object"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    cout &lt;&lt; <span style="color: #CC9393;">"  tag : "</span> &lt;&lt; name_of_tag (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag) &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    cout &lt;&lt; <span style="color: #CC9393;">"  obj : "</span> &lt;&lt; <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;repr (env) &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    exit (1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgde7dd72" class="outline-3">
<h3 id="orgde7dd72">obj_t::apply_to_arg_dict</h3>
<div class="outline-text-3" id="text-orgde7dd72">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">obj_t</span>::<span style="color: #93E0E3;">apply_to_arg_dict</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : obj_t::apply_to_arg_dict"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    cout &lt;&lt; <span style="color: #CC9393;">"  applying non applicable object"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    cout &lt;&lt; <span style="color: #CC9393;">"  tag : "</span> &lt;&lt; name_of_tag (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag) &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    cout &lt;&lt; <span style="color: #CC9393;">"  obj : "</span> &lt;&lt; <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;repr (env) &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    exit (1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4a44c8e" class="outline-3">
<h3 id="org4a44c8e">define</h3>
<div class="outline-text-3" id="text-org4a44c8e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">box_t</span> *
<span style="color: #93E0E3;">boxing</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>);

<span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">define</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = boxing (env, name);
    box-&gt;obj = obj;
    box-&gt;empty_p = <span style="color: #BFEBBF;">false</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org343a60d" class="outline-3">
<h3 id="org343a60d">obj_eq</h3>
<div class="outline-text-3" id="text-org343a60d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">obj_eq</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; &amp;<span style="color: #DFAF8F;">lhs</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; &amp;<span style="color: #DFAF8F;">rhs</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> lhs-&gt;eq (env, rhs);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6bf0bd7" class="outline-3">
<h3 id="org6bf0bd7">find_obj_from_name</h3>
<div class="outline-text-3" id="text-org6bf0bd7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">find_obj_from_name</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">string_vector</span> = string_split (name, <span style="color: #DCDCCC; background-color: #3F3F3F;">'.</span><span style="color: #D0BF8F; font-weight: bold;">'</span>);
    assert (string_vector.size () &gt; 0);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">first_name</span> = string_vector [0];
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.box_map.find (first_name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.box_map.end ()) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = box-&gt;obj;
        <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sub_name</span>: vector_rest (string_vector)) {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = obj-&gt;obj_map.find (sub_name);
            <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != obj-&gt;obj_map.end ()) {
                obj = it-&gt;second;
            }
            <span style="color: #F0DFAF; font-weight: bold;">else</span> {
                <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">nullptr</span>;
            }
        }
        <span style="color: #F0DFAF; font-weight: bold;">return</span> obj;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">nullptr</span>;
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgbec793b" class="outline-2">
<h2 id="orgbec793b">jo</h2>
<div class="outline-text-2" id="text-orgbec793b">
</div><div id="outline-container-org7bdb016" class="outline-3">
<h3 id="org7bdb016">jo_t::copy</h3>
<div class="outline-text-3" id="text-org7bdb016">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : jo_t::copy unknown jo"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    exit (1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf940b12" class="outline-3">
<h3 id="orgf940b12">jo_t::~jo_t</h3>
<div class="outline-text-3" id="text-orgf940b12">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">jo_t</span>::~<span style="color: #93E0E3;">jo_t</span> ()
{
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">all classes that will be derived from</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">should have a virtual or protected destructor,</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">otherwise deleting an instance via a pointer</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">to a base class results in undefined behavior.</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga4ca3ea" class="outline-3">
<h3 id="orga4ca3ea">jo_t::exe</h3>
<div class="outline-text-3" id="text-orga4ca3ea">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : unknown jo"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    exit (1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6651b8c" class="outline-3">
<h3 id="org6651b8c">jo_t::repr</h3>
<div class="outline-text-3" id="text-org6651b8c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"#&lt;unknown-jo&gt;"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org70a8282" class="outline-2">
<h2 id="org70a8282">env</h2>
<div class="outline-text-2" id="text-org70a8282">
</div><div id="outline-container-org6c92c5d" class="outline-3">
<h3 id="org6c92c5d">box</h3>
<div class="outline-text-3" id="text-org6c92c5d">
</div><div id="outline-container-org3d6f20f" class="outline-4">
<h4 id="org3d6f20f">box_t::box_t</h4>
<div class="outline-text-4" id="text-org3d6f20f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">box_t</span>::<span style="color: #93E0E3;">box_t</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;empty_p = <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org38e32f5" class="outline-4">
<h4 id="org38e32f5">boxing</h4>
<div class="outline-text-4" id="text-org38e32f5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">box_t</span> *
<span style="color: #93E0E3;">boxing</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.box_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.box_map.end ()) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> box;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">box_t</span> ();
        env.box_map [name] = box;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> box;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga1a77fa" class="outline-4">
<h4 id="orga1a77fa">name_of_box</h4>
<div class="outline-text-4" id="text-orga1a77fa">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_t</span>
<span style="color: #93E0E3;">name_of_box</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: env.box_map) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = kv.first;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (kv.second == box) {
            <span style="color: #F0DFAF; font-weight: bold;">return</span> name;
        }
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"#non-name"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org796c03b" class="outline-3">
<h3 id="org796c03b">jojo</h3>
<div class="outline-text-3" id="text-org796c03b">
</div><div id="outline-container-orgb6fe25a" class="outline-4">
<h4 id="orgb6fe25a">jojo_t::jojo_t</h4>
<div class="outline-text-4" id="text-orgb6fe25a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">jojo_t</span>::
<span style="color: #93E0E3;">jojo_t</span> (<span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jo_vector = jo_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2197559" class="outline-4">
<h4 id="org2197559">jojo_t::~jojo_t</h4>
<div class="outline-text-4" id="text-org2197559">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">jojo_t</span>::
~<span style="color: #93E0E3;">jojo_t</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #7CB8BB;">jo_t</span> *<span style="color: #DFAF8F;">jo_ptr</span>: <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jo_vector)
        <span style="color: #F0DFAF; font-weight: bold;">delete</span> jo_ptr;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdfd41ca" class="outline-4">
<h4 id="orgdfd41ca">jojo_append</h4>
<div class="outline-text-4" id="text-orgdfd41ca">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">jojo_append</span> (
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">ante</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">succ</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jo_vector</span> = jo_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span>: ante-&gt;jo_vector) jo_vector.push_back (x-&gt;copy ());
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span>: succ-&gt;jo_vector) jo_vector.push_back (x-&gt;copy ());
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeed0cce" class="outline-4">
<h4 id="orgeed0cce">jojo_repr</h4>
<div class="outline-text-4" id="text-orgeed0cce">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">jojo_repr</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>)
{
    assert (jojo-&gt;jo_vector.size () != 0);
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">jo</span>: jojo-&gt;jo_vector) {
        repr += jo-&gt;repr (env);
        repr += <span style="color: #CC9393;">" "</span>;
    }
    repr.pop_back ();
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6c053db" class="outline-3">
<h3 id="org6c053db">frame</h3>
<div class="outline-text-3" id="text-org6c053db">
</div><div id="outline-container-org73699a5" class="outline-4">
<h4 id="org73699a5">frame_t::frame_t</h4>
<div class="outline-text-4" id="text-org73699a5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">frame_t</span>::
<span style="color: #93E0E3;">frame_t</span> (
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>,
    <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;index = 0;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo = jojo;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;local_scope = local_scope;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2b9f8e0" class="outline-4">
<h4 id="org2b9f8e0">jojo_print</h4>
<div class="outline-text-4" id="text-org2b9f8e0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">jojo_print</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">jo</span>: jojo-&gt;jo_vector) {
        cout &lt;&lt; jo-&gt;repr (env) &lt;&lt; <span style="color: #CC9393;">" "</span>;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org953b660" class="outline-4">
<h4 id="org953b660">jojo_print_with_index</h4>
<div class="outline-text-4" id="text-org953b660">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">jojo_print_with_index</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>,
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = jojo-&gt;jo_vector.begin ();
         it != jojo-&gt;jo_vector.end ();
         it++) {
        <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">it_index</span> = it - jojo-&gt;jo_vector.begin ();
        <span style="color: #7CB8BB;">jo_t</span> *<span style="color: #DFAF8F;">jo</span> = *it;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (index == it_index) {
            cout &lt;&lt; <span style="color: #CC9393;">"-&gt;&gt; "</span> &lt;&lt; jo-&gt;repr (env) &lt;&lt; <span style="color: #CC9393;">" "</span>;
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> {
            cout &lt;&lt; jo-&gt;repr (env) &lt;&lt; <span style="color: #CC9393;">" "</span>;
        }
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org127ec61" class="outline-4">
<h4 id="org127ec61">frame_report</h4>
<div class="outline-text-4" id="text-org127ec61">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">frame_report</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">frame_t</span>&gt; <span style="color: #DFAF8F;">frame</span>)
{
    cout &lt;&lt; <span style="color: #CC9393;">"  - ["</span> &lt;&lt; frame-&gt;index+1
         &lt;&lt; <span style="color: #CC9393;">"/"</span> &lt;&lt; frame-&gt;jojo-&gt;jo_vector.size ()
         &lt;&lt; <span style="color: #CC9393;">"] "</span>;
    jojo_print_with_index (env, frame-&gt;jojo, frame-&gt;index);
    cout &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    cout &lt;&lt; local_scope_repr (env, frame-&gt;local_scope);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org91c317a" class="outline-3">
<h3 id="org91c317a">tag</h3>
<div class="outline-text-3" id="text-org91c317a">
</div><div id="outline-container-org8f933d5" class="outline-4">
<h4 id="org8f933d5">tag_name_p</h4>
<div class="outline-text-4" id="text-org8f933d5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">tag_name_p</span> (<span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = name.size ();
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (size &lt; 3) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (name [size - 1] != <span style="color: #DCDCCC; background-color: #3F3F3F;">'t</span><span style="color: #D0BF8F; font-weight: bold;">'</span>) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (name [size - 2] != <span style="color: #DCDCCC; background-color: #3F3F3F;">'-</span><span style="color: #D0BF8F; font-weight: bold;">'</span>) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org38b4bf5" class="outline-4">
<h4 id="org38b4bf5">tagging</h4>
<div class="outline-text-4" id="text-org38b4bf5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">tag_t</span>
<span style="color: #93E0E3;">tagging</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    assert (tag_name_p (name));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.tag_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.tag_map.end ()) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">tag</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> tag;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">tag</span> = env.tagged_box_vector.size ();
        env.tag_map [name] = tag;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = boxing (env, name);
        env.tagged_box_vector.push_back (make_pair (name, box));
        <span style="color: #F0DFAF; font-weight: bold;">return</span> tag;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdbc1672" class="outline-4">
<h4 id="orgdbc1672">box_of_tag</h4>
<div class="outline-text-4" id="text-orgdbc1672">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">box_t</span> *
<span style="color: #93E0E3;">box_of_tag</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (tag &gt;= env.tagged_box_vector.size ()) {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : box_of_tag"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  unknown tag : "</span> &lt;&lt; tag &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> env.tagged_box_vector [tag] .second;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org54476f1" class="outline-4">
<h4 id="org54476f1">name_of_tag</h4>
<div class="outline-text-4" id="text-org54476f1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_t</span>
<span style="color: #93E0E3;">name_of_tag</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (tag &gt;= env.tagged_box_vector.size ()) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"#&lt;unknown-tag:"</span> + to_string (tag) + <span style="color: #CC9393;">"&gt;"</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> env.tagged_box_vector [tag] .first;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc1767a9" class="outline-4">
<h4 id="orgc1767a9">null_tagged_box</h4>
<div class="outline-text-4" id="text-orgc1767a9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">tagged_box_t</span> <span style="color: #DFAF8F;">null_tagged_box</span> = make_pair (<span style="color: #CC9393;">""</span>, <span style="color: #BFEBBF;">nullptr</span>);
</pre>
</div>
</div>
</div>

<div id="outline-container-org68508f5" class="outline-4">
<h4 id="org68508f5">make_tagged_box_vector</h4>
<div class="outline-text-4" id="text-org68508f5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">tagged_box_vector_t</span>
<span style="color: #93E0E3;">make_tagged_box_vector</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">tagged_box_vector</span> = tagged_box_vector_t (64, null_tagged_box);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> tagged_box_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1ae54cb" class="outline-4">
<h4 id="org1ae54cb">preserved_tag</h4>
<div class="outline-text-4" id="text-org1ae54cb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">def_type</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>);

<span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">preserve_tag</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    env.tag_map [name] = tag;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = boxing (env, name);
    env.tagged_box_vector [tag] = make_pair (name, box);
    def_type (env, name);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6cfac5e" class="outline-4">
<h4 id="org6cfac5e">about preserved tags</h4>
<div class="outline-text-4" id="text-org6cfac5e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">closure_tag</span>      = 0;
<span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">type_tag</span>         = 1;
<span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">true_tag</span>         = 2;
<span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">false_tag</span>        = 3;
<span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">data_pred_tag</span>    = 4;
<span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">data_cons_tag</span>    = 5;
<span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">prim_tag</span>         = 6;
<span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">num_tag</span>          = 7;
<span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">str_tag</span>          = 8;
<span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">null_tag</span>         = 9;
<span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">cons_tag</span>         = 10;
<span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">vect_tag</span>         = 12;
<span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">dict_tag</span>         = 13;
<span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">module_tag</span>       = 14;
<span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">keyword_tag</span>      = 15;
<span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">macro_tag</span>        = 16;
<span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">top_keyword_tag</span>  = 17;
<span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">sym_tag</span>          = 18;
<span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">nothing_tag</span>      = 19;
<span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">just_tag</span>         = 20;
</pre>
</div>
</div>
</div>

<div id="outline-container-orga709f43" class="outline-4">
<h4 id="orga709f43">init_tagged_box_vector</h4>
<div class="outline-text-4" id="text-orga709f43">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">init_tagged_box_vector</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    preserve_tag (env, closure_tag      , <span style="color: #CC9393;">"closure-t"</span>);
    preserve_tag (env, type_tag         , <span style="color: #CC9393;">"type-t"</span>);
    preserve_tag (env, true_tag         , <span style="color: #CC9393;">"true-t"</span>);
    preserve_tag (env, false_tag        , <span style="color: #CC9393;">"false-t"</span>);
    preserve_tag (env, data_pred_tag    , <span style="color: #CC9393;">"data-pred-t"</span>);
    preserve_tag (env, data_cons_tag    , <span style="color: #CC9393;">"data-cons-t"</span>);
    preserve_tag (env, prim_tag         , <span style="color: #CC9393;">"prim-t"</span>);
    preserve_tag (env, num_tag          , <span style="color: #CC9393;">"num-t"</span>);
    preserve_tag (env, str_tag          , <span style="color: #CC9393;">"str-t"</span>);
    preserve_tag (env, null_tag         , <span style="color: #CC9393;">"null-t"</span>);
    preserve_tag (env, cons_tag         , <span style="color: #CC9393;">"cons-t"</span>);
    preserve_tag (env, vect_tag         , <span style="color: #CC9393;">"vect-t"</span>);
    preserve_tag (env, dict_tag         , <span style="color: #CC9393;">"dict-t"</span>);
    preserve_tag (env, module_tag       , <span style="color: #CC9393;">"module-t"</span>);
    preserve_tag (env, keyword_tag      , <span style="color: #CC9393;">"keyword-t"</span>);
    preserve_tag (env, macro_tag        , <span style="color: #CC9393;">"macro-t"</span>);
    preserve_tag (env, top_keyword_tag  , <span style="color: #CC9393;">"top-keyword-t"</span>);
    preserve_tag (env, sym_tag          , <span style="color: #CC9393;">"sym-t"</span>);
    preserve_tag (env, nothing_tag      , <span style="color: #CC9393;">"nothing-t"</span>);
    preserve_tag (env, just_tag         , <span style="color: #CC9393;">"just-t"</span>);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge958815" class="outline-3">
<h3 id="orge958815">env_t::env_t</h3>
<div class="outline-text-3" id="text-orge958815">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">env_t</span> ()
{
   <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;current_dir = <span style="color: #BFEBBF;">fs</span>::current_path ();
   <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tagged_box_vector = make_tagged_box_vector ();
   <span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">env</span> = *<span style="color: #F0DFAF; font-weight: bold;">this</span>;
   init_tagged_box_vector (env);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3321b2e" class="outline-3">
<h3 id="org3321b2e">env_t::step</h3>
<div class="outline-text-3" id="text-org3321b2e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">step</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">frame</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;frame_stack.top ();
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">size</span> = frame-&gt;jojo-&gt;jo_vector.size ();
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">it is assumed that jojo in frame are not empty</span>
    assert (size != 0);
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span> = frame-&gt;index;
    frame-&gt;index++;
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">handle proper tail call</span>
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (index+1 == size) <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;frame_stack.pop ();
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">since the last frame might be drop,</span>
    <span style="color: #5F7F5F;">//   </span><span style="color: #7F9F7F;">we pass last local_scope as an extra argument.</span>
    frame-&gt;jojo-&gt;jo_vector[index]-&gt;exe (*<span style="color: #F0DFAF; font-weight: bold;">this</span>, frame-&gt;local_scope);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org775b212" class="outline-3">
<h3 id="org775b212">env_t::run</h3>
<div class="outline-text-3" id="text-org775b212">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">run</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span><span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;frame_stack.empty ()) {
        <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;step ();
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb3117c7" class="outline-3">
<h3 id="orgb3117c7">env_t::box_map_report</h3>
<div class="outline-text-3" id="text-orgb3117c7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">box_map_report</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">env</span> = *<span style="color: #F0DFAF; font-weight: bold;">this</span>;
    cout &lt;&lt; <span style="color: #CC9393;">"- ["</span> &lt;&lt; env.box_map.size () &lt;&lt; <span style="color: #CC9393;">"] "</span>
         &lt;&lt; <span style="color: #CC9393;">"box_map - "</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: env.box_map) {
        cout &lt;&lt; <span style="color: #CC9393;">"  "</span> &lt;&lt; kv.first &lt;&lt; <span style="color: #CC9393;">" = "</span>;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = kv.second;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (box-&gt;empty_p)
            cout &lt;&lt; <span style="color: #CC9393;">"_"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">else</span>
            cout &lt;&lt; box-&gt;obj-&gt;repr (env);
        cout &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org659de1c" class="outline-3">
<h3 id="org659de1c">env_t::frame_stack_report</h3>
<div class="outline-text-3" id="text-org659de1c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">frame_stack_report</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">env</span> = *<span style="color: #F0DFAF; font-weight: bold;">this</span>;
    cout &lt;&lt; <span style="color: #CC9393;">"- ["</span> &lt;&lt; env.frame_stack.size () &lt;&lt; <span style="color: #CC9393;">"] "</span>
         &lt;&lt; <span style="color: #CC9393;">"frame_stack - "</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    <span style="color: #7CB8BB;">frame_stack_t</span> <span style="color: #DFAF8F;">frame_stack</span> = env.frame_stack;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> frame_stack.empty ()) {
       <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">frame</span> = frame_stack.top ();
       frame_report (env, frame);
       frame_stack.pop ();
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org35f723d" class="outline-3">
<h3 id="org35f723d">env_t::obj_stack_report</h3>
<div class="outline-text-3" id="text-org35f723d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">obj_stack_report</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">env</span> = *<span style="color: #F0DFAF; font-weight: bold;">this</span>;
    cout &lt;&lt; <span style="color: #CC9393;">"- ["</span> &lt;&lt; env.obj_stack.size () &lt;&lt; <span style="color: #CC9393;">"] "</span>
         &lt;&lt; <span style="color: #CC9393;">"obj_stack - "</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_stack</span> = env.obj_stack;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> obj_stack.empty ()) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = obj_stack.top ();
        cout &lt;&lt; <span style="color: #CC9393;">"  "</span>;
        cout &lt;&lt; obj-&gt;repr (env);
        cout &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        obj_stack.pop ();
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5c508c3" class="outline-3">
<h3 id="org5c508c3">env_t::report</h3>
<div class="outline-text-3" id="text-org5c508c3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">report</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;box_map_report ();
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;frame_stack_report ();
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_stack_report ();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org14bb1bd" class="outline-3">
<h3 id="org14bb1bd">env_t::run_with_base</h3>
<div class="outline-text-3" id="text-org14bb1bd">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">run_with_base</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">base</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;frame_stack.size () &gt; base) {
        <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;step ();
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org15b16df" class="outline-3">
<h3 id="org15b16df">env_t::double_report</h3>
<div class="outline-text-3" id="text-org15b16df">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">double_report</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;report ();
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;run ();
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;report ();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2315851" class="outline-3">
<h3 id="org2315851">env_t::step_and_report</h3>
<div class="outline-text-3" id="text-org2315851">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">step_and_report</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;step ();
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;report ();
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga166454" class="outline-2">
<h2 id="orga166454">closure</h2>
<div class="outline-text-2" id="text-orga166454">
</div><div id="outline-container-org19ba3b1" class="outline-3">
<h3 id="org19ba3b1">closure_o</h3>
<div class="outline-text-3" id="text-org19ba3b1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">closure_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>;
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>;
    <span style="color: #7CB8BB;">bind_vector_t</span> <span style="color: #DFAF8F;">bind_vector</span>;
    <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>;
    <span style="color: #93E0E3;">closure_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
               <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
               <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>,
               <span style="color: #7CB8BB;">bind_vector_t</span> <span style="color: #DFAF8F;">bind_vector</span>,
               <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>);
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">apply_to_arg_dict</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd725af1" class="outline-3">
<h3 id="orgd725af1">closure_o::closure_o</h3>
<div class="outline-text-3" id="text-orgd725af1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">closure_o</span>::
<span style="color: #93E0E3;">closure_o</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>,
    <span style="color: #7CB8BB;">bind_vector_t</span> <span style="color: #DFAF8F;">bind_vector</span>,
    <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = closure_tag;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector = name_vector;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo = jojo;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;bind_vector = bind_vector;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;local_scope = local_scope;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9023d4a" class="outline-3">
<h3 id="org9023d4a">make_closure</h3>
<div class="outline-text-3" id="text-org9023d4a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;closure_o&gt;
<span style="color: #93E0E3;">make_closure</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>,
    <span style="color: #7CB8BB;">bind_vector_t</span> <span style="color: #DFAF8F;">bind_vector</span>,
    <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;closure_o&gt; (
        env,
        name_vector,
        jojo,
        bind_vector,
        local_scope);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb8f8e39" class="outline-3">
<h3 id="orgb8f8e39">closure_o::apply</h3>
<div class="outline-text-3" id="text-orgb8f8e39">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">closure_o</span>::<span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">have</span> = number_of_obj_in_bind_vector (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;bind_vector);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack</span> = size - have;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (arity &gt; lack) {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : closure_o::apply"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  over-arity apply"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  arity &gt; lack"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  arity : "</span> &lt;&lt; arity &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  lack : "</span> &lt;&lt; lack &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_vector</span> = pick_up_obj_vector (env, arity);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bind_vector</span> = bind_vector_merge_obj_vector (
        env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;bind_vector, obj_vector);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lack == arity) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_scope</span> = local_scope_extend (
            <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;local_scope, bind_vector);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">frame</span> = make_shared &lt;<span style="color: #7CB8BB;">frame_t</span>&gt; (
            <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo, local_scope);
        env.frame_stack.push (frame);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        assert ((arity &lt; lack));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">closure</span> = make_closure (
            env,
            <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector,
            <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo,
            bind_vector,
            <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;local_scope);
        env.obj_stack.push (closure);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org884e458" class="outline-3">
<h3 id="org884e458">closure_o::eq</h3>
<div class="outline-text-3" id="text-org884e458">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">closure_o</span>::<span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">raw pointers must be eq first</span>
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span> != obj.get ()) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;closure_o&gt; (obj);
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">then scopes</span>
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (local_scope_eq
        (env,
         <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;local_scope,
         that-&gt;local_scope)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">then bindings</span>
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (bind_vector_eq
        (env,
         <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;bind_vector,
         that-&gt;bind_vector)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2446fee" class="outline-3">
<h3 id="org2446fee">closure_p</h3>
<div class="outline-text-3" id="text-org2446fee">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">closure_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == closure_tag;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org27d4fe3" class="outline-3">
<h3 id="org27d4fe3">closure_o::repr</h3>
<div class="outline-text-3" id="text-org27d4fe3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">closure_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"(closure "</span>;
    repr += name_vector_repr (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector);
    repr += <span style="color: #CC9393;">" "</span>;
    repr += jojo_repr (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo);
    repr += <span style="color: #CC9393;">"\n"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_scope</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;local_scope;
    local_scope.push_back (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;bind_vector);
    repr += local_scope_repr (env, local_scope);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> repr.empty ()) repr.pop_back ();
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> repr.empty ()) repr.pop_back ();
    repr += <span style="color: #CC9393;">")"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org90224a9" class="outline-2">
<h2 id="org90224a9">type</h2>
<div class="outline-text-2" id="text-org90224a9">
</div><div id="outline-container-org172152a" class="outline-3">
<h3 id="org172152a">type_o</h3>
<div class="outline-text-3" id="text-org172152a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">type_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag_of_type</span>;
    <span style="color: #7CB8BB;">tag_vector_t</span> <span style="color: #DFAF8F;">super_tag_vector</span>;
    <span style="color: #93E0E3;">type_o</span> (
        <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
        <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag_of_type</span>,
        <span style="color: #7CB8BB;">tag_vector_t</span> <span style="color: #DFAF8F;">super_tag_vector</span>,
        <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org2df24a1" class="outline-3">
<h3 id="org2df24a1">type_o::type_o</h3>
<div class="outline-text-3" id="text-org2df24a1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">type_o</span>::<span style="color: #93E0E3;">type_o</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag_of_type</span>,
    <span style="color: #7CB8BB;">tag_vector_t</span> <span style="color: #DFAF8F;">super_tag_vector</span>,
    <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = type_tag;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag_of_type = tag_of_type;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;super_tag_vector = super_tag_vector;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map = obj_map;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgab0eeb9" class="outline-3">
<h3 id="orgab0eeb9">make_type</h3>
<div class="outline-text-3" id="text-orgab0eeb9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;type_o&gt;
<span style="color: #93E0E3;">make_type</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag_of_type</span>,
    <span style="color: #7CB8BB;">tag_vector_t</span> <span style="color: #DFAF8F;">super_tag_vector</span>,
    <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;type_o&gt; (
        env,
        tag_of_type,
        super_tag_vector,
        obj_map);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbcb91b7" class="outline-3">
<h3 id="orgbcb91b7">as_type</h3>
<div class="outline-text-3" id="text-orgbcb91b7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;type_o&gt;
<span style="color: #93E0E3;">as_type</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> static_pointer_cast &lt;type_o&gt; (obj);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2a70919" class="outline-3">
<h3 id="org2a70919">type_o::repr</h3>
<div class="outline-text-3" id="text-org2a70919">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">type_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> name_of_tag (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag_of_type);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org78fd222" class="outline-3">
<h3 id="org78fd222">type_o::eq</h3>
<div class="outline-text-3" id="text-org78fd222">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">type_o</span>::<span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = as_type (obj);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag_of_type != that-&gt;tag_of_type) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8fb22df" class="outline-3">
<h3 id="org8fb22df">find_type_from_prefix</h3>
<div class="outline-text-3" id="text-org8fb22df">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;type_o&gt;
<span style="color: #93E0E3;">find_type_from_prefix</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">prefix</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">string_vector</span> = string_split (prefix, <span style="color: #DCDCCC; background-color: #3F3F3F;">'.</span><span style="color: #D0BF8F; font-weight: bold;">'</span>);
    assert (string_vector.size () &gt; 0);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">top</span> = string_vector [0];
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.box_map.find (top + <span style="color: #CC9393;">"-t"</span>);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.box_map.end ()) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (box-&gt;empty_p) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">nullptr</span>;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = box-&gt;obj;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (obj-&gt;tag != type_tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">nullptr</span>;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">type</span> = as_type (obj);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = string_vector.begin () + 1;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = string_vector.end ();
        <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++) {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">field</span> = *it;
            field += <span style="color: #CC9393;">"-t"</span>;
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = type-&gt;obj_map [field];
            <span style="color: #F0DFAF; font-weight: bold;">if</span> (obj-&gt;tag != type_tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">nullptr</span>;
            type = as_type (obj);
        }
        <span style="color: #F0DFAF; font-weight: bold;">return</span> type;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">nullptr</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfcaa212" class="outline-3">
<h3 id="orgfcaa212">assign</h3>
<div class="outline-text-3" id="text-orgfcaa212">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">assign</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">prefix</span>,
    <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (prefix == <span style="color: #CC9393;">""</span>) {
        define (env, name, obj);
        <span style="color: #F0DFAF; font-weight: bold;">return</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">type</span> = find_type_from_prefix (env, prefix);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (type) {
        type-&gt;obj_map [name] = obj;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : assign fail"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  unknown prefix : "</span> &lt;&lt; prefix &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge2a826a" class="outline-3">
<h3 id="orge2a826a">assign_type</h3>
<div class="outline-text-3" id="text-orge2a826a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">assign_type</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">prefix</span>,
    <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">type_name</span>,
    <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag_of_type</span>,
    <span style="color: #7CB8BB;">tag_vector_t</span> <span style="color: #DFAF8F;">super_tag_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">type</span> = make_type (
        env,
        tag_of_type,
        super_tag_vector,
        <span style="color: #7CB8BB;">obj_map_t</span> ());
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = box_of_tag (env, tag_of_type);
    box-&gt;obj = type;
    box-&gt;empty_p = <span style="color: #BFEBBF;">false</span>;
    assign (env, prefix, type_name, type);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org46b94dc" class="outline-3">
<h3 id="org46b94dc">define_type</h3>
<div class="outline-text-3" id="text-org46b94dc">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">define_type</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">type_name</span> = name;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">tag_of_type</span> = tagging (env, name);
    assign_type (env, <span style="color: #CC9393;">""</span>, type_name, tag_of_type, {});
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org17ef715" class="outline-3">
<h3 id="org17ef715">type_of</h3>
<div class="outline-text-3" id="text-org17ef715">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;type_o&gt;
<span style="color: #93E0E3;">type_of</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = box_of_tag (env, obj-&gt;tag);
    assert (<span style="color: #F0DFAF; font-weight: bold;">!</span> box-&gt;empty_p);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> as_type (box-&gt;obj);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8b6632d" class="outline-2">
<h2 id="org8b6632d">data</h2>
<div class="outline-text-2" id="text-org8b6632d">
</div><div id="outline-container-orgb9d2828" class="outline-3">
<h3 id="orgb9d2828">data_o</h3>
<div class="outline-text-3" id="text-orgb9d2828">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">data_o</span>: <span style="color: #7CB8BB;">obj_t</span>, <span style="color: #7CB8BB;">enable_shared_from_this</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
{
    <span style="color: #93E0E3;">data_o</span> (
        <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
        <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag</span>,
        <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org3bf266a" class="outline-3">
<h3 id="org3bf266a">data_o::data_o</h3>
<div class="outline-text-3" id="text-org3bf266a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">data_o</span>::
<span style="color: #93E0E3;">data_o</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag</span>,
    <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = tag;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map = obj_map;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6244c1f" class="outline-3">
<h3 id="org6244c1f">make_data</h3>
<div class="outline-text-3" id="text-org6244c1f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">make_data</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag</span>,
    <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;data_o&gt; (
        env,
        tag,
        obj_map);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org860a31a" class="outline-3">
<h3 id="org860a31a">data_o::eq</h3>
<div class="outline-text-3" id="text-org860a31a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">data_o</span>::<span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;data_o&gt; (obj);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> obj_map_eq (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map, that-&gt;obj_map);

}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4e2954d" class="outline-3">
<h3 id="org4e2954d">data_o::repr</h3>
<div class="outline-text-3" id="text-org4e2954d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">sexp_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>);

<span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">data_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag == null_tag <span style="color: #F0DFAF; font-weight: bold;">or</span>
        <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag == cons_tag)
    {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> sexp_repr (env, shared_from_this ());
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map.size () == 0) {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
        repr += name_of_tag (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag);
        repr.pop_back ();
        repr.pop_back ();
        repr += <span style="color: #CC9393;">"-c"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"("</span>;
        repr += name_of_tag (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag);
        repr.pop_back ();
        repr.pop_back ();
        repr += <span style="color: #CC9393;">"-c "</span>;
        repr += obj_map_repr (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        repr += <span style="color: #CC9393;">")"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7d7dca1" class="outline-3">
<h3 id="org7d7dca1">assign_data</h3>
<div class="outline-text-3" id="text-org7d7dca1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">assign_data</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">prefix</span>,
    <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">data_name</span>,
    <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag_of_type</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">data</span> = make_data (env, tag_of_type, <span style="color: #7CB8BB;">obj_map_t</span> ());
    assign (env, prefix, data_name, data);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc9a2f27" class="outline-2">
<h2 id="orgc9a2f27">bool</h2>
<div class="outline-text-2" id="text-orgc9a2f27">
</div><div id="outline-container-org3deae55" class="outline-3">
<h3 id="org3deae55">true_c</h3>
<div class="outline-text-3" id="text-org3deae55">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">true_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
   <span style="color: #F0DFAF; font-weight: bold;">return</span> make_data (env, true_tag, <span style="color: #7CB8BB;">obj_map_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org91aa8f0" class="outline-3">
<h3 id="org91aa8f0">true_p</h3>
<div class="outline-text-3" id="text-org91aa8f0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">true_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == true_tag;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaac8bc2" class="outline-3">
<h3 id="orgaac8bc2">false_c</h3>
<div class="outline-text-3" id="text-orgaac8bc2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">false_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
   <span style="color: #F0DFAF; font-weight: bold;">return</span> make_data (env, false_tag, <span style="color: #7CB8BB;">obj_map_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org34bc033" class="outline-3">
<h3 id="org34bc033">false_p</h3>
<div class="outline-text-3" id="text-org34bc033">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">false_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == false_tag;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga381ee8" class="outline-3">
<h3 id="orga381ee8">make_bool</h3>
<div class="outline-text-3" id="text-orga381ee8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">make_bool</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">bool</span> <span style="color: #DFAF8F;">b</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (b) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> true_c (env);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> false_c (env);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd2662cd" class="outline-3">
<h3 id="orgd2662cd">bool_p</h3>
<div class="outline-text-3" id="text-orgd2662cd">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">bool_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> true_p (env, a)
        <span style="color: #F0DFAF; font-weight: bold;">or</span> false_p (env, a);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc4f269b" class="outline-2">
<h2 id="orgc4f269b">data_pred</h2>
<div class="outline-text-2" id="text-orgc4f269b">
</div><div id="outline-container-org61a9cc8" class="outline-3">
<h3 id="org61a9cc8">data_pred_o</h3>
<div class="outline-text-3" id="text-org61a9cc8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">data_pred_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag_of_type</span>;
    <span style="color: #93E0E3;">data_pred_o</span> (
        <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
        <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag_of_type</span>);
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org24b93cf" class="outline-3">
<h3 id="org24b93cf">data_pred_o::data_pred_o</h3>
<div class="outline-text-3" id="text-org24b93cf">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">data_pred_o</span>::
<span style="color: #93E0E3;">data_pred_o</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag_of_type</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = data_pred_tag;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag_of_type = tag_of_type;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcf2875a" class="outline-3">
<h3 id="orgcf2875a">data_pred_o::apply</h3>
<div class="outline-text-3" id="text-orgcf2875a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">data_pred_o</span>::<span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (arity == 1) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
        env.obj_stack.pop ();
        env.obj_stack.push (
            make_bool (
                env,
                obj-&gt;tag == <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag_of_type));
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : data_pred_o::apply"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  arity of this kind of apply must be 1"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  arity : "</span> &lt;&lt; arity &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1eb96a9" class="outline-3">
<h3 id="org1eb96a9">data_pred_o::eq</h3>
<div class="outline-text-3" id="text-org1eb96a9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">data_pred_o</span>::<span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;data_pred_o&gt; (obj);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag_of_type != that-&gt;tag_of_type) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org959e2bb" class="outline-3">
<h3 id="org959e2bb">data_pred_o::repr</h3>
<div class="outline-text-3" id="text-org959e2bb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">data_pred_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
    repr += name_of_tag (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag_of_type);
    repr.pop_back ();
    repr.pop_back ();
    repr += <span style="color: #CC9393;">"-p"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbc81c33" class="outline-3">
<h3 id="orgbc81c33">assign_data_pred</h3>
<div class="outline-text-3" id="text-orgbc81c33">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">assign_data_pred</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">prefix</span>,
    <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">pred_name</span>,
    <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag_of_type</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">data_pred</span> = make_shared &lt;data_pred_o&gt;
        (env, tag_of_type);
    assign (env, prefix, pred_name, data_pred);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org262ec69" class="outline-3">
<h3 id="org262ec69">define_data_pred</h3>
<div class="outline-text-3" id="text-org262ec69">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">define_data_pred</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">pred_name</span>,
    <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag_of_type</span>)
{
    assign_data_pred (env, <span style="color: #CC9393;">""</span>, pred_name, tag_of_type);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgcece13a" class="outline-2">
<h2 id="orgcece13a">data_cons</h2>
<div class="outline-text-2" id="text-orgcece13a">
</div><div id="outline-container-org72325c6" class="outline-3">
<h3 id="org72325c6">data_cons_o</h3>
<div class="outline-text-3" id="text-org72325c6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">data_cons_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag_of_type</span>;
    <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>;
    <span style="color: #93E0E3;">data_cons_o</span> (
        <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
        <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag_of_type</span>,
        <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
        <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>);
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>);
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">apply_to_arg_dict</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org4a8696f" class="outline-3">
<h3 id="org4a8696f">data_cons_o::data_cons_o</h3>
<div class="outline-text-3" id="text-org4a8696f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">data_cons_o</span>::
<span style="color: #93E0E3;">data_cons_o</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag_of_type</span>,
    <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
    <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = data_cons_tag;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag_of_type = tag_of_type;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector = name_vector;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map = obj_map;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgefb707e" class="outline-3">
<h3 id="orgefb707e">make_data_cons</h3>
<div class="outline-text-3" id="text-orgefb707e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;data_cons_o&gt;
<span style="color: #93E0E3;">make_data_cons</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag_of_type</span>,
    <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
    <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;data_cons_o&gt; (
        env,
        tag_of_type,
        name_vector,
        obj_map);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdc3370f" class="outline-3">
<h3 id="orgdc3370f">data_cons_o::apply</h3>
<div class="outline-text-3" id="text-orgdc3370f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">data_cons_o</span>::<span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">have</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack</span> = size - have;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lack == arity) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack_name_vector</span> = name_vector_obj_map_lack (
            <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = pick_up_obj_map_and_merge (
            env, lack_name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">data</span> = make_data (
            env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag_of_type, obj_map);
        env.obj_stack.push (data);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (arity &lt; lack) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack_name_vector</span> = name_vector_obj_map_arity_lack (
            <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map, arity);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = pick_up_obj_map_and_merge (
            env, lack_name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">data_cons</span> = make_data_cons (
            env,
            <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag_of_type,
            <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector,
            obj_map);
        env.obj_stack.push (data_cons);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : data_cons_o::apply"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  over-arity apply"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  arity &gt; lack"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  arity : "</span> &lt;&lt; arity &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  lack : "</span> &lt;&lt; lack &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb3ec846" class="outline-3">
<h3 id="orgb3ec846">data_cons_o::eq</h3>
<div class="outline-text-3" id="text-orgb3ec846">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">data_cons_o</span>::<span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;data_cons_o&gt; (obj);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag_of_type != that-&gt;tag_of_type) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> obj_map_eq (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map, that-&gt;obj_map);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org66ed25a" class="outline-3">
<h3 id="org66ed25a">data_cons_p</h3>
<div class="outline-text-3" id="text-org66ed25a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">data_cons_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == data_cons_tag;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgffa930f" class="outline-3">
<h3 id="orgffa930f">data_cons_o::repr</h3>
<div class="outline-text-3" id="text-orgffa930f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">data_cons_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector.size () == 0) {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
        repr += name_of_tag (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag_of_type);
        repr.pop_back ();
        repr.pop_back ();
        repr += <span style="color: #CC9393;">"-c"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"("</span>;
        repr += name_of_tag (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag_of_type);
        repr.pop_back ();
        repr.pop_back ();
        repr += <span style="color: #CC9393;">"-c "</span>;
        repr += name_vector_and_obj_map_repr
            (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        repr += <span style="color: #CC9393;">")"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgace1a6" class="outline-3">
<h3 id="orgace1a6">assign_data_cons</h3>
<div class="outline-text-3" id="text-orgace1a6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">assign_data_cons</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">prefix</span>,
    <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">data_name</span>,
    <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag_of_type</span>,
    <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">data_cons</span> = make_data_cons (
        env,
        tag_of_type,
        name_vector,
        <span style="color: #7CB8BB;">obj_map_t</span> ());
    assign (env, prefix, data_name, data_cons);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgdcd1579" class="outline-2">
<h2 id="orgdcd1579">prim</h2>
<div class="outline-text-2" id="text-orgdcd1579">
</div><div id="outline-container-org797776d" class="outline-3">
<h3 id="org797776d">prim_fn</h3>
<div class="outline-text-3" id="text-org797776d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">prim_fn</span> = <span style="color: #7CB8BB;">function</span>
    &lt;<span style="color: #7CB8BB;">void</span> (<span style="color: #7CB8BB;">env_t</span> &amp;, <span style="color: #7CB8BB;">obj_map_t</span> &amp;)&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-org3d1e48a" class="outline-3">
<h3 id="org3d1e48a">prim_o</h3>
<div class="outline-text-3" id="text-org3d1e48a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">prim_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>;
    <span style="color: #7CB8BB;">prim_fn</span> <span style="color: #DFAF8F;">fn</span>;
    <span style="color: #93E0E3;">prim_o</span> (
        <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
        <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
        <span style="color: #7CB8BB;">prim_fn</span> <span style="color: #DFAF8F;">fn</span>,
        <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>);
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">apply_to_arg_dict</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org6ada691" class="outline-3">
<h3 id="org6ada691">prim_o::prim_o</h3>
<div class="outline-text-3" id="text-org6ada691">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">prim_o</span>::<span style="color: #93E0E3;">prim_o</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
    <span style="color: #7CB8BB;">prim_fn</span> <span style="color: #DFAF8F;">fn</span>,
    <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = prim_tag;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector = name_vector;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;fn = fn;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map = obj_map;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgba0ff0c" class="outline-3">
<h3 id="orgba0ff0c">make_prim</h3>
<div class="outline-text-3" id="text-orgba0ff0c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;prim_o&gt;
<span style="color: #93E0E3;">make_prim</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
    <span style="color: #7CB8BB;">prim_fn</span> <span style="color: #DFAF8F;">fn</span>,
    <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;prim_o&gt; (
        env,
        name_vector,
        fn,
        obj_map);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc00b49f" class="outline-3">
<h3 id="orgc00b49f">prim_p</h3>
<div class="outline-text-3" id="text-orgc00b49f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">prim_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == prim_tag;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6959ad5" class="outline-3">
<h3 id="org6959ad5">prim_o::repr</h3>
<div class="outline-text-3" id="text-org6959ad5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">prim_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector.size () == 0) {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"(prim)"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"(prim "</span>;
        repr += name_vector_and_obj_map_repr
            (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        repr += <span style="color: #CC9393;">")"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org20b3ca5" class="outline-3">
<h3 id="org20b3ca5">prim_o::eq</h3>
<div class="outline-text-3" id="text-org20b3ca5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span> <span style="color: #BFEBBF;">prim_o</span>::<span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;prim_o&gt; (obj);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span> != obj.get ()) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> obj_map_eq (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map, that-&gt;obj_map);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org33b8e7d" class="outline-3">
<h3 id="org33b8e7d">prim_o::apply</h3>
<div class="outline-text-3" id="text-org33b8e7d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span> <span style="color: #BFEBBF;">prim_o</span>::<span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">have</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack</span> = size - have;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lack == arity) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack_name_vector</span> = name_vector_obj_map_lack (
            <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = pick_up_obj_map_and_merge (
            env, lack_name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;fn (env, obj_map);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (arity &lt; lack) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack_name_vector</span> = name_vector_obj_map_arity_lack (
            <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map, arity);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = pick_up_obj_map_and_merge (
            env, lack_name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">prim</span> = make_prim (
            env,
            <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector,
            <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;fn,
            obj_map);
        env.obj_stack.push (prim);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : prim_o::apply"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  over-arity apply"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  arity &gt; lack"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  arity : "</span> &lt;&lt; arity &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  lack : "</span> &lt;&lt; lack &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd64f998" class="outline-3">
<h3 id="orgd64f998">sig_t</h3>
<div class="outline-text-3" id="text-orgd64f998">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">sig_t</span> = name_vector_t;
</pre>
</div>
</div>
</div>

<div id="outline-container-org4ad4e79" class="outline-3">
<h3 id="org4ad4e79">name_of_sig</h3>
<div class="outline-text-3" id="text-org4ad4e79">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_t</span>
<span style="color: #93E0E3;">name_of_sig</span> (<span style="color: #7CB8BB;">sig_t</span> &amp;<span style="color: #DFAF8F;">sig</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> sig [0];
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org66ae3a" class="outline-3">
<h3 id="org66ae3a">name_vector_of_sig</h3>
<div class="outline-text-3" id="text-org66ae3a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_vector_t</span>
<span style="color: #93E0E3;">name_vector_of_sig</span> (<span style="color: #7CB8BB;">sig_t</span> &amp;<span style="color: #DFAF8F;">sig</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = name_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = sig.begin () + 1;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = sig.end ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++) {
        name_vector.push_back (*it);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> name_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb0be286" class="outline-3">
<h3 id="orgb0be286">define_prim</h3>
<div class="outline-text-3" id="text-orgb0be286">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">define_prim</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">sig</span>, <span style="color: #7CB8BB;">prim_fn</span> <span style="color: #DFAF8F;">fn</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = name_of_sig (sig);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = name_vector_of_sig (sig);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">prim</span> = make_prim (
        env, name_vector, fn, <span style="color: #7CB8BB;">obj_map_t</span> ());
    define (env, name, prim);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7f0907c" class="outline-2">
<h2 id="org7f0907c">num</h2>
<div class="outline-text-2" id="text-org7f0907c">
</div><div id="outline-container-org3dd25b4" class="outline-3">
<h3 id="org3dd25b4">num_o</h3>
<div class="outline-text-3" id="text-org3dd25b4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">num_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">num_t</span> <span style="color: #DFAF8F;">num</span>;
    <span style="color: #93E0E3;">num_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">num_t</span> <span style="color: #DFAF8F;">num</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org564757c" class="outline-3">
<h3 id="org564757c">num_o::num_o</h3>
<div class="outline-text-3" id="text-org564757c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">num_o</span>::<span style="color: #93E0E3;">num_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">num_t</span> <span style="color: #DFAF8F;">num</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = num_tag;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;num = num;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8d661e0" class="outline-3">
<h3 id="org8d661e0">make_num</h3>
<div class="outline-text-3" id="text-org8d661e0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;num_o&gt;
<span style="color: #93E0E3;">make_num</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">num_t</span> <span style="color: #DFAF8F;">num</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;num_o&gt; (env, num);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6c5242f" class="outline-3">
<h3 id="org6c5242f">num_o::repr</h3>
<div class="outline-text-3" id="text-org6c5242f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">num_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;num == floor (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;num)) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> to_string (<span style="color: #F0DFAF; font-weight: bold;">static_cast</span> &lt;<span style="color: #7CB8BB;">long</span> <span style="color: #7CB8BB;">long</span> <span style="color: #7CB8BB;">int</span>&gt; (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;num));
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> to_string (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;num);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcd202cc" class="outline-3">
<h3 id="orgcd202cc">as_num</h3>
<div class="outline-text-3" id="text-orgcd202cc">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;num_o&gt;
<span style="color: #93E0E3;">as_num</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    assert (obj-&gt;tag == num_tag);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> static_pointer_cast &lt;num_o&gt; (obj);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc734984" class="outline-3">
<h3 id="orgc734984">num_o::eq</h3>
<div class="outline-text-3" id="text-orgc734984">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">num_o</span>::<span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = as_num (obj);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;num == that-&gt;num);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1b08fda" class="outline-3">
<h3 id="org1b08fda">num_p</h3>
<div class="outline-text-3" id="text-org1b08fda">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">num_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == num_tag;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd93d469" class="outline-2">
<h2 id="orgd93d469">str</h2>
<div class="outline-text-2" id="text-orgd93d469">
</div><div id="outline-container-orgd6b021" class="outline-3">
<h3 id="orgd6b021">str_o</h3>
<div class="outline-text-3" id="text-orgd6b021">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">str_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>;
    <span style="color: #93E0E3;">str_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org7d5cba1" class="outline-3">
<h3 id="org7d5cba1">str_o::str_o</h3>
<div class="outline-text-3" id="text-org7d5cba1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">str_o</span>::<span style="color: #93E0E3;">str_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = str_tag;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;str = str;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga2e2063" class="outline-3">
<h3 id="orga2e2063">make_str</h3>
<div class="outline-text-3" id="text-orga2e2063">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;str_o&gt;
<span style="color: #93E0E3;">make_str</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;str_o&gt; (env, str);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd315c06" class="outline-3">
<h3 id="orgd315c06">str_o::repr</h3>
<div class="outline-text-3" id="text-orgd315c06">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">str_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"\""</span> + <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;str + <span style="color: #CC9393;">"\""</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org547f9e8" class="outline-3">
<h3 id="org547f9e8">as_str</h3>
<div class="outline-text-3" id="text-org547f9e8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;str_o&gt;
<span style="color: #93E0E3;">as_str</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    assert (obj-&gt;tag == str_tag);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> static_pointer_cast &lt;str_o&gt; (obj);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org696f4d6" class="outline-3">
<h3 id="org696f4d6">str_o::eq</h3>
<div class="outline-text-3" id="text-org696f4d6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">str_o</span>::<span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = as_str (obj);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;str == that-&gt;str);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd300e2c" class="outline-3">
<h3 id="orgd300e2c">str_p</h3>
<div class="outline-text-3" id="text-orgd300e2c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">str_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == str_tag;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org20a87eb" class="outline-3">
<h3 id="org20a87eb">str_length</h3>
<div class="outline-text-3" id="text-org20a87eb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;num_o&gt;
<span style="color: #93E0E3;">str_length</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;str_o&gt; <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = str-&gt;str.size ();
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_num (env, <span style="color: #F0DFAF; font-weight: bold;">static_cast</span> &lt;<span style="color: #7CB8BB;">num_t</span>&gt; (size));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org893d3c9" class="outline-3">
<h3 id="org893d3c9">str_append</h3>
<div class="outline-text-3" id="text-org893d3c9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;str_o&gt;
<span style="color: #93E0E3;">str_append</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;str_o&gt; <span style="color: #DFAF8F;">ante</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;str_o&gt; <span style="color: #DFAF8F;">succ</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_str (env, ante-&gt;str + succ-&gt;str);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org69752cc" class="outline-3">
<h3 id="org69752cc">str_slice</h3>
<div class="outline-text-3" id="text-org69752cc">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;str_o&gt;
<span style="color: #93E0E3;">str_slice</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;str_o&gt; <span style="color: #DFAF8F;">str</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;num_o&gt; <span style="color: #DFAF8F;">begin</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;num_o&gt; <span style="color: #DFAF8F;">end</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = str-&gt;str.size ();
    assert (begin-&gt;num &gt;= 0);
    assert (end-&gt;num &lt; size);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">length</span> = end-&gt;num - begin-&gt;num;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_str (env, str-&gt;str.substr (begin-&gt;num, length));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf7ed09d" class="outline-3">
<h3 id="orgf7ed09d">str_ref</h3>
<div class="outline-text-3" id="text-orgf7ed09d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;str_o&gt;
<span style="color: #93E0E3;">str_ref</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;str_o&gt; <span style="color: #DFAF8F;">str</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;num_o&gt; <span style="color: #DFAF8F;">index</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = str-&gt;str.size ();
    assert (index-&gt;num &gt;= 0);
    assert (index-&gt;num &lt; size);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">c</span> = str-&gt;str [index-&gt;num];
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">s</span> = string ();
    s += c;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_str (env, s);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd746831" class="outline-3">
<h3 id="orgd746831">str_head</h3>
<div class="outline-text-3" id="text-orgd746831">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;str_o&gt;
<span style="color: #93E0E3;">str_head</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;str_o&gt; <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = str-&gt;str.size ();
    assert (size &gt;= 1);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">c</span> = str-&gt;str [0];
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">s</span> = string ();
    s += c;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_str (env, s);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9a27c04" class="outline-3">
<h3 id="org9a27c04">str_rest</h3>
<div class="outline-text-3" id="text-org9a27c04">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;str_o&gt;
<span style="color: #93E0E3;">str_rest</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;str_o&gt; <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = str-&gt;str.size ();
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_str (env, str-&gt;str.substr (1, size -1));
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgdfbc3ce" class="outline-2">
<h2 id="orgdfbc3ce">sym</h2>
<div class="outline-text-2" id="text-orgdfbc3ce">
</div><div id="outline-container-orgb8a88f2" class="outline-3">
<h3 id="orgb8a88f2">sym_o</h3>
<div class="outline-text-3" id="text-orgb8a88f2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">sym_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">symbol</span> <span style="color: #DFAF8F;">sym</span>;
    <span style="color: #93E0E3;">sym_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">symbol</span> <span style="color: #DFAF8F;">sym</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">symbol</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc90bc25" class="outline-3">
<h3 id="orgc90bc25">sym_o::sym_o</h3>
<div class="outline-text-3" id="text-orgc90bc25">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">sym_o</span>::<span style="color: #93E0E3;">sym_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">symbol</span> <span style="color: #DFAF8F;">sym</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = sym_tag;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;sym = sym;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbb9a151" class="outline-3">
<h3 id="orgbb9a151">make_sym</h3>
<div class="outline-text-3" id="text-orgbb9a151">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;sym_o&gt;
<span style="color: #93E0E3;">make_sym</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">symbol</span> <span style="color: #DFAF8F;">sym</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;sym_o&gt; (env, sym);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdf932b0" class="outline-3">
<h3 id="orgdf932b0">sym_o::repr</h3>
<div class="outline-text-3" id="text-orgdf932b0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">symbol</span>
<span style="color: #BFEBBF;">sym_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"'"</span> + <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;sym;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga842dc7" class="outline-3">
<h3 id="orga842dc7">as_sym</h3>
<div class="outline-text-3" id="text-orga842dc7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;sym_o&gt;
<span style="color: #93E0E3;">as_sym</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    assert (obj-&gt;tag == sym_tag);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> static_pointer_cast &lt;sym_o&gt; (obj);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5ce645f" class="outline-3">
<h3 id="org5ce645f">sym_o::eq</h3>
<div class="outline-text-3" id="text-org5ce645f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">sym_o</span>::<span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = as_sym (obj);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;sym == that-&gt;sym);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3ff0cae" class="outline-3">
<h3 id="org3ff0cae">sym_p</h3>
<div class="outline-text-3" id="text-org3ff0cae">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">sym_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == sym_tag;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org91f2835" class="outline-3">
<h3 id="org91f2835">sym_length</h3>
<div class="outline-text-3" id="text-org91f2835">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;num_o&gt;
<span style="color: #93E0E3;">sym_length</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;sym_o&gt; <span style="color: #DFAF8F;">sym</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = sym-&gt;sym.size ();
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_num (env, <span style="color: #F0DFAF; font-weight: bold;">static_cast</span> &lt;<span style="color: #7CB8BB;">num_t</span>&gt; (size));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org52930b0" class="outline-3">
<h3 id="org52930b0">sym_append</h3>
<div class="outline-text-3" id="text-org52930b0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;sym_o&gt;
<span style="color: #93E0E3;">sym_append</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;sym_o&gt; <span style="color: #DFAF8F;">ante</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;sym_o&gt; <span style="color: #DFAF8F;">succ</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_sym (env, ante-&gt;sym + succ-&gt;sym);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd38141b" class="outline-3">
<h3 id="orgd38141b">sym_slice</h3>
<div class="outline-text-3" id="text-orgd38141b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;sym_o&gt;
<span style="color: #93E0E3;">sym_slice</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;sym_o&gt; <span style="color: #DFAF8F;">sym</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;num_o&gt; <span style="color: #DFAF8F;">begin</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;num_o&gt; <span style="color: #DFAF8F;">end</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = sym-&gt;sym.size ();
    assert (begin-&gt;num &gt;= 0);
    assert (end-&gt;num &lt; size);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">length</span> = end-&gt;num - begin-&gt;num;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_sym (env, sym-&gt;sym.substr (begin-&gt;num, length));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf8427d2" class="outline-3">
<h3 id="orgf8427d2">sym_ref</h3>
<div class="outline-text-3" id="text-orgf8427d2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;sym_o&gt;
<span style="color: #93E0E3;">sym_ref</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;sym_o&gt; <span style="color: #DFAF8F;">sym</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;num_o&gt; <span style="color: #DFAF8F;">index</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = sym-&gt;sym.size ();
    assert (index-&gt;num &gt;= 0);
    assert (index-&gt;num &lt; size);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">c</span> = sym-&gt;sym [index-&gt;num];
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">s</span> = symbol ();
    s += c;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_sym (env, s);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcc63a0f" class="outline-3">
<h3 id="orgcc63a0f">sym_head</h3>
<div class="outline-text-3" id="text-orgcc63a0f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;sym_o&gt;
<span style="color: #93E0E3;">sym_head</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;sym_o&gt; <span style="color: #DFAF8F;">sym</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = sym-&gt;sym.size ();
    assert (size &gt;= 1);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">c</span> = sym-&gt;sym [0];
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">s</span> = symbol ();
    s += c;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_sym (env, s);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6d587ae" class="outline-3">
<h3 id="org6d587ae">sym_rest</h3>
<div class="outline-text-3" id="text-org6d587ae">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;sym_o&gt;
<span style="color: #93E0E3;">sym_rest</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;sym_o&gt; <span style="color: #DFAF8F;">sym</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = sym-&gt;sym.size ();
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_sym (env, sym-&gt;sym.substr (1, size -1));
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfd5f57f" class="outline-2">
<h2 id="orgfd5f57f">list</h2>
<div class="outline-text-2" id="text-orgfd5f57f">
</div><div id="outline-container-orgb041fb8" class="outline-3">
<h3 id="orgb041fb8">null_c</h3>
<div class="outline-text-3" id="text-orgb041fb8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">null_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
   <span style="color: #F0DFAF; font-weight: bold;">return</span> make_data (env, null_tag, <span style="color: #7CB8BB;">obj_map_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdae5013" class="outline-3">
<h3 id="orgdae5013">null_p</h3>
<div class="outline-text-3" id="text-orgdae5013">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">null_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == null_tag;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org80aa940" class="outline-3">
<h3 id="org80aa940">cons_c</h3>
<div class="outline-text-3" id="text-org80aa940">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">cons_c</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">car</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">cdr</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = obj_map_t ();
    obj_map [<span style="color: #CC9393;">"car"</span>] = car;
    obj_map [<span style="color: #CC9393;">"cdr"</span>] = cdr;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_data (env, cons_tag, obj_map);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge4ab6b2" class="outline-3">
<h3 id="orge4ab6b2">cons_p</h3>
<div class="outline-text-3" id="text-orge4ab6b2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">cons_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == cons_tag;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge5691da" class="outline-3">
<h3 id="orge5691da">car</h3>
<div class="outline-text-3" id="text-orge5691da">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">car</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">cons</span>)
{
    assert (cons_p (env, cons));
    <span style="color: #F0DFAF; font-weight: bold;">return</span> cons-&gt;obj_map [<span style="color: #CC9393;">"car"</span>];
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org904c6c4" class="outline-3">
<h3 id="org904c6c4">cdr</h3>
<div class="outline-text-3" id="text-org904c6c4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">cdr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">cons</span>)
{
    assert (cons_p (env, cons));
    <span style="color: #F0DFAF; font-weight: bold;">return</span> cons-&gt;obj_map [<span style="color: #CC9393;">"cdr"</span>];
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd88da93" class="outline-3">
<h3 id="orgd88da93">list_p</h3>
<div class="outline-text-3" id="text-orgd88da93">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">list_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> null_p (env, a)
        <span style="color: #F0DFAF; font-weight: bold;">or</span> cons_p (env, a);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4a62764" class="outline-3">
<h3 id="org4a62764">list_size</h3>
<div class="outline-text-3" id="text-org4a62764">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">size_t</span>
<span style="color: #93E0E3;">list_size</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">l</span>)
{
    assert (list_p (env, l));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> null_p (env, l)) {
        size++;
        l = cdr (env, l);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> size;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge2ef11b" class="outline-3">
<h3 id="orge2ef11b">list_length</h3>
<div class="outline-text-3" id="text-orge2ef11b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;num_o&gt;
<span style="color: #93E0E3;">list_length</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">l</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = list_size (env, l);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">length</span> = <span style="color: #F0DFAF; font-weight: bold;">static_cast</span> &lt;<span style="color: #7CB8BB;">num_t</span>&gt; (size);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_num (env, length);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org33249aa" class="outline-3">
<h3 id="org33249aa">list_reverse</h3>
<div class="outline-text-3" id="text-org33249aa">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">list_reverse</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">l</span>)
{
    assert (list_p (env, l));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">result</span> = null_c (env);
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> null_p (env, l)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = car (env, l);
        result = cons_c (env, obj, result);
        l = cdr (env, l);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> result;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4b54d9" class="outline-3">
<h3 id="org4b54d9">list_append</h3>
<div class="outline-text-3" id="text-org4b54d9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">list_append</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">ante</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">succ</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">l</span> = list_reverse (env, ante);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">result</span> = succ;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> null_p (env, l)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = car (env, l);
        result = cons_c (env, obj, result);
        l = cdr (env, l);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> result;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9794203" class="outline-3">
<h3 id="org9794203">unit_list</h3>
<div class="outline-text-3" id="text-org9794203">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">unit_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (env, obj, null_c (env));
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb01c34f" class="outline-2">
<h2 id="orgb01c34f">vect</h2>
<div class="outline-text-2" id="text-orgb01c34f">
</div><div id="outline-container-orga14a0b2" class="outline-3">
<h3 id="orga14a0b2">vect_o</h3>
<div class="outline-text-3" id="text-orga14a0b2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">vect_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">obj_vector_t</span> <span style="color: #DFAF8F;">obj_vector</span>;
    <span style="color: #93E0E3;">vect_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_vector_t</span> <span style="color: #DFAF8F;">obj_vector</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org5b31e76" class="outline-3">
<h3 id="org5b31e76">vect_o::vect_o</h3>
<div class="outline-text-3" id="text-org5b31e76">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">vect_o</span>::<span style="color: #93E0E3;">vect_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_vector_t</span> <span style="color: #DFAF8F;">obj_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = vect_tag;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_vector = obj_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc707ee6" class="outline-3">
<h3 id="orgc707ee6">make_vect</h3>
<div class="outline-text-3" id="text-orgc707ee6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;vect_o&gt;
<span style="color: #93E0E3;">make_vect</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_vector_t</span> <span style="color: #DFAF8F;">obj_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;vect_o&gt; (env, obj_vector);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfb7aef3" class="outline-3">
<h3 id="orgfb7aef3">as_vect</h3>
<div class="outline-text-3" id="text-orgfb7aef3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;vect_o&gt;
<span style="color: #93E0E3;">as_vect</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    assert (obj-&gt;tag == vect_tag);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> static_pointer_cast &lt;vect_o&gt; (obj);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge00d80b" class="outline-3">
<h3 id="orge00d80b">vect_eq</h3>
<div class="outline-text-3" id="text-orge00d80b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">vect_eq</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">obj_vector_t</span> &amp;<span style="color: #DFAF8F;">lhs</span>,
    <span style="color: #7CB8BB;">obj_vector_t</span> &amp;<span style="color: #DFAF8F;">rhs</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lhs.size () != rhs.size ()) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = lhs.size ();
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (index &lt; size) {
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> obj_eq (env, lhs [index], rhs [index]))
            <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
        index++;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd045e2a" class="outline-3">
<h3 id="orgd045e2a">vect_o::eq</h3>
<div class="outline-text-3" id="text-orgd045e2a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">vect_o</span>::<span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = as_vect (obj);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> vect_eq (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_vector, that-&gt;obj_vector);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1e89820" class="outline-3">
<h3 id="org1e89820">vect_o::repr</h3>
<div class="outline-text-3" id="text-org1e89820">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">vect_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"["</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">obj</span>: <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_vector) {
        repr += obj-&gt;repr (env);
        repr += <span style="color: #CC9393;">" "</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> repr.empty ()) repr.pop_back ();
    repr += <span style="color: #CC9393;">"]"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org46dc64a" class="outline-3">
<h3 id="org46dc64a">vect_p</h3>
<div class="outline-text-3" id="text-org46dc64a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">vect_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == vect_tag;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org76f5bd5" class="outline-3">
<h3 id="org76f5bd5">list_to_vect</h3>
<div class="outline-text-3" id="text-org76f5bd5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;vect_o&gt;
<span style="color: #93E0E3;">list_to_vect</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">l</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_vector</span> = obj_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (cons_p (env, l)) {
        obj_vector.push_back (car (env, l));
        l = cdr (env, l);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_vect (env, obj_vector);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org61082f4" class="outline-3">
<h3 id="org61082f4">vect_to_list</h3>
<div class="outline-text-3" id="text-org61082f4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">vect_to_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;vect_o&gt; <span style="color: #DFAF8F;">vect</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_vector</span> = vect-&gt;obj_vector;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">result</span> = null_c (env);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = obj_vector.rbegin ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = obj_vector.rend ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++)
        result = cons_c (env, *it, result);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> result;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org257dd4c" class="outline-3">
<h3 id="org257dd4c">vect_length</h3>
<div class="outline-text-3" id="text-org257dd4c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;num_o&gt;
<span style="color: #93E0E3;">vect_length</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;vect_o&gt; <span style="color: #DFAF8F;">vect</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_num (env, vect-&gt;obj_vector.size ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf9a5186" class="outline-3">
<h3 id="orgf9a5186">vect_append</h3>
<div class="outline-text-3" id="text-orgf9a5186">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;vect_o&gt;
<span style="color: #93E0E3;">vect_append</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;vect_o&gt; <span style="color: #DFAF8F;">ante</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;vect_o&gt; <span style="color: #DFAF8F;">succ</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_vector</span> = obj_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span>: ante-&gt;obj_vector)
        obj_vector.push_back (obj);
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span>: succ-&gt;obj_vector)
        obj_vector.push_back (obj);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_vect (env, obj_vector);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf57507f" class="outline-3">
<h3 id="orgf57507f">vect_slice</h3>
<div class="outline-text-3" id="text-orgf57507f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;vect_o&gt;
<span style="color: #93E0E3;">vect_slice</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;vect_o&gt; <span style="color: #DFAF8F;">vect</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;num_o&gt; <span style="color: #DFAF8F;">begin</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;num_o&gt; <span style="color: #DFAF8F;">end</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = vect-&gt;obj_vector.size ();
    assert (begin-&gt;num &gt;= 0);
    assert (end-&gt;num &lt; size);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_vector</span> = obj_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = vect-&gt;obj_vector.begin () + begin-&gt;num;
         it != vect-&gt;obj_vector.begin () + end-&gt;num;
         it++) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = *it;
        obj_vector.push_back (obj);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_vect (env, obj_vector);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1453638" class="outline-3">
<h3 id="org1453638">vect_ref</h3>
<div class="outline-text-3" id="text-org1453638">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">vect_ref</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;vect_o&gt; <span style="color: #DFAF8F;">vect</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;num_o&gt; <span style="color: #DFAF8F;">index</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = vect-&gt;obj_vector.size ();
    assert (index-&gt;num &gt;= 0);
    assert (index-&gt;num &lt; size);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> vect-&gt;obj_vector [index-&gt;num];
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga947782" class="outline-3">
<h3 id="orga947782">vect_head</h3>
<div class="outline-text-3" id="text-orga947782">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">vect_head</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;vect_o&gt; <span style="color: #DFAF8F;">vect</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = vect-&gt;obj_vector.size ();
    assert (size &gt;= 1);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> vect-&gt;obj_vector [0];
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb7eda18" class="outline-3">
<h3 id="orgb7eda18">vect_rest</h3>
<div class="outline-text-3" id="text-orgb7eda18">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;vect_o&gt;
<span style="color: #93E0E3;">vect_rest</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;vect_o&gt; <span style="color: #DFAF8F;">vect</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = vect-&gt;obj_vector.size ();
    assert (size &gt;= 1);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_vector</span> = obj_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = vect-&gt;obj_vector.begin () + 1;
         it != vect-&gt;obj_vector.end ();
         it++) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = *it;
        obj_vector.push_back (obj);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_vect (env, obj_vector);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org81055e6" class="outline-3">
<h3 id="org81055e6">vect_reverse</h3>
<div class="outline-text-3" id="text-org81055e6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;vect_o&gt;
<span style="color: #93E0E3;">vect_reverse</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;vect_o&gt; <span style="color: #DFAF8F;">vect</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_vector</span> = vect-&gt;obj_vector;
    reverse (obj_vector.begin (),
             obj_vector.end ());
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_vect (env, obj_vector);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga3bb5e4" class="outline-3">
<h3 id="orga3bb5e4">unit_vect</h3>
<div class="outline-text-3" id="text-orga3bb5e4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;vect_o&gt;
<span style="color: #93E0E3;">unit_vect</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_vector</span> = obj_vector_t ();
    obj_vector.push_back (obj);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_vect (env, obj_vector);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgeabf00d" class="outline-2">
<h2 id="orgeabf00d">maybe</h2>
<div class="outline-text-2" id="text-orgeabf00d">
</div><div id="outline-container-org7d253ad" class="outline-3">
<h3 id="org7d253ad">nothing_c</h3>
<div class="outline-text-3" id="text-org7d253ad">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">nothing_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
   <span style="color: #F0DFAF; font-weight: bold;">return</span> make_data (env, nothing_tag, <span style="color: #7CB8BB;">obj_map_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7fcf28c" class="outline-3">
<h3 id="org7fcf28c">nothing_p</h3>
<div class="outline-text-3" id="text-org7fcf28c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">nothing_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == nothing_tag;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org75da0a6" class="outline-3">
<h3 id="org75da0a6">just_c</h3>
<div class="outline-text-3" id="text-org75da0a6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">just_c</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">value</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = obj_map_t ();
    obj_map [<span style="color: #CC9393;">"value"</span>] = value;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_data (env, just_tag, obj_map);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd88e4c3" class="outline-3">
<h3 id="orgd88e4c3">just_p</h3>
<div class="outline-text-3" id="text-orgd88e4c3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">just_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == just_tag;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd8ac480" class="outline-3">
<h3 id="orgd8ac480">value_of_just</h3>
<div class="outline-text-3" id="text-orgd8ac480">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">value_of_just</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">just</span>)
{
    assert (just_p (env, just));
    <span style="color: #F0DFAF; font-weight: bold;">return</span> just-&gt;obj_map [<span style="color: #CC9393;">"value"</span>];
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org238a688" class="outline-3">
<h3 id="org238a688">maybe_p</h3>
<div class="outline-text-3" id="text-org238a688">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">maybe_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> nothing_p (env, a)
        <span style="color: #F0DFAF; font-weight: bold;">or</span> just_p (env, a);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6247cd7" class="outline-2">
<h2 id="org6247cd7">dict</h2>
<div class="outline-text-2" id="text-org6247cd7">
</div><div id="outline-container-org38537f5" class="outline-3">
<h3 id="org38537f5">dict_o</h3>
<div class="outline-text-3" id="text-org38537f5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">dict_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #93E0E3;">dict_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org8d4dbff" class="outline-3">
<h3 id="org8d4dbff">dict_o::dict_o</h3>
<div class="outline-text-3" id="text-org8d4dbff">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">dict_o</span>::<span style="color: #93E0E3;">dict_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = dict_tag;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map = obj_map;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org90e63da" class="outline-3">
<h3 id="org90e63da">make_dict</h3>
<div class="outline-text-3" id="text-org90e63da">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;dict_o&gt;
<span style="color: #93E0E3;">make_dict</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;dict_o&gt; (env, obj_map);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgea1b05e" class="outline-3">
<h3 id="orgea1b05e">as_dict</h3>
<div class="outline-text-3" id="text-orgea1b05e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;dict_o&gt;
<span style="color: #93E0E3;">as_dict</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    assert (obj-&gt;tag == dict_tag);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> static_pointer_cast &lt;dict_o&gt; (obj);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org18aa7f1" class="outline-3">
<h3 id="org18aa7f1">dict_o::eq</h3>
<div class="outline-text-3" id="text-org18aa7f1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">dict_o</span>::<span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = as_dict (obj);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> obj_map_eq (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map, that-&gt;obj_map);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org20fad28" class="outline-3">
<h3 id="org20fad28">dict_o::repr</h3>
<div class="outline-text-3" id="text-org20fad28">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">dict_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"{"</span>;
    repr += obj_map_repr (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
    repr += <span style="color: #CC9393;">"}"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org81f1a63" class="outline-3">
<h3 id="org81f1a63">dict_p</h3>
<div class="outline-text-3" id="text-org81f1a63">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">dict_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == dict_tag;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd1a12e8" class="outline-3">
<h3 id="orgd1a12e8">list_to_dict</h3>
<div class="outline-text-3" id="text-orgd1a12e8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;dict_o&gt;
<span style="color: #93E0E3;">list_to_dict</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">l</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = obj_map_t ();
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> null_p (env, l)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">pair</span> = car (env, l);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sym</span> = as_sym (car (env, pair));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = car (env, cdr (env, pair));
        obj_map [sym-&gt;sym] = obj;
        l = cdr (env, l);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_dict (env, obj_map);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3b00750" class="outline-3">
<h3 id="org3b00750">dict_to_list</h3>
<div class="outline-text-3" id="text-org3b00750">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">dict_to_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;dict_o&gt; <span style="color: #DFAF8F;">dict</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">result</span> = null_c (env);
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: dict-&gt;obj_map) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sym</span> = make_sym (env, kv.first);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = kv.second;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">pair</span> = cons_c (env, sym, unit_list (env, obj));
        result = cons_c (env, pair, result);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> result;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org80b489c" class="outline-3">
<h3 id="org80b489c">dict_to_flat_list</h3>
<div class="outline-text-3" id="text-org80b489c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">dict_to_flat_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;dict_o&gt; <span style="color: #DFAF8F;">dict</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">result</span> = null_c (env);
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: dict-&gt;obj_map) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sym</span> = make_sym (env, kv.first);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">key</span> = cons_c (
            env,
            make_sym (env, <span style="color: #CC9393;">"quote"</span>),
            unit_list (env, sym));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = kv.second;
        result = cons_c (env, obj, result);
        result = cons_c (env, key, result);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> result;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org926196" class="outline-3">
<h3 id="org926196">dict_length</h3>
<div class="outline-text-3" id="text-org926196">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;num_o&gt;
<span style="color: #93E0E3;">dict_length</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;dict_o&gt; <span style="color: #DFAF8F;">dict</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_num (env, dict-&gt;obj_map.size ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org84150b8" class="outline-3">
<h3 id="org84150b8">dict_key_list</h3>
<div class="outline-text-3" id="text-org84150b8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">dict_key_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;dict_o&gt; <span style="color: #DFAF8F;">dict</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">result</span> = null_c (env);
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: dict-&gt;obj_map) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sym</span> = make_sym (env, kv.first);
        result = cons_c (env, sym, result);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> result;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org229fa7a" class="outline-3">
<h3 id="org229fa7a">dict_value_list</h3>
<div class="outline-text-3" id="text-org229fa7a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">dict_value_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;dict_o&gt; <span style="color: #DFAF8F;">dict</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">result</span> = null_c (env);
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: dict-&gt;obj_map) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = kv.second;
        result = cons_c (env, obj, result);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> result;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3ecdc45" class="outline-3">
<h3 id="org3ecdc45">dict_insert</h3>
<div class="outline-text-3" id="text-org3ecdc45">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;dict_o&gt;
<span style="color: #93E0E3;">dict_insert</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;dict_o&gt; <span style="color: #DFAF8F;">dict</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;sym_o&gt; <span style="color: #DFAF8F;">sym</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">value</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = dict-&gt;obj_map;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">key</span> = sym-&gt;sym;
    obj_map [key] = value;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_dict (env, obj_map);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5444dcf" class="outline-3">
<h3 id="org5444dcf">dict_merge</h3>
<div class="outline-text-3" id="text-org5444dcf">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;dict_o&gt;
<span style="color: #93E0E3;">dict_merge</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;dict_o&gt; <span style="color: #DFAF8F;">ante</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;dict_o&gt; <span style="color: #DFAF8F;">succ</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = ante-&gt;obj_map;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: succ-&gt;obj_map) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">key</span> = kv.first;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">value</span> = kv.second;
        obj_map [key] = value;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_dict (env, obj_map);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org808b67d" class="outline-3">
<h3 id="org808b67d">dict_find</h3>
<div class="outline-text-3" id="text-org808b67d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">dict_find</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;dict_o&gt; <span style="color: #DFAF8F;">dict</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;sym_o&gt; <span style="color: #DFAF8F;">sym</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = dict-&gt;obj_map;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">key</span> = sym-&gt;sym;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = obj_map.find (key);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != obj_map.end ()) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">value</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> just_c (env, value);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> nothing_c (env);
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3e1248a" class="outline-2">
<h2 id="org3e1248a">scan</h2>
<div class="outline-text-2" id="text-org3e1248a">
</div><div id="outline-container-org19d9884" class="outline-3">
<h3 id="org19d9884">space_char_p</h3>
<div class="outline-text-3" id="text-org19d9884">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">space_char_p</span> (<span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> c == <span style="color: #DCDCCC; background-color: #3F3F3F;">' </span><span style="color: #D0BF8F; font-weight: bold;">'</span>
        <span style="color: #F0DFAF; font-weight: bold;">or</span> c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'\n</span><span style="color: #D0BF8F; font-weight: bold;">'</span>
        <span style="color: #F0DFAF; font-weight: bold;">or</span> c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'\t</span><span style="color: #D0BF8F; font-weight: bold;">'</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgee23726" class="outline-3">
<h3 id="orgee23726">delimiter_char_p</h3>
<div class="outline-text-3" id="text-orgee23726">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">delimiter_char_p</span> (<span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'(</span><span style="color: #D0BF8F; font-weight: bold;">'</span>
        <span style="color: #F0DFAF; font-weight: bold;">or</span> c == <span style="color: #DCDCCC; background-color: #3F3F3F;">')</span><span style="color: #D0BF8F; font-weight: bold;">'</span>
        <span style="color: #F0DFAF; font-weight: bold;">or</span> c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'[</span><span style="color: #D0BF8F; font-weight: bold;">'</span>
        <span style="color: #F0DFAF; font-weight: bold;">or</span> c == <span style="color: #DCDCCC; background-color: #3F3F3F;">']</span><span style="color: #D0BF8F; font-weight: bold;">'</span>
        <span style="color: #F0DFAF; font-weight: bold;">or</span> c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'{</span><span style="color: #D0BF8F; font-weight: bold;">'</span>
        <span style="color: #F0DFAF; font-weight: bold;">or</span> c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'}</span><span style="color: #D0BF8F; font-weight: bold;">'</span>
        <span style="color: #F0DFAF; font-weight: bold;">or</span> c == <span style="color: #DCDCCC; background-color: #3F3F3F;">',</span><span style="color: #D0BF8F; font-weight: bold;">'</span>
        <span style="color: #F0DFAF; font-weight: bold;">or</span> c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'`</span><span style="color: #D0BF8F; font-weight: bold;">'</span>
        <span style="color: #F0DFAF; font-weight: bold;">or</span> c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'\''</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1b73f23" class="outline-3">
<h3 id="org1b73f23">semicolon_char_p</h3>
<div class="outline-text-3" id="text-org1b73f23">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">semicolon_char_p</span> (<span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> (c == <span style="color: #DCDCCC; background-color: #3F3F3F;">';</span><span style="color: #D0BF8F; font-weight: bold;">'</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc97a221" class="outline-3">
<h3 id="orgc97a221">newline_char_p</h3>
<div class="outline-text-3" id="text-orgc97a221">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">newline_char_p</span> (<span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> (c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'\n</span><span style="color: #D0BF8F; font-weight: bold;">'</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5428822" class="outline-3">
<h3 id="org5428822">string_from_char</h3>
<div class="outline-text-3" id="text-org5428822">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">string_from_char</span> (<span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span> = <span style="color: #CC9393;">""</span>;
    str.push_back (c);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> str;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1588e96" class="outline-3">
<h3 id="org1588e96">doublequote_char_p</h3>
<div class="outline-text-3" id="text-org1588e96">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">doublequote_char_p</span> (<span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'"</span><span style="color: #D0BF8F; font-weight: bold;">'</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd809921" class="outline-3">
<h3 id="orgd809921">find_word_length</h3>
<div class="outline-text-3" id="text-orgd809921">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">size_t</span>
<span style="color: #93E0E3;">find_word_length</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">code</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">begin</span>)
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">length</span> = code.length ();
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span> = begin;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #BFEBBF;">true</span>) {
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (index == length)
            <span style="color: #F0DFAF; font-weight: bold;">return</span> index - begin;
        <span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span> = code [index];
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (space_char_p (c) <span style="color: #F0DFAF; font-weight: bold;">or</span>
            doublequote_char_p (c) <span style="color: #F0DFAF; font-weight: bold;">or</span>
            semicolon_char_p (c) <span style="color: #F0DFAF; font-weight: bold;">or</span>
            delimiter_char_p (c))
            <span style="color: #F0DFAF; font-weight: bold;">return</span> index - begin;
        index++;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org999f79a" class="outline-3">
<h3 id="org999f79a">find_string_length</h3>
<div class="outline-text-3" id="text-org999f79a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">size_t</span>
<span style="color: #93E0E3;">find_string_length</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">code</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">begin</span>)
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">length</span> = code.length ();
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span> = begin + 1;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #BFEBBF;">true</span>) {
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (index == length) {
            cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : find_string_length"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
            cout &lt;&lt; <span style="color: #CC9393;">"  doublequote mismatch"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
            exit (1);
        }
        <span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span> = code [index];
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (doublequote_char_p (c))
            <span style="color: #F0DFAF; font-weight: bold;">return</span> index - begin + 1;
        index++;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5a45fd9" class="outline-3">
<h3 id="org5a45fd9">find_comment_length</h3>
<div class="outline-text-3" id="text-org5a45fd9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">size_t</span>
<span style="color: #93E0E3;">find_comment_length</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">code</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">begin</span>)
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">length</span> = code.length ();
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span> = begin;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #BFEBBF;">true</span>) {
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (index == length) {
            cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : find_string_length"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
            cout &lt;&lt; <span style="color: #CC9393;">"  end-of-line mismatch"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
            exit (1);
        }
        <span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span> = code [index];
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (newline_char_p (c))
            <span style="color: #F0DFAF; font-weight: bold;">return</span> index - begin + 1;
        index++;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4b3f8ab" class="outline-3">
<h3 id="org4b3f8ab">scan_word_vector</h3>
<div class="outline-text-3" id="text-org4b3f8ab">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string_vector_t</span>
<span style="color: #93E0E3;">scan_word_vector</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">code</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">string_vector</span> = string_vector_t ();
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">i</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (i &lt; code.length ()) {
        <span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span> = code [i];
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (space_char_p (c)) i++;
        <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (delimiter_char_p (c)) {
            string_vector.push_back (string_from_char (c));
            i++;
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (semicolon_char_p (c)) {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">length</span> = find_comment_length (code, i);
            i += length;
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (doublequote_char_p (c)) {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">length</span> = find_string_length (code, i);
            <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span> = code.substr (i, length);
            string_vector.push_back (str);
            i += length;
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">length</span> = find_word_length (code, i);
            <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">word</span> = code.substr (i, length);
            string_vector.push_back (word);
            i += length;
        }
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> string_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd3ff936" class="outline-3">
<h3 id="orgd3ff936">test_scan</h3>
<div class="outline-text-3" id="text-orgd3ff936">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_scan</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">code</span> = <span style="color: #CC9393;">"(cons-c &lt;car&gt; &lt;cdr&gt;)"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">string_vector</span> = scan_word_vector (code);
    assert (string_vector.size () == 5);
    assert (string_vector [0] == <span style="color: #CC9393;">"("</span>);
    assert (string_vector [1] == <span style="color: #CC9393;">"cons-c"</span>);
    assert (string_vector [2] == <span style="color: #CC9393;">"&lt;car&gt;"</span>);
    assert (string_vector [3] == <span style="color: #CC9393;">"&lt;cdr&gt;"</span>);
    assert (string_vector [4] == <span style="color: #CC9393;">")"</span>);

    {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">code</span> = <span style="color: #CC9393;">"\"123\""</span>;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">string_vector</span> = scan_word_vector (code);
        assert (string_vector.size () == 1);
        assert (string_vector [0] == <span style="color: #CC9393;">"\"123\""</span>);
    }

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8d583f9" class="outline-2">
<h2 id="org8d583f9">sexp</h2>
<div class="outline-text-2" id="text-org8d583f9">
</div><div id="outline-container-org618a90d" class="outline-3">
<h3 id="org618a90d"><span class="done _note_">[note]</span> about literal in quote</h3>
<div class="outline-text-3" id="text-org618a90d">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">( )</td>
<td class="org-left">list-t</td>
</tr>

<tr>
<td class="org-left">[ ]</td>
<td class="org-left">vect-t</td>
</tr>

<tr>
<td class="org-left">{ }</td>
<td class="org-left">dict-t</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org8e2279f" class="outline-3">
<h3 id="org8e2279f">word_vector_to_word_list &#x2013; drop `,`</h3>
<div class="outline-text-3" id="text-org8e2279f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">word_vector_to_word_list</span>
(<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">string_vector_t</span> &amp;<span style="color: #DFAF8F;">word_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = word_vector.rbegin ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = word_vector.rend ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">collect</span> = null_c (env);
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word</span> = *it;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (word != <span style="color: #CC9393;">","</span>) {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = make_str (env, word);
            collect = cons_c (env, obj, collect);
        }
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> collect;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd6fe89e" class="outline-3">
<h3 id="orgd6fe89e">scan_word_list</h3>
<div class="outline-text-3" id="text-orgd6fe89e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">scan_word_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;str_o&gt; <span style="color: #DFAF8F;">code</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word_vector</span> = scan_word_vector (code-&gt;str);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> word_vector_to_word_list
        (env, word_vector);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org295fa0f" class="outline-3">
<h3 id="org295fa0f">bar_word_p</h3>
<div class="outline-text-3" id="text-org295fa0f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">bar_word_p</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">word</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> word == <span style="color: #CC9393;">"("</span>
        <span style="color: #F0DFAF; font-weight: bold;">or</span> word == <span style="color: #CC9393;">"["</span>
        <span style="color: #F0DFAF; font-weight: bold;">or</span> word == <span style="color: #CC9393;">"{"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5a55d4a" class="outline-3">
<h3 id="org5a55d4a">ket_word_p</h3>
<div class="outline-text-3" id="text-org5a55d4a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">ket_word_p</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">word</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> word == <span style="color: #CC9393;">")"</span>
        <span style="color: #F0DFAF; font-weight: bold;">or</span> word == <span style="color: #CC9393;">"]"</span>
        <span style="color: #F0DFAF; font-weight: bold;">or</span> word == <span style="color: #CC9393;">"}"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc547f4e" class="outline-3">
<h3 id="orgc547f4e">quote_word_p</h3>
<div class="outline-text-3" id="text-orgc547f4e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">quote_word_p</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">word</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> word == <span style="color: #CC9393;">"'"</span>
        <span style="color: #F0DFAF; font-weight: bold;">or</span> word == <span style="color: #CC9393;">"`"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4d9be62" class="outline-3">
<h3 id="org4d9be62">unquote_word_p</h3>
<div class="outline-text-3" id="text-org4d9be62">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">unquote_word_p</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">word</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> word == <span style="color: #CC9393;">"~"</span>
        <span style="color: #F0DFAF; font-weight: bold;">or</span> word == <span style="color: #CC9393;">"~@"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org605b015" class="outline-3">
<h3 id="org605b015">bar_word_to_ket_word</h3>
<div class="outline-text-3" id="text-org605b015">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">bar_word_to_ket_word</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">bar</span>)
{
    assert (bar_word_p (bar));
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (bar == <span style="color: #CC9393;">"("</span>) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">")"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (bar == <span style="color: #CC9393;">"["</span>) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"]"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (bar == <span style="color: #CC9393;">"{"</span>) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"}"</span>;
    cout &lt;&lt; <span style="color: #CC9393;">"bar_word_to_ket_word fail\n"</span>;
    exit (1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7669d60" class="outline-3">
<h3 id="org7669d60">word_list_head_with_bar_ket_counter</h3>
<div class="outline-text-3" id="text-org7669d60">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">word_list_head_with_bar_ket_counter</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">word_list</span>,
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">bar</span>,
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">ket</span>,
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">counter</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (counter == 0)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> null_c (env);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = as_str (car (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word</span> = head-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == bar)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (
            env, head, word_list_head_with_bar_ket_counter (
                env, cdr (env, word_list),
                bar, ket, counter + 1));
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == ket)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (
            env, head, word_list_head_with_bar_ket_counter (
                env,
                cdr (env, word_list),
                bar, ket, counter - 1));
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (
            env, head, word_list_head_with_bar_ket_counter (
                env,
                cdr (env, word_list),
                bar, ket, counter));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1fab9cd" class="outline-3">
<h3 id="org1fab9cd">word_list_head</h3>
<div class="outline-text-3" id="text-org1fab9cd">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">word_list_head</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">word_list</span>)
{
    assert (cons_p (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = as_str (car (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word</span> = head-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (bar_word_p (word)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bar</span> = word;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">ket</span> = bar_word_to_ket_word (word);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (
            env, head, word_list_head_with_bar_ket_counter (
                env,
                cdr (env, word_list),
                bar, ket, 1));
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (quote_word_p (word))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (
            env, head, word_list_head (env, cdr (env, word_list)));
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (unquote_word_p (word))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (
            env, head, word_list_head (env, cdr (env, word_list)));
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> unit_list (env, head);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4c9a6e" class="outline-3">
<h3 id="org4c9a6e">word_list_rest_with_bar_ket_counter</h3>
<div class="outline-text-3" id="text-org4c9a6e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">word_list_rest_with_bar_ket_counter</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">word_list</span>,
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">bar</span>,
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">ket</span>,
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">counter</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (counter == 0)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> word_list;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = as_str (car (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word</span> = head-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == bar)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> word_list_rest_with_bar_ket_counter (
            env,
            cdr (env, word_list),
            bar, ket, counter + 1);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == ket)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> word_list_rest_with_bar_ket_counter (
            env,
            cdr (env, word_list),
            bar, ket, counter - 1);
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> word_list_rest_with_bar_ket_counter (
            env,
            cdr (env, word_list),
            bar, ket, counter);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org86fd214" class="outline-3">
<h3 id="org86fd214">word_list_rest</h3>
<div class="outline-text-3" id="text-org86fd214">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">word_list_rest</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">word_list</span>)
{
    assert (cons_p (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = as_str (car (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word</span> = head-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (bar_word_p (word)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bar</span> = word;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">ket</span> = bar_word_to_ket_word (word);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> word_list_rest_with_bar_ket_counter
            (env,
             cdr (env, word_list),
             bar, ket, 1);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (quote_word_p (word))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> word_list_rest (env, cdr (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (unquote_word_p (word))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> word_list_rest (env, cdr (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cdr (env, word_list);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd8a702" class="outline-3">
<h3 id="orgd8a702">word_list_drop_ket</h3>
<div class="outline-text-3" id="text-orgd8a702">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">word_list_drop_ket</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">word_list</span>,
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">ket</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, word_list);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, word_list);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, rest))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> null_c (env);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">cdr_rest</span> = cdr (env, rest);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">car_rest</span> = as_str (car (env, rest));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word</span> = car_rest-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, cdr_rest)) {
        assert (word == ket);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> unit_list (env, head);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (
            env, head,
            word_list_drop_ket (env, rest, ket));
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org547c968" class="outline-3">
<h3 id="org547c968">string_string_p</h3>
<div class="outline-text-3" id="text-org547c968">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">string_string_p</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = str.size ();
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (size &lt; 2) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (str [0] != <span style="color: #DCDCCC; background-color: #3F3F3F;">'"</span><span style="color: #D0BF8F; font-weight: bold;">'</span>) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (str [size-1] != <span style="color: #DCDCCC; background-color: #3F3F3F;">'"</span><span style="color: #D0BF8F; font-weight: bold;">'</span>) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5b12937" class="outline-3">
<h3 id="org5b12937">string_string_to_string</h3>
<div class="outline-text-3" id="text-org5b12937">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">string_string_to_string</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = str.size () - 2;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> str.substr (1, size);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org54256e2" class="outline-3">
<h3 id="org54256e2">num_string_p</h3>
<div class="outline-text-3" id="text-org54256e2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">num_string_p</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = str.size ();
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (size &lt; 1) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (str [0] == <span style="color: #DCDCCC; background-color: #3F3F3F;">'-</span><span style="color: #D0BF8F; font-weight: bold;">'</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> num_string_p (str.substr (1, size - 1));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">string_vector</span> = string_split (str, <span style="color: #DCDCCC; background-color: #3F3F3F;">'.</span><span style="color: #D0BF8F; font-weight: bold;">'</span>);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (string_vector.size () == 0) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (string_vector.size () &gt;= 3) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">pos</span> = str.find_first_not_of (<span style="color: #CC9393;">"0123456789."</span>);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (pos != <span style="color: #BFEBBF;">string</span>::npos) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd5f3908" class="outline-3">
<h3 id="orgd5f3908">sexp_list_to_vect</h3>
<div class="outline-text-3" id="text-orgd5f3908">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;vect_o&gt;
<span style="color: #93E0E3;">sexp_list_to_vect</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp_list</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> list_to_vect (env, sexp_list);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org126475a" class="outline-3">
<h3 id="org126475a">sexp_list_prefix_assign_with_last_sexp</h3>
<div class="outline-text-3" id="text-org126475a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">sexp_list_prefix_assign</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp_list</span>);

<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">sexp_list_prefix_assign_with_last_sexp</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp_list</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">last_sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, sexp_list)) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> unit_list (env, last_sexp);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, sexp_list);
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (sym_p (env, head) <span style="color: #F0DFAF; font-weight: bold;">and</span> as_sym (head) -&gt;sym == <span style="color: #CC9393;">"="</span>) {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">next</span> = car (env, cdr (env, sexp_list));
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, cdr (env, sexp_list));
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">new_last_sexp</span> = cons_c (
                env, head, cons_c (
                    env, last_sexp,
                    unit_list (env, next)));
            <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (
                env, new_last_sexp,
                sexp_list_prefix_assign (
                    env, rest));
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, sexp_list);
            <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (
                env, last_sexp,
                sexp_list_prefix_assign_with_last_sexp (
                    env, rest, head));
        }
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgea23460" class="outline-3">
<h3 id="orgea23460">sexp_list_prefix_assign</h3>
<div class="outline-text-3" id="text-orgea23460">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">sexp_list_prefix_assign</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp_list</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, sexp_list))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> sexp_list;
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> sexp_list_prefix_assign_with_last_sexp (
            env,
            cdr (env, sexp_list),
            car (env, sexp_list));
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4d2e1b2" class="outline-3">
<h3 id="org4d2e1b2">sexp_list_assign_to_pair</h3>
<div class="outline-text-3" id="text-org4d2e1b2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">sexp_list_assign_to_pair</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp_list</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, sexp_list))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> sexp_list;
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (
            env,
            cdr (env, car (env, sexp_list)),
            sexp_list_assign_to_pair (
                env, cdr (env, sexp_list)));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org86d02ac" class="outline-3">
<h3 id="org86d02ac">sexp_list_to_dict</h3>
<div class="outline-text-3" id="text-org86d02ac">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;dict_o&gt;
<span style="color: #93E0E3;">sexp_list_to_dict</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp_list</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> list_to_dict (
        env, sexp_list_assign_to_pair (
            env, sexp_list_prefix_assign (env, sexp_list)));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf90b097" class="outline-3">
<h3 id="orgf90b097"><span class="done _note_">[note]</span> about sexp</h3>
<div class="outline-text-3" id="text-orgf90b097">
<ul class="org-ul">
<li><p>sexp-t := str-t | sym-t | num-t |</p><p>(list-t sexp-t) | (vect-t sexp-t) | (dict-t sym-t sexp-t)</p></li></ul>
</div>
</div>

<div id="outline-container-org28851f2" class="outline-3">
<h3 id="org28851f2">parse_sexp</h3>
<div class="outline-text-3" id="text-org28851f2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">parse_sexp_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">word_list</span>);

<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">parse_sexp</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">word_list</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = as_str (car (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word</span> = head-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, word_list);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == <span style="color: #CC9393;">"("</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> parse_sexp_list (
            env,
            word_list_drop_ket (env, rest, <span style="color: #CC9393;">")"</span>));
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == <span style="color: #CC9393;">"["</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> sexp_list_to_vect (
            env, parse_sexp_list (
                env, word_list_drop_ket (env, rest, <span style="color: #CC9393;">"]"</span>)));
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == <span style="color: #CC9393;">"{"</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> sexp_list_to_dict (
            env, parse_sexp_list (
                env, word_list_drop_ket (env, rest, <span style="color: #CC9393;">"}"</span>)));
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == <span style="color: #CC9393;">"'"</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (env, make_sym (env, <span style="color: #CC9393;">"quote"</span>),
                       unit_list (env, parse_sexp (env, rest)));
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == <span style="color: #CC9393;">"`"</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (env, make_sym (env, <span style="color: #CC9393;">"quasiquote"</span>),
                       unit_list (env, parse_sexp (env, rest)));
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == <span style="color: #CC9393;">"~"</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (env, make_sym (env, <span style="color: #CC9393;">"unquote"</span>),
                       unit_list (env, parse_sexp (env, rest)));
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == <span style="color: #CC9393;">"~@"</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (env, make_sym (env, <span style="color: #CC9393;">"unquote-splicing"</span>),
                       unit_list (env, parse_sexp (env, rest)));
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (num_string_p (word))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> make_num (env, s2n (word));
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (string_string_p (word))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> make_str (env, string_string_to_string (word));
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> make_sym (env, word);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6c15e3d" class="outline-3">
<h3 id="org6c15e3d">parse_sexp_list</h3>
<div class="outline-text-3" id="text-org6c15e3d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">parse_sexp_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">word_list</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, word_list))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> word_list;
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (
            env,
            parse_sexp (env, word_list_head (env, word_list)),
            parse_sexp_list (env, word_list_rest (env, word_list)));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaa5ab02" class="outline-3">
<h3 id="orgaa5ab02">sexp_repr</h3>
<div class="outline-text-3" id="text-orgaa5ab02">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">sexp_list_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>);

<span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">sexp_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, a)) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"()"</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (cons_p (env, a)) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"("</span> + sexp_list_repr (env, a) + <span style="color: #CC9393;">")"</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (vect_p (env, a)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">v</span> = as_vect (a);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">l</span> = vect_to_list (env, v);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"["</span> + sexp_list_repr (env, l) + <span style="color: #CC9393;">"]"</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (dict_p (env, a)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">d</span> = as_dict (a);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">l</span> = dict_to_list (env, d);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"{"</span> + sexp_list_repr (env, l) + <span style="color: #CC9393;">"}"</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (str_p (env, a)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = as_str (a);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #DCDCCC; background-color: #3F3F3F;">'"'</span> + str-&gt;str + <span style="color: #DCDCCC; background-color: #3F3F3F;">'"</span><span style="color: #D0BF8F; font-weight: bold;">'</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (sym_p (env, a)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sym</span> = as_sym (a);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> sym-&gt;sym;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;repr (env);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2c39170" class="outline-3">
<h3 id="org2c39170">sexp_list_repr</h3>
<div class="outline-text-3" id="text-org2c39170">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">sexp_list_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp_list</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, sexp_list))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">""</span>;
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, cdr (env, sexp_list)))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> sexp_repr (env, car (env, sexp_list));
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, cdr (env, sexp_list)))
        <span style="color: #F0DFAF; font-weight: bold;">return</span>
            sexp_repr (env, car (env, sexp_list)) + <span style="color: #CC9393;">" . "</span> +
            sexp_repr (env, cdr (env, sexp_list));
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span>
            sexp_repr (env, car (env, sexp_list)) + <span style="color: #CC9393;">" "</span> +
            sexp_list_repr (env, cdr (env, sexp_list));
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6d3e213" class="outline-2">
<h2 id="org6d3e213">system</h2>
<div class="outline-text-2" id="text-org6d3e213">
</div><div id="outline-container-orgc43fbff" class="outline-3">
<h3 id="orgc43fbff">system_env_find</h3>
<div class="outline-text-3" id="text-orgc43fbff">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">system_env_find</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env_var</span> = name.c_str ();
    <span style="color: #F0DFAF; font-weight: bold;">const</span> <span style="color: #7CB8BB;">char</span>* <span style="color: #DFAF8F;">env_p</span> = getenv (env_var);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (env_p) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> string (env_p);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> string ();
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgee78dcf" class="outline-3">
<h3 id="orgee78dcf">dollar_string_p</h3>
<div class="outline-text-3" id="text-orgee78dcf">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">dollar_string_p</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">s</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = s.size ();
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (size &lt; 2) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> s [0] == <span style="color: #DCDCCC; background-color: #3F3F3F;">'$</span><span style="color: #D0BF8F; font-weight: bold;">'</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org62e083b" class="outline-3">
<h3 id="org62e083b">dollar_string_to_name</h3>
<div class="outline-text-3" id="text-org62e083b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_t</span>
<span style="color: #93E0E3;">dollar_string_to_name</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">dollar_string</span>)
{
    assert (dollar_string_p (dollar_string));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = dollar_string.size ();
    <span style="color: #F0DFAF; font-weight: bold;">return</span> dollar_string.substr (1, size -1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5282b90" class="outline-3">
<h3 id="org5282b90">expend_path</h3>
<div class="outline-text-3" id="text-org5282b90">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">path_t</span>
<span style="color: #93E0E3;">expend_path</span> (<span style="color: #7CB8BB;">path_t</span> <span style="color: #DFAF8F;">p</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">string_vector</span> = string_split (p.string (), <span style="color: #DCDCCC; background-color: #3F3F3F;">'/</span><span style="color: #D0BF8F; font-weight: bold;">'</span>);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">result_vector</span> = string_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span>: string_vector) {
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (dollar_string_p (str)) {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = dollar_string_to_name (str);
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">result</span> = system_env_find (name);
            <span style="color: #F0DFAF; font-weight: bold;">if</span> (result == <span style="color: #CC9393;">""</span>) {
                cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : expend_path"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
                cout &lt;&lt; <span style="color: #CC9393;">"  a var is unbound"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
                cout &lt;&lt; <span style="color: #CC9393;">"  var : "</span> &lt;&lt; str &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
                exit (1);
            }
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">pos</span> = result.find (<span style="color: #CC9393;">":"</span>);
            <span style="color: #F0DFAF; font-weight: bold;">if</span> (pos != <span style="color: #BFEBBF;">string</span>::npos) {
                cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : expend_path"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
                cout &lt;&lt; <span style="color: #CC9393;">"  a var must be bound to one string"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
                cout &lt;&lt; <span style="color: #CC9393;">"  var : "</span> &lt;&lt; str &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
                cout &lt;&lt; <span style="color: #CC9393;">"  string list : "</span> &lt;&lt; result &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
                exit (1);
            }
            result_vector.push_back (result);
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> {
            result_vector.push_back (str);
        }
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> path_t (string_vector_join (result_vector, <span style="color: #DCDCCC; background-color: #3F3F3F;">'/</span><span style="color: #D0BF8F; font-weight: bold;">'</span>));
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1b3d323" class="outline-2">
<h2 id="org1b3d323">module</h2>
<div class="outline-text-2" id="text-org1b3d323">
</div><div id="outline-container-org3479c7e" class="outline-3">
<h3 id="org3479c7e">module_o</h3>
<div class="outline-text-3" id="text-org3479c7e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">module_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">env_t</span> <span style="color: #DFAF8F;">module_env</span>;
    <span style="color: #93E0E3;">module_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">env_t</span> <span style="color: #DFAF8F;">module_env</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org120c16d" class="outline-3">
<h3 id="org120c16d">module_o::module_o</h3>
<div class="outline-text-3" id="text-org120c16d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">module_o</span>::<span style="color: #93E0E3;">module_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">env_t</span> <span style="color: #DFAF8F;">module_env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = module_tag;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;module_env = module_env;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: module_env.box_map) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = kv.first;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = kv.second;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> box-&gt;empty_p) {
            <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map [name] = box-&gt;obj;
        }
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdb03a99" class="outline-3">
<h3 id="orgdb03a99"><span class="todo _todo_">[todo]</span> eq_env_p</h3>
<div class="outline-text-3" id="text-orgdb03a99">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">eq_env_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">lhs</span>, <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">rhs</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org56429e1" class="outline-3">
<h3 id="org56429e1">module_o::eq</h3>
<div class="outline-text-3" id="text-org56429e1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">module_o</span>::<span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;module_o&gt; (obj);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> eq_env_p (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;module_env, that-&gt;module_env);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org770aa83" class="outline-3">
<h3 id="org770aa83">module_o::repr</h3>
<div class="outline-text-3" id="text-org770aa83">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">module_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"(module)"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org255feb2" class="outline-2">
<h2 id="org255feb2">compile</h2>
<div class="outline-text-2" id="text-org255feb2">
</div><div id="outline-container-orge5e2ad0" class="outline-3">
<h3 id="orge5e2ad0">forward declaration</h3>
<div class="outline-text-3" id="text-orge5e2ad0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">symbol_compile</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
    <span style="color: #7CB8BB;">symbol</span> <span style="color: #DFAF8F;">sym</span>);

<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">sexp_compile</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>);

<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">sexp_list_compile</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp_list</span>);
</pre>
</div>
</div>
</div>

<div id="outline-container-org430bc26" class="outline-3">
<h3 id="org430bc26">lit_compile</h3>
<div class="outline-text-3" id="text-org430bc26">
</div><div id="outline-container-orgf8374fb" class="outline-4">
<h4 id="orgf8374fb">lit_jo</h4>
<div class="outline-text-4" id="text-orgf8374fb">
</div><div id="outline-container-orgb6eabdd" class="outline-5">
<h5 id="orgb6eabdd">lit_jo_t</h5>
<div class="outline-text-5" id="text-orgb6eabdd">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">lit_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>;
    <span style="color: #93E0E3;">lit_jo_t</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org5dc2a81" class="outline-5">
<h5 id="org5dc2a81">lit_jo_t::lit_jo_t</h5>
<div class="outline-text-5" id="text-org5dc2a81">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">lit_jo_t</span>::
<span style="color: #93E0E3;">lit_jo_t</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj = obj;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb5c4993" class="outline-5">
<h5 id="orgb5c4993">lit_jo_t::copy</h5>
<div class="outline-text-5" id="text-orgb5c4993">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">lit_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">lit_jo_t</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2865b96" class="outline-5">
<h5 id="org2865b96">lit_jo_t::exe</h5>
<div class="outline-text-5" id="text-org2865b96">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">lit_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    env.obj_stack.push (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4a34911" class="outline-5">
<h5 id="org4a34911">lit_jo_t::repr</h5>
<div class="outline-text-5" id="text-org4a34911">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">lit_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj-&gt;repr (env);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org74ac6e" class="outline-4">
<h4 id="org74ac6e">lit_compile</h4>
<div class="outline-text-4" id="text-org74ac6e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">lit_compile</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jo_vector</span> = jo_vector_t ();
    jo_vector.push_back (<span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">lit_jo_t</span> (sexp));;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org42852a4" class="outline-3">
<h3 id="org42852a4">field_symbol_compile</h3>
<div class="outline-text-3" id="text-org42852a4">
</div><div id="outline-container-orge31a3cd" class="outline-4">
<h4 id="orge31a3cd">field_jo</h4>
<div class="outline-text-4" id="text-orge31a3cd">
</div><div id="outline-container-org42e9ca4" class="outline-5">
<h5 id="org42e9ca4">field_jo_t</h5>
<div class="outline-text-5" id="text-org42e9ca4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">field_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>;
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #93E0E3;">field_jo_t</span> (<span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>);
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org995790a" class="outline-5">
<h5 id="org995790a">field_jo_t::field_jo_t</h5>
<div class="outline-text-5" id="text-org995790a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">field_jo_t</span>::<span style="color: #93E0E3;">field_jo_t</span> (<span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name = name;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org16f209e" class="outline-5">
<h5 id="org16f209e">field_jo_t::copy</h5>
<div class="outline-text-5" id="text-org16f209e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">field_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf0ecd55" class="outline-5">
<h5 id="orgf0ecd55">field_jo_t::exe</h5>
<div class="outline-text-5" id="text-orgf0ecd55">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">field_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
    env.obj_stack.pop ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = obj-&gt;obj_map.find (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != obj-&gt;obj_map.end ()) {
        env.obj_stack.push (it-&gt;second);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">type</span> = type_of (env, obj);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = type-&gt;obj_map.find (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name);
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != type-&gt;obj_map.end ()) {
            <span style="color: #F0DFAF; font-weight: bold;">if</span> (it-&gt;second-&gt;tag == closure_tag) {
                <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">method</span> = static_pointer_cast &lt;closure_o&gt;
                    (it-&gt;second);
                assert (method-&gt;name_vector.size () == 1);
                env.obj_stack.push (obj);
                method-&gt;apply (env, 1);
            }
            <span style="color: #F0DFAF; font-weight: bold;">else</span> {
                env.obj_stack.push (it-&gt;second);
            }
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> {
            cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : field_jo_t::exe"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
            cout &lt;&lt; <span style="color: #CC9393;">"  unknown field : "</span> &lt;&lt; <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
            cout &lt;&lt; <span style="color: #CC9393;">"  fail to find it in both object and type"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
            exit (1);
        }
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6461c59" class="outline-5">
<h5 id="org6461c59">field_jo_t::repr</h5>
<div class="outline-text-5" id="text-org6461c59">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">field_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"."</span> + <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org21d71ae" class="outline-4">
<h4 id="org21d71ae">field_symbol_p</h4>
<div class="outline-text-4" id="text-org21d71ae">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">field_symbol_p</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (string_string_p (str)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">pos</span> = str.find (<span style="color: #CC9393;">"."</span>);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> (pos != <span style="color: #BFEBBF;">string</span>::npos);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org924eb83" class="outline-4">
<h4 id="org924eb83">field_symbol_compile</h4>
<div class="outline-text-4" id="text-org924eb83">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">field_symbol_compile</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">string_vector</span> = string_split (str, <span style="color: #DCDCCC; background-color: #3F3F3F;">'.</span><span style="color: #D0BF8F; font-weight: bold;">'</span>);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = symbol_compile
        (env, local_ref_map, string_vector [0]);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = string_vector.begin () + 1;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = string_vector.end ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jo_vector</span> = jo_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++) {
        jo_vector.push_back (<span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (*it));
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo_append (jojo, make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector));
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2673b6c" class="outline-3">
<h3 id="org2673b6c">dot_symbol_compile</h3>
<div class="outline-text-3" id="text-org2673b6c">
</div><div id="outline-container-org17b3f1c" class="outline-4">
<h4 id="org17b3f1c">dot_symbol_p</h4>
<div class="outline-text-4" id="text-org17b3f1c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">dot_symbol_p</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = str.size ();
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (size &lt; 1) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> (str [0] == <span style="color: #DCDCCC; background-color: #3F3F3F;">'.</span><span style="color: #D0BF8F; font-weight: bold;">'</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcd8bb4c" class="outline-4">
<h4 id="orgcd8bb4c">dot_symbol_compile</h4>
<div class="outline-text-4" id="text-orgcd8bb4c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">dot_symbol_compile</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">string_vector</span> = string_split (str, <span style="color: #DCDCCC; background-color: #3F3F3F;">'.</span><span style="color: #D0BF8F; font-weight: bold;">'</span>);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = string_vector.begin () + 1;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = string_vector.end ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jo_vector</span> = jo_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++) {
        jo_vector.push_back (<span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (*it));
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2eaa371" class="outline-3">
<h3 id="org2eaa371">ref_compile</h3>
<div class="outline-text-3" id="text-org2eaa371">
</div><div id="outline-container-org2d7020d" class="outline-4">
<h4 id="org2d7020d">ref_jo</h4>
<div class="outline-text-4" id="text-org2d7020d">
</div><div id="outline-container-orga500adb" class="outline-5">
<h5 id="orga500adb">ref_jo_t</h5>
<div class="outline-text-5" id="text-orga500adb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">ref_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span>;
    <span style="color: #93E0E3;">ref_jo_t</span> (<span style="color: #7CB8BB;">box_t</span> *);
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaff17f8" class="outline-5">
<h5 id="orgaff17f8">ref_jo_t::ref_jo_t</h5>
<div class="outline-text-5" id="text-orgaff17f8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">ref_jo_t</span>::<span style="color: #93E0E3;">ref_jo_t</span> (<span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;box = box;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org81cf622" class="outline-5">
<h5 id="org81cf622">ref_jo_t::copy</h5>
<div class="outline-text-5" id="text-org81cf622">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">ref_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;box);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3181104" class="outline-5">
<h5 id="org3181104">ref_jo_t::exe</h5>
<div class="outline-text-5" id="text-org3181104">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">ref_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;box-&gt;empty_p) {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : ref_jo_t::exe fail"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  undefined name : "</span>
             &lt;&lt; name_of_box (env, box) &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        env.obj_stack.push (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;box-&gt;obj);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org111788a" class="outline-5">
<h5 id="org111788a">ref_jo_t::repr</h5>
<div class="outline-text-5" id="text-org111788a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">ref_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> name_of_box (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;box);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3df0804" class="outline-4">
<h4 id="org3df0804">local_ref_jo</h4>
<div class="outline-text-4" id="text-org3df0804">
</div><div id="outline-container-orgab649a1" class="outline-5">
<h5 id="orgab649a1">local_ref_jo_t</h5>
<div class="outline-text-5" id="text-orgab649a1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">local_ref_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">level</span>;
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span>;
    <span style="color: #93E0E3;">local_ref_jo_t</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">level</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span>);
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org44ef000" class="outline-5">
<h5 id="org44ef000">local_ref_jo_t::local_ref_jo_t</h5>
<div class="outline-text-5" id="text-org44ef000">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">local_ref_jo_t</span>::
<span style="color: #93E0E3;">local_ref_jo_t</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">level</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;level = level;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;index = index;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga0d5224" class="outline-5">
<h5 id="orga0d5224">local_ref_jo_t::copy</h5>
<div class="outline-text-5" id="text-orga0d5224">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">local_ref_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">local_ref_jo_t</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;level, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;index);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd8a9512" class="outline-5">
<h5 id="orgd8a9512">local_ref_jo_t::exe</h5>
<div class="outline-text-5" id="text-orgd8a9512">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">local_ref_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">this is the only place where</span>
    <span style="color: #5F7F5F;">//   </span><span style="color: #7F9F7F;">the local_scope in the arg of exe is uesd.</span>
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bind_vector</span> =
        local_scope [local_scope.size () - <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;level - 1];
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bind</span> =
        bind_vector [bind_vector.size () - <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;index - 1];
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = bind.second;
    env.obj_stack.push (obj);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2a67b3e" class="outline-5">
<h5 id="org2a67b3e">local_ref_jo_t::repr</h5>
<div class="outline-text-5" id="text-org2a67b3e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">local_ref_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"local."</span> +
        to_string (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;level) + <span style="color: #CC9393;">"."</span> +
        to_string (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;index);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org716d89f" class="outline-4">
<h4 id="org716d89f">ref_compile</h4>
<div class="outline-text-4" id="text-org716d89f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">ref_compile</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
    <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jo_vector</span> = jo_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = local_ref_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != local_ref_map.end ()) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_ref</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_ref_jo</span> = <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">local_ref_jo_t</span>
            (local_ref.first,
             local_ref.second);
        jo_vector.push_back (local_ref_jo);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        jo_vector.push_back (<span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, name)));
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc70cfb9" class="outline-3">
<h3 id="orgc70cfb9">symbol_compile</h3>
<div class="outline-text-3" id="text-orgc70cfb9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">symbol_compile</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
    <span style="color: #7CB8BB;">symbol</span> <span style="color: #DFAF8F;">sym</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (dot_symbol_p (sym))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> dot_symbol_compile (env, local_ref_map, sym);
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (field_symbol_p (sym))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> field_symbol_compile (env, local_ref_map, sym);
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> ref_compile (env, local_ref_map, sym);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgae3f752" class="outline-3">
<h3 id="orgae3f752">vect_compile</h3>
<div class="outline-text-3" id="text-orgae3f752">
</div><div id="outline-container-org700841c" class="outline-4">
<h4 id="org700841c">collect_vect_jo</h4>
<div class="outline-text-4" id="text-org700841c">
</div><div id="outline-container-org20be62c" class="outline-5">
<h5 id="org20be62c">collect_vect_jo_t</h5>
<div class="outline-text-5" id="text-org20be62c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">collect_vect_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">counter</span>;
    <span style="color: #93E0E3;">collect_vect_jo_t</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">counter</span>);
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org5e50bac" class="outline-5">
<h5 id="org5e50bac">collect_vect_jo_t::collect_vect_jo_t</h5>
<div class="outline-text-5" id="text-org5e50bac">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">collect_vect_jo_t</span>::
<span style="color: #93E0E3;">collect_vect_jo_t</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">counter</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;counter = counter;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8a5c772" class="outline-5">
<h5 id="org8a5c772">collect_vect_jo_t::copy</h5>
<div class="outline-text-5" id="text-org8a5c772">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">collect_vect_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">collect_vect_jo_t</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;counter);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org64384eb" class="outline-5">
<h5 id="org64384eb">collect_vect_jo_t::exe</h5>
<div class="outline-text-5" id="text-org64384eb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">collect_vect_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_vector</span> = obj_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (index &lt; <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;counter) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
        env.obj_stack.pop ();
        obj_vector.push_back (obj);
        index++;
    }
    reverse (obj_vector.begin (),
             obj_vector.end ());
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">vect</span> = make_vect (env, obj_vector);
    env.obj_stack.push (vect);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org382de1d" class="outline-5">
<h5 id="org382de1d">collect_vect_jo_t::repr</h5>
<div class="outline-text-5" id="text-org382de1d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">collect_vect_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"(collect-vect "</span> + to_string (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;counter) + <span style="color: #CC9393;">")"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf1dfc22" class="outline-4">
<h4 id="orgf1dfc22">vect_compile</h4>
<div class="outline-text-4" id="text-orgf1dfc22">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">vect_compile</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;vect_o&gt; <span style="color: #DFAF8F;">vect</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sexp_list</span> = vect_to_list (env, vect);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = sexp_list_compile
        (env, local_ref_map, sexp_list);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">counter</span> = list_size (env, sexp_list);
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">collect_vect_jo_t</span> (counter),
    };
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">ending_jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo_append (jojo, ending_jojo);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org13e524e" class="outline-3">
<h3 id="org13e524e">dict_compile</h3>
<div class="outline-text-3" id="text-org13e524e">
</div><div id="outline-container-orga96bda5" class="outline-4">
<h4 id="orga96bda5">collect_dict_jo</h4>
<div class="outline-text-4" id="text-orga96bda5">
</div><div id="outline-container-orga2a1333" class="outline-5">
<h5 id="orga2a1333">collect_dict_jo_t</h5>
<div class="outline-text-5" id="text-orga2a1333">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">collect_dict_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">counter</span>;
    <span style="color: #93E0E3;">collect_dict_jo_t</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">counter</span>);
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org6b18cea" class="outline-5">
<h5 id="org6b18cea">collect_dict_jo_t::collect_dict_jo_t</h5>
<div class="outline-text-5" id="text-org6b18cea">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">collect_dict_jo_t</span>::
<span style="color: #93E0E3;">collect_dict_jo_t</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">counter</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;counter = counter;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc18d860" class="outline-5">
<h5 id="orgc18d860">collect_dict_jo_t::copy</h5>
<div class="outline-text-5" id="text-orgc18d860">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">collect_dict_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">collect_dict_jo_t</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;counter);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga3b218f" class="outline-5">
<h5 id="orga3b218f">collect_dict_jo_t::exe</h5>
<div class="outline-text-5" id="text-orga3b218f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">collect_dict_jo_t</span>::<span style="color: #93E0E3;">exe</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = obj_map_t ();
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (index &lt; <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;counter) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
        env.obj_stack.pop ();
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = env.obj_stack.top ();
        env.obj_stack.pop ();
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">key</span> = as_sym (str);
        obj_map [key-&gt;sym] = obj;
        index++;
    }
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">dict</span> = make_dict (env, obj_map);
    env.obj_stack.push (dict);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2f2c8c2" class="outline-5">
<h5 id="org2f2c8c2">collect_dict_jo_t::repr</h5>
<div class="outline-text-5" id="text-org2f2c8c2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">collect_dict_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"(collect-dict "</span> + to_string (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;counter) + <span style="color: #CC9393;">")"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb9d2d3e" class="outline-4">
<h4 id="orgb9d2d3e">dict_compile</h4>
<div class="outline-text-4" id="text-orgb9d2d3e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">dict_compile</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;dict_o&gt; <span style="color: #DFAF8F;">dict</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sexp_list</span> = dict_to_flat_list (env, dict);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = sexp_list_compile
        (env, local_ref_map, sexp_list);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">counter</span> = list_size (env, sexp_list);
    counter = counter / 2;
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">collect_dict_jo_t</span> (counter),
    };
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">ending_jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo_append (jojo, ending_jojo);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9cdcf30" class="outline-3">
<h3 id="org9cdcf30">keyword_compile</h3>
<div class="outline-text-3" id="text-org9cdcf30">
</div><div id="outline-container-orga409583" class="outline-4">
<h4 id="orga409583">keyword</h4>
<div class="outline-text-4" id="text-orga409583">
</div><div id="outline-container-org9e4470d" class="outline-5">
<h5 id="org9e4470d">keyword_fn</h5>
<div class="outline-text-5" id="text-org9e4470d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">keyword_fn</span> = <span style="color: #7CB8BB;">function</span>
    &lt;<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (
         <span style="color: #7CB8BB;">env_t</span> &amp;,
         <span style="color: #DFAF8F;">local_ref_map_t</span> &amp;,
         <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;)&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-orga7464da" class="outline-5">
<h5 id="orga7464da">keyword_o</h5>
<div class="outline-text-5" id="text-orga7464da">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">keyword_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">keyword_fn</span> <span style="color: #DFAF8F;">fn</span>;
    <span style="color: #93E0E3;">keyword_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">keyword_fn</span> <span style="color: #DFAF8F;">fn</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org7edefc8" class="outline-5">
<h5 id="org7edefc8">keyword_o::keyword_o</h5>
<div class="outline-text-5" id="text-org7edefc8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">keyword_o</span>::
<span style="color: #93E0E3;">keyword_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">keyword_fn</span> <span style="color: #DFAF8F;">fn</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = keyword_tag;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;fn = fn;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfac6653" class="outline-5">
<h5 id="orgfac6653">keyword_o::eq</h5>
<div class="outline-text-5" id="text-orgfac6653">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">keyword_o</span>::<span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">this</span> != obj.get ();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdf9b77f" class="outline-5">
<h5 id="orgdf9b77f">keyword_p</h5>
<div class="outline-text-5" id="text-orgdf9b77f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">keyword_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == keyword_tag;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org40f51cf" class="outline-5">
<h5 id="org40f51cf">define_keyword</h5>
<div class="outline-text-5" id="text-org40f51cf">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">define_keyword</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>, <span style="color: #7CB8BB;">keyword_fn</span> <span style="color: #DFAF8F;">fn</span>)
{
    define (env, name, make_shared &lt;keyword_o&gt; (env, fn));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd028fc4" class="outline-5">
<h5 id="orgd028fc4">keyword_sexp_p</h5>
<div class="outline-text-5" id="text-orgd028fc4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">keyword_sexp_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, sexp)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> sym_p (env, (car (env, sexp)))) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = as_sym (car (env, sexp));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = head-&gt;sym;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.box_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.box_map.end ()) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (box-&gt;empty_p) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (keyword_p (env, box-&gt;obj)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
        <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org50285b6" class="outline-5">
<h5 id="org50285b6">keyword_fn_from_name</h5>
<div class="outline-text-5" id="text-org50285b6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">keyword_fn</span>
<span style="color: #93E0E3;">keyword_fn_from_name</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.box_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.box_map.end ()) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (box-&gt;empty_p) {
            cout &lt;&lt; <span style="color: #CC9393;">"- fatal error: keyword_fn_from_name fail\n"</span>;
            exit (1);
        }
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (keyword_p (env, box-&gt;obj)) {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">keyword</span> = static_pointer_cast &lt;keyword_o&gt;
                (box-&gt;obj);
            <span style="color: #F0DFAF; font-weight: bold;">return</span> keyword-&gt;fn;
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> {
            cout &lt;&lt; <span style="color: #CC9393;">"- fatal error: keyword_fn_from_name fail\n"</span>;
            exit (1);
        };
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error: keyword_fn_from_name fail\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3770d55" class="outline-4">
<h4 id="org3770d55">keyword_compile</h4>
<div class="outline-text-4" id="text-org3770d55">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">keyword_compile</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = as_sym (car (env, sexp));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">body</span> = cdr (env, sexp);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = head-&gt;sym;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">fn</span> = keyword_fn_from_name (env, name);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> fn (env, local_ref_map, body);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org15fb0c7" class="outline-3">
<h3 id="org15fb0c7">macro_compile</h3>
<div class="outline-text-3" id="text-org15fb0c7">
</div><div id="outline-container-org6cf06f" class="outline-4">
<h4 id="org6cf06f">macro</h4>
<div class="outline-text-4" id="text-org6cf06f">
</div><div id="outline-container-org1583a5f" class="outline-5">
<h5 id="org1583a5f">macro_o</h5>
<div class="outline-text-5" id="text-org1583a5f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">macro_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>;
    <span style="color: #93E0E3;">macro_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orge1a1154" class="outline-5">
<h5 id="orge1a1154">macro_o::macro_o</h5>
<div class="outline-text-5" id="text-orge1a1154">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">macro_o</span>::
<span style="color: #93E0E3;">macro_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = macro_tag;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj = obj;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6c18f61" class="outline-5">
<h5 id="org6c18f61">make_macro</h5>
<div class="outline-text-5" id="text-org6c18f61">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;macro_o&gt;
<span style="color: #93E0E3;">make_macro</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;macro_o&gt; (env, obj);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org23f6af" class="outline-5">
<h5 id="org23f6af">macro_p</h5>
<div class="outline-text-5" id="text-org23f6af">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">macro_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == macro_tag;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb5f9da7" class="outline-5">
<h5 id="orgb5f9da7">as_macro</h5>
<div class="outline-text-5" id="text-orgb5f9da7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;macro_o&gt;
<span style="color: #93E0E3;">as_macro</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    assert (obj-&gt;tag == macro_tag);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> static_pointer_cast &lt;macro_o&gt; (obj);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org93768f1" class="outline-5">
<h5 id="org93768f1">macro_o::eq</h5>
<div class="outline-text-5" id="text-org93768f1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">macro_o</span>::<span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = as_macro (obj);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> obj_eq (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj, that-&gt;obj);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org982efc6" class="outline-5">
<h5 id="org982efc6">forward declaration of sexp_eval</h5>
<div class="outline-text-5" id="text-org982efc6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">sexp_eval</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>);
</pre>
</div>
</div>
</div>

<div id="outline-container-org9fa6a33" class="outline-5">
<h5 id="org9fa6a33">macro_sexp_p</h5>
<div class="outline-text-5" id="text-org9fa6a33">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">macro_sexp_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, sexp)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, sexp);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> sym_p (env, head)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sym</span> = as_sym (head);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = sym-&gt;sym;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">found</span> = find_obj_from_name (env, name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> found) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = sexp_eval (env, head);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> macro_p (env, obj);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5a0a71e" class="outline-5">
<h5 id="org5a0a71e">macro_eval</h5>
<div class="outline-text-5" id="text-org5a0a71e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">macro_eval</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    assert (cons_p (env, sexp));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, sexp);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, sexp);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = sexp_eval (env, head);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">macro</span> = as_macro (obj);
    env.obj_stack.push (rest);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">base</span> = env.frame_stack.size ();
    macro-&gt;obj-&gt;apply (env, 1);
    env.run_with_base (base);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">new_sexp</span> = env.obj_stack.top ();
    env.obj_stack.pop ();
    <span style="color: #F0DFAF; font-weight: bold;">return</span> new_sexp;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7babf49" class="outline-5">
<h5 id="org7babf49">define_prim_macro</h5>
<div class="outline-text-5" id="text-org7babf49">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">define_prim_macro</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>, <span style="color: #7CB8BB;">prim_fn</span> <span style="color: #DFAF8F;">fn</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = name_vector_t ();
    name_vector.push_back (<span style="color: #CC9393;">"body"</span>);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">prim</span> = make_prim (
        env, name_vector, fn, <span style="color: #7CB8BB;">obj_map_t</span> ());
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">macro</span> = make_shared &lt;macro_o&gt; (env, prim);
    define (env, name, macro);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6d0a4d2" class="outline-4">
<h4 id="org6d0a4d2">macro_compile</h4>
<div class="outline-text-4" id="text-org6d0a4d2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">macro_compile</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> sexp_compile (
        env,
        local_ref_map,
        macro_eval (env, sexp));
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org318c9e0" class="outline-3">
<h3 id="org318c9e0">call_compile</h3>
<div class="outline-text-3" id="text-org318c9e0">
</div><div id="outline-container-org8679de3" class="outline-4">
<h4 id="org8679de3">apply_jo</h4>
<div class="outline-text-4" id="text-org8679de3">
</div><div id="outline-container-org836dae8" class="outline-5">
<h5 id="org836dae8">apply_jo_t</h5>
<div class="outline-text-5" id="text-org836dae8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">apply_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>;
    <span style="color: #93E0E3;">apply_jo_t</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>);
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org7d86038" class="outline-5">
<h5 id="org7d86038">apply_jo_t::apply_jo_t</h5>
<div class="outline-text-5" id="text-org7d86038">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">apply_jo_t</span>::
<span style="color: #93E0E3;">apply_jo_t</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;arity = arity;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5d5bdf0" class="outline-5">
<h5 id="org5d5bdf0">apply_jo_t::copy</h5>
<div class="outline-text-5" id="text-org5d5bdf0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">apply_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;arity);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4707048" class="outline-5">
<h5 id="org4707048">apply_jo_t::exe</h5>
<div class="outline-text-5" id="text-org4707048">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">apply_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
    env.obj_stack.pop ();
    obj-&gt;apply (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;arity);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3bb23b" class="outline-5">
<h5 id="org3bb23b">apply_jo_t::repr</h5>
<div class="outline-text-5" id="text-org3bb23b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">apply_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"(apply "</span> +
        to_string (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;arity) + <span style="color: #CC9393;">")"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgeabfd7c" class="outline-4">
<h4 id="orgeabfd7c">arity_of_body</h4>
<div class="outline-text-4" id="text-orgeabfd7c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">size_t</span>
<span style="color: #93E0E3;">arity_of_body</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    assert (list_p (env, body));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">arity</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> null_p (env, body)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, body);
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> sym_p (env, head)) {
            arity++;
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sym</span> = as_sym (head) -&gt;sym;
            <span style="color: #F0DFAF; font-weight: bold;">if</span> (dot_symbol_p (sym)) {
                <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">arity = arity;</span>
            }
            <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (sym == <span style="color: #CC9393;">"drop"</span>) {
                arity--;
            }
            <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (sym == <span style="color: #CC9393;">"dup"</span>) {
                arity++;
            }
            <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (sym == <span style="color: #CC9393;">"over"</span>) {
                arity++;
            }
            <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (sym == <span style="color: #CC9393;">"tuck"</span>) {
                arity++;
            }
            <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (sym == <span style="color: #CC9393;">"swap"</span>) {
                <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">arity = arity;</span>
            }
            <span style="color: #F0DFAF; font-weight: bold;">else</span> {
                arity++;
            }
        }
        body = cdr (env, body);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> arity;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org96f8be1" class="outline-4">
<h4 id="org96f8be1">call_compile</h4>
<div class="outline-text-4" id="text-org96f8be1">
<ul class="org-ul">
<li><p>the head still must be one word.</p></li></ul>

<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">call_compile</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, sexp);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">body</span> = cdr (env, sexp);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jo_vector</span> = jo_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">arity</span> = arity_of_body (env, body);
    jo_vector.push_back (<span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (arity));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head_jojo</span> = sexp_compile (env, local_ref_map, head);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">body_jojo</span> = sexp_list_compile (env, local_ref_map, body);
    jojo = jojo_append (head_jojo, jojo);
    jojo = jojo_append (body_jojo, jojo);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc595d3a" class="outline-3">
<h3 id="orgc595d3a">call_with_arg_dict_compile</h3>
<div class="outline-text-3" id="text-orgc595d3a">
</div><div id="outline-container-org79b5246" class="outline-4">
<h4 id="org79b5246">apply_to_arg_dict_jo</h4>
<div class="outline-text-4" id="text-org79b5246">
</div><div id="outline-container-orgbce206a" class="outline-5">
<h5 id="orgbce206a">apply_to_arg_dict_jo_t</h5>
<div class="outline-text-5" id="text-orgbce206a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">apply_to_arg_dict_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc1b210" class="outline-5">
<h5 id="orgc1b210">apply_to_arg_dict_jo_t::copy</h5>
<div class="outline-text-5" id="text-orgc1b210">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">apply_to_arg_dict_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_to_arg_dict_jo_t</span> ();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd024227" class="outline-5">
<h5 id="orgd024227">apply_to_arg_dict_jo_t::exe</h5>
<div class="outline-text-5" id="text-orgd024227">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">apply_to_arg_dict_jo_t</span>::<span style="color: #93E0E3;">exe</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
    env.obj_stack.pop ();
    obj-&gt;apply_to_arg_dict (env);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org31c7d37" class="outline-5">
<h5 id="org31c7d37">apply_to_arg_dict_jo_t::repr</h5>
<div class="outline-text-5" id="text-org31c7d37">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">apply_to_arg_dict_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"(apply-to-arg-dict)"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org77ab709" class="outline-4">
<h4 id="org77ab709">apply_to_arg_dict</h4>
<div class="outline-text-4" id="text-org77ab709">
</div><div id="outline-container-org8d9609e" class="outline-5">
<h5 id="org8d9609e">closure_o::apply_to_arg_dict</h5>
<div class="outline-text-5" id="text-org8d9609e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">closure_o</span>::<span style="color: #93E0E3;">apply_to_arg_dict</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
    env.obj_stack.pop ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">arg_dict</span> = as_dict (obj);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bind_vector</span> = bind_vector_merge_obj_map (
        env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;bind_vector, arg_dict-&gt;obj_map);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">have</span> = number_of_obj_in_bind_vector (bind_vector);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (size == have) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_scope</span> = local_scope_extend (
            <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;local_scope, bind_vector);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">frame</span> = make_shared &lt;<span style="color: #7CB8BB;">frame_t</span>&gt; (
            <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo, local_scope);
        env.frame_stack.push (frame);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">closure</span> = make_closure (
            env,
            <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector,
            <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo,
            bind_vector,
            <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;local_scope);
        env.obj_stack.push (closure);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org18ca2f8" class="outline-5">
<h5 id="org18ca2f8">prim_o::apply_to_arg_dict</h5>
<div class="outline-text-5" id="text-org18ca2f8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">prim_o</span>::<span style="color: #93E0E3;">apply_to_arg_dict</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
    env.obj_stack.pop ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">arg_dict</span> = as_dict (obj);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = obj_map_merge (
        env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map, arg_dict-&gt;obj_map);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">have</span> = obj_map.size ();
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (size == have) {
        <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;fn (env, obj_map);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">prim</span> = make_prim (
            env,
            <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector,
            <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;fn,
            obj_map);
        env.obj_stack.push (prim);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org952ca9d" class="outline-5">
<h5 id="org952ca9d">data_cons_o::apply_to_arg_dict</h5>
<div class="outline-text-5" id="text-org952ca9d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">data_cons_o</span>::<span style="color: #93E0E3;">apply_to_arg_dict</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
    env.obj_stack.pop ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">arg_dict</span> = as_dict (obj);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = obj_map_merge (
        env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map, arg_dict-&gt;obj_map);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">have</span> = obj_map.size ();
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (size == have) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">data</span> = make_data (
            env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag_of_type, obj_map);
        env.obj_stack.push (data);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">data_cons</span> = make_data_cons (
            env,
            <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag_of_type,
            <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector,
            obj_map);
        env.obj_stack.push (data_cons);
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc4c8836" class="outline-4">
<h4 id="orgc4c8836">call_with_arg_dict_sexp_p</h4>
<div class="outline-text-4" id="text-orgc4c8836">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">call_with_arg_dict_sexp_p</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, sexp)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">l</span> = cdr (env, sexp);
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> null_p (env, l)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, l);
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (sym_p (env, head) <span style="color: #F0DFAF; font-weight: bold;">and</span> as_sym (head) -&gt;sym == <span style="color: #CC9393;">"="</span>) {
            <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
        }
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (cons_p (env, head)) {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head_head</span> = car (env, head);
            <span style="color: #F0DFAF; font-weight: bold;">if</span> (sym_p (env, head_head) <span style="color: #F0DFAF; font-weight: bold;">and</span>
                as_sym (head_head) -&gt;sym == <span style="color: #CC9393;">"="</span>)
            {
                <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
            }
        }
        l = cdr (env, l);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgda217bf" class="outline-4">
<h4 id="orgda217bf">call_with_arg_dict_compile</h4>
<div class="outline-text-4" id="text-orgda217bf">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">call_with_arg_dict_compile</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, sexp);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">body</span> = cdr (env, sexp);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jo_vector</span> = jo_vector_t ();
    jo_vector.push_back (<span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_to_arg_dict_jo_t</span> ());
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head_jojo</span> = sexp_compile (env, local_ref_map, head);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">dict</span> = sexp_list_to_dict (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">body_jojo</span> = dict_compile (env, local_ref_map, dict);
    jojo = jojo_append (head_jojo, jojo);
    jojo = jojo_append (body_jojo, jojo);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgcbacaef" class="outline-3">
<h3 id="orgcbacaef">sexp_compile</h3>
<div class="outline-text-3" id="text-orgcbacaef">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">sexp_compile</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (str_p (env, sexp) <span style="color: #F0DFAF; font-weight: bold;">or</span>
        num_p (env, sexp))
    {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> lit_compile (env, local_ref_map, sexp);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (sym_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sym</span> = as_sym (sexp);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> symbol_compile (env, local_ref_map, sym-&gt;sym);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (vect_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> vect_compile (env, local_ref_map, as_vect (sexp));
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (dict_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> dict_compile (env, local_ref_map, as_dict (sexp));
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (keyword_sexp_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> keyword_compile (env, local_ref_map, sexp);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (macro_sexp_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> macro_compile (env, local_ref_map, sexp);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (call_with_arg_dict_sexp_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> call_with_arg_dict_compile (env, local_ref_map, sexp);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        assert (cons_p (env, sexp));
        <span style="color: #F0DFAF; font-weight: bold;">return</span> call_compile (env, local_ref_map, sexp);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org782e18c" class="outline-3">
<h3 id="org782e18c">sexp_list_compile</h3>
<div class="outline-text-3" id="text-org782e18c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">sexp_list_compile</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp_list</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (<span style="color: #DFAF8F;">jo_vector_t</span> ());
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, sexp_list))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo;
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        assert (cons_p (env, sexp_list));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head_jojo</span> = sexp_compile
            (env, local_ref_map, car (env, sexp_list));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">body_jojo</span> = sexp_list_compile
            (env, local_ref_map, cdr (env, sexp_list));
        <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo_append (head_jojo, body_jojo);
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9397074" class="outline-2">
<h2 id="org9397074">run</h2>
<div class="outline-text-2" id="text-org9397074">
</div><div id="outline-container-org3427d59" class="outline-3">
<h3 id="org3427d59">top_keyword</h3>
<div class="outline-text-3" id="text-org3427d59">
</div><div id="outline-container-org7cd8cd9" class="outline-4">
<h4 id="org7cd8cd9">top_keyword_fn</h4>
<div class="outline-text-4" id="text-org7cd8cd9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">top_keyword_fn</span> = <span style="color: #7CB8BB;">function</span>
    &lt;<span style="color: #7CB8BB;">void</span> (<span style="color: #7CB8BB;">env_t</span> &amp;, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;)&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-org8e85f99" class="outline-4">
<h4 id="org8e85f99">top_keyword_o</h4>
<div class="outline-text-4" id="text-org8e85f99">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">top_keyword_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">top_keyword_fn</span> <span style="color: #DFAF8F;">fn</span>;
    <span style="color: #93E0E3;">top_keyword_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">top_keyword_fn</span> <span style="color: #DFAF8F;">fn</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orge584764" class="outline-4">
<h4 id="orge584764">top_keyword_o::top_keyword_o</h4>
<div class="outline-text-4" id="text-orge584764">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">top_keyword_o</span>::
<span style="color: #93E0E3;">top_keyword_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">top_keyword_fn</span> <span style="color: #DFAF8F;">fn</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = top_keyword_tag;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;fn = fn;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5bb57b2" class="outline-4">
<h4 id="org5bb57b2">top_keyword_o::eq</h4>
<div class="outline-text-4" id="text-org5bb57b2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">top_keyword_o</span>::<span style="color: #93E0E3;">eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">this</span> != obj.get ();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2db80b9" class="outline-4">
<h4 id="org2db80b9">top_keyword_p</h4>
<div class="outline-text-4" id="text-org2db80b9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">top_keyword_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == top_keyword_tag;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgea131f1" class="outline-4">
<h4 id="orgea131f1">define_top_keyword</h4>
<div class="outline-text-4" id="text-orgea131f1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">define_top_keyword</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>, <span style="color: #7CB8BB;">top_keyword_fn</span> <span style="color: #DFAF8F;">fn</span>)
{
    define (env, name, make_shared &lt;top_keyword_o&gt; (env, fn));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3aa3b23" class="outline-4">
<h4 id="org3aa3b23">top_keyword_sexp_p</h4>
<div class="outline-text-4" id="text-org3aa3b23">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">top_keyword_sexp_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, sexp)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> sym_p (env, (car (env, sexp)))) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = as_sym (car (env, sexp));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = head-&gt;sym;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.box_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.box_map.end ()) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (box-&gt;empty_p) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (top_keyword_p (env, box-&gt;obj)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
        <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgadf9bf3" class="outline-4">
<h4 id="orgadf9bf3">top_keyword_fn_from_name</h4>
<div class="outline-text-4" id="text-orgadf9bf3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">top_keyword_fn</span>
<span style="color: #93E0E3;">top_keyword_fn_from_name</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.box_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.box_map.end ()) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (box-&gt;empty_p) {
            cout &lt;&lt; <span style="color: #CC9393;">"- fatal error: top_keyword_fn_from_name fail\n"</span>;
            exit (1);
        }
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (top_keyword_p (env, box-&gt;obj)) {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">top_keyword</span> = static_pointer_cast &lt;top_keyword_o&gt;
                (box-&gt;obj);
            <span style="color: #F0DFAF; font-weight: bold;">return</span> top_keyword-&gt;fn;
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> {
            cout &lt;&lt; <span style="color: #CC9393;">"- fatal error: top_keyword_fn_from_name fail\n"</span>;
            exit (1);
        };
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error: top_keyword_fn_from_name fail\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7ba13c4" class="outline-3">
<h3 id="org7ba13c4">jojo_run</h3>
<div class="outline-text-3" id="text-org7ba13c4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">jojo_run</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">base</span> = env.frame_stack.size ();
    env.frame_stack.push (make_shared &lt;<span style="color: #7CB8BB;">frame_t</span>&gt; (jojo, local_scope));
    env.run_with_base (base);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org83970cc" class="outline-3">
<h3 id="org83970cc">jojo_eval</h3>
<div class="outline-text-3" id="text-org83970cc">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">jojo_eval</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>)
{
    jojo_run (env, local_scope, jojo);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">result</span> = env.obj_stack.top ();
    env.obj_stack.pop ();
    <span style="color: #F0DFAF; font-weight: bold;">return</span> result;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7d019ce" class="outline-3">
<h3 id="org7d019ce">jojo_run_in_new_frame</h3>
<div class="outline-text-3" id="text-org7d019ce">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">jojo_run_in_new_frame</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">base</span> = env.frame_stack.size ();
    env.frame_stack.push (new_frame_from_jojo (jojo));
    env.run_with_base (base);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgac74c57" class="outline-3">
<h3 id="orgac74c57">jojo_eval_in_new_frame</h3>
<div class="outline-text-3" id="text-orgac74c57">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">jojo_eval_in_new_frame</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>)
{
    jojo_run_in_new_frame (env, jojo);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">result</span> = env.obj_stack.top ();
    env.obj_stack.pop ();
    <span style="color: #F0DFAF; font-weight: bold;">return</span> result;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orged0311a" class="outline-3">
<h3 id="orged0311a">sexp_run</h3>
<div class="outline-text-3" id="text-orged0311a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">sexp_run</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (top_keyword_sexp_p (env, sexp)) {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : sexp_run"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  can not handle top_keyword_sexp"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  sexp : "</span> &lt;&lt; sexp_repr (env, sexp) &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_ref_map</span> = local_ref_map_t ();
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = sexp_compile (env, local_ref_map, sexp);
        jojo_run_in_new_frame (env, jojo);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf263bd4" class="outline-3">
<h3 id="orgf263bd4">sexp_list_run</h3>
<div class="outline-text-3" id="text-orgf263bd4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">sexp_list_run</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp_list</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, sexp_list))
        <span style="color: #F0DFAF; font-weight: bold;">return</span>;
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        sexp_run (env, car (env, sexp_list));
        sexp_list_run (env, cdr (env, sexp_list));
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdd447e9" class="outline-3">
<h3 id="orgdd447e9">sexp_eval</h3>
<div class="outline-text-3" id="text-orgdd447e9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">sexp_eval</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size_before</span> = env.obj_stack.size ();
    sexp_run (env, sexp);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size_after</span> = env.obj_stack.size ();
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (size_after - size_before == 1) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
        env.obj_stack.pop ();
        <span style="color: #F0DFAF; font-weight: bold;">return</span> obj;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : sexp_eval mismatch"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  sexp must eval to one value"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  sexp : "</span> &lt;&lt; sexp_repr (env, sexp) &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  stack size before : "</span> &lt;&lt; size_before &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  stack size after : "</span> &lt;&lt; size_after &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc07a754" class="outline-3">
<h3 id="orgc07a754">top_sexp_run</h3>
<div class="outline-text-3" id="text-orgc07a754">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">top_sexp_run</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (top_keyword_sexp_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = as_sym (car (env, sexp));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">body</span> = cdr (env, sexp);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = head-&gt;sym;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">fn</span> = top_keyword_fn_from_name (env, name);
        fn (env, body);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_ref_map</span> = local_ref_map_t ();
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = sexp_compile (env, local_ref_map, sexp);
        jojo_run_in_new_frame (env, jojo);
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> env.obj_stack.empty ())
            env.obj_stack.pop ();
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgadc840e" class="outline-3">
<h3 id="orgadc840e">top_sexp_list_run</h3>
<div class="outline-text-3" id="text-orgadc840e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">top_sexp_list_run</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp_list</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, sexp_list))
        <span style="color: #F0DFAF; font-weight: bold;">return</span>;
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        top_sexp_run (env, car (env, sexp_list));
        top_sexp_list_run (env, cdr (env, sexp_list));
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1fdeafd" class="outline-3">
<h3 id="org1fdeafd">code_run</h3>
<div class="outline-text-3" id="text-org1fdeafd">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">code_run</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;str_o&gt; <span style="color: #DFAF8F;">code</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word_list</span> = scan_word_list (env, code);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sexp_list</span> = parse_sexp_list (env, word_list);
    top_sexp_list_run (env, sexp_list);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3a603ae" class="outline-3">
<h3 id="org3a603ae">code_from_module_path</h3>
<div class="outline-text-3" id="text-org3a603ae">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;str_o&gt;
<span style="color: #93E0E3;">code_from_module_path</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">path_t</span> <span style="color: #DFAF8F;">module_path</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">input_file</span> = ifstream (module_path);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">buffer</span> = stringstream ();
    buffer &lt;&lt; input_file.rdbuf ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">code</span> = make_str (env, buffer.str ());
    <span style="color: #F0DFAF; font-weight: bold;">return</span> code;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdcd1862" class="outline-3">
<h3 id="orgdcd1862">respect_current_dir</h3>
<div class="outline-text-3" id="text-orgdcd1862">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">path_t</span>
<span style="color: #93E0E3;">respect_current_dir</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">path_t</span> <span style="color: #DFAF8F;">p</span>)
{
    p = expend_path (p);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">normal_path</span> = path_t ();
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (p.is_absolute ()) {
        normal_path = p;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        assert (p.is_relative ());
        normal_path = env.current_dir / p;
    }
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">normal_path = fs::canonical (normal_path);</span>
    <span style="color: #F0DFAF; font-weight: bold;">return</span> normal_path;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4954a55" class="outline-3">
<h3 id="org4954a55">respect_module_path</h3>
<div class="outline-text-3" id="text-org4954a55">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">path_t</span>
<span style="color: #93E0E3;">respect_module_path</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">path_t</span> <span style="color: #DFAF8F;">p</span>)
{
    p = expend_path (p);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">normal_path</span> = path_t ();
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (p.is_absolute ()) {
        normal_path = p;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        assert (p.is_relative ());
        normal_path = env.module_path.parent_path () / p;
    }
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">normal_path = fs::canonical (normal_path);</span>
    <span style="color: #F0DFAF; font-weight: bold;">return</span> normal_path;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga640290" class="outline-3">
<h3 id="orga640290">env_from_module_path</h3>
<div class="outline-text-3" id="text-orga640290">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">expose_core</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);

<span style="color: #7CB8BB;">env_t</span>
<span style="color: #93E0E3;">env_from_module_path</span> (<span style="color: #7CB8BB;">path_t</span> <span style="color: #DFAF8F;">module_path</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();
    module_path = respect_current_dir (env, module_path);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> <span style="color: #BFEBBF;">fs</span>::exists (module_path)) {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : env_from_module_path"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  file does not exists : "</span> &lt;&lt; module_path &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> <span style="color: #BFEBBF;">fs</span>::is_regular_file (module_path)) {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : env_from_module_path"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  not regular file : "</span> &lt;&lt; module_path &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
    env.module_path = module_path;
    expose_core (env);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">code</span> = code_from_module_path (env, env.module_path);
    code_run (env, code);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> env;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org33d735e" class="outline-2">
<h2 id="org33d735e">(=)</h2>
<div class="outline-text-2" id="text-org33d735e">
</div><div id="outline-container-org18eca1a" class="outline-3">
<h3 id="org18eca1a">prefix_of_string</h3>
<div class="outline-text-3" id="text-org18eca1a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_t</span>
<span style="color: #93E0E3;">prefix_of_string</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">string_vector</span> = string_split (str, <span style="color: #DCDCCC; background-color: #3F3F3F;">'.</span><span style="color: #D0BF8F; font-weight: bold;">'</span>);
    assert (string_vector.size () &gt; 0);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (string_vector.size () == 1)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">""</span>;
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        string_vector.pop_back ();
        <span style="color: #F0DFAF; font-weight: bold;">return</span> string_vector_join (string_vector, <span style="color: #DCDCCC; background-color: #3F3F3F;">'.</span><span style="color: #D0BF8F; font-weight: bold;">'</span>);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1ec6551" class="outline-3">
<h3 id="org1ec6551">name_of_string</h3>
<div class="outline-text-3" id="text-org1ec6551">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_t</span>
<span style="color: #93E0E3;">name_of_string</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">string_vector</span> = string_split (str, <span style="color: #DCDCCC; background-color: #3F3F3F;">'.</span><span style="color: #D0BF8F; font-weight: bold;">'</span>);
    assert (string_vector.size () &gt; 0);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> string_vector [string_vector.size () - 1];
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6c63b6e" class="outline-3">
<h3 id="org6c63b6e">(= &lt;name&gt; (data &#x2026;))</h3>
<div class="outline-text-3" id="text-org6c63b6e">
</div><div id="outline-container-orgb29e543" class="outline-4">
<h4 id="orgb29e543">assign_data_p</h4>
<div class="outline-text-4" id="text-orgb29e543">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">assign_data_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, body))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> sym_p (env, car (env, body)))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, cdr (env, body)))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, car (env, cdr (env, body))))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> sym_p (env, car (env, car (env, cdr (env, body)))))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sym</span> = as_sym (car (env, car (env, cdr (env, body))));
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (sym-&gt;sym != <span style="color: #CC9393;">"data"</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, cdr (env, car (env, cdr (env, body)))))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> sym_p (env, car (env, cdr (env, car (env, cdr (env, body))))))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (as_sym (car (env, cdr (env, car (env, cdr (env, body)))))
        -&gt;sym == <span style="color: #CC9393;">":&gt;"</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (as_sym (car (env, cdr (env, car (env, cdr (env, body)))))
        -&gt;sym == <span style="color: #CC9393;">"&lt;:"</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5f4ccb6" class="outline-4">
<h4 id="org5f4ccb6">tk_assign_data</h4>
<div class="outline-text-4" id="text-org5f4ccb6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">tk_assign_data</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = as_sym (car (env, body));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">prefix</span> = prefix_of_string (head-&gt;sym);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">type_name</span> = name_of_string (head-&gt;sym);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">data_name</span> = name_t2c (type_name);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">pred_name</span> = name_t2p (type_name);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">tag_of_type</span> = tagging (env, head-&gt;sym);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">data_body</span> = cdr (env, (car (env, rest)));
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, data_body)) {
        assign_type
            (env, prefix, type_name, tag_of_type, {});
        assign_data_pred
            (env, prefix, pred_name, tag_of_type);
        assign_data
            (env, prefix, data_name, tag_of_type);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vect</span> = list_to_vect (env, data_body);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = name_vector_t ();
        <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span>: name_vect-&gt;obj_vector) {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sym</span> = as_sym (obj);
            name_vector.push_back (sym-&gt;sym);
        }
        assign_type
            (env, prefix, type_name, tag_of_type, {});
        assign_data_pred
            (env, prefix, pred_name, tag_of_type);
        assign_data_cons
            (env, prefix, data_name, tag_of_type, name_vector);
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3e3cd90" class="outline-3">
<h3 id="org3e3cd90">(= &lt;name&gt; (data &lt;: [&#x2026;] &#x2026;))</h3>
<div class="outline-text-3" id="text-org3e3cd90">
</div><div id="outline-container-org653ceb" class="outline-4">
<h4 id="org653ceb">assign_data_inherit_p</h4>
<div class="outline-text-4" id="text-org653ceb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">assign_data_inherit_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, body))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> sym_p (env, car (env, body)))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, cdr (env, body)))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, car (env, cdr (env, body))))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> sym_p (env, car (env, car (env, cdr (env, body)))))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sym</span> = as_sym (car (env, car (env, cdr (env, body))));
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (sym-&gt;sym != <span style="color: #CC9393;">"data"</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, cdr (env, car (env, cdr (env, body)))))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> sym_p (env, car (env, cdr (env, car (env, cdr (env, body))))))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (as_sym (car (env, cdr (env, car (env, cdr (env, body)))))
        -&gt;sym == <span style="color: #CC9393;">":&gt;"</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (as_sym (car (env, cdr (env, car (env, cdr (env, body)))))
        -&gt;sym == <span style="color: #CC9393;">"&lt;:"</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdc38030" class="outline-4">
<h4 id="orgdc38030">tagging_name_vect</h4>
<div class="outline-text-4" id="text-orgdc38030">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">tag_vector_t</span>
<span style="color: #93E0E3;">tagging_name_vect</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;vect_o&gt; <span style="color: #DFAF8F;">vect</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">tag_vector</span> = tag_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span>: vect-&gt;obj_vector) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sym</span> = as_sym (obj);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = sym-&gt;sym;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">tag</span> = tagging (env, name);
        tag_vector.push_back (tag);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> tag_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf50af37" class="outline-4">
<h4 id="orgf50af37"><span class="todo _todo_">[todo]</span> tk_assign_data_inherit</h4>
<div class="outline-text-4" id="text-orgf50af37">
<ul class="org-ul">
<li><p>the inherited type must be defined before,</p><p>because we need the fields of them here.</p></li></ul>

<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">tk_assign_data_inherit</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = as_sym (car (env, body));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">prefix</span> = prefix_of_string (head-&gt;sym);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">type_name</span> = name_of_string (head-&gt;sym);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">data_name</span> = name_t2c (type_name);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">pred_name</span> = name_t2p (type_name);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">tag_of_type</span> = tagging (env, head-&gt;sym);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">data_body</span> = cdr (env, (car (env, rest)));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">super_name_vect</span> = as_vect (car (env, cdr (env, data_body)));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">super_tag_vector</span> = tagging_name_vect (env, super_name_vect);
    data_body = cdr (env, (cdr (env, data_body)));
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, data_body)) {
        assign_type
            (env, prefix, type_name, tag_of_type, super_tag_vector);
        assign_data_pred
            (env, prefix, pred_name, tag_of_type);
        assign_data
            (env, prefix, data_name, tag_of_type);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vect</span> = list_to_vect (env, data_body);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = name_vector_t ();
        <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span>: name_vect-&gt;obj_vector) {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sym</span> = as_sym (obj);
            name_vector.push_back (sym-&gt;sym);
        }
        assign_type
            (env, prefix, type_name, tag_of_type, super_tag_vector);
        assign_data_pred
            (env, prefix, pred_name, tag_of_type);
        assign_data_cons
            (env, prefix, data_name, tag_of_type, name_vector);
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2bc18d1" class="outline-3">
<h3 id="org2bc18d1">(= &lt;name&gt; (data :&gt; [&#x2026;] &#x2026;))</h3>
<div class="outline-text-3" id="text-org2bc18d1">
</div><div id="outline-container-orgf9bb96d" class="outline-4">
<h4 id="orgf9bb96d">assign_data_union_p</h4>
<div class="outline-text-4" id="text-orgf9bb96d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">assign_data_union_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, body))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> sym_p (env, car (env, body)))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, cdr (env, body)))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, car (env, cdr (env, body))))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> sym_p (env, car (env, car (env, cdr (env, body)))))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sym</span> = as_sym (car (env, car (env, cdr (env, body))));
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (sym-&gt;sym != <span style="color: #CC9393;">"data"</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, cdr (env, car (env, cdr (env, body)))))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> sym_p (env, car (env, cdr (env, car (env, cdr (env, body))))))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (as_sym (car (env, cdr (env, car (env, cdr (env, body)))))
        -&gt;sym == <span style="color: #CC9393;">":&gt;"</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (as_sym (car (env, cdr (env, car (env, cdr (env, body)))))
        -&gt;sym == <span style="color: #CC9393;">"&lt;:"</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgac49034" class="outline-4">
<h4 id="orgac49034"><span class="todo _todo_">[todo]</span> tk_assign_data_union</h4>
<div class="outline-text-4" id="text-orgac49034">
<div class="org-src-container">

<pre class="src src-cpp"></pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org637166c" class="outline-3">
<h3 id="org637166c">(= (&lt;name&gt; &#x2026;) &#x2026;)</h3>
<div class="outline-text-3" id="text-org637166c">
</div><div id="outline-container-org458dd26" class="outline-4">
<h4 id="org458dd26">assign_lambda_sugar_p</h4>
<div class="outline-text-4" id="text-org458dd26">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">assign_lambda_sugar_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, body))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, car (env, body)))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2a9781d" class="outline-4">
<h4 id="org2a9781d">assign_lambda_desugar</h4>
<div class="outline-text-4" id="text-org2a9781d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">assign_lambda_desugar</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = car (env, head);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lambda_body</span> = cdr (env, body);
    lambda_body = cons_c
        (env,
         list_to_vect (env, cdr (env, head)),
         lambda_body);
    lambda_body = cons_c
        (env,
         make_sym (env, <span style="color: #CC9393;">"lambda"</span>),
         lambda_body);
    lambda_body = unit_list (env, lambda_body);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (env, name, lambda_body);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb497a29" class="outline-3">
<h3 id="orgb497a29">(= &lt;name&gt; &#x2026;)</h3>
<div class="outline-text-3" id="text-orgb497a29">
</div><div id="outline-container-org6d3155c" class="outline-4">
<h4 id="org6d3155c">sexp_substitute_recur</h4>
<div class="outline-text-4" id="text-org6d3155c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">sexp_substitute_recur</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sub</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (sym_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sym</span> = as_sym (sexp);
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (sym-&gt;sym == <span style="color: #CC9393;">"recur"</span>)
            <span style="color: #F0DFAF; font-weight: bold;">return</span> sub;
        <span style="color: #F0DFAF; font-weight: bold;">else</span>
            <span style="color: #F0DFAF; font-weight: bold;">return</span> sexp;
    }
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (cons_p (env, sexp))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c
            (env,
             sexp_substitute_recur (env, sub, car (env, sexp)),
             sexp_substitute_recur (env, sub, cdr (env, sexp)));
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (vect_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">vect_sexp</span> = as_vect (sexp);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">list_sexp</span> = vect_to_list (env, vect_sexp);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">new_list_sexp</span> = sexp_substitute_recur (env, sub, list_sexp);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> list_to_vect (env, new_list_sexp);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> sexp;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7606b90" class="outline-4">
<h4 id="org7606b90">sexp_patch_this</h4>
<div class="outline-text-4" id="text-org7606b90">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">sexp_patch_this</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">this_str</span> = make_sym (env, <span style="color: #CC9393;">"this"</span>);
    <span style="color: #7CB8BB;">obj_vector_t</span> <span style="color: #DFAF8F;">obj_vector</span> = { this_str };
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">vect</span> = make_vect (env, obj_vector);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lambda_body</span> = unit_list (env, sexp);
    lambda_body = cons_c (env, vect, lambda_body);
    lambda_body = cons_c (
        env,
        make_sym (env, <span style="color: #CC9393;">"lambda"</span>),
        lambda_body);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> lambda_body;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org90edd04" class="outline-4">
<h4 id="org90edd04">tk_assign_value</h4>
<div class="outline-text-4" id="text-org90edd04">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">tk_assign_value</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = as_sym (car (env, body));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, body);
    assert (null_p (env, cdr (env, rest)));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sexp</span> = car (env, rest);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = name_of_string (head-&gt;sym);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">prefix</span> = prefix_of_string (head-&gt;sym);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (prefix != <span style="color: #CC9393;">""</span>)
        sexp = sexp_patch_this (env, sexp);
    sexp = sexp_substitute_recur (env, head, sexp);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = sexp_eval (env, sexp);
    assign (env, prefix, name, obj);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2f556e5" class="outline-3">
<h3 id="org2f556e5">tk_assign</h3>
<div class="outline-text-3" id="text-org2f556e5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">tk_assign</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (assign_data_p (env, body))
        tk_assign_data (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (assign_data_inherit_p (env, body))
        tk_assign_data_inherit (env, body);
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">else if (assign_data_union_p (env, body))</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">tk_assign_data_union (env, body);</span>
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (assign_lambda_sugar_p (env, body))
        tk_assign_value (env, assign_lambda_desugar (env, body));
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        tk_assign_value (env, body);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfea8956" class="outline-2">
<h2 id="orgfea8956">stack</h2>
<div class="outline-text-2" id="text-orgfea8956">
</div><div id="outline-container-org9e3406e" class="outline-3">
<h3 id="org9e3406e">stack_word_p</h3>
<div class="outline-text-3" id="text-org9e3406e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">stack_word_p</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">word</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> word == <span style="color: #CC9393;">"drop"</span>
        <span style="color: #F0DFAF; font-weight: bold;">or</span> word == <span style="color: #CC9393;">"dup"</span>
        <span style="color: #F0DFAF; font-weight: bold;">or</span> word == <span style="color: #CC9393;">"over"</span>
        <span style="color: #F0DFAF; font-weight: bold;">or</span> word == <span style="color: #CC9393;">"tuck"</span>
        <span style="color: #F0DFAF; font-weight: bold;">or</span> word == <span style="color: #CC9393;">"swap"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1c15f24" class="outline-2">
<h2 id="org1c15f24">syntax</h2>
<div class="outline-text-2" id="text-org1c15f24">
</div><div id="outline-container-org4d939f2" class="outline-3">
<h3 id="org4d939f2">(lambda)</h3>
<div class="outline-text-3" id="text-org4d939f2">
</div><div id="outline-container-orgbe76844" class="outline-4">
<h4 id="orgbe76844">lambda_jo</h4>
<div class="outline-text-4" id="text-orgbe76844">
</div><div id="outline-container-org4bdb212" class="outline-5">
<h5 id="org4bdb212">lambda_jo_t</h5>
<div class="outline-text-5" id="text-org4bdb212">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">lambda_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>;
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>;
    <span style="color: #93E0E3;">lambda_jo_t</span> (
        <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
        <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>);
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb0682e9" class="outline-5">
<h5 id="orgb0682e9">lambda_jo_t::lambda_jo_t</h5>
<div class="outline-text-5" id="text-orgb0682e9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">lambda_jo_t</span>::
<span style="color: #93E0E3;">lambda_jo_t</span> (
    <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector = name_vector;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo = jojo;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9d0ff12" class="outline-5">
<h5 id="org9d0ff12">lambda_jo_t::copy</h5>
<div class="outline-text-5" id="text-org9d0ff12">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">lambda_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">lambda_jo_t</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org20a1f6" class="outline-5">
<h5 id="org20a1f6">lambda_jo_t::exe</h5>
<div class="outline-text-5" id="text-org20a1f6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">lambda_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">closure</span> = make_closure (
        env,
        <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector,
        <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo,
        bind_vector_from_name_vector (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector),
        local_scope);
    env.obj_stack.push (closure);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7249e3" class="outline-5">
<h5 id="org7249e3">lambda_jo_t::repr</h5>
<div class="outline-text-5" id="text-org7249e3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">lambda_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"(lambda "</span> +
        name_vector_repr (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector) +
        <span style="color: #CC9393;">" "</span> +
        jojo_repr (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo) +
        <span style="color: #CC9393;">")"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org26d1599" class="outline-4">
<h4 id="org26d1599">body_patch_drop</h4>
<div class="outline-text-4" id="text-org26d1599">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">body_patch_drop</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp_list</span>)
{
    assert (cons_p (env, sexp_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, sexp_list);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, sexp_list);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, rest))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> sexp_list;
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">drop</span> = unit_list (env, make_sym (env, <span style="color: #CC9393;">"drop"</span>));
        sexp_list = body_patch_drop (env, rest);
        sexp_list = cons_c (env, drop, sexp_list);
        sexp_list = cons_c (env, head, sexp_list);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> sexp_list;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc4cc90d" class="outline-4">
<h4 id="orgc4cc90d">obj_vector_to_name_vector</h4>
<div class="outline-text-4" id="text-orgc4cc90d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_vector_t</span>
<span style="color: #93E0E3;">obj_vector_to_name_vector</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_vector_t</span> &amp;<span style="color: #DFAF8F;">obj_vect</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = name_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">obj</span>: obj_vect) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sym</span> = as_sym (obj);
        name_vector.push_back (sym-&gt;sym);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> name_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7478ee2" class="outline-4">
<h4 id="org7478ee2">k_lambda</h4>
<div class="outline-text-4" id="text-org7478ee2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">k_lambda</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">old_local_ref_map</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vect</span> = as_vect (car (env, body));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = obj_vector_to_name_vector
        (env, name_vect-&gt;obj_vector);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_ref_map</span> = local_ref_map_extend
        (env, old_local_ref_map, name_vector);
    rest = body_patch_drop (env, rest);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest_jojo</span> = sexp_list_compile
        (env, local_ref_map, rest);
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">lambda_jo_t</span> (name_vector, rest_jojo),
    };
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5919095" class="outline-3">
<h3 id="org5919095">(macro)</h3>
<div class="outline-text-3" id="text-org5919095">
</div><div id="outline-container-org3ed4244" class="outline-4">
<h4 id="org3ed4244">macro_maker_jo</h4>
<div class="outline-text-4" id="text-org3ed4244">
</div><div id="outline-container-orgc244b64" class="outline-5">
<h5 id="orgc244b64">macro_maker_jo_t</h5>
<div class="outline-text-5" id="text-orgc244b64">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">macro_maker_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org622580" class="outline-5">
<h5 id="org622580">macro_maker_jo_t::copy</h5>
<div class="outline-text-5" id="text-org622580">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">macro_maker_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">macro_maker_jo_t</span> ();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8e17ce5" class="outline-5">
<h5 id="org8e17ce5">macro_maker_jo_t::exe</h5>
<div class="outline-text-5" id="text-org8e17ce5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">macro_maker_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
    env.obj_stack.pop ();
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (closure_p (env, obj)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">macro</span> = make_macro (env, obj);
        env.obj_stack.push (macro);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : macro_maker_jo_t::exe"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  can only make macro from closure"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org60bab9" class="outline-5">
<h5 id="org60bab9">macro_maker_jo_t::repr</h5>
<div class="outline-text-5" id="text-org60bab9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">macro_maker_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"(macro_maker)"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb7e318f" class="outline-4">
<h4 id="orgb7e318f">k_macro</h4>
<div class="outline-text-4" id="text-orgb7e318f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">k_macro</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">old_local_ref_map</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vect</span> = as_vect (car (env, body));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = obj_vector_to_name_vector
        (env, name_vect-&gt;obj_vector);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_ref_map</span> = local_ref_map_extend
        (env, old_local_ref_map, name_vector);
    rest = body_patch_drop (env, rest);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest_jojo</span> = sexp_list_compile
        (env, local_ref_map, rest);
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">lambda_jo_t</span> (name_vector, rest_jojo),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">macro_maker_jo_t</span> (),
    };
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgeeda417" class="outline-3">
<h3 id="orgeeda417">(case)</h3>
<div class="outline-text-3" id="text-orgeeda417">
</div><div id="outline-container-orga20b9e8" class="outline-4">
<h4 id="orga20b9e8">case_jo</h4>
<div class="outline-text-4" id="text-orga20b9e8">
</div><div id="outline-container-orga209b4b" class="outline-5">
<h5 id="orga209b4b">case_jo_t</h5>
<div class="outline-text-5" id="text-orga209b4b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">case_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">jojo_map_t</span> <span style="color: #DFAF8F;">jojo_map</span>;
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">default_jojo</span>;
    <span style="color: #93E0E3;">case_jo_t</span> (<span style="color: #7CB8BB;">jojo_map_t</span> <span style="color: #DFAF8F;">jojo_map</span>);
    <span style="color: #93E0E3;">case_jo_t</span> (
        <span style="color: #7CB8BB;">jojo_map_t</span> <span style="color: #DFAF8F;">jojo_map</span>,
        <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">default_jojo</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">has_default_jojo_p</span> ();
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeae4213" class="outline-5">
<h5 id="orgeae4213">case_jo_t::case_jo_t</h5>
<div class="outline-text-5" id="text-orgeae4213">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">case_jo_t</span>::
<span style="color: #93E0E3;">case_jo_t</span> (<span style="color: #7CB8BB;">jojo_map_t</span> <span style="color: #DFAF8F;">jojo_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo_map = jojo_map;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;default_jojo = <span style="color: #BFEBBF;">nullptr</span>;
}

<span style="color: #BFEBBF;">case_jo_t</span>::
<span style="color: #93E0E3;">case_jo_t</span> (<span style="color: #7CB8BB;">jojo_map_t</span> <span style="color: #DFAF8F;">jojo_map</span>,
           <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">default_jojo</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo_map = jojo_map;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;default_jojo = default_jojo;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7ec14ea" class="outline-5">
<h5 id="org7ec14ea">case_jo_t::has_default_jojo_p</h5>
<div class="outline-text-5" id="text-org7ec14ea">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">case_jo_t</span>::<span style="color: #93E0E3;">has_default_jojo_p</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;default_jojo != <span style="color: #BFEBBF;">nullptr</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org58b823f" class="outline-5">
<h5 id="org58b823f">case_jo_t::copy</h5>
<div class="outline-text-5" id="text-org58b823f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">case_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">case_jo_t</span>
        (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo_map,
         <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;default_jojo);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfaa25d5" class="outline-5">
<h5 id="orgfaa25d5">case_jo_t::exe</h5>
<div class="outline-text-5" id="text-orgfaa25d5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">case_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
    env.obj_stack.pop ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo_map.find (obj-&gt;tag);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo_map.end ()) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">frame</span> = make_shared &lt;<span style="color: #7CB8BB;">frame_t</span>&gt; (jojo, local_scope);
        env.frame_stack.push (frame);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;has_default_jojo_p ()) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;default_jojo;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">frame</span> = make_shared &lt;<span style="color: #7CB8BB;">frame_t</span>&gt; (jojo, local_scope);
        env.frame_stack.push (frame);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : case_jo_t::exe mismatch"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  tag : "</span> &lt;&lt; obj-&gt;tag &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7539bde" class="outline-5">
<h5 id="org7539bde"><span class="todo _todo_">[todo]</span> case_jo_t::repr</h5>
<div class="outline-text-5" id="text-org7539bde">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">case_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"(case)"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf837f29" class="outline-4">
<h4 id="orgf837f29">case_compile</h4>
<div class="outline-text-4" id="text-orgf837f29">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">case_compile</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo_map</span> = jojo_map_t ();
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">default_jojo</span> = <span style="color: #BFEBBF;">nullptr</span>;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> null_p (env, body)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">one</span> = car (env, body);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = as_sym (car (env, one));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, one);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = head-&gt;sym;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (name == <span style="color: #CC9393;">"_"</span>) {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = sexp_list_compile (env, local_ref_map, rest);
            body = cdr (env, body);
            default_jojo = jojo;
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">tag</span> = tagging (env, name);
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = sexp_list_compile (env, local_ref_map, rest);
            jojo_map [tag] = jojo;
            body = cdr (env, body);
        }
    }
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">case_jo_t</span> (jojo_map, default_jojo),
    };
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcdd5aab" class="outline-4">
<h4 id="orgcdd5aab">k_case</h4>
<div class="outline-text-4" id="text-orgcdd5aab">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">k_case</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head_jojo</span> = sexp_compile (env, local_ref_map, head);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest_jojo</span> = case_compile (env, local_ref_map, rest);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo_append (head_jojo, rest_jojo);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2cdfc00" class="outline-3">
<h3 id="org2cdfc00">(quote)</h3>
<div class="outline-text-3" id="text-org2cdfc00">
</div><div id="outline-container-org954e94" class="outline-4">
<h4 id="org954e94">sexp_qoute_compile</h4>
<div class="outline-text-4" id="text-org954e94">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">sexp_qoute_compile</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">lit_jo_t</span> (sexp),
    };
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8debba1" class="outline-4">
<h4 id="org8debba1">k_quote</h4>
<div class="outline-text-4" id="text-org8debba1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">k_quote</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    assert (cons_p (env, body));
    assert (null_p (env, cdr (env, body)));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sexp</span> = car (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> sexp_qoute_compile (env, sexp);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org329a3fc" class="outline-3">
<h3 id="org329a3fc">(*) &#x2013; literal list</h3>
<div class="outline-text-3" id="text-org329a3fc">
</div><div id="outline-container-orgacb039" class="outline-4">
<h4 id="orgacb039">collect_list_jo</h4>
<div class="outline-text-4" id="text-orgacb039">
</div><div id="outline-container-org9bea9b0" class="outline-5">
<h5 id="org9bea9b0">collect_list_jo_t</h5>
<div class="outline-text-5" id="text-org9bea9b0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">collect_list_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">counter</span>;
    <span style="color: #93E0E3;">collect_list_jo_t</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">counter</span>);
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org5bae854" class="outline-5">
<h5 id="org5bae854">collect_list_jo_t::collect_list_jo_t</h5>
<div class="outline-text-5" id="text-org5bae854">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">collect_list_jo_t</span>::
<span style="color: #93E0E3;">collect_list_jo_t</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">counter</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;counter = counter;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7291f76" class="outline-5">
<h5 id="org7291f76">collect_list_jo_t::copy</h5>
<div class="outline-text-5" id="text-org7291f76">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">collect_list_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">collect_list_jo_t</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;counter);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb4fcb88" class="outline-5">
<h5 id="orgb4fcb88">collect_list_jo_t::exe</h5>
<div class="outline-text-5" id="text-orgb4fcb88">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">collect_list_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">collection</span> = null_c (env);
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (index &lt; <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;counter) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
        env.obj_stack.pop ();
        collection = cons_c (env, obj, collection);
        index++;
    }
    env.obj_stack.push (collection);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga7bb35a" class="outline-5">
<h5 id="orga7bb35a">collect_list_jo_t::repr</h5>
<div class="outline-text-5" id="text-orga7bb35a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">collect_list_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"(collect-list "</span> + to_string (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;counter) + <span style="color: #CC9393;">")"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8af0aab" class="outline-4">
<h4 id="org8af0aab">k_list</h4>
<div class="outline-text-4" id="text-org8af0aab">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">k_list</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sexp_list</span> = body;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = sexp_list_compile
        (env, local_ref_map, sexp_list);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">counter</span> = list_size (env, sexp_list);
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">collect_list_jo_t</span> (counter),
    };
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">ending_jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo_append (jojo, ending_jojo);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfdeb9e0" class="outline-3">
<h3 id="orgfdeb9e0">(note)</h3>
<div class="outline-text-3" id="text-orgfdeb9e0">
</div><div id="outline-container-org6e7c259" class="outline-4">
<h4 id="org6e7c259">k_note</h4>
<div class="outline-text-4" id="text-org6e7c259">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">k_note</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    body = cons_c (env, make_sym (env, <span style="color: #CC9393;">"note"</span>),
                   body);
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">lit_jo_t</span> (body),
    };
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org37791e6" class="outline-3">
<h3 id="org37791e6">(assert)</h3>
<div class="outline-text-3" id="text-org37791e6">
</div><div id="outline-container-orgc099777" class="outline-4">
<h4 id="orgc099777">assert_jo</h4>
<div class="outline-text-4" id="text-orgc099777">
</div><div id="outline-container-orgc5709cc" class="outline-5">
<h5 id="orgc5709cc">assert_jo_t</h5>
<div class="outline-text-5" id="text-orgc5709cc">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">assert_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>;
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>;
    <span style="color: #93E0E3;">assert_jo_t</span> (
        <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>,
        <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>);
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org90aba89" class="outline-5">
<h5 id="org90aba89">assert_jo_t::assert_jo_t</h5>
<div class="outline-text-5" id="text-org90aba89">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">assert_jo_t</span>::
<span style="color: #93E0E3;">assert_jo_t</span> (
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;body = body;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo = jojo;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdb34876" class="outline-5">
<h5 id="orgdb34876">assert_jo_t::copy</h5>
<div class="outline-text-5" id="text-orgdb34876">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">assert_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">assert_jo_t</span>
        (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;body,
         <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org88d1493" class="outline-5">
<h5 id="org88d1493">assert_jo_t::exe</h5>
<div class="outline-text-5" id="text-org88d1493">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">assert_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">base</span> = env.frame_stack.size ();
    env.frame_stack.push (
        make_shared &lt;<span style="color: #7CB8BB;">frame_t</span>&gt; (
            <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo,
            local_scope));
    env.run_with_base (base);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">result</span> = env.obj_stack.top ();
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (true_p (env, result)) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        env.frame_stack_report ();
        env.obj_stack_report ();
        cout &lt;&lt; <span style="color: #CC9393;">"- assert fail : "</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  "</span> &lt;&lt; sexp_list_repr (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;body) &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8135219" class="outline-5">
<h5 id="org8135219">assert_jo_t::repr</h5>
<div class="outline-text-5" id="text-org8135219">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">assert_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"(assert)"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org398651a" class="outline-4">
<h4 id="org398651a">k_assert</h4>
<div class="outline-text-4" id="text-org398651a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">k_assert</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = sexp_list_compile (env, local_ref_map, body);
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">assert_jo_t</span> (body, jojo),
    };
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgaaf7e0d" class="outline-3">
<h3 id="orgaaf7e0d">(if)</h3>
<div class="outline-text-3" id="text-orgaaf7e0d">
</div><div id="outline-container-orgc7aae2e" class="outline-4">
<h4 id="orgc7aae2e">if_jo</h4>
<div class="outline-text-4" id="text-orgc7aae2e">
</div><div id="outline-container-orgd36ea3f" class="outline-5">
<h5 id="orgd36ea3f">if_jo_t</h5>
<div class="outline-text-5" id="text-orgd36ea3f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">if_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">pred_jojo</span>;
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">then_jojo</span>;
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">else_jojo</span>;
    <span style="color: #93E0E3;">if_jo_t</span> (
        <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">pred_jojo</span>,
        <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">then_jojo</span>,
        <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">else_jojo</span>);
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org9f19719" class="outline-5">
<h5 id="org9f19719">if_jo_t::if_jo_t</h5>
<div class="outline-text-5" id="text-org9f19719">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">if_jo_t</span>::
<span style="color: #93E0E3;">if_jo_t</span> (
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">pred_jojo</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">then_jojo</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">else_jojo</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;pred_jojo = pred_jojo;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;then_jojo = then_jojo;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;else_jojo = else_jojo;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1cb15b7" class="outline-5">
<h5 id="org1cb15b7">if_jo_t::copy</h5>
<div class="outline-text-5" id="text-org1cb15b7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">if_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">if_jo_t</span>
        (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;pred_jojo,
         <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;then_jojo,
         <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;else_jojo);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org748deb7" class="outline-5">
<h5 id="org748deb7">if_jo_t::exe</h5>
<div class="outline-text-5" id="text-org748deb7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">if_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">result</span> = jojo_eval (env, local_scope, pred_jojo);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (true_p (env, result)) {
        env.frame_stack.push (
            make_shared &lt;<span style="color: #7CB8BB;">frame_t</span>&gt; (
                <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;then_jojo,
                local_scope));
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (false_p (env, result)) {
        env.frame_stack.push (
            make_shared &lt;<span style="color: #7CB8BB;">frame_t</span>&gt; (
                <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;else_jojo,
                local_scope));
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : if_jo_t::exe"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  pred_jojo run to non bool value"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc52d9f6" class="outline-5">
<h5 id="orgc52d9f6">if_jo_t::repr</h5>
<div class="outline-text-5" id="text-orgc52d9f6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">if_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"(if)"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org36b34de" class="outline-4">
<h4 id="org36b34de">k_if</h4>
<div class="outline-text-4" id="text-org36b34de">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">k_if</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = list_size (env, body);
    assert (size == 3);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">pred_sexp</span> = car (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">then_sexp</span> = car (env, cdr (env, body));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">else_sexp</span> = car (env, cdr (env, cdr (env, body)));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">pred_jojo</span> = sexp_compile (env, local_ref_map, pred_sexp);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">then_jojo</span> = sexp_compile (env, local_ref_map, then_sexp);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">else_jojo</span> = sexp_compile (env, local_ref_map, else_sexp);
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">if_jo_t</span> (pred_jojo, then_jojo, else_jojo),
    };
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org90c2b21" class="outline-3">
<h3 id="org90c2b21">(when)</h3>
<div class="outline-text-3" id="text-org90c2b21">
</div><div id="outline-container-orgc979cd8" class="outline-4">
<h4 id="orgc979cd8">when_jo</h4>
<div class="outline-text-4" id="text-orgc979cd8">
</div><div id="outline-container-org1dfc491" class="outline-5">
<h5 id="org1dfc491">when_jo_t</h5>
<div class="outline-text-5" id="text-org1dfc491">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">when_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">pred_jojo</span>;
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">then_jojo</span>;
    <span style="color: #93E0E3;">when_jo_t</span> (
        <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">pred_jojo</span>,
        <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">then_jojo</span>);
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org536c11f" class="outline-5">
<h5 id="org536c11f">when_jo_t::when_jo_t</h5>
<div class="outline-text-5" id="text-org536c11f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">when_jo_t</span>::
<span style="color: #93E0E3;">when_jo_t</span> (
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">pred_jojo</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">then_jojo</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;pred_jojo = pred_jojo;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;then_jojo = then_jojo;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org72f628f" class="outline-5">
<h5 id="org72f628f">when_jo_t::copy</h5>
<div class="outline-text-5" id="text-org72f628f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">when_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">when_jo_t</span>
        (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;pred_jojo,
         <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;then_jojo);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org27ada03" class="outline-5">
<h5 id="org27ada03">when_jo_t::exe</h5>
<div class="outline-text-5" id="text-org27ada03">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">when_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">result</span> = jojo_eval (env, local_scope, pred_jojo);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (true_p (env, result)) {
        env.frame_stack.push (
            make_shared &lt;<span style="color: #7CB8BB;">frame_t</span>&gt; (
                <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;then_jojo,
                local_scope));
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (false_p (env, result)) {
        env.obj_stack.push (result);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : when_jo_t::exe"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  pred_jojo run to non bool value"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org54eb208" class="outline-5">
<h5 id="org54eb208">when_jo_t::repr</h5>
<div class="outline-text-5" id="text-org54eb208">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">when_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"(when)"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb226c15" class="outline-4">
<h4 id="orgb226c15">k_when</h4>
<div class="outline-text-4" id="text-orgb226c15">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">k_when</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = list_size (env, body);
    assert (size == 2);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">pred_sexp</span> = car (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">then_sexp</span> = car (env, cdr (env, body));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">pred_jojo</span> = sexp_compile (env, local_ref_map, pred_sexp);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">then_jojo</span> = sexp_compile (env, local_ref_map, then_sexp);
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">when_jo_t</span> (pred_jojo, then_jojo),
    };
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org682010c" class="outline-3">
<h3 id="org682010c">(begin)</h3>
<div class="outline-text-3" id="text-org682010c">
</div><div id="outline-container-orge084e9d" class="outline-4">
<h4 id="orge084e9d">k_begin</h4>
<div class="outline-text-4" id="text-orge084e9d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">k_begin</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    body = body_patch_drop (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> sexp_list_compile (env, local_ref_map, body);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org301b6c1" class="outline-3">
<h3 id="org301b6c1">(let)</h3>
<div class="outline-text-3" id="text-org301b6c1">
</div><div id="outline-container-orgd03d358" class="outline-4">
<h4 id="orgd03d358">m_let</h4>
<div class="outline-text-4" id="text-orgd03d358">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">m_let</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">body</span> = obj_map [<span style="color: #CC9393;">"body"</span>];
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">binding_vect</span> = as_vect (head);
    binding_vect = vect_reverse (env, binding_vect);
    rest = cons_c (env, make_sym (env, <span style="color: #CC9393;">"begin"</span>), rest);
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">binding</span>: binding_vect-&gt;obj_vector) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = car (env, binding);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = car (env, cdr (env, binding));
        rest = unit_list (env, rest);
        rest = cons_c (env, unit_vect (env, name), rest);
        rest = cons_c (env, make_sym (env, <span style="color: #CC9393;">"lambda"</span>), rest);
        rest = cons_c (env, rest, unit_list (env, obj));
    }
    env.obj_stack.push (rest);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1168bb3" class="outline-3">
<h3 id="org1168bb3">(quasiquote)</h3>
<div class="outline-text-3" id="text-org1168bb3">
</div><div id="outline-container-orgf69ef9e" class="outline-4">
<h4 id="orgf69ef9e">sexp_quote_and_unquote</h4>
<div class="outline-text-4" id="text-orgf69ef9e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">sexp_list_quote_and_unquote</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp_list</span>);

<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">sexp_quote_and_unquote</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (str_p (env, sexp) <span style="color: #F0DFAF; font-weight: bold;">or</span> num_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> sexp;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (sym_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (
            env,
            make_sym (env, <span style="color: #CC9393;">"quote"</span>),
            unit_list (env, sexp));
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (
            env,
            make_sym (env, <span style="color: #CC9393;">"quote"</span>),
            unit_list (env, sexp));
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (vect_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">l</span> = vect_to_list (env, as_vect (sexp));
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (
            env,
            make_sym (env, <span style="color: #CC9393;">"list-to-vect"</span>),
            unit_list (env, sexp_list_quote_and_unquote (env, l)));
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (dict_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">l</span> = dict_to_list (env, as_dict (sexp));
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (
            env,
            make_sym (env, <span style="color: #CC9393;">"list-to-dict"</span>),
            unit_list (env, sexp_list_quote_and_unquote (env, l)));
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        assert (cons_p (env, sexp));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, sexp);
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (sym_p (env, head) <span style="color: #F0DFAF; font-weight: bold;">and</span>
            as_sym (head) -&gt;sym == <span style="color: #CC9393;">"unquote"</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, sexp);
            assert (cons_p (env, rest));
            assert (null_p (env, cdr (env, rest)));
            <span style="color: #F0DFAF; font-weight: bold;">return</span> car (env, rest);
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> {
            <span style="color: #F0DFAF; font-weight: bold;">return</span> sexp_list_quote_and_unquote (
                env,
                sexp);
        }
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd41a2ed" class="outline-4">
<h4 id="orgd41a2ed">sexp_list_quote_and_unquote</h4>
<div class="outline-text-4" id="text-orgd41a2ed">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">sexp_list_quote_and_unquote</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp_list</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, sexp_list)) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> unit_list (env, make_sym (env, <span style="color: #CC9393;">"*"</span>));
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        assert (cons_p (env, sexp_list));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sexp</span> = car (env, sexp_list);
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (cons_p (env, sexp) <span style="color: #F0DFAF; font-weight: bold;">and</span>
            sym_p (env, car (env, sexp)) <span style="color: #F0DFAF; font-weight: bold;">and</span>
            as_sym (car (env, sexp)) -&gt;sym == <span style="color: #CC9393;">"unquote-splicing"</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, sexp);
            assert (cons_p (env, rest));
            assert (null_p (env, cdr (env, rest)));
            sexp = car (env, rest);
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> {
            sexp = cons_c (
                env,
                make_sym (env, <span style="color: #CC9393;">"*"</span>),
                unit_list (env, sexp_quote_and_unquote (env, sexp)));
        }
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">result</span> = sexp_list_quote_and_unquote (
            env, cdr (env, sexp_list));
        result = unit_list (env, result);
        result = cons_c (env, sexp, result);
        result = cons_c (env, make_sym (env, <span style="color: #CC9393;">"list-append"</span>), result);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> result;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2188656" class="outline-4">
<h4 id="org2188656">m_quasiquote</h4>
<div class="outline-text-4" id="text-org2188656">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">m_quasiquote</span> (
    <span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
    <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">body</span> = obj_map [<span style="color: #CC9393;">"body"</span>];
    assert (cons_p (env, body));
    assert (null_p (env, cdr (env, body)));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sexp</span> = car (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">new_sexp</span> = sexp_quote_and_unquote (env, sexp);
    env.obj_stack.push (new_sexp);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2752ede" class="outline-3">
<h3 id="org2752ede">(and)</h3>
<div class="outline-text-3" id="text-org2752ede">
</div><div id="outline-container-org10c6bde" class="outline-4">
<h4 id="org10c6bde">sexp_list_and</h4>
<div class="outline-text-4" id="text-org10c6bde">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">sexp_list_and</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp_list</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, sexp_list)) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> make_sym (env, <span style="color: #CC9393;">"true-c"</span>);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, cdr (env, sexp_list))) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> car (env, sexp_list);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, sexp_list);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, sexp_list);
        head = cons_c (
            env,
            make_sym (env, <span style="color: #CC9393;">"not"</span>),
            unit_list (env, head));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">result</span> = unit_list (env, sexp_list_and (env, rest));
        result = cons_c (
            env,
            make_sym (env, <span style="color: #CC9393;">"false-c"</span>),
            result);
        result = cons_c (
            env,
            head,
            result);
        result = cons_c (
            env,
            make_sym (env, <span style="color: #CC9393;">"if"</span>),
            result);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> result;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb04335c" class="outline-4">
<h4 id="orgb04335c">m_and</h4>
<div class="outline-text-4" id="text-orgb04335c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">m_and</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">body</span> = obj_map [<span style="color: #CC9393;">"body"</span>];
    env.obj_stack.push (sexp_list_and (env, body));
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgdc03720" class="outline-3">
<h3 id="orgdc03720">(or)</h3>
<div class="outline-text-3" id="text-orgdc03720">
</div><div id="outline-container-org3f7525d" class="outline-4">
<h4 id="org3f7525d">sexp_list_or</h4>
<div class="outline-text-4" id="text-org3f7525d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">sexp_list_or</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp_list</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, sexp_list)) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> make_sym (env, <span style="color: #CC9393;">"false-c"</span>);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, cdr (env, sexp_list))) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> car (env, sexp_list);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, sexp_list);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, sexp_list);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">result</span> = unit_list (env, sexp_list_or (env, rest));
        result = cons_c (
            env,
            make_sym (env, <span style="color: #CC9393;">"true-c"</span>),
            result);
        result = cons_c (
            env,
            head,
            result);
        result = cons_c (
            env,
            make_sym (env, <span style="color: #CC9393;">"if"</span>),
            result);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> result;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8be4ec" class="outline-4">
<h4 id="org8be4ec">m_or</h4>
<div class="outline-text-4" id="text-org8be4ec">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">m_or</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">body</span> = obj_map [<span style="color: #CC9393;">"body"</span>];
    env.obj_stack.push (sexp_list_or (env, body));
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb1bf678" class="outline-3">
<h3 id="orgb1bf678">(cond)</h3>
<div class="outline-text-3" id="text-orgb1bf678">
</div><div id="outline-container-org6a956c0" class="outline-4">
<h4 id="org6a956c0">vect_list_cond</h4>
<div class="outline-text-4" id="text-org6a956c0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">vect_list_cond</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">vect_list</span>)
{
    assert (<span style="color: #F0DFAF; font-weight: bold;">!</span> null_p (env, vect_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, vect_list);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, vect_list);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">l</span> = vect_to_list (env, as_vect (head));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">question</span> = car (env, l);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">answer</span> = cons_c (
        env,
        make_sym (env, <span style="color: #CC9393;">"begin"</span>),
        cdr (env, l));
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, rest)) {
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (sym_p (env, question) <span style="color: #F0DFAF; font-weight: bold;">and</span>
            as_sym (question) -&gt;sym == <span style="color: #CC9393;">"else"</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">return</span> answer;
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">result</span> = null_c (env);
            result = cons_c (env, answer, result);
            result = cons_c (env, question, result);
            result = cons_c (env, make_sym (env, <span style="color: #CC9393;">"when"</span>), result);
            <span style="color: #F0DFAF; font-weight: bold;">return</span> result;
        }
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">result</span> = unit_list (env, vect_list_cond (env, rest));
        result = cons_c (env, answer, result);
        result = cons_c (env, question, result);
        result = cons_c (env, make_sym (env, <span style="color: #CC9393;">"if"</span>), result);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> result;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org59a1e76" class="outline-4">
<h4 id="org59a1e76">m_cond</h4>
<div class="outline-text-4" id="text-org59a1e76">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">m_cond</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">body</span> = obj_map [<span style="color: #CC9393;">"body"</span>];
    env.obj_stack.push (vect_list_cond (env, body));
}
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb4f5976" class="outline-2">
<h2 id="orgb4f5976">expose</h2>
<div class="outline-text-2" id="text-orgb4f5976">
</div><div id="outline-container-org4d6b60d" class="outline-3">
<h3 id="org4d6b60d">def_type</h3>
<div class="outline-text-3" id="text-org4d6b60d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">def_type</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    define_type (env, name);
    define_data_pred (env, name_t2p (name), tagging (env, name));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbcc702e" class="outline-3">
<h3 id="orgbcc702e">expose_type</h3>
<div class="outline-text-3" id="text-orgbcc702e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">expose_type</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_prim (
        env, { <span style="color: #CC9393;">"type-of"</span>, <span style="color: #CC9393;">"obj"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = obj_map [<span style="color: #CC9393;">"obj"</span>];
            env.obj_stack.push (type_of (env, obj));
        });
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org16a3c96" class="outline-3">
<h3 id="org16a3c96">expose_bool</h3>
<div class="outline-text-3" id="text-org16a3c96">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">expose_bool</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define (env, <span style="color: #CC9393;">"true-c"</span>, true_c (env));
    define (env, <span style="color: #CC9393;">"true"</span>, true_c (env));
    define (env, <span style="color: #CC9393;">"false-c"</span>, false_c (env));
    define (env, <span style="color: #CC9393;">"false"</span>, false_c (env));
    define_prim (
        env, { <span style="color: #CC9393;">"not"</span>, <span style="color: #CC9393;">"bool"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = obj_map [<span style="color: #CC9393;">"bool"</span>];
            assert (bool_p (env, obj));
            env.obj_stack.push (make_bool (env, false_p (env, obj)));
        });
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8dd4c6c" class="outline-3">
<h3 id="org8dd4c6c">expose_num</h3>
<div class="outline-text-3" id="text-org8dd4c6c">
</div><div id="outline-container-orgc8e5d4b" class="outline-4">
<h4 id="orgc8e5d4b">expose_num_predicate</h4>
<div class="outline-text-4" id="text-orgc8e5d4b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">expose_num_predicate</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_prim (
        env, { <span style="color: #CC9393;">"lt"</span>, <span style="color: #CC9393;">"x"</span>, <span style="color: #CC9393;">"y"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">y</span> = as_num (obj_map [<span style="color: #CC9393;">"y"</span>]);
            env.obj_stack.push (make_bool (env, x-&gt;num &lt; y-&gt;num));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"gt"</span>, <span style="color: #CC9393;">"x"</span>, <span style="color: #CC9393;">"y"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">y</span> = as_num (obj_map [<span style="color: #CC9393;">"y"</span>]);
            env.obj_stack.push (make_bool (env, x-&gt;num &gt; y-&gt;num));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"lteq"</span>, <span style="color: #CC9393;">"x"</span>, <span style="color: #CC9393;">"y"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">y</span> = as_num (obj_map [<span style="color: #CC9393;">"y"</span>]);
            env.obj_stack.push (make_bool (env, x-&gt;num &lt;= y-&gt;num));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"gteq"</span>, <span style="color: #CC9393;">"x"</span>, <span style="color: #CC9393;">"y"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">y</span> = as_num (obj_map [<span style="color: #CC9393;">"y"</span>]);
            env.obj_stack.push (make_bool (env, x-&gt;num &gt;= y-&gt;num));
        });
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc6c0787" class="outline-4">
<h4 id="orgc6c0787">expose_num_1</h4>
<div class="outline-text-4" id="text-orgc6c0787">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">expose_num_1</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_prim (
        env, { <span style="color: #CC9393;">"add"</span>, <span style="color: #CC9393;">"x"</span>, <span style="color: #CC9393;">"y"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">y</span> = as_num (obj_map [<span style="color: #CC9393;">"y"</span>]);
            env.obj_stack.push
                (make_num
                 (env, x-&gt;num + y-&gt;num));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"sub"</span>, <span style="color: #CC9393;">"x"</span>, <span style="color: #CC9393;">"y"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">y</span> = as_num (obj_map [<span style="color: #CC9393;">"y"</span>]);
            env.obj_stack.push
                (make_num
                 (env, x-&gt;num - y-&gt;num));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"max"</span>, <span style="color: #CC9393;">"x"</span>, <span style="color: #CC9393;">"y"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">y</span> = as_num (obj_map [<span style="color: #CC9393;">"y"</span>]);
            env.obj_stack.push
                (make_num
                 (env, fmax (x-&gt;num, y-&gt;num)));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"min"</span>, <span style="color: #CC9393;">"x"</span>, <span style="color: #CC9393;">"y"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">y</span> = as_num (obj_map [<span style="color: #CC9393;">"y"</span>]);
            env.obj_stack.push
                (make_num
                 (env, fmin (x-&gt;num, y-&gt;num)));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"neg"</span>, <span style="color: #CC9393;">"x"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            env.obj_stack.push
                (make_num
                 (env, - x-&gt;num));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"abs"</span>, <span style="color: #CC9393;">"x"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            env.obj_stack.push
                (make_num
                 (env, fabs (x-&gt;num)));
        });
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org497248e" class="outline-4">
<h4 id="org497248e">expose_num_2</h4>
<div class="outline-text-4" id="text-org497248e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">expose_num_2</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_prim (
        env, { <span style="color: #CC9393;">"mul"</span>, <span style="color: #CC9393;">"x"</span>, <span style="color: #CC9393;">"y"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">y</span> = as_num (obj_map [<span style="color: #CC9393;">"y"</span>]);
            env.obj_stack.push
                (make_num
                 (env, x-&gt;num * y-&gt;num));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"div"</span>, <span style="color: #CC9393;">"x"</span>, <span style="color: #CC9393;">"y"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">y</span> = as_num (obj_map [<span style="color: #CC9393;">"y"</span>]);
            env.obj_stack.push
                (make_num
                 (env, x-&gt;num / y-&gt;num));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"mod"</span>, <span style="color: #CC9393;">"x"</span>, <span style="color: #CC9393;">"y"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">y</span> = as_num (obj_map [<span style="color: #CC9393;">"y"</span>]);
            env.obj_stack.push
                (make_num
                 (env, fmod (x-&gt;num, y-&gt;num)));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"hypot"</span>, <span style="color: #CC9393;">"x"</span>, <span style="color: #CC9393;">"y"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">y</span> = as_num (obj_map [<span style="color: #CC9393;">"y"</span>]);
            env.obj_stack.push
                (make_num
                 (env, hypot (x-&gt;num, y-&gt;num)));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"sqrt"</span>, <span style="color: #CC9393;">"x"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            env.obj_stack.push
                (make_num
                 (env, sqrt (x-&gt;num)));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"cbrt"</span>, <span style="color: #CC9393;">"x"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            env.obj_stack.push
                (make_num
                 (env, cbrt (x-&gt;num)));
        });
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8658b38" class="outline-4">
<h4 id="org8658b38">expose_num_3</h4>
<div class="outline-text-4" id="text-org8658b38">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">expose_num_3</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_prim (
        env, { <span style="color: #CC9393;">"pow"</span>, <span style="color: #CC9393;">"x"</span>, <span style="color: #CC9393;">"y"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">y</span> = as_num (obj_map [<span style="color: #CC9393;">"y"</span>]);
            env.obj_stack.push
                (make_num
                 (env, pow (x-&gt;num, y-&gt;num)));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"expe"</span>, <span style="color: #CC9393;">"x"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            env.obj_stack.push
                (make_num
                 (env, exp (x-&gt;num)));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"exp2"</span>, <span style="color: #CC9393;">"x"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            env.obj_stack.push
                (make_num
                 (env, exp2 (x-&gt;num)));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"expm1"</span>, <span style="color: #CC9393;">"x"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            env.obj_stack.push
                (make_num
                 (env, expm1 (x-&gt;num)));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"loge"</span>, <span style="color: #CC9393;">"x"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            env.obj_stack.push
                (make_num
                 (env, log (x-&gt;num)));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"log10"</span>, <span style="color: #CC9393;">"x"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            env.obj_stack.push
                (make_num
                 (env, log10 (x-&gt;num)));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"log2"</span>, <span style="color: #CC9393;">"x"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            env.obj_stack.push
                (make_num
                 (env, log2 (x-&gt;num)));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"log1p"</span>, <span style="color: #CC9393;">"x"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            env.obj_stack.push
                (make_num
                 (env, log1p (x-&gt;num)));
        });
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbe7b183" class="outline-4">
<h4 id="orgbe7b183">expose_num_trigonometry</h4>
<div class="outline-text-4" id="text-orgbe7b183">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">expose_num_trigonometry</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_prim (
        env, { <span style="color: #CC9393;">"sin"</span>, <span style="color: #CC9393;">"x"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            env.obj_stack.push
                (make_num
                 (env, sin (x-&gt;num)));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"cos"</span>, <span style="color: #CC9393;">"x"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            env.obj_stack.push
                (make_num
                 (env, cos (x-&gt;num)));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"tan"</span>, <span style="color: #CC9393;">"x"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            env.obj_stack.push
                (make_num
                 (env, tan (x-&gt;num)));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"asin"</span>, <span style="color: #CC9393;">"x"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            env.obj_stack.push
                (make_num
                 (env, asin (x-&gt;num)));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"acos"</span>, <span style="color: #CC9393;">"x"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            env.obj_stack.push
                (make_num
                 (env, acos (x-&gt;num)));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"atan"</span>, <span style="color: #CC9393;">"x"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            env.obj_stack.push
                (make_num
                 (env, atan (x-&gt;num)));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"atan2"</span>, <span style="color: #CC9393;">"x"</span>, <span style="color: #CC9393;">"y"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">y</span> = as_num (obj_map [<span style="color: #CC9393;">"y"</span>]);
            env.obj_stack.push
                (make_num
                 (env, atan2 (x-&gt;num, y-&gt;num)));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"sinh"</span>, <span style="color: #CC9393;">"x"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            env.obj_stack.push
                (make_num
                 (env, sinh (x-&gt;num)));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"cosh"</span>, <span style="color: #CC9393;">"x"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            env.obj_stack.push
                (make_num
                 (env, cosh (x-&gt;num)));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"tanh"</span>, <span style="color: #CC9393;">"x"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            env.obj_stack.push
                (make_num
                 (env, tanh (x-&gt;num)));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"asinh"</span>, <span style="color: #CC9393;">"x"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            env.obj_stack.push
                (make_num
                 (env, asinh (x-&gt;num)));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"acosh"</span>, <span style="color: #CC9393;">"x"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            env.obj_stack.push
                (make_num
                 (env, acosh (x-&gt;num)));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"atanh"</span>, <span style="color: #CC9393;">"x"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span> = as_num (obj_map [<span style="color: #CC9393;">"x"</span>]);
            env.obj_stack.push
                (make_num
                 (env, atanh (x-&gt;num)));
        });
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org853351b" class="outline-4">
<h4 id="org853351b">expose_num</h4>
<div class="outline-text-4" id="text-org853351b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">expose_num</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    expose_num_predicate (env);
    expose_num_1 (env);
    expose_num_2 (env);
    expose_num_3 (env);
    expose_num_trigonometry (env);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4cde990" class="outline-3">
<h3 id="org4cde990">expose_str</h3>
<div class="outline-text-3" id="text-org4cde990">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">expose_str</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_prim (
        env, { <span style="color: #CC9393;">"str-print"</span>, <span style="color: #CC9393;">"str"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = obj_map [<span style="color: #CC9393;">"str"</span>];
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = as_str (obj);
            cout &lt;&lt; str-&gt;str;
            env.obj_stack.push (str);
        });
    define_prim (
        env, { <span style="color: #CC9393;">"str-length"</span>, <span style="color: #CC9393;">"str"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
        env.obj_stack.push (
            str_length (
                env,
                as_str (obj_map [<span style="color: #CC9393;">"str"</span>])));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"str-append"</span>, <span style="color: #CC9393;">"ante"</span>, <span style="color: #CC9393;">"succ"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                str_append (
                    env,
                    as_str (obj_map [<span style="color: #CC9393;">"ante"</span>]),
                    as_str (obj_map [<span style="color: #CC9393;">"succ"</span>])));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"str-slice"</span>, <span style="color: #CC9393;">"str"</span>, <span style="color: #CC9393;">"begin"</span>, <span style="color: #CC9393;">"end"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                str_slice (
                    env,
                    as_str (obj_map [<span style="color: #CC9393;">"str"</span>]),
                    as_num (obj_map [<span style="color: #CC9393;">"begin"</span>]),
                    as_num (obj_map [<span style="color: #CC9393;">"end"</span>])));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"str-ref"</span>, <span style="color: #CC9393;">"str"</span>, <span style="color: #CC9393;">"index"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                str_ref (
                    env,
                    as_str (obj_map [<span style="color: #CC9393;">"str"</span>]),
                    as_num (obj_map [<span style="color: #CC9393;">"index"</span>])));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"str-head"</span>, <span style="color: #CC9393;">"str"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                str_head (
                    env,
                    as_str (obj_map [<span style="color: #CC9393;">"str"</span>])));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"str-rest"</span>, <span style="color: #CC9393;">"str"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                str_rest (
                    env,
                    as_str (obj_map [<span style="color: #CC9393;">"str"</span>])));
        });
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org476aeb" class="outline-3">
<h3 id="org476aeb">expose_sym</h3>
<div class="outline-text-3" id="text-org476aeb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">expose_sym</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_prim (
        env, { <span style="color: #CC9393;">"sym-print"</span>, <span style="color: #CC9393;">"sym"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = obj_map [<span style="color: #CC9393;">"sym"</span>];
            assert (sym_p (env, obj));
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sym</span> = as_sym (obj);
            cout &lt;&lt; sym-&gt;sym;
            env.obj_stack.push (sym);
        });
    define_prim (
        env, { <span style="color: #CC9393;">"sym-length"</span>, <span style="color: #CC9393;">"sym"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
        env.obj_stack.push (
            sym_length (
                env,
                as_sym (obj_map [<span style="color: #CC9393;">"sym"</span>])));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"sym-append"</span>, <span style="color: #CC9393;">"ante"</span>, <span style="color: #CC9393;">"succ"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                sym_append (
                    env,
                    as_sym (obj_map [<span style="color: #CC9393;">"ante"</span>]),
                    as_sym (obj_map [<span style="color: #CC9393;">"succ"</span>])));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"sym-slice"</span>, <span style="color: #CC9393;">"sym"</span>, <span style="color: #CC9393;">"begin"</span>, <span style="color: #CC9393;">"end"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                sym_slice (
                    env,
                    as_sym (obj_map [<span style="color: #CC9393;">"sym"</span>]),
                    as_num (obj_map [<span style="color: #CC9393;">"begin"</span>]),
                    as_num (obj_map [<span style="color: #CC9393;">"end"</span>])));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"sym-ref"</span>, <span style="color: #CC9393;">"sym"</span>, <span style="color: #CC9393;">"index"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                sym_ref (
                    env,
                    as_sym (obj_map [<span style="color: #CC9393;">"sym"</span>]),
                    as_num (obj_map [<span style="color: #CC9393;">"index"</span>])));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"sym-head"</span>, <span style="color: #CC9393;">"sym"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                sym_head (
                    env,
                    as_sym (obj_map [<span style="color: #CC9393;">"sym"</span>])));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"sym-rest"</span>, <span style="color: #CC9393;">"sym"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                sym_rest (
                    env,
                    as_sym (obj_map [<span style="color: #CC9393;">"sym"</span>])));
        });
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2f18f0b" class="outline-3">
<h3 id="org2f18f0b">expose_list</h3>
<div class="outline-text-3" id="text-org2f18f0b">
</div><div id="outline-container-org8c3474d" class="outline-4">
<h4 id="org8c3474d">jj_cons_c</h4>
<div class="outline-text-4" id="text-org8c3474d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;data_cons_o&gt;
<span style="color: #93E0E3;">jj_cons_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_data_cons (
        env,
        cons_tag,
        name_vector_t ({ <span style="color: #CC9393;">"car"</span>, <span style="color: #CC9393;">"cdr"</span> }),
        <span style="color: #7CB8BB;">obj_map_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org51d0aba" class="outline-4">
<h4 id="org51d0aba">expose_list</h4>
<div class="outline-text-4" id="text-org51d0aba">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">expose_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define (env, <span style="color: #CC9393;">"null-c"</span>, null_c (env));
    define (env, <span style="color: #CC9393;">"null"</span>, null_c (env));
    define (env, <span style="color: #CC9393;">"cons-c"</span>, jj_cons_c (env));
    define (env, <span style="color: #CC9393;">"cons"</span>, jj_cons_c (env));
    define_prim (
        env, { <span style="color: #CC9393;">"list-length"</span>, <span style="color: #CC9393;">"list"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                list_length (
                    env,
                    obj_map [<span style="color: #CC9393;">"list"</span>]));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"list-reverse"</span>, <span style="color: #CC9393;">"list"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                list_reverse (
                    env,
                    obj_map [<span style="color: #CC9393;">"list"</span>]));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"list-append"</span>, <span style="color: #CC9393;">"ante"</span>, <span style="color: #CC9393;">"succ"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                list_append (
                    env,
                    obj_map [<span style="color: #CC9393;">"ante"</span>],
                    obj_map [<span style="color: #CC9393;">"succ"</span>]));
        });
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org35c92e5" class="outline-3">
<h3 id="org35c92e5">expose_vect</h3>
<div class="outline-text-3" id="text-org35c92e5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">expose_vect</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_prim (
        env, { <span style="color: #CC9393;">"list-to-vect"</span>, <span style="color: #CC9393;">"list"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                list_to_vect (
                    env,
                    obj_map [<span style="color: #CC9393;">"list"</span>]));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"vect-to-list"</span>, <span style="color: #CC9393;">"vect"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                vect_to_list (
                    env,
                    as_vect (obj_map [<span style="color: #CC9393;">"vect"</span>])));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"vect-length"</span>, <span style="color: #CC9393;">"vect"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                vect_length (
                    env,
                    as_vect (obj_map [<span style="color: #CC9393;">"vect"</span>])));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"vect-append"</span>, <span style="color: #CC9393;">"ante"</span>, <span style="color: #CC9393;">"succ"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                vect_append (
                    env,
                    as_vect (obj_map [<span style="color: #CC9393;">"ante"</span>]),
                    as_vect (obj_map [<span style="color: #CC9393;">"succ"</span>])));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"vect-slice"</span>, <span style="color: #CC9393;">"vect"</span>, <span style="color: #CC9393;">"begin"</span>, <span style="color: #CC9393;">"end"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                vect_slice (
                    env,
                    as_vect (obj_map [<span style="color: #CC9393;">"vect"</span>]),
                    as_num (obj_map [<span style="color: #CC9393;">"begin"</span>]),
                    as_num (obj_map [<span style="color: #CC9393;">"end"</span>])));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"vect-ref"</span>, <span style="color: #CC9393;">"vect"</span>, <span style="color: #CC9393;">"index"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                vect_ref (
                    env,
                    as_vect (obj_map [<span style="color: #CC9393;">"vect"</span>]),
                    as_num (obj_map [<span style="color: #CC9393;">"index"</span>])));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"vect-head"</span>, <span style="color: #CC9393;">"vect"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                vect_head (
                    env,
                    as_vect (obj_map [<span style="color: #CC9393;">"vect"</span>])));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"vect-rest"</span>, <span style="color: #CC9393;">"vect"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                vect_rest (
                    env,
                    as_vect (obj_map [<span style="color: #CC9393;">"vect"</span>])));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"unit-vect"</span>, <span style="color: #CC9393;">"obj"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                unit_vect (
                    env,
                    obj_map [<span style="color: #CC9393;">"obj"</span>]));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"vect-reverse"</span>, <span style="color: #CC9393;">"vect"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                vect_reverse (
                    env,
                    as_vect (obj_map [<span style="color: #CC9393;">"vect"</span>])));
        });
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8975f1c" class="outline-3">
<h3 id="org8975f1c">expose_maybe</h3>
<div class="outline-text-3" id="text-org8975f1c">
</div><div id="outline-container-org5f27a91" class="outline-4">
<h4 id="org5f27a91">jj_just_c</h4>
<div class="outline-text-4" id="text-org5f27a91">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;data_cons_o&gt;
<span style="color: #93E0E3;">jj_just_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_data_cons (
        env,
        just_tag,
        name_vector_t ({ <span style="color: #CC9393;">"value"</span> }),
        <span style="color: #7CB8BB;">obj_map_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6b5b3f6" class="outline-4">
<h4 id="org6b5b3f6">expose_maybe</h4>
<div class="outline-text-4" id="text-org6b5b3f6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">expose_maybe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define (env, <span style="color: #CC9393;">"nothing-c"</span>, nothing_c (env));
    define (env, <span style="color: #CC9393;">"nothing"</span>, nothing_c (env));
    define (env, <span style="color: #CC9393;">"just-c"</span>, jj_just_c (env));
    define (env, <span style="color: #CC9393;">"just"</span>, jj_just_c (env));
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org30ee25b" class="outline-3">
<h3 id="org30ee25b">expose_dict</h3>
<div class="outline-text-3" id="text-org30ee25b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">expose_dict</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_prim (
        env, { <span style="color: #CC9393;">"list-to-dict"</span>, <span style="color: #CC9393;">"list"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                list_to_dict (
                    env,
                    obj_map [<span style="color: #CC9393;">"list"</span>]));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"dict-to-list"</span>, <span style="color: #CC9393;">"dict"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                dict_to_list (
                    env,
                    as_dict (obj_map [<span style="color: #CC9393;">"dict"</span>])));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"dict-length"</span>, <span style="color: #CC9393;">"dict"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                dict_length (
                    env,
                    as_dict (obj_map [<span style="color: #CC9393;">"dict"</span>])));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"dict-key-list"</span>, <span style="color: #CC9393;">"dict"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                dict_key_list (
                    env,
                    as_dict (obj_map [<span style="color: #CC9393;">"dict"</span>])));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"dict-value-list"</span>, <span style="color: #CC9393;">"dict"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                dict_value_list (
                    env,
                    as_dict (obj_map [<span style="color: #CC9393;">"dict"</span>])));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"dict-insert"</span>, <span style="color: #CC9393;">"dict"</span>, <span style="color: #CC9393;">"key"</span>, <span style="color: #CC9393;">"value"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                dict_insert (
                    env,
                    as_dict (obj_map [<span style="color: #CC9393;">"dict"</span>]),
                    as_sym (obj_map [<span style="color: #CC9393;">"key"</span>]),
                    obj_map [<span style="color: #CC9393;">"value"</span>]));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"dict-merge"</span>, <span style="color: #CC9393;">"ante"</span>, <span style="color: #CC9393;">"succ"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                dict_merge (
                    env,
                    as_dict (obj_map [<span style="color: #CC9393;">"ante"</span>]),
                    as_dict (obj_map [<span style="color: #CC9393;">"succ"</span>])));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"dict-find"</span>, <span style="color: #CC9393;">"dict"</span>, <span style="color: #CC9393;">"key"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                dict_find (
                    env,
                    as_dict (obj_map [<span style="color: #CC9393;">"dict"</span>]),
                    as_sym (obj_map [<span style="color: #CC9393;">"key"</span>])));
        });
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgebf8c93" class="outline-3">
<h3 id="orgebf8c93">expose_sexp</h3>
<div class="outline-text-3" id="text-orgebf8c93">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">expose_sexp</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_prim (
        env, { <span style="color: #CC9393;">"scan-word-list"</span>, <span style="color: #CC9393;">"code"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- str-t -&gt; (list-t str-t)</span>
            env.obj_stack.push (
                scan_word_list (
                    env,
                    as_str (obj_map [<span style="color: #CC9393;">"code"</span>])));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"parse-sexp"</span>, <span style="color: #CC9393;">"word-list"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- (list-t str-t) -&gt; sexp-t</span>
            env.obj_stack.push (
                parse_sexp (
                    env,
                    obj_map [<span style="color: #CC9393;">"word-list"</span>]));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"parse-sexp-list"</span>, <span style="color: #CC9393;">"word-list"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- (list-t str-t) -&gt; (list-t sexp-t)</span>
            env.obj_stack.push (
                parse_sexp_list (
                    env,
                    obj_map [<span style="color: #CC9393;">"word-list"</span>]));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"sexp-repr"</span>, <span style="color: #CC9393;">"sexp"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                make_str (
                    env,
                    sexp_repr (env, obj_map [<span style="color: #CC9393;">"sexp"</span>])));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"sexp-list-repr"</span>, <span style="color: #CC9393;">"sexp-list"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (
                make_str (
                    env,
                    sexp_list_repr (env, obj_map [<span style="color: #CC9393;">"sexp-list"</span>])));
        });
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge2834f" class="outline-3">
<h3 id="orge2834f">expose_top_keyword</h3>
<div class="outline-text-3" id="text-orge2834f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">expose_top_keyword</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org130cc14" class="outline-3">
<h3 id="org130cc14">expose_keyword</h3>
<div class="outline-text-3" id="text-org130cc14">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">expose_keyword</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org180fb6f" class="outline-3">
<h3 id="org180fb6f">expose_system</h3>
<div class="outline-text-3" id="text-org180fb6f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">expose_system</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_prim (
        env, { <span style="color: #CC9393;">"system-env-find"</span>, <span style="color: #CC9393;">"name"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- str-t -&gt; str-t</span>
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = as_str (obj_map [<span style="color: #CC9393;">"name"</span>]);
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = str-&gt;str;
            env.obj_stack.push (make_str (env, system_env_find (name)));
        });
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga79ecab" class="outline-3">
<h3 id="orga79ecab">expose_module</h3>
<div class="outline-text-3" id="text-orga79ecab">
</div><div id="outline-container-org70b1595" class="outline-4">
<h4 id="org70b1595">jj_import</h4>
<div class="outline-text-4" id="text-org70b1595">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_import_sig</span> = { <span style="color: #CC9393;">"import"</span>, <span style="color: #CC9393;">"module-path"</span> };
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- str-t -&gt; module-t</span>
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_import</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = obj_map [<span style="color: #CC9393;">"module-path"</span>];
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = as_str (obj);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">module_path</span> = path_t (str-&gt;str);
    module_path = respect_module_path
        (env, module_path);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">module_env</span> = env_from_module_path (module_path);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">mod</span> = make_shared &lt;module_o&gt; (env, module_env);
    env.obj_stack.push (mod);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc9426d" class="outline-4">
<h4 id="orgc9426d">expose_module</h4>
<div class="outline-text-4" id="text-orgc9426d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">expose_module</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_prim (env,
                 jj_import_sig,
                 jj_import);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org23f3c74" class="outline-3">
<h3 id="org23f3c74">expose_stack</h3>
<div class="outline-text-3" id="text-org23f3c74">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">expose_stack</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_prim (
        env, { <span style="color: #CC9393;">"drop"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.pop ();
        });
    define_prim (
        env, { <span style="color: #CC9393;">"dup"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
            env.obj_stack.push (obj);
        });
    define_prim (
        env, { <span style="color: #CC9393;">"over"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">b</span> = env.obj_stack.top ();
            env.obj_stack.pop ();
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">a</span> = env.obj_stack.top ();
            env.obj_stack.pop ();
            env.obj_stack.push (a);
            env.obj_stack.push (b);
            env.obj_stack.push (a);
        });
    define_prim (
        env, { <span style="color: #CC9393;">"tuck"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">b</span> = env.obj_stack.top ();
            env.obj_stack.pop ();
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">a</span> = env.obj_stack.top ();
            env.obj_stack.pop ();
            env.obj_stack.push (b);
            env.obj_stack.push (a);
            env.obj_stack.push (b);
        });
    define_prim (
        env, { <span style="color: #CC9393;">"swap"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">b</span> = env.obj_stack.top ();
            env.obj_stack.pop ();
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">a</span> = env.obj_stack.top ();
            env.obj_stack.pop ();
            env.obj_stack.push (b);
            env.obj_stack.push (a);
        });
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4528bec" class="outline-3">
<h3 id="org4528bec">expose_syntax</h3>
<div class="outline-text-3" id="text-org4528bec">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">expose_syntax</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_top_keyword (env, <span style="color: #CC9393;">"="</span>, tk_assign);
    define_keyword (env, <span style="color: #CC9393;">"lambda"</span>, k_lambda);
    define_keyword (env, <span style="color: #CC9393;">"macro"</span>, k_macro);
    define_keyword (env, <span style="color: #CC9393;">"case"</span>, k_case);
    define_keyword (env, <span style="color: #CC9393;">"quote"</span>, k_quote);
    define_keyword (env, <span style="color: #CC9393;">"*"</span>, k_list);
    define_keyword (env, <span style="color: #CC9393;">"note"</span>, k_note);
    define_keyword (env, <span style="color: #CC9393;">"assert"</span>, k_assert);
    define_keyword (env, <span style="color: #CC9393;">"if"</span>, k_if);
    define_keyword (env, <span style="color: #CC9393;">"when"</span>, k_when);
    define_keyword (env, <span style="color: #CC9393;">"begin"</span>, k_begin);
    define_prim_macro (env, <span style="color: #CC9393;">"let"</span>, m_let);
    define_prim_macro (env, <span style="color: #CC9393;">"quasiquote"</span>, m_quasiquote);
    define_prim_macro (env, <span style="color: #CC9393;">"and"</span>, m_and);
    define_prim_macro (env, <span style="color: #CC9393;">"or"</span>, m_or);
    define_prim_macro (env, <span style="color: #CC9393;">"cond"</span>, m_cond);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7349576" class="outline-3">
<h3 id="org7349576">expose_misc</h3>
<div class="outline-text-3" id="text-org7349576">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">expose_misc</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_prim (
        env, { <span style="color: #CC9393;">"repr"</span>, <span style="color: #CC9393;">"obj"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = obj_map [<span style="color: #CC9393;">"obj"</span>];
            env.obj_stack.push (
                make_str (
                    env,
                    obj-&gt;repr (env)));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"print"</span>, <span style="color: #CC9393;">"obj"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = obj_map [<span style="color: #CC9393;">"obj"</span>];
            cout &lt;&lt; obj-&gt;repr (env) &lt;&lt; flush;
            env.obj_stack.push (obj);
        });
    define_prim (
        env, { <span style="color: #CC9393;">"println"</span>, <span style="color: #CC9393;">"obj"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = obj_map [<span style="color: #CC9393;">"obj"</span>];
            cout &lt;&lt; obj-&gt;repr (env) &lt;&lt; <span style="color: #CC9393;">"\n"</span> &lt;&lt; flush;
            env.obj_stack.push (obj);
        });
    define_prim (
        env, { <span style="color: #CC9393;">"nl"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            cout &lt;&lt; <span style="color: #CC9393;">"\n"</span> &lt;&lt; flush;
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">nl</span> = make_str (env, <span style="color: #CC9393;">"\n"</span>);
            env.obj_stack.push (nl);
        });
    define_prim (
        env, { <span style="color: #CC9393;">"eq"</span>, <span style="color: #CC9393;">"lhs"</span>, <span style="color: #CC9393;">"rhs"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lhs</span> = obj_map [<span style="color: #CC9393;">"lhs"</span>];
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rhs</span> = obj_map [<span style="color: #CC9393;">"rhs"</span>];
            env.obj_stack.push (
                make_bool (
                    env,
                    obj_eq (env, lhs, rhs)));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"env-report"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.report ();
            env.obj_stack.push (true_c (env));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"env-stack-report"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack_report ();
            env.obj_stack.push (true_c (env));
        });
    define_prim (
        env, { <span style="color: #CC9393;">"env-frame-report"</span> },
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.frame_stack_report ();
            env.obj_stack.push (true_c (env));
        });
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9ce71bb" class="outline-3">
<h3 id="org9ce71bb">expose_core</h3>
<div class="outline-text-3" id="text-org9ce71bb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">expose_core</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    expose_bool (env);
    expose_num (env);
    expose_str (env);
    expose_sym (env);
    expose_list (env);
    expose_vect (env);
    expose_maybe (env);
    expose_dict (env);
    expose_sexp (env);
    expose_top_keyword (env);
    expose_keyword (env);
    expose_system (env);
    expose_module (env);
    expose_syntax (env);
    expose_type (env);
    expose_stack (env);
    expose_misc (env);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd823735" class="outline-2">
<h2 id="orgd823735">epilog</h2>
<div class="outline-text-2" id="text-orgd823735">
</div><div id="outline-container-orge18b0f9" class="outline-3">
<h3 id="orge18b0f9">test</h3>
<div class="outline-text-3" id="text-orge18b0f9">
</div><div id="outline-container-org4788bc5" class="outline-4">
<h4 id="org4788bc5">test_step</h4>
<div class="outline-text-4" id="text-org4788bc5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_step</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    define (env, <span style="color: #CC9393;">"s1"</span>, make_str (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_str (env, <span style="color: #CC9393;">"world"</span>));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    {
        env.run ();
        assert_stack_size (env, 2);
        assert_pop_eq (env, make_str (env, <span style="color: #CC9393;">"world"</span>));
        assert_pop_eq (env, make_str (env, <span style="color: #CC9393;">"bye"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7bfa6fe" class="outline-4">
<h4 id="org7bfa6fe">test_data</h4>
<div class="outline-text-4" id="text-org7bfa6fe">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_data</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span> = {
        {<span style="color: #CC9393;">"car"</span>, make_str (env, <span style="color: #CC9393;">"bye"</span>)},
        {<span style="color: #CC9393;">"cdr"</span>, make_str (env, <span style="color: #CC9393;">"world"</span>)},
    };

    define (env, <span style="color: #CC9393;">"last-cry"</span>, make_data (env, cons_tag, obj_map));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"last-cry"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #CC9393;">"car"</span>),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"last-cry"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #CC9393;">"cdr"</span>),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"last-cry"</span>)),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    {
        env.run ();

        assert_stack_size (env, 3);
        assert_pop_eq (
            env, make_data (
                env,
                cons_tag,
                obj_map));
        assert_pop_eq (env, make_str (env, <span style="color: #CC9393;">"world"</span>));
        assert_pop_eq (env, make_str (env, <span style="color: #CC9393;">"bye"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge6bb0ed" class="outline-4">
<h4 id="orge6bb0ed">test_apply</h4>
<div class="outline-text-4" id="text-orge6bb0ed">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_apply</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    define (env, <span style="color: #CC9393;">"s1"</span>, make_str (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_str (env, <span style="color: #CC9393;">"world"</span>));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">body</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">local_ref_jo_t</span> (0, 0),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">local_ref_jo_t</span> (0, 1),
    };

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">lambda_jo_t</span> ({ <span style="color: #CC9393;">"x"</span>, <span style="color: #CC9393;">"y"</span> },
                         make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (body)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (2),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">env.double_report ();</span>

    {
        env.run ();
        assert_stack_size (env, 2);
        assert_pop_eq (env, make_str (env, <span style="color: #CC9393;">"world"</span>));
        assert_pop_eq (env, make_str (env, <span style="color: #CC9393;">"bye"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9173357" class="outline-4">
<h4 id="org9173357">test_lambda_curry</h4>
<div class="outline-text-4" id="text-org9173357">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_lambda_curry</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    define (env, <span style="color: #CC9393;">"s1"</span>, make_str (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_str (env, <span style="color: #CC9393;">"world"</span>));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">body</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">local_ref_jo_t</span> (0, 0),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">local_ref_jo_t</span> (0, 1),
    };

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">lambda_jo_t</span> ({ <span style="color: #CC9393;">"x"</span>, <span style="color: #CC9393;">"y"</span> },
                         make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (body)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">{</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">}</span>

    {
        env.run ();
        assert_stack_size (env, 2);
        assert_pop_eq (env, make_str (env, <span style="color: #CC9393;">"bye"</span>));
        assert_pop_eq (env, make_str (env, <span style="color: #CC9393;">"world"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9466a" class="outline-4">
<h4 id="org9466a">test_data_cons</h4>
<div class="outline-text-4" id="text-org9466a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_data_cons</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    define (env, <span style="color: #CC9393;">"s1"</span>, make_str (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_str (env, <span style="color: #CC9393;">"world"</span>));
    define (env, <span style="color: #CC9393;">"cons-c"</span>,
            make_data_cons (
                env,
                cons_tag,
                name_vector_t ({ <span style="color: #CC9393;">"car"</span>, <span style="color: #CC9393;">"cdr"</span> }),
                <span style="color: #7CB8BB;">obj_map_t</span> ()));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"cons-c"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (2),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #CC9393;">"cdr"</span>),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">env.double_report ();</span>

    {
        env.run ();
        assert_stack_size (env, 1);
        assert_pop_eq (env, make_str (env, <span style="color: #CC9393;">"world"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org776c12b" class="outline-4">
<h4 id="org776c12b">test_data_cons_curry</h4>
<div class="outline-text-4" id="text-org776c12b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_data_cons_curry</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    define (env, <span style="color: #CC9393;">"s1"</span>, make_str (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_str (env, <span style="color: #CC9393;">"world"</span>));
    define (env, <span style="color: #CC9393;">"cons-c"</span>,
            make_data_cons (
                env,
                cons_tag,
                name_vector_t ({ <span style="color: #CC9393;">"car"</span>, <span style="color: #CC9393;">"cdr"</span> }),
                <span style="color: #7CB8BB;">obj_map_t</span> ()));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"cons-c"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #CC9393;">"car"</span>),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">env.double_report ();</span>

    {
        env.run ();
        assert_stack_size (env, 1);
        assert_pop_eq (env, make_str (env, <span style="color: #CC9393;">"world"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf5ee42" class="outline-4">
<h4 id="orgf5ee42">test_prim</h4>
<div class="outline-text-4" id="text-orgf5ee42">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_prim</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    define (env, <span style="color: #CC9393;">"s1"</span>, make_str (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_str (env, <span style="color: #CC9393;">"world"</span>));

    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">swap</span> =
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (obj_map [<span style="color: #CC9393;">"y"</span>]);
            env.obj_stack.push (obj_map [<span style="color: #CC9393;">"x"</span>]);
        };

    define (env, <span style="color: #CC9393;">"swap"</span>,
            make_prim (
                env,
                name_vector_t { <span style="color: #CC9393;">"x"</span>, <span style="color: #CC9393;">"y"</span> },
                swap,
                <span style="color: #7CB8BB;">obj_map_t</span> ()));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"swap"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (2),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"swap"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">env.double_report ();</span>

    {
        env.run ();
        assert_stack_size (env, 4);
        assert_pop_eq (env, make_str (env, <span style="color: #CC9393;">"world"</span>));
        assert_pop_eq (env, make_str (env, <span style="color: #CC9393;">"bye"</span>));
        assert_pop_eq (env, make_str (env, <span style="color: #CC9393;">"bye"</span>));
        assert_pop_eq (env, make_str (env, <span style="color: #CC9393;">"world"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge526538" class="outline-3">
<h3 id="orge526538">test_all</h3>
<div class="outline-text-3" id="text-orge526538">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_all</span> ()
{
    test_step ();
    test_data ();
    test_apply ();
    test_lambda_curry ();
    test_data_cons ();
    test_data_cons_curry ();
    test_prim ();
    test_scan ();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge00f67d" class="outline-3">
<h3 id="orge00f67d">the_story_begins</h3>
<div class="outline-text-3" id="text-orge00f67d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">the_story_begins</span> (<span style="color: #7CB8BB;">string_vector_t</span> <span style="color: #DFAF8F;">arg_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">module_path_string</span>: arg_vector) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">module_path</span> = path_t (module_path_string);
        env_from_module_path (module_path);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org636930c" class="outline-3">
<h3 id="org636930c">main</h3>
<div class="outline-text-3" id="text-org636930c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">int</span>
<span style="color: #93E0E3;">main</span> (<span style="color: #7CB8BB;">int</span> <span style="color: #DFAF8F;">argc</span>, <span style="color: #7CB8BB;">char</span> **<span style="color: #DFAF8F;">argv</span>)
{
    test_all ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">arg_vector</span> = string_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">i</span> = 1; i &lt; argc; i++) {
        arg_vector.push_back (<span style="color: #7CB8BB;">string</span> (<span style="color: #DFAF8F;">argv</span>[i]));
    }
    the_story_begins (arg_vector);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> 0;
}
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2018-08-17 Fri 04:21</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
