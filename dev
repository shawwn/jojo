#!/usr/bin/env bash

# C="g++"
C="clang++"
W="-Wall -Wno-infinite-recursion"
# W="-Wall -Wno-infinite-recursion -Wextra"
O="-foptimize-sibling-calls -O2"
L="-lstdc++fs"
PREFIX=$HOME

tangle () {
    ./tangle.js
}

build ()
{
    clean
    tangle
    time $C -o jojo jojo.cpp $W $L
}

release () {
    clean
    time $C -o jojo jojo.cpp $W $O $L
}

clean () {
    rm -f jojo
}

test () {
    for FILE in $(ls test | grep "\.jo" | grep "test-")
    do
        ./jojo "test/$FILE"
    done
}

debug () {
    # time valgrind --leak-check=full ./jojo
    for FILE in $(ls test | grep "\.jo" | grep "test-")
    do
        echo "<test/$FILE>" && valgrind ./jojo "test/$FILE" && echo "</test/$FILE>" && echo ""
    done
}

install () {
    cp jojo $PREFIX/bin/
}


uninstall () {
    rm $PREFIX/bin/jojo
}

main () {
    for TASK in $@
    do
        $TASK
    done
}

main $@
