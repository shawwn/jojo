<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2018-08-01 Wed 00:58 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>jojo</title>
<meta name="generator" content="Org-mode" />
<link rel="stylesheet" href="css/org-page.css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">jojo</h1>
<div id="table-of-contents">
<h2>overview</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgf278854">prolog</a>
<ul>
<li><a href="#orgbe8f457">include</a></li>
<li><a href="#org426adb7">using</a></li>
<li><a href="#org1f538f2">help</a>
<ul>
<li><a href="#org933ffa8">debug_here</a></li>
<li><a href="#org1eadf3b">string_split</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org654181a">datatype</a>
<ul>
<li><a href="#org6168872">forward declaration</a></li>
<li><a href="#org103d46c">name_t</a></li>
<li><a href="#org40dca1e">name_vector_t</a></li>
<li><a href="#org8903257">bind_t</a></li>
<li><a href="#org45201c1">bind_vector_t</a></li>
<li><a href="#org17eb3af">local_scope_t</a></li>
<li><a href="#org78ad4c">jo_vector_t</a></li>
<li><a href="#org9f50f8f">jojo_t</a></li>
<li><a href="#org89f6138">jo_t</a></li>
<li><a href="#org71f5ba8">tag_t</a></li>
<li><a href="#orgb75b154">tag_name_box_vector</a></li>
<li><a href="#org3b8d99c">tag_map</a></li>
<li><a href="#orgb8d7dec">obj_map_t</a></li>
<li><a href="#orgef93f0b">obj_t</a></li>
<li><a href="#orgf1cf097">obj_vector_t</a></li>
<li><a href="#org6fde5d5">frame_t</a></li>
<li><a href="#org983f815">box_t</a></li>
<li><a href="#org568c498">box_map_t</a></li>
<li><a href="#org72bdee6">obj_stack_t</a></li>
<li><a href="#org18e78c7">frame_stack_t</a></li>
<li><a href="#orga09921e">env_t</a></li>
</ul>
</li>
<li><a href="#org4e6f78a">jojo</a>
<ul>
<li><a href="#org8c0aeaa">jojo_repr</a></li>
<li><a href="#org20f2fcc">jojo_print</a></li>
<li><a href="#org1fd8044">jojo_print_with_index</a></li>
</ul>
</li>
<li><a href="#orgfca09f3">name_vector</a>
<ul>
<li><a href="#orgc551413">name_vector_repr</a></li>
</ul>
</li>
<li><a href="#org3c83e19">obj</a>
<ul>
<li><a href="#orgfaf750">about tag</a>
<ul>
<li><a href="#org39e32fb">tagging</a></li>
<li><a href="#org4244b6c">name_of_tag</a></li>
<li><a href="#orge0be19c">box_of_tag</a></li>
</ul>
</li>
<li><a href="#org6ba000d">local</a>
<ul>
<li><a href="#org17c68a8">bind_vector_repr</a></li>
<li><a href="#org3020c92">local_scope_repr</a></li>
</ul>
</li>
<li><a href="#orgf52021b">obj</a>
<ul>
<li><a href="#org578ace5">obj_t::~obj_t</a></li>
<li><a href="#org5484eb1">obj_t::repr</a></li>
<li><a href="#org1b0d17b">obj_t::equal</a></li>
<li><a href="#org81caf52">obj_t::apply</a></li>
</ul>
</li>
<li><a href="#org98663ca">closure</a>
<ul>
<li><a href="#org4cdc89">number_of_obj_in_bind_vector</a></li>
<li><a href="#org64df794">closure_o</a></li>
<li><a href="#org5b05396">closure_o::closure_o</a></li>
<li><a href="#org17589a8">bind_vector_insert_obj</a></li>
<li><a href="#org838aad8">bind_vector_merge_obj_vector</a></li>
<li><a href="#org891e4b4">pick_up_obj_vector</a></li>
<li><a href="#orgad79f07">local_scope_extend</a></li>
<li><a href="#orgdaf8ce4">closure_o::apply</a></li>
<li><a href="#org6fc84dc">bind_equal</a></li>
<li><a href="#orgffef070">bind_vector_equal</a></li>
<li><a href="#org95befc2">local_scope_equal</a></li>
<li><a href="#org790d93">closure_o::equal</a></li>
<li><a href="#org89bd16c">closure_o::repr</a></li>
</ul>
</li>
<li><a href="#orgb24b14b">string</a>
<ul>
<li><a href="#orgd8b6ed1">str_o</a></li>
<li><a href="#org85c3a37">str_o::str_o</a></li>
<li><a href="#orgd44ff1b">str_o::repr</a></li>
<li><a href="#org16ac3d2">str_o::equal</a></li>
</ul>
</li>
<li><a href="#org93b3b02">data</a>
<ul>
<li><a href="#org45a03cb">data_o</a></li>
<li><a href="#orgda3abc1">data_o::data_o</a></li>
<li><a href="#orgf3e7e9a">obj_map_equal</a></li>
<li><a href="#orgc74f1d7">data_o::equal</a></li>
<li><a href="#orgecce556">obj_map_repr</a></li>
<li><a href="#org5a36a40">data_o::repr</a></li>
</ul>
</li>
<li><a href="#org9e6faf2">data_cons</a>
<ul>
<li><a href="#org4576ab0">data_cons_o</a></li>
<li><a href="#org8821d15">data_cons_o::data_cons_o</a></li>
<li><a href="#org87471ee">name_vector_obj_map_lack</a></li>
<li><a href="#org4cf2e78">name_vector_obj_map_arity_lack</a></li>
<li><a href="#orge43f6b1">pick_up_obj_map_and_merge</a></li>
<li><a href="#org1ae6ec1">data_cons_o::apply</a></li>
<li><a href="#org7dc3cfd">data_cons_o::equal</a></li>
<li><a href="#orgddbac5a">name_vector_and_obj_map_repr</a></li>
<li><a href="#orgea9e0dc">data_cons_o::repr</a></li>
</ul>
</li>
<li><a href="#org62e558a">prim</a>
<ul>
<li><a href="#org6d51de5">prim_fn</a></li>
<li><a href="#orge8c3a40">prim_o</a></li>
<li><a href="#orga165abf">prim_o::prim_o</a></li>
<li><a href="#org8313b74">prim_o::repr</a></li>
<li><a href="#orge61c06c">prim_o::equal</a></li>
<li><a href="#org80b322f">prim_o::apply</a></li>
</ul>
</li>
<li><a href="#org6f757fb">tag</a>
<ul>
<li><a href="#orge786f8f">tag_o</a></li>
<li><a href="#org6976ab9">tag_o::tag_o</a></li>
<li><a href="#org690ff38">tag_o::repr</a></li>
<li><a href="#org482b739">tag_o::equal</a></li>
</ul>
</li>
<li><a href="#org8697156">type</a>
<ul>
<li><a href="#org2f6f518">type_o</a></li>
<li><a href="#org57fe48c">type_o::type_o</a></li>
<li><a href="#org9600fc">type_o::repr</a></li>
<li><a href="#org7e737c3">type_o::equal</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org6bd898e">env</a>
<ul>
<li><a href="#orgfd70526">frame</a>
<ul>
<li><a href="#org167a530">frame_t::frame_t</a></li>
<li><a href="#org2ed4e68">frame_report</a></li>
</ul>
</li>
<li><a href="#orgeebb369">box</a>
<ul>
<li><a href="#org854560f">box_t::box_t</a></li>
<li><a href="#org67885a2">boxing</a></li>
</ul>
</li>
<li><a href="#orgd8ba29">box_map</a>
<ul>
<li><a href="#orgbdeaba4">box_map_report</a></li>
<li><a href="#org7b40805">name_of_box</a></li>
</ul>
</li>
<li><a href="#org736cbc7">obj_stack</a>
<ul>
<li><a href="#orgd022012">frame_stack_report</a></li>
</ul>
</li>
<li><a href="#orge0c1388">frame_stack</a>
<ul>
<li><a href="#org1b48c7c">obj_stack_report</a></li>
</ul>
</li>
<li><a href="#org1954fea">env_t::step</a></li>
<li><a href="#org76de562">env_t::run</a></li>
<li><a href="#orgcd13c5c">env_t::report</a></li>
<li><a href="#org83de9b4">env_t::run_with_base</a></li>
<li><a href="#orga34af58">env_t::double_report</a></li>
<li><a href="#org6dc762">env_t::step_and_report</a></li>
</ul>
</li>
<li><a href="#org4f98698">jo</a>
<ul>
<li><a href="#orgf759ed4">jojo</a>
<ul>
<li><a href="#orgc6cf495">jojo_t::jojo_t</a></li>
<li><a href="#org8d8603c">jojo_t::~jojo_t</a></li>
</ul>
</li>
<li><a href="#orgf3f3386">jo</a>
<ul>
<li><a href="#org12679de">jo_t::copy</a></li>
<li><a href="#orgca79ce0">jo_t::~jo_t</a></li>
<li><a href="#org931b22c">jo_t::exe</a></li>
<li><a href="#orgc1cb573">jo_t::repr</a></li>
</ul>
</li>
<li><a href="#orgce555c8">ref_jo</a>
<ul>
<li><a href="#orga0c973f">ref_jo_t</a></li>
<li><a href="#org9c46349">ref_jo_t::ref_jo_t</a></li>
<li><a href="#org75d84c1">ref_jo_t::copy</a></li>
<li><a href="#orgc1ef738">ref_jo_t::exe</a></li>
<li><a href="#org49ea0ef">ref_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#org22b204e">local_ref_jo</a>
<ul>
<li><a href="#org66a321">local_ref_jo_t</a></li>
<li><a href="#org2b5ab9d">local_ref_jo_t::local_ref_jo_t</a></li>
<li><a href="#orge94b586">local_ref_jo_t::copy</a></li>
<li><a href="#org17cb5f5">vector_rev_ref</a></li>
<li><a href="#org7b8de31">local_ref_jo_t::exe</a></li>
<li><a href="#orge47320d">local_ref_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#orgcf0ba1f">lambda_jo</a>
<ul>
<li><a href="#orge686359">lambda_jo_t</a></li>
<li><a href="#org7307e40">lambda_jo_t::lambda_jo_t</a></li>
<li><a href="#org4284ef5">lambda_jo_t::copy</a></li>
<li><a href="#orge7d1a44">bind_vector_from_name_vector</a></li>
<li><a href="#orgab62c79">lambda_jo_t::exe</a></li>
<li><a href="#orgf71e48f">lambda_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#org6ce33c8">field_jo</a>
<ul>
<li><a href="#orgdbe2996">field_jo_t</a></li>
<li><a href="#org1a6a74d">field_jo_t::field_jo_t</a></li>
<li><a href="#org3acc25e">field_jo_t::copy</a></li>
<li><a href="#org3bdb1b8">closure_p</a></li>
<li><a href="#orgd5530a4">field_jo_t::exe</a></li>
<li><a href="#orgded0a1f">field_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#org52c9236">apply_jo</a>
<ul>
<li><a href="#org244e8f9">apply_jo_t</a></li>
<li><a href="#orgbb867">apply_jo_t::apply_jo_t</a></li>
<li><a href="#orgeb801fb">apply_jo_t::copy</a></li>
<li><a href="#orge09b6a7">apply_jo_t::exe</a></li>
<li><a href="#org467d9db">apply_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#org804c7ea">case_jo</a>
<ul>
<li><a href="#org71346db">jojo_map_t</a></li>
<li><a href="#org7577e13">case_jo_t</a></li>
<li><a href="#orgb1fab66">case_jo_t::case_jo_t</a></li>
<li><a href="#org5d364dc">case_jo_t::copy</a></li>
<li><a href="#org2addeef">case_jo_t::exe</a></li>
<li><a href="#orgbbbf93e"><span class="todo _todo_">[todo]</span> case_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#orgacddd5">nop_jo</a>
<ul>
<li><a href="#org7317074">nop_jo_t</a></li>
<li><a href="#org14d78b9">nop_jo_t::copy</a></li>
<li><a href="#orgf186f1c">nop_jo_t::exe</a></li>
<li><a href="#org45e9d77">nop_jo_t::repr</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org3de76fa">define</a>
<ul>
<li><a href="#orgffeec97">define</a></li>
<li><a href="#orgbbc2ac0">type_p</a></li>
<li><a href="#org4ed0085">assign</a></li>
<li><a href="#orgc0cecf7">sig_t</a></li>
<li><a href="#org82c887">name_of_sig</a></li>
<li><a href="#orge7d8536">name_vector_of_sig</a></li>
<li><a href="#org2e45cc3">define_prim</a></li>
</ul>
</li>
<li><a href="#orgac16cde"><b>test</b></a>
<ul>
<li><a href="#org5fc9ab">new_frame_from_jojo</a></li>
<li><a href="#orgcc6e6ce">new_frame_from_jo_vector</a></li>
<li><a href="#org80b6ded">assert</a>
<ul>
<li><a href="#org633ceb0">assert_pop_eq</a></li>
<li><a href="#org7eeb669">assert_tos_eq</a></li>
<li><a href="#orgdbe9488">assert_stack_size</a></li>
</ul>
</li>
<li><a href="#org1ebf580"><span class="todo _todo_">[todo]</span> import_test</a></li>
</ul>
</li>
<li><a href="#org4d8435b"><b>bool</b></a>
<ul>
<li><a href="#org5515246">true_c</a></li>
<li><a href="#org7a70376">false_c</a></li>
<li><a href="#org4ae2885">jj_true_c</a></li>
<li><a href="#org8cf85f2">jj_false_c</a></li>
<li><a href="#org473621f">import_bool</a></li>
<li><a href="#orgdd47dca">test_bool</a></li>
</ul>
</li>
<li><a href="#org7c85ed2"><b>list</b></a>
<ul>
<li><a href="#orge502e6a">null_c</a></li>
<li><a href="#org6738be9">cons_c</a></li>
<li><a href="#orge2ec674">cons_p</a></li>
<li><a href="#org590b3f5">car</a></li>
<li><a href="#org759e442">cdr</a></li>
<li><a href="#org4ed37d6">null_p</a></li>
<li><a href="#orgb39e113">list_p</a></li>
<li><a href="#orgfb5a383">list_length</a></li>
<li><a href="#org6e6354f">jj_null_c</a></li>
<li><a href="#org226315c">jj_cons_c</a></li>
<li><a href="#orgfff4e83">import_list</a></li>
<li><a href="#org3954d55">test_list</a></li>
</ul>
</li>
<li><a href="#org167fc6c"><b>str</b></a>
<ul>
<li><a href="#orge214752">str_p</a></li>
<li><a href="#org85f45ac">jj_str_print</a></li>
<li><a href="#org7d6d3bd">import_str</a></li>
<li><a href="#org1b60258"><span class="todo _todo_">[todo]</span> test_str</a></li>
</ul>
</li>
<li><a href="#orgaba9e22"><b>vect</b></a>
<ul>
<li><a href="#orgf820da9">obj_vect_t</a></li>
<li><a href="#org3b4f0b9">vect_o</a></li>
<li><a href="#org7d012fa">vect_o::vect_o</a></li>
<li><a href="#org73d67b0">obj_equal</a></li>
<li><a href="#org7256af2">vect_equal</a></li>
<li><a href="#org6a78daa">vect_o::equal</a></li>
<li><a href="#org29d3e33">vect_o::repr</a></li>
<li><a href="#orgc1ad047">vect_p</a></li>
<li><a href="#orge3bfb97">list_to_vect</a></li>
<li><a href="#orgc0f0a07">jj_list_to_vect</a></li>
<li><a href="#org9a13cd4">vect_to_list</a></li>
<li><a href="#org31cb3a3">jj_vect_to_list</a></li>
<li><a href="#org401cbe1">import_vect</a></li>
<li><a href="#org72559f3">test_vect</a></li>
</ul>
</li>
<li><a href="#org8599d70"><b>dict</b></a>
<ul>
<li><a href="#org3c29362"><span class="todo _todo_">[todo]</span> import_dict</a></li>
<li><a href="#orgad090c6"><span class="todo _todo_">[todo]</span> test_dict</a></li>
</ul>
</li>
<li><a href="#org3713eda"><b>sexp</b></a>
<ul>
<li><a href="#org74e29be">string_vector_t</a></li>
<li><a href="#org72813e5">space_char_p</a></li>
<li><a href="#org31efe76">delimiter_char_p</a></li>
<li><a href="#org92f190c">string_from_char</a></li>
<li><a href="#org6313743">doublequote_char_p</a></li>
<li><a href="#org69d0c9b">find_word_length</a></li>
<li><a href="#org7633ce5">scan_word_vector</a></li>
<li><a href="#orgb389da7">string_vector_to_string_list</a></li>
<li><a href="#orgda5de75"><span class="todo _note_">[note]</span> about literal in quote</a></li>
<li><a href="#orgc2e50e2">scan_word_list</a></li>
<li><a href="#orgb447c72">bar_word_p</a></li>
<li><a href="#orge164228">ket_word_p</a></li>
<li><a href="#org3036794">quote_word_p</a></li>
<li><a href="#org771cdf3">bar_word_to_ket_word</a></li>
<li><a href="#org608f35">word_list_head_with_bar_ket_counter</a></li>
<li><a href="#org472f4ca">word_list_head</a></li>
<li><a href="#org5ff848f">word_list_rest_with_bar_ket_counter</a></li>
<li><a href="#org94976d1">word_list_rest</a></li>
<li><a href="#orgc85ae7f">word_list_drop_ket</a></li>
<li><a href="#org1f160a">parse_sexp</a></li>
<li><a href="#orgd0cdb94">parse_sexp_list</a></li>
<li><a href="#orgb8cda1c">sexp_repr</a></li>
<li><a href="#org9163534">sexp_list_repr</a></li>
<li><a href="#org72f6ba3">jj_scan_word_list</a></li>
<li><a href="#orgfff5197">jj_parse_sexp</a></li>
<li><a href="#orga36b091">jj_parse_sexp_list</a></li>
<li><a href="#org407d64b">jj_sexp_repr</a></li>
<li><a href="#orgd89238f">jj_sexp_list_repr</a></li>
<li><a href="#org5f3a922">import_sexp</a></li>
<li><a href="#org5798d6e">test_sexp_scan</a></li>
<li><a href="#org48675e2">test_sexp_list</a></li>
<li><a href="#org252cd32">test_sexp_vect</a></li>
<li><a href="#orga46c3d4">test_sexp</a></li>
</ul>
</li>
<li><a href="#org93460ea"><b>top-keyword</b></a>
<ul>
<li><a href="#orgbef78aa">top_keyword_fn</a></li>
<li><a href="#orgf6a29db">top_keyword_o</a></li>
<li><a href="#orgdc06520">top_keyword_o::top_keyword_o</a></li>
<li><a href="#org70b842d">top_keyword_o::equal</a></li>
<li><a href="#orgb4e1b56">top_keyword_p</a></li>
<li><a href="#orgc40f6cd">define_top_keyword</a></li>
<li><a href="#org1240977">import_top_keyword</a></li>
</ul>
</li>
<li><a href="#orgeab0ef9"><b>keyword</b></a>
<ul>
<li><a href="#orga094834">local_ref_map_t</a></li>
<li><a href="#orga66315b">local_ref_map_extend</a></li>
<li><a href="#org539e586">keyword_fn</a></li>
<li><a href="#orgc4a8fb6">keyword_o</a></li>
<li><a href="#orgce10674">keyword_o::keyword_o</a></li>
<li><a href="#org1f4c8c3">keyword_o::equal</a></li>
<li><a href="#org82c6e7a">keyword_p</a></li>
<li><a href="#orgea92f53">define_keyword</a></li>
<li><a href="#orgb069ee3">obj_vect_to_name_vector</a></li>
<li><a href="#org85e6d8e">import_keyword</a></li>
</ul>
</li>
<li><a href="#org998c8d7"><span class="todo _todo_">[todo]</span> <b>macro</b></a></li>
<li><a href="#org2d9b9c5"><b>compile</b></a>
<ul>
<li><a href="#orgceac846">keyword_sexp_p</a></li>
<li><a href="#org7f5cab7">get_keyword_fn</a></li>
<li><a href="#orgae5a3dd">jojo_append</a></li>
<li><a href="#org3e00da1">dot_string_p</a></li>
<li><a href="#org6cdeaff">dot_string_compile</a></li>
<li><a href="#org7075f65">ref_compile</a></li>
<li><a href="#org76b6877"><span class="todo _todo_">[todo]</span> string_compile</a></li>
<li><a href="#org540139">sexp_compile</a></li>
<li><a href="#org265f262">sexp_list_compile</a></li>
<li><a href="#orgce36c09">dot_head_p</a></li>
<li><a href="#org63dfa68">call_compile</a></li>
<li><a href="#org9174324">import_compile</a></li>
<li><a href="#orgf3bba0e">test_compile</a></li>
</ul>
</li>
<li><a href="#org3b15d7a"><b>eval</b></a>
<ul>
<li><a href="#org897f02d">top_keyword_sexp_p</a></li>
<li><a href="#orgd0a84a9">get_top_keyword_fn</a></li>
<li><a href="#org61f54bc">jojo_run</a></li>
<li><a href="#org2792f16">sexp_eval</a></li>
<li><a href="#org30657ad">sexp_list_eval</a></li>
<li><a href="#org1dd58a0">code_eval</a></li>
<li><a href="#org5e910ff">jj_code_eval</a></li>
<li><a href="#org81a775">import_eval</a></li>
<li><a href="#orga23c845"><span class="todo _todo_">[todo]</span> test_eval</a></li>
</ul>
</li>
<li><a href="#org8bb32ee"><b>syntax</b></a>
<ul>
<li><a href="#orgd6bd895">(= &lt;name&gt; (data &#x2026;))</a>
<ul>
<li><a href="#org869bc8"><span class="todo _note_">[note]</span> type must all be top-level</a></li>
<li><a href="#orgd3eb34e">assign_data_p</a></li>
<li><a href="#orgfaeee3d">type_name_to_data_name</a></li>
<li><a href="#orgbaa45bb">tk_assign_data</a></li>
</ul>
</li>
<li><a href="#org8aea08a">(= (&lt;name&gt; &#x2026;) &#x2026;)</a>
<ul>
<li><a href="#orgec428da">assign_lambda_sugar_p</a></li>
<li><a href="#org443b576">assign_lambda_desugar</a></li>
</ul>
</li>
<li><a href="#orgca7290e">(= &lt;name&gt; &#x2026;)</a>
<ul>
<li><a href="#orga7cf87f">sexp_substitute_recur</a></li>
<li><a href="#orge30d512">lambda_sexp_patch_this</a></li>
<li><a href="#org648f639">rest_patch_this</a></li>
<li><a href="#orgbdf9113">tk_assign_value</a></li>
</ul>
</li>
<li><a href="#org2cd7943">tk_assign</a></li>
<li><a href="#orgd64ccb7">k_lambda</a></li>
<li><a href="#orge553df1">case_compile</a></li>
<li><a href="#org8063991">k_case</a></li>
<li><a href="#orga7615bf">k_note</a></li>
<li><a href="#orgb0f184e">import_syntax</a></li>
<li><a href="#org848c3ba">test_syntax</a></li>
</ul>
</li>
<li><a href="#org89643b9"><b>tag</b></a>
<ul>
<li><a href="#orga7e7988"><span class="todo _todo_">[todo]</span> jj_get_tag</a></li>
<li><a href="#org25fbaab"><span class="todo _todo_">[todo]</span> import_tag</a></li>
<li><a href="#org60b60b2"><span class="todo _todo_">[todo]</span> test_tag</a></li>
</ul>
</li>
<li><a href="#org7244efb"><b>misc</b></a>
<ul>
<li><a href="#org2f289e5">jj_repr</a></li>
<li><a href="#orga5005b3">jj_print</a></li>
<li><a href="#org3473333">jj_println</a></li>
<li><a href="#orgfb40751">jj_newline</a></li>
<li><a href="#org88c298d">jj_equal</a></li>
<li><a href="#orge55cba0">import_misc</a></li>
<li><a href="#org5d05216">test_misc</a></li>
</ul>
</li>
<li><a href="#org525d8fd">epilog</a>
<ul>
<li><a href="#orge76c9c6">test</a>
<ul>
<li><a href="#org956a7bd">test_step</a></li>
<li><a href="#org967b9df">test_data</a></li>
<li><a href="#orgeaedd87">test_apply</a></li>
<li><a href="#org586089a">test_lambda_curry</a></li>
<li><a href="#orgc58c975">test_data_cons</a></li>
<li><a href="#org2fcd413">test_data_cons_curry</a></li>
<li><a href="#org515d5cd">test_prim</a></li>
</ul>
</li>
<li><a href="#org178011b">test_all</a></li>
<li><a href="#org44defe">import_all</a></li>
<li><a href="#org3d9656f">eval_file</a></li>
<li><a href="#orgde33491">the_story_begin</a></li>
<li><a href="#orgb81bb8c">main</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgf278854" class="outline-2">
<h2 id="orgf278854">prolog</h2>
<div class="outline-text-2" id="text-orgf278854">
</div><div id="outline-container-orgbe8f457" class="outline-3">
<h3 id="orgbe8f457">include</h3>
<div class="outline-text-3" id="text-orgbe8f457">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;iostream&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;fstream&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;sstream&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;algorithm&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;functional&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;cassert&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;memory&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;vector&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;array&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;map&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;set&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;stack&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org426adb7" class="outline-3">
<h3 id="org426adb7">using</h3>
<div class="outline-text-3" id="text-org426adb7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #F0DFAF; font-weight: bold;">namespace</span> <span style="color: #BFEBBF;">std</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org1f538f2" class="outline-3">
<h3 id="org1f538f2">help</h3>
<div class="outline-text-3" id="text-org1f538f2">
</div><div id="outline-container-org933ffa8" class="outline-4">
<h4 id="org933ffa8">debug_here</h4>
<div class="outline-text-4" id="text-org933ffa8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">debug_here</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span>)
{
    cout &lt;&lt; <span style="color: #CC9393;">" - HERE: "</span> &lt;&lt; index &lt;&lt; <span style="color: #CC9393;">"\n"</span> &lt;&lt; flush;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1eadf3b" class="outline-4">
<h4 id="org1eadf3b">string_split</h4>
<div class="outline-text-4" id="text-org1eadf3b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">template</span> &lt;<span style="color: #F0DFAF; font-weight: bold;">typename</span> <span style="color: #7CB8BB;">Out</span>&gt;
<span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">string_split</span> (<span style="color: #F0DFAF; font-weight: bold;">const</span> <span style="color: #7CB8BB;">string</span> &amp;<span style="color: #DFAF8F;">s</span>, <span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">delim</span>, <span style="color: #7CB8BB;">Out</span> <span style="color: #DFAF8F;">result</span>)
{
    <span style="color: #7CB8BB;">stringstream</span> <span style="color: #DFAF8F;">ss</span> (s);
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">item</span>;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (getline (ss, item, delim)) {
        *(result++) = item;
    }
}

<span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">string</span>&gt;
<span style="color: #93E0E3;">string_split</span> (<span style="color: #F0DFAF; font-weight: bold;">const</span> <span style="color: #7CB8BB;">string</span> &amp;<span style="color: #DFAF8F;">s</span>, <span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">delim</span>)
{
    <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">string</span>&gt; <span style="color: #DFAF8F;">elems</span>;
    string_split (s, delim, back_inserter (elems));
    <span style="color: #F0DFAF; font-weight: bold;">return</span> elems;
}
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org654181a" class="outline-2">
<h2 id="org654181a">datatype</h2>
<div class="outline-text-2" id="text-org654181a">
</div><div id="outline-container-org6168872" class="outline-3">
<h3 id="org6168872">forward declaration</h3>
<div class="outline-text-3" id="text-org6168872">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">env_t</span>;
<span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">obj_t</span>;
<span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">jo_t</span>;
<span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">box_t</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org103d46c" class="outline-3">
<h3 id="org103d46c">name_t</h3>
<div class="outline-text-3" id="text-org103d46c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">name_t</span> = string;
</pre>
</div>
</div>
</div>

<div id="outline-container-org40dca1e" class="outline-3">
<h3 id="org40dca1e">name_vector_t</h3>
<div class="outline-text-3" id="text-org40dca1e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">name_vector_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">name_t</span>&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-org8903257" class="outline-3">
<h3 id="org8903257">bind_t</h3>
<div class="outline-text-3" id="text-org8903257">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">bind_t</span> = <span style="color: #7CB8BB;">pair</span> &lt;<span style="color: #7CB8BB;">name_t</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-org45201c1" class="outline-3">
<h3 id="org45201c1">bind_vector_t</h3>
<div class="outline-text-3" id="text-org45201c1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">index from end</span>
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">bind_vector_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">bind_t</span>&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-org17eb3af" class="outline-3">
<h3 id="org17eb3af">local_scope_t</h3>
<div class="outline-text-3" id="text-org17eb3af">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">index from end</span>
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">local_scope_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">bind_vector_t</span>&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-org78ad4c" class="outline-3">
<h3 id="org78ad4c">jo_vector_t</h3>
<div class="outline-text-3" id="text-org78ad4c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">jo_vector_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">jo_t</span> *&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-org9f50f8f" class="outline-3">
<h3 id="org9f50f8f">jojo_t</h3>
<div class="outline-text-3" id="text-org9f50f8f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">jojo_t</span>
{
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span>;
    <span style="color: #93E0E3;">jojo_t</span> (<span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span>);
    ~<span style="color: #93E0E3;">jojo_t</span> ();
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org89f6138" class="outline-3">
<h3 id="org89f6138">jo_t</h3>
<div class="outline-text-3" id="text-org89f6138">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> ~<span style="color: #93E0E3;">jo_t</span> ();
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org71f5ba8" class="outline-3">
<h3 id="org71f5ba8">tag_t</h3>
<div class="outline-text-3" id="text-org71f5ba8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">tag_t</span> = size_t;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb75b154" class="outline-3">
<h3 id="orgb75b154">tag_name_box_vector</h3>
<div class="outline-text-3" id="text-orgb75b154">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">tag_name_box_vector_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">pair</span> &lt;<span style="color: #7CB8BB;">name_t</span>, <span style="color: #7CB8BB;">box_t</span> *&gt;&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-org3b8d99c" class="outline-3">
<h3 id="org3b8d99c">tag_map</h3>
<div class="outline-text-3" id="text-org3b8d99c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">tag_map_t</span> = <span style="color: #7CB8BB;">map</span> &lt;<span style="color: #7CB8BB;">name_t</span>, <span style="color: #7CB8BB;">tag_t</span>&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb8d7dec" class="outline-3">
<h3 id="orgb8d7dec">obj_map_t</h3>
<div class="outline-text-3" id="text-orgb8d7dec">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">obj_map_t</span> = <span style="color: #7CB8BB;">map</span> &lt;<span style="color: #7CB8BB;">name_t</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgef93f0b" class="outline-3">
<h3 id="orgef93f0b">obj_t</h3>
<div class="outline-text-3" id="text-orgef93f0b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag</span>;
    <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>;
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> ~<span style="color: #93E0E3;">obj_t</span> ();
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf1cf097" class="outline-3">
<h3 id="orgf1cf097">obj_vector_t</h3>
<div class="outline-text-3" id="text-orgf1cf097">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">obj_vector_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-org6fde5d5" class="outline-3">
<h3 id="org6fde5d5">frame_t</h3>
<div class="outline-text-3" id="text-org6fde5d5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">frame_t</span>
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span>;
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>;
    <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>;
    <span style="color: #93E0E3;">frame_t</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>, <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org983f815" class="outline-3">
<h3 id="org983f815">box_t</h3>
<div class="outline-text-3" id="text-org983f815">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">box_t</span>
{
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>;
    <span style="color: #7CB8BB;">bool</span> <span style="color: #DFAF8F;">empty_p</span>;
    <span style="color: #93E0E3;">box_t</span> ();
    <span style="color: #93E0E3;">box_t</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org568c498" class="outline-3">
<h3 id="org568c498">box_map_t</h3>
<div class="outline-text-3" id="text-org568c498">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">box_map_t</span> = <span style="color: #7CB8BB;">map</span> &lt;<span style="color: #7CB8BB;">name_t</span>, <span style="color: #7CB8BB;">box_t</span> *&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-org72bdee6" class="outline-3">
<h3 id="org72bdee6">obj_stack_t</h3>
<div class="outline-text-3" id="text-org72bdee6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">obj_stack_t</span> = <span style="color: #7CB8BB;">stack</span> &lt;<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-org18e78c7" class="outline-3">
<h3 id="org18e78c7">frame_stack_t</h3>
<div class="outline-text-3" id="text-org18e78c7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">frame_stack_t</span> = <span style="color: #7CB8BB;">stack</span> &lt;<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">frame_t</span>&gt;&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-orga09921e" class="outline-3">
<h3 id="orga09921e">env_t</h3>
<div class="outline-text-3" id="text-orga09921e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">env_t</span>
{
    <span style="color: #7CB8BB;">box_map_t</span> <span style="color: #DFAF8F;">box_map</span>;
    <span style="color: #7CB8BB;">obj_stack_t</span> <span style="color: #DFAF8F;">obj_stack</span>;
    <span style="color: #7CB8BB;">frame_stack_t</span> <span style="color: #DFAF8F;">frame_stack</span>;
    <span style="color: #7CB8BB;">tag_name_box_vector_t</span> <span style="color: #DFAF8F;">tag_name_box_vector</span>;
    <span style="color: #7CB8BB;">tag_map_t</span> <span style="color: #DFAF8F;">tag_map</span>;
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">step</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">run</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">report</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">run_with_base</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">base</span>);
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">double_report</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">step_and_report</span> ();
};
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4e6f78a" class="outline-2">
<h2 id="org4e6f78a">jojo</h2>
<div class="outline-text-2" id="text-org4e6f78a">
</div><div id="outline-container-org8c0aeaa" class="outline-3">
<h3 id="org8c0aeaa">jojo_repr</h3>
<div class="outline-text-3" id="text-org8c0aeaa">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">jojo_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>)
{
    assert (jojo-&gt;jo_vector.size () != 0);
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">jo</span>: jojo-&gt;jo_vector) {
        repr += jo-&gt;repr (env);
        repr += <span style="color: #CC9393;">" "</span>;
    }
    repr.pop_back ();
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org20f2fcc" class="outline-3">
<h3 id="org20f2fcc">jojo_print</h3>
<div class="outline-text-3" id="text-org20f2fcc">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">jojo_print</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">jo</span>: jojo-&gt;jo_vector) {
        cout &lt;&lt; jo-&gt;repr (env)
             &lt;&lt; <span style="color: #CC9393;">" "</span>;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1fd8044" class="outline-3">
<h3 id="org1fd8044">jojo_print_with_index</h3>
<div class="outline-text-3" id="text-org1fd8044">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">jojo_print_with_index</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                       <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>,
                       <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = jojo-&gt;jo_vector.begin ();
         it != jojo-&gt;jo_vector.end ();
         it++) {
        <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">it_index</span> = it - jojo-&gt;jo_vector.begin ();
        <span style="color: #7CB8BB;">jo_t</span> *<span style="color: #DFAF8F;">jo</span> = *it;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (index == it_index) {
            cout &lt;&lt; <span style="color: #CC9393;">"-&gt;&gt; "</span> &lt;&lt; jo-&gt;repr (env) &lt;&lt; <span style="color: #CC9393;">" "</span>;
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> {
            cout &lt;&lt; jo-&gt;repr (env) &lt;&lt; <span style="color: #CC9393;">" "</span>;
        }
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfca09f3" class="outline-2">
<h2 id="orgfca09f3">name_vector</h2>
<div class="outline-text-2" id="text-orgfca09f3">
</div><div id="outline-container-orgc551413" class="outline-3">
<h3 id="orgc551413">name_vector_repr</h3>
<div class="outline-text-3" id="text-orgc551413">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">name_vector_repr</span> (<span style="color: #7CB8BB;">name_vector_t</span> &amp;<span style="color: #DFAF8F;">name_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (name_vector.size () == 0) {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"["</span>;
        repr += <span style="color: #CC9393;">"]"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"["</span>;
        <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span>: name_vector) {
            repr += name;
            repr += <span style="color: #CC9393;">" "</span>;
        }
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> repr.empty ()) repr.pop_back ();
        repr += <span style="color: #CC9393;">"]"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3c83e19" class="outline-2">
<h2 id="org3c83e19">obj</h2>
<div class="outline-text-2" id="text-org3c83e19">
</div><div id="outline-container-orgfaf750" class="outline-3">
<h3 id="orgfaf750">about tag</h3>
<div class="outline-text-3" id="text-orgfaf750">
</div><div id="outline-container-org39e32fb" class="outline-4">
<h4 id="org39e32fb">tagging</h4>
<div class="outline-text-4" id="text-org39e32fb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">box_t</span> *
<span style="color: #93E0E3;">boxing</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>);

<span style="color: #7CB8BB;">tag_t</span>
<span style="color: #93E0E3;">tagging</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.tag_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.tag_map.end ()) {
        <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> tag;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">tag</span> = env.tag_name_box_vector.size ();
        env.tag_map [name] = tag;
        <span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span> = boxing (env, name);
        env.tag_name_box_vector.push_back (make_pair (name, box));
        <span style="color: #F0DFAF; font-weight: bold;">return</span> tag;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4244b6c" class="outline-4">
<h4 id="org4244b6c">name_of_tag</h4>
<div class="outline-text-4" id="text-org4244b6c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_t</span>
<span style="color: #93E0E3;">name_of_tag</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (tag &gt;= env.tag_name_box_vector.size ()) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"#&lt;unknown-tag-"</span> + to_string (tag) + <span style="color: #CC9393;">"&gt;"</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> env.tag_name_box_vector [tag] .first;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge0be19c" class="outline-4">
<h4 id="orge0be19c">box_of_tag</h4>
<div class="outline-text-4" id="text-orge0be19c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">box_t</span> *
<span style="color: #93E0E3;">box_of_tag</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (tag &gt;= env.tag_name_box_vector.size ()) {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : box_of_tag"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  unknown tag : "</span> &lt;&lt; tag &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> env.tag_name_box_vector [tag] .second;
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6ba000d" class="outline-3">
<h3 id="org6ba000d">local</h3>
<div class="outline-text-3" id="text-org6ba000d">
</div><div id="outline-container-org17c68a8" class="outline-4">
<h4 id="org17c68a8">bind_vector_repr</h4>
<div class="outline-text-4" id="text-org17c68a8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">bind_vector_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">bind_vector_t</span> <span style="color: #DFAF8F;">bind_vector</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = bind_vector.rbegin ();
         it != bind_vector.rend ();
         it++) {
        repr += <span style="color: #CC9393;">"("</span>;
        repr += to_string (distance (bind_vector.rbegin (), it));
        repr += <span style="color: #CC9393;">" "</span>;
        repr += it-&gt;first;
        repr += <span style="color: #CC9393;">" = "</span>;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (obj == <span style="color: #BFEBBF;">nullptr</span>)
            repr += <span style="color: #CC9393;">"_"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">else</span>
            repr += obj-&gt;repr (env);
        repr += <span style="color: #CC9393;">") "</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3020c92" class="outline-4">
<h4 id="org3020c92">local_scope_repr</h4>
<div class="outline-text-4" id="text-org3020c92">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">local_scope_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
    repr += <span style="color: #CC9393;">"  - ["</span>;
    repr += to_string (local_scope.size ());
    repr += <span style="color: #CC9393;">"] "</span>;
    repr += <span style="color: #CC9393;">"local_scope - "</span>;
    repr += <span style="color: #CC9393;">"\n"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = local_scope.rbegin ();
         it != local_scope.rend ();
         it++) {
        repr += <span style="color: #CC9393;">"    "</span>;
        repr += to_string (distance (local_scope.rbegin (), it));
        repr += <span style="color: #CC9393;">" "</span>;
        repr += bind_vector_repr (env, *it);
        repr += <span style="color: #CC9393;">"\n"</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf52021b" class="outline-3">
<h3 id="orgf52021b">obj</h3>
<div class="outline-text-3" id="text-orgf52021b">
</div><div id="outline-container-org578ace5" class="outline-4">
<h4 id="org578ace5">obj_t::~obj_t</h4>
<div class="outline-text-4" id="text-org578ace5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">obj_t</span>::~<span style="color: #93E0E3;">obj_t</span> ()
{
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">all classes that will be derived from</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">should have a virtual or protected destructor,</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">otherwise deleting an instance via a pointer</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">to a base class results in undefined behavior.</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5484eb1" class="outline-4">
<h4 id="org5484eb1">obj_t::repr</h4>
<div class="outline-text-4" id="text-org5484eb1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">obj_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"#&lt;"</span> + name_of_tag (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag) + <span style="color: #CC9393;">"&gt;"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1b0d17b" class="outline-4">
<h4 id="org1b0d17b">obj_t::equal</h4>
<div class="outline-text-4" id="text-org1b0d17b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">obj_t</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : obj_t::equal"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  equal is not implemented for  : "</span>
             &lt;&lt; name_of_tag (env, obj-&gt;tag) &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org81caf52" class="outline-4">
<h4 id="org81caf52">obj_t::apply</h4>
<div class="outline-text-4" id="text-org81caf52">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">obj_t</span>::<span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>)
{
    cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : applying non applicable object"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    exit (1);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org98663ca" class="outline-3">
<h3 id="org98663ca">closure</h3>
<div class="outline-text-3" id="text-org98663ca">
</div><div id="outline-container-org4cdc89" class="outline-4">
<h4 id="org4cdc89">number_of_obj_in_bind_vector</h4>
<div class="outline-text-4" id="text-org4cdc89">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">size_t</span>
<span style="color: #93E0E3;">number_of_obj_in_bind_vector</span> (<span style="color: #7CB8BB;">bind_vector_t</span> &amp;<span style="color: #DFAF8F;">bind_vector</span>)
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">sum</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = bind_vector.begin ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = bind_vector.end ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++)
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (it-&gt;second)
            sum++;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> sum;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org64df794" class="outline-4">
<h4 id="org64df794">closure_o</h4>
<div class="outline-text-4" id="text-org64df794">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">closure_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>;
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>;
    <span style="color: #7CB8BB;">bind_vector_t</span> <span style="color: #DFAF8F;">bind_vector</span>;
    <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>;
    <span style="color: #93E0E3;">closure_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
               <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
               <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>,
               <span style="color: #7CB8BB;">bind_vector_t</span> <span style="color: #DFAF8F;">bind_vector</span>,
               <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org5b05396" class="outline-4">
<h4 id="org5b05396">closure_o::closure_o</h4>
<div class="outline-text-4" id="text-org5b05396">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">closure_o</span>::
<span style="color: #93E0E3;">closure_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
           <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
           <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>,
           <span style="color: #7CB8BB;">bind_vector_t</span> <span style="color: #DFAF8F;">bind_vector</span>,
           <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = tagging (env, <span style="color: #CC9393;">"closure-t"</span>);
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector = name_vector;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo = jojo;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;bind_vector = bind_vector;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;local_scope = local_scope;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org17589a8" class="outline-4">
<h4 id="org17589a8">bind_vector_insert_obj</h4>
<div class="outline-text-4" id="text-org17589a8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">bind_vector_insert_obj</span> (<span style="color: #7CB8BB;">bind_vector_t</span> &amp;<span style="color: #DFAF8F;">bind_vector</span>,
                        <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = bind_vector.rbegin ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = bind_vector.rend ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++) {
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (it-&gt;second == <span style="color: #BFEBBF;">nullptr</span>) {
            it-&gt;second = obj;
            <span style="color: #F0DFAF; font-weight: bold;">return</span>;
        }
    }
    cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : bind_vector_insert_obj"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
         &lt;&lt; <span style="color: #CC9393;">"  the bind_vector is filled"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    exit (1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org838aad8" class="outline-4">
<h4 id="org838aad8">bind_vector_merge_obj_vector</h4>
<div class="outline-text-4" id="text-org838aad8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bind_vector_t</span>
<span style="color: #93E0E3;">bind_vector_merge_obj_vector</span> (<span style="color: #7CB8BB;">bind_vector_t</span> &amp;<span style="color: #DFAF8F;">old_bind_vector</span>,
                              <span style="color: #7CB8BB;">obj_vector_t</span> &amp;<span style="color: #DFAF8F;">obj_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bind_vector</span> = old_bind_vector;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span>: obj_vector)
        bind_vector_insert_obj (bind_vector, obj);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> bind_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org891e4b4" class="outline-4">
<h4 id="org891e4b4">pick_up_obj_vector</h4>
<div class="outline-text-4" id="text-org891e4b4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">obj_vector_t</span>
<span style="color: #93E0E3;">pick_up_obj_vector</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">counter</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_vector</span> = obj_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (counter &gt; 0) {
        counter--;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
        obj_vector.push_back (obj);
        env.obj_stack.pop ();
    }
    reverse (obj_vector.begin (),
             obj_vector.end ());
    <span style="color: #F0DFAF; font-weight: bold;">return</span> obj_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgad79f07" class="outline-4">
<h4 id="orgad79f07">local_scope_extend</h4>
<div class="outline-text-4" id="text-orgad79f07">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">local_scope_t</span>
<span style="color: #93E0E3;">local_scope_extend</span> (<span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">old_local_scope</span>,
                    <span style="color: #7CB8BB;">bind_vector_t</span> <span style="color: #DFAF8F;">bind_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_scope</span> = old_local_scope;
    local_scope.push_back (bind_vector);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> local_scope;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdaf8ce4" class="outline-4">
<h4 id="orgdaf8ce4">closure_o::apply</h4>
<div class="outline-text-4" id="text-orgdaf8ce4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">closure_o</span>::<span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">have</span> = number_of_obj_in_bind_vector (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;bind_vector);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack</span> = size - have;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lack == arity) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_vector</span> = pick_up_obj_vector
            (env, arity);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bind_vector</span> = bind_vector_merge_obj_vector
             (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;bind_vector, obj_vector);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_scope</span> = local_scope_extend
            (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;local_scope, bind_vector);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">frame</span> = make_shared &lt;<span style="color: #7CB8BB;">frame_t</span>&gt;
            (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo, local_scope);
        env.frame_stack.push (frame);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (arity &lt; lack) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_vector</span> = pick_up_obj_vector
            (env, arity);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bind_vector</span> = bind_vector_merge_obj_vector
            (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;bind_vector, obj_vector);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">closure</span> = make_shared &lt;closure_o&gt;
            (env,
             <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector,
             <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo,
             bind_vector,
             <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;local_scope);
        env.obj_stack.push (closure);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : closure_o::apply"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  over-arity apply"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  arity &gt; lack"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  arity : "</span> &lt;&lt; arity &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  lack : "</span> &lt;&lt; lack &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6fc84dc" class="outline-4">
<h4 id="org6fc84dc">bind_equal</h4>
<div class="outline-text-4" id="text-org6fc84dc">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">bind_equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
            <span style="color: #7CB8BB;">bind_t</span> &amp;<span style="color: #DFAF8F;">lhs</span>,
            <span style="color: #7CB8BB;">bind_t</span> &amp;<span style="color: #DFAF8F;">rhs</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lhs.first != rhs.first) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> lhs.second-&gt;equal (env, rhs.second);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgffef070" class="outline-4">
<h4 id="orgffef070">bind_vector_equal</h4>
<div class="outline-text-4" id="text-orgffef070">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">bind_vector_equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                   <span style="color: #7CB8BB;">bind_vector_t</span> &amp;<span style="color: #DFAF8F;">lhs</span>,
                   <span style="color: #7CB8BB;">bind_vector_t</span> &amp;<span style="color: #DFAF8F;">rhs</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lhs.size () != rhs.size ()) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = lhs.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">index</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (index &lt; size) {
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> bind_equal (env, lhs [index], rhs [index]))
            <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
        index++;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org95befc2" class="outline-4">
<h4 id="org95befc2">local_scope_equal</h4>
<div class="outline-text-4" id="text-org95befc2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">local_scope_equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                   <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">lhs</span>,
                   <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">rhs</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lhs.size () != rhs.size ()) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = lhs.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">index</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (index &lt; size) {
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> bind_vector_equal (env, lhs [index], rhs [index]))
            <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
        index++;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org790d93" class="outline-4">
<h4 id="org790d93">closure_o::equal</h4>
<div class="outline-text-4" id="text-org790d93">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">closure_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">raw pointers must be equal first</span>
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span> != obj.get ()) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;closure_o&gt; (obj);
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">then scopes</span>
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (local_scope_equal
        (env,
         <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;local_scope,
         that-&gt;local_scope)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">then bindings</span>
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (bind_vector_equal
        (env,
         <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;bind_vector,
         that-&gt;bind_vector)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org89bd16c" class="outline-4">
<h4 id="org89bd16c">closure_o::repr</h4>
<div class="outline-text-4" id="text-org89bd16c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">closure_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"- closure "</span>;
    repr += name_vector_repr (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector);
    repr += <span style="color: #CC9393;">"\n"</span>;
    repr += <span style="color: #CC9393;">"  "</span>;
    repr += jojo_repr (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo);
    repr += <span style="color: #CC9393;">"\n"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_scope</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;local_scope;
    local_scope.push_back (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;bind_vector);
    repr += local_scope_repr (env, local_scope);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb24b14b" class="outline-3">
<h3 id="orgb24b14b">string</h3>
<div class="outline-text-3" id="text-orgb24b14b">
</div><div id="outline-container-orgd8b6ed1" class="outline-4">
<h4 id="orgd8b6ed1">str_o</h4>
<div class="outline-text-4" id="text-orgd8b6ed1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">str_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>;
    <span style="color: #93E0E3;">str_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org85c3a37" class="outline-4">
<h4 id="org85c3a37">str_o::str_o</h4>
<div class="outline-text-4" id="text-org85c3a37">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">str_o</span>::<span style="color: #93E0E3;">str_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = tagging (env, <span style="color: #CC9393;">"str-t"</span>);
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;str = str;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd44ff1b" class="outline-4">
<h4 id="orgd44ff1b">str_o::repr</h4>
<div class="outline-text-4" id="text-orgd44ff1b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">str_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"\""</span> + <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;str + <span style="color: #CC9393;">"\""</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org16ac3d2" class="outline-4">
<h4 id="org16ac3d2">str_o::equal</h4>
<div class="outline-text-4" id="text-org16ac3d2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">str_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;str_o&gt; (obj);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;str == that-&gt;str);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org93b3b02" class="outline-3">
<h3 id="org93b3b02">data</h3>
<div class="outline-text-3" id="text-org93b3b02">
</div><div id="outline-container-org45a03cb" class="outline-4">
<h4 id="org45a03cb">data_o</h4>
<div class="outline-text-4" id="text-org45a03cb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">data_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #93E0E3;">data_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
            <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag</span>,
            <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgda3abc1" class="outline-4">
<h4 id="orgda3abc1">data_o::data_o</h4>
<div class="outline-text-4" id="text-orgda3abc1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">data_o</span>::
<span style="color: #93E0E3;">data_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
        <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag</span>,
        <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = tag;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map = obj_map;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf3e7e9a" class="outline-4">
<h4 id="orgf3e7e9a">obj_map_equal</h4>
<div class="outline-text-4" id="text-orgf3e7e9a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">obj_map_equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">lhs</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">rhs</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lhs.size () != rhs.size ()) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: lhs) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = kv.first;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = rhs.find (name);
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (it == rhs.end ()) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> kv.second-&gt;equal (env, it-&gt;second)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc74f1d7" class="outline-4">
<h4 id="orgc74f1d7">data_o::equal</h4>
<div class="outline-text-4" id="text-orgc74f1d7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">data_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;data_o&gt; (obj);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> obj_map_equal (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map, that-&gt;obj_map);

}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgecce556" class="outline-4">
<h4 id="orgecce556">obj_map_repr</h4>
<div class="outline-text-4" id="text-orgecce556">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">obj_map_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: obj_map) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = kv.first;
        repr += name;
        repr += <span style="color: #CC9393;">" = "</span>;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = kv.second;
        repr += obj-&gt;repr (env);
        repr += <span style="color: #CC9393;">" "</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> repr.empty ()) repr.pop_back ();
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5a36a40" class="outline-4">
<h4 id="org5a36a40">data_o::repr</h4>
<div class="outline-text-4" id="text-org5a36a40">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">data_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map.size () == 0) {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
        repr += name_of_tag (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag);
        repr.pop_back ();
        repr.pop_back ();
        repr += <span style="color: #CC9393;">"-c"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"("</span>;
        repr += name_of_tag (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag);
        repr.pop_back ();
        repr.pop_back ();
        repr += <span style="color: #CC9393;">"-c "</span>;
        repr += obj_map_repr (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        repr += <span style="color: #CC9393;">")"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9e6faf2" class="outline-3">
<h3 id="org9e6faf2">data_cons</h3>
<div class="outline-text-3" id="text-org9e6faf2">
</div><div id="outline-container-org4576ab0" class="outline-4">
<h4 id="org4576ab0">data_cons_o</h4>
<div class="outline-text-4" id="text-org4576ab0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">data_cons_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">type_tag</span>;
    <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>;
    <span style="color: #93E0E3;">data_cons_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                 <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">type_tag</span>,
                 <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
                 <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>);
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org8821d15" class="outline-4">
<h4 id="org8821d15">data_cons_o::data_cons_o</h4>
<div class="outline-text-4" id="text-org8821d15">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">data_cons_o</span>::
<span style="color: #93E0E3;">data_cons_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
             <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">type_tag</span>,
             <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
             <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = tagging (env, <span style="color: #CC9393;">"data-cons-t"</span>);
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;type_tag = type_tag;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector = name_vector;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map = obj_map;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org87471ee" class="outline-4">
<h4 id="org87471ee">name_vector_obj_map_lack</h4>
<div class="outline-text-4" id="text-org87471ee">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_vector_t</span>
<span style="color: #93E0E3;">name_vector_obj_map_lack</span> (<span style="color: #7CB8BB;">name_vector_t</span> &amp;<span style="color: #DFAF8F;">old_name_vector</span>,
                          <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = name_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span>: old_name_vector) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = obj_map.find (name);
        <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">not found == lack</span>
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (it == obj_map.end ())
            name_vector.push_back (name);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> name_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4cf2e78" class="outline-4">
<h4 id="org4cf2e78">name_vector_obj_map_arity_lack</h4>
<div class="outline-text-4" id="text-org4cf2e78">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_vector_t</span>
<span style="color: #93E0E3;">name_vector_obj_map_arity_lack</span> (<span style="color: #7CB8BB;">name_vector_t</span> &amp;<span style="color: #DFAF8F;">old_name_vector</span>,
                                <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>,
                                <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = name_vector_obj_map_lack
        (old_name_vector, obj_map);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack</span> = name_vector.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">counter</span> = lack - arity;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (counter &gt; 0) {
        counter--;
        name_vector.pop_back ();
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> name_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge43f6b1" class="outline-4">
<h4 id="orge43f6b1">pick_up_obj_map_and_merge</h4>
<div class="outline-text-4" id="text-orge43f6b1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">obj_map_t</span>
<span style="color: #93E0E3;">pick_up_obj_map_and_merge</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                           <span style="color: #7CB8BB;">name_vector_t</span> &amp;<span style="color: #DFAF8F;">lack_name_vector</span>,
                           <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">old_obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = old_obj_map;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = lack_name_vector.rbegin ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = lack_name_vector.rend ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++) {
        <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span> = *it;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
        env.obj_stack.pop ();
        obj_map [name] = obj;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> obj_map;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1ae6ec1" class="outline-4">
<h4 id="org1ae6ec1">data_cons_o::apply</h4>
<div class="outline-text-4" id="text-org1ae6ec1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">data_cons_o</span>::<span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">have</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack</span> = size - have;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lack == arity) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack_name_vector</span> = name_vector_obj_map_lack
            (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = pick_up_obj_map_and_merge
            (env, lack_name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">data</span> = make_shared &lt;data_o&gt;
            (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;type_tag, obj_map);
        env.obj_stack.push (data);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (arity &lt; lack) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack_name_vector</span> = name_vector_obj_map_arity_lack
            (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map, arity);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = pick_up_obj_map_and_merge
            (env, lack_name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">data_cons</span> = make_shared &lt;data_cons_o&gt;
            (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;type_tag, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, obj_map);
        env.obj_stack.push (data_cons);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : data_cons_o::apply"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  over-arity apply"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  arity &gt; lack"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  arity : "</span> &lt;&lt; arity &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  lack : "</span> &lt;&lt; lack &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7dc3cfd" class="outline-4">
<h4 id="org7dc3cfd">data_cons_o::equal</h4>
<div class="outline-text-4" id="text-org7dc3cfd">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">data_cons_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;data_cons_o&gt; (obj);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;type_tag != that-&gt;type_tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> obj_map_equal (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map, that-&gt;obj_map);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgddbac5a" class="outline-4">
<h4 id="orgddbac5a">name_vector_and_obj_map_repr</h4>
<div class="outline-text-4" id="text-orgddbac5a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">name_vector_and_obj_map_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                              <span style="color: #7CB8BB;">name_vector_t</span> &amp;<span style="color: #DFAF8F;">name_vector</span>,
                              <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">name</span>: name_vector) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = obj_map.find (name);
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (it == obj_map.end ()) {
            repr += name;
            repr += <span style="color: #CC9393;">" = _ "</span>;
        }
    }
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: obj_map) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = kv.first;
        repr += name;
        repr += <span style="color: #CC9393;">" = "</span>;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = kv.second;
        repr += obj-&gt;repr (env);
        repr += <span style="color: #CC9393;">" "</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> repr.empty ()) repr.pop_back ();
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgea9e0dc" class="outline-4">
<h4 id="orgea9e0dc">data_cons_o::repr</h4>
<div class="outline-text-4" id="text-orgea9e0dc">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">data_cons_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector.size () == 0) {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
        repr += name_of_tag (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;type_tag);
        repr.pop_back ();
        repr.pop_back ();
        repr += <span style="color: #CC9393;">"-c"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"("</span>;
        repr += name_of_tag (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;type_tag);
        repr.pop_back ();
        repr.pop_back ();
        repr += <span style="color: #CC9393;">"-c "</span>;
        repr += name_vector_and_obj_map_repr
            (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        repr += <span style="color: #CC9393;">")"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org62e558a" class="outline-3">
<h3 id="org62e558a">prim</h3>
<div class="outline-text-3" id="text-org62e558a">
</div><div id="outline-container-org6d51de5" class="outline-4">
<h4 id="org6d51de5">prim_fn</h4>
<div class="outline-text-4" id="text-org6d51de5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">prim_fn</span> = <span style="color: #7CB8BB;">function</span>
    &lt;<span style="color: #7CB8BB;">void</span> (<span style="color: #7CB8BB;">env_t</span> &amp;, <span style="color: #7CB8BB;">obj_map_t</span> &amp;)&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-orge8c3a40" class="outline-4">
<h4 id="orge8c3a40">prim_o</h4>
<div class="outline-text-4" id="text-orge8c3a40">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">prim_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>;
    <span style="color: #7CB8BB;">prim_fn</span> <span style="color: #DFAF8F;">fn</span>;
    <span style="color: #93E0E3;">prim_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
            <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
            <span style="color: #7CB8BB;">prim_fn</span> <span style="color: #DFAF8F;">fn</span>,
            <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orga165abf" class="outline-4">
<h4 id="orga165abf">prim_o::prim_o</h4>
<div class="outline-text-4" id="text-orga165abf">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">prim_o</span>::<span style="color: #93E0E3;">prim_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
                <span style="color: #7CB8BB;">prim_fn</span> <span style="color: #DFAF8F;">fn</span>,
                <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = tagging (env, <span style="color: #CC9393;">"prim-t"</span>);
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector = name_vector;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;fn = fn;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map = obj_map;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8313b74" class="outline-4">
<h4 id="org8313b74">prim_o::repr</h4>
<div class="outline-text-4" id="text-org8313b74">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">prim_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector.size () == 0) {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"(prim)"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"(prim "</span>;
        repr += name_vector_and_obj_map_repr
            (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        repr += <span style="color: #CC9393;">")"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge61c06c" class="outline-4">
<h4 id="orge61c06c">prim_o::equal</h4>
<div class="outline-text-4" id="text-orge61c06c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span> <span style="color: #BFEBBF;">prim_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;prim_o&gt; (obj);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span> != obj.get ()) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> obj_map_equal (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map, that-&gt;obj_map);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org80b322f" class="outline-4">
<h4 id="org80b322f">prim_o::apply</h4>
<div class="outline-text-4" id="text-org80b322f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span> <span style="color: #BFEBBF;">prim_o</span>::<span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">have</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack</span> = size - have;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lack == arity) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack_name_vector</span> = name_vector_obj_map_lack
            (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = pick_up_obj_map_and_merge
            (env, lack_name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;fn (env, obj_map);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (arity &lt; lack) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack_name_vector</span> = name_vector_obj_map_arity_lack
            (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map, arity);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = pick_up_obj_map_and_merge
            (env, lack_name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">prim</span> = make_shared &lt;prim_o&gt;
            (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;fn, obj_map);
        env.obj_stack.push (prim);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : prim_o::apply"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  over-arity apply"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  arity &gt; lack"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  arity : "</span> &lt;&lt; arity &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  lack : "</span> &lt;&lt; lack &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6f757fb" class="outline-3">
<h3 id="org6f757fb">tag</h3>
<div class="outline-text-3" id="text-org6f757fb">
</div><div id="outline-container-orge786f8f" class="outline-4">
<h4 id="orge786f8f">tag_o</h4>
<div class="outline-text-4" id="text-orge786f8f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">tag_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag</span>;
    <span style="color: #93E0E3;">tag_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org6976ab9" class="outline-4">
<h4 id="org6976ab9">tag_o::tag_o</h4>
<div class="outline-text-4" id="text-org6976ab9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">tag_o</span>::<span style="color: #93E0E3;">tag_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = tag;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org690ff38" class="outline-4">
<h4 id="org690ff38">tag_o::repr</h4>
<div class="outline-text-4" id="text-org690ff38">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">tag_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> name_of_tag (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org482b739" class="outline-4">
<h4 id="org482b739">tag_o::equal</h4>
<div class="outline-text-4" id="text-org482b739">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">tag_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;tag_o&gt; (obj);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag == that-&gt;tag);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8697156" class="outline-3">
<h3 id="org8697156">type</h3>
<div class="outline-text-3" id="text-org8697156">
</div><div id="outline-container-org2f6f518" class="outline-4">
<h4 id="org2f6f518">type_o</h4>
<div class="outline-text-4" id="text-org2f6f518">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">type_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">type_tag</span>;
    <span style="color: #93E0E3;">type_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
            <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">type_tag</span>,
            <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org57fe48c" class="outline-4">
<h4 id="org57fe48c">type_o::type_o</h4>
<div class="outline-text-4" id="text-org57fe48c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">type_o</span>::<span style="color: #93E0E3;">type_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">type_tag</span>,
                <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = tagging (env, <span style="color: #CC9393;">"type-t"</span>);
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;type_tag = type_tag;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map = obj_map;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9600fc" class="outline-4">
<h4 id="org9600fc">type_o::repr</h4>
<div class="outline-text-4" id="text-org9600fc">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">type_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> name_of_tag (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;type_tag);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7e737c3" class="outline-4">
<h4 id="org7e737c3">type_o::equal</h4>
<div class="outline-text-4" id="text-org7e737c3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">type_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;type_o&gt; (obj);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;type_tag != that-&gt;type_tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org6bd898e" class="outline-2">
<h2 id="org6bd898e">env</h2>
<div class="outline-text-2" id="text-org6bd898e">
</div><div id="outline-container-orgfd70526" class="outline-3">
<h3 id="orgfd70526">frame</h3>
<div class="outline-text-3" id="text-orgfd70526">
</div><div id="outline-container-org167a530" class="outline-4">
<h4 id="org167a530">frame_t::frame_t</h4>
<div class="outline-text-4" id="text-org167a530">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">frame_t</span>::<span style="color: #93E0E3;">frame_t</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>,
                  <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;index = 0;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo = jojo;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;local_scope = local_scope;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2ed4e68" class="outline-4">
<h4 id="org2ed4e68">frame_report</h4>
<div class="outline-text-4" id="text-org2ed4e68">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">frame_report</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">frame_t</span>&gt; <span style="color: #DFAF8F;">frame</span>)
{
    cout &lt;&lt; <span style="color: #CC9393;">"  - ["</span> &lt;&lt; frame-&gt;index+1
         &lt;&lt; <span style="color: #CC9393;">"/"</span> &lt;&lt; frame-&gt;jojo-&gt;jo_vector.size ()
         &lt;&lt; <span style="color: #CC9393;">"] "</span>;
    jojo_print_with_index (env, frame-&gt;jojo, frame-&gt;index);
    cout &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    cout &lt;&lt; local_scope_repr (env, frame-&gt;local_scope);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgeebb369" class="outline-3">
<h3 id="orgeebb369">box</h3>
<div class="outline-text-3" id="text-orgeebb369">
</div><div id="outline-container-org854560f" class="outline-4">
<h4 id="org854560f">box_t::box_t</h4>
<div class="outline-text-4" id="text-org854560f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">box_t</span>::<span style="color: #93E0E3;">box_t</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;empty_p = <span style="color: #BFEBBF;">true</span>;
}

<span style="color: #BFEBBF;">box_t</span>::<span style="color: #93E0E3;">box_t</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;empty_p = <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj = obj;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org67885a2" class="outline-4">
<h4 id="org67885a2">boxing</h4>
<div class="outline-text-4" id="text-org67885a2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">box_t</span> *
<span style="color: #93E0E3;">boxing</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.box_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.box_map.end ()) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> box;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">box_t</span> ();
        env.box_map [name] = box;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> box;
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd8ba29" class="outline-3">
<h3 id="orgd8ba29">box_map</h3>
<div class="outline-text-3" id="text-orgd8ba29">
</div><div id="outline-container-orgbdeaba4" class="outline-4">
<h4 id="orgbdeaba4">box_map_report</h4>
<div class="outline-text-4" id="text-orgbdeaba4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">box_map_report</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    cout &lt;&lt; <span style="color: #CC9393;">"- ["</span> &lt;&lt; env.box_map.size () &lt;&lt; <span style="color: #CC9393;">"] "</span>
         &lt;&lt; <span style="color: #CC9393;">"box_map - "</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: env.box_map) {
        cout &lt;&lt; <span style="color: #CC9393;">"  "</span> &lt;&lt; kv.first &lt;&lt; <span style="color: #CC9393;">" = "</span>;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = kv.second;
        cout &lt;&lt; box-&gt;obj-&gt;repr (env);
        cout &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7b40805" class="outline-4">
<h4 id="org7b40805">name_of_box</h4>
<div class="outline-text-4" id="text-org7b40805">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_t</span>
<span style="color: #93E0E3;">name_of_box</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: env.box_map) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = kv.first;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (kv.second == box) {
            <span style="color: #F0DFAF; font-weight: bold;">return</span> name;
        }
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"#non-name"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org736cbc7" class="outline-3">
<h3 id="org736cbc7">obj_stack</h3>
<div class="outline-text-3" id="text-org736cbc7">
</div><div id="outline-container-orgd022012" class="outline-4">
<h4 id="orgd022012">frame_stack_report</h4>
<div class="outline-text-4" id="text-orgd022012">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">frame_stack_report</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    cout &lt;&lt; <span style="color: #CC9393;">"- ["</span> &lt;&lt; env.frame_stack.size () &lt;&lt; <span style="color: #CC9393;">"] "</span>
         &lt;&lt; <span style="color: #CC9393;">"frame_stack - "</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    <span style="color: #7CB8BB;">frame_stack_t</span> <span style="color: #DFAF8F;">frame_stack</span> = env.frame_stack;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> frame_stack.empty ()) {
       <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">frame</span> = frame_stack.top ();
       frame_report (env, frame);
       frame_stack.pop ();
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge0c1388" class="outline-3">
<h3 id="orge0c1388">frame_stack</h3>
<div class="outline-text-3" id="text-orge0c1388">
</div><div id="outline-container-org1b48c7c" class="outline-4">
<h4 id="org1b48c7c">obj_stack_report</h4>
<div class="outline-text-4" id="text-org1b48c7c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">obj_stack_report</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    cout &lt;&lt; <span style="color: #CC9393;">"- ["</span> &lt;&lt; env.obj_stack.size () &lt;&lt; <span style="color: #CC9393;">"] "</span>
         &lt;&lt; <span style="color: #CC9393;">"obj_stack - "</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_stack</span> = env.obj_stack;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> obj_stack.empty ()) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = obj_stack.top ();
        cout &lt;&lt; <span style="color: #CC9393;">"  "</span>;
        cout &lt;&lt; obj-&gt;repr (env);
        cout &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        obj_stack.pop ();
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1954fea" class="outline-3">
<h3 id="org1954fea">env_t::step</h3>
<div class="outline-text-3" id="text-org1954fea">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">step</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">frame</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;frame_stack.top ();
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">size</span> = frame-&gt;jojo-&gt;jo_vector.size ();
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">it is assumed that jojo in frame are not empty</span>
    assert (size != 0);
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span> = frame-&gt;index;
    frame-&gt;index++;
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">handle proper tail call</span>
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (index+1 == size) <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;frame_stack.pop ();
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">since the last frame might be drop,</span>
    <span style="color: #5F7F5F;">//   </span><span style="color: #7F9F7F;">we pass last local_scope as an extra argument.</span>
    frame-&gt;jojo-&gt;jo_vector[index]-&gt;exe (*<span style="color: #F0DFAF; font-weight: bold;">this</span>, frame-&gt;local_scope);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org76de562" class="outline-3">
<h3 id="org76de562">env_t::run</h3>
<div class="outline-text-3" id="text-org76de562">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">run</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span><span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;frame_stack.empty ()) {
        <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;step ();
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcd13c5c" class="outline-3">
<h3 id="orgcd13c5c">env_t::report</h3>
<div class="outline-text-3" id="text-orgcd13c5c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">report</span> ()
{
    box_map_report (*<span style="color: #F0DFAF; font-weight: bold;">this</span>);
    frame_stack_report (*<span style="color: #F0DFAF; font-weight: bold;">this</span>);
    obj_stack_report (*<span style="color: #F0DFAF; font-weight: bold;">this</span>);
    cout &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org83de9b4" class="outline-3">
<h3 id="org83de9b4">env_t::run_with_base</h3>
<div class="outline-text-3" id="text-org83de9b4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">run_with_base</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">base</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;frame_stack.size () &gt; base) {
        <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;step ();
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga34af58" class="outline-3">
<h3 id="orga34af58">env_t::double_report</h3>
<div class="outline-text-3" id="text-orga34af58">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">double_report</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;report ();
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;run ();
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;report ();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6dc762" class="outline-3">
<h3 id="org6dc762">env_t::step_and_report</h3>
<div class="outline-text-3" id="text-org6dc762">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">step_and_report</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;step ();
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;report ();
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4f98698" class="outline-2">
<h2 id="org4f98698">jo</h2>
<div class="outline-text-2" id="text-org4f98698">
</div><div id="outline-container-orgf759ed4" class="outline-3">
<h3 id="orgf759ed4">jojo</h3>
<div class="outline-text-3" id="text-orgf759ed4">
</div><div id="outline-container-orgc6cf495" class="outline-4">
<h4 id="orgc6cf495">jojo_t::jojo_t</h4>
<div class="outline-text-4" id="text-orgc6cf495">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">jojo_t</span>::
<span style="color: #93E0E3;">jojo_t</span> (<span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jo_vector = jo_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8d8603c" class="outline-4">
<h4 id="org8d8603c">jojo_t::~jojo_t</h4>
<div class="outline-text-4" id="text-org8d8603c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">jojo_t</span>::
~<span style="color: #93E0E3;">jojo_t</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #7CB8BB;">jo_t</span> *<span style="color: #DFAF8F;">jo_ptr</span>: <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jo_vector)
        <span style="color: #F0DFAF; font-weight: bold;">delete</span> jo_ptr;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf3f3386" class="outline-3">
<h3 id="orgf3f3386">jo</h3>
<div class="outline-text-3" id="text-orgf3f3386">
</div><div id="outline-container-org12679de" class="outline-4">
<h4 id="org12679de">jo_t::copy</h4>
<div class="outline-text-4" id="text-org12679de">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : jo_t::copy unknown jo"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    exit (1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgca79ce0" class="outline-4">
<h4 id="orgca79ce0">jo_t::~jo_t</h4>
<div class="outline-text-4" id="text-orgca79ce0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">jo_t</span>::~<span style="color: #93E0E3;">jo_t</span> ()
{
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">all classes that will be derived from</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">should have a virtual or protected destructor,</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">otherwise deleting an instance via a pointer</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">to a base class results in undefined behavior.</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org931b22c" class="outline-4">
<h4 id="org931b22c">jo_t::exe</h4>
<div class="outline-text-4" id="text-org931b22c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : unknown jo"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    exit (1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc1cb573" class="outline-4">
<h4 id="orgc1cb573">jo_t::repr</h4>
<div class="outline-text-4" id="text-orgc1cb573">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"#&lt;unknown-jo&gt;"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgce555c8" class="outline-3">
<h3 id="orgce555c8">ref_jo</h3>
<div class="outline-text-3" id="text-orgce555c8">
</div><div id="outline-container-orga0c973f" class="outline-4">
<h4 id="orga0c973f">ref_jo_t</h4>
<div class="outline-text-4" id="text-orga0c973f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">ref_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span>;
    <span style="color: #93E0E3;">ref_jo_t</span> (<span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span>);
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org9c46349" class="outline-4">
<h4 id="org9c46349">ref_jo_t::ref_jo_t</h4>
<div class="outline-text-4" id="text-org9c46349">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">ref_jo_t</span>::<span style="color: #93E0E3;">ref_jo_t</span> (<span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;box = box;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org75d84c1" class="outline-4">
<h4 id="org75d84c1">ref_jo_t::copy</h4>
<div class="outline-text-4" id="text-org75d84c1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">ref_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;box);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc1ef738" class="outline-4">
<h4 id="orgc1ef738">ref_jo_t::exe</h4>
<div class="outline-text-4" id="text-orgc1ef738">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">ref_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;box-&gt;empty_p) {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : ref_jo_t::exe fail"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  undefined name : "</span>
             &lt;&lt; name_of_box (env, box) &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        env.obj_stack.push (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;box-&gt;obj);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org49ea0ef" class="outline-4">
<h4 id="org49ea0ef">ref_jo_t::repr</h4>
<div class="outline-text-4" id="text-org49ea0ef">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">ref_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> name_of_box (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;box);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org22b204e" class="outline-3">
<h3 id="org22b204e">local_ref_jo</h3>
<div class="outline-text-3" id="text-org22b204e">
</div><div id="outline-container-org66a321" class="outline-4">
<h4 id="org66a321">local_ref_jo_t</h4>
<div class="outline-text-4" id="text-org66a321">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">local_ref_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">level</span>;
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span>;
    <span style="color: #93E0E3;">local_ref_jo_t</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">level</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span>);
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org2b5ab9d" class="outline-4">
<h4 id="org2b5ab9d">local_ref_jo_t::local_ref_jo_t</h4>
<div class="outline-text-4" id="text-org2b5ab9d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">local_ref_jo_t</span>::
<span style="color: #93E0E3;">local_ref_jo_t</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">level</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;level = level;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;index = index;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge94b586" class="outline-4">
<h4 id="orge94b586">local_ref_jo_t::copy</h4>
<div class="outline-text-4" id="text-orge94b586">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">local_ref_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">local_ref_jo_t</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;level, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;index);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org17cb5f5" class="outline-4">
<h4 id="org17cb5f5">vector_rev_ref</h4>
<div class="outline-text-4" id="text-org17cb5f5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">template</span> &lt;<span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">T</span>&gt;
<span style="color: #7CB8BB;">T</span>
<span style="color: #93E0E3;">vector_rev_ref</span> (<span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">T</span>&gt; <span style="color: #DFAF8F;">vect</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">rev_index</span>)
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">size</span> = vect.size ();
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span> = size - rev_index - 1;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> vect [index];
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7b8de31" class="outline-4">
<h4 id="org7b8de31">local_ref_jo_t::exe</h4>
<div class="outline-text-4" id="text-org7b8de31">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">local_ref_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">this is the only place where</span>
    <span style="color: #5F7F5F;">//   </span><span style="color: #7F9F7F;">the local_scope in the arg of exe is uesd.</span>
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bind_vector</span> =
        vector_rev_ref (local_scope, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;level);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bind</span> =
        vector_rev_ref (bind_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;index);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = bind.second;
    env.obj_stack.push (obj);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge47320d" class="outline-4">
<h4 id="orge47320d">local_ref_jo_t::repr</h4>
<div class="outline-text-4" id="text-orge47320d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">local_ref_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"local."</span> +
        to_string (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;level) + <span style="color: #CC9393;">"."</span> +
        to_string (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;index);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgcf0ba1f" class="outline-3">
<h3 id="orgcf0ba1f">lambda_jo</h3>
<div class="outline-text-3" id="text-orgcf0ba1f">
</div><div id="outline-container-orge686359" class="outline-4">
<h4 id="orge686359">lambda_jo_t</h4>
<div class="outline-text-4" id="text-orge686359">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">lambda_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>;
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>;
    <span style="color: #93E0E3;">lambda_jo_t</span> (<span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
                 <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>);
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org7307e40" class="outline-4">
<h4 id="org7307e40">lambda_jo_t::lambda_jo_t</h4>
<div class="outline-text-4" id="text-org7307e40">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">lambda_jo_t</span>::
<span style="color: #93E0E3;">lambda_jo_t</span> (<span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
             <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector = name_vector;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo = jojo;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4284ef5" class="outline-4">
<h4 id="org4284ef5">lambda_jo_t::copy</h4>
<div class="outline-text-4" id="text-org4284ef5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">lambda_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">lambda_jo_t</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge7d1a44" class="outline-4">
<h4 id="orge7d1a44">bind_vector_from_name_vector</h4>
<div class="outline-text-4" id="text-orge7d1a44">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bind_vector_t</span>
<span style="color: #93E0E3;">bind_vector_from_name_vector</span> (<span style="color: #7CB8BB;">name_vector_t</span> &amp;<span style="color: #DFAF8F;">name_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bind_vector</span> = bind_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = name_vector.begin ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = name_vector.end ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++)
        bind_vector.push_back (make_pair (*it, <span style="color: #BFEBBF;">nullptr</span>));
    <span style="color: #F0DFAF; font-weight: bold;">return</span> bind_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgab62c79" class="outline-4">
<h4 id="orgab62c79">lambda_jo_t::exe</h4>
<div class="outline-text-4" id="text-orgab62c79">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">lambda_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">closure</span> = make_shared &lt;closure_o&gt;
        (env,
         <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector,
         <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo,
         bind_vector_from_name_vector (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector),
         local_scope);
    env.obj_stack.push (closure);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf71e48f" class="outline-4">
<h4 id="orgf71e48f">lambda_jo_t::repr</h4>
<div class="outline-text-4" id="text-orgf71e48f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">lambda_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"(lambda "</span> +
        name_vector_repr (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector) +
        <span style="color: #CC9393;">" "</span> +
        jojo_repr (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo) +
        <span style="color: #CC9393;">")"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6ce33c8" class="outline-3">
<h3 id="org6ce33c8">field_jo</h3>
<div class="outline-text-3" id="text-org6ce33c8">
</div><div id="outline-container-orgdbe2996" class="outline-4">
<h4 id="orgdbe2996">field_jo_t</h4>
<div class="outline-text-4" id="text-orgdbe2996">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">field_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>;
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #93E0E3;">field_jo_t</span> (<span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>);
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org1a6a74d" class="outline-4">
<h4 id="org1a6a74d">field_jo_t::field_jo_t</h4>
<div class="outline-text-4" id="text-org1a6a74d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">field_jo_t</span>::<span style="color: #93E0E3;">field_jo_t</span> (<span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name = name;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3acc25e" class="outline-4">
<h4 id="org3acc25e">field_jo_t::copy</h4>
<div class="outline-text-4" id="text-org3acc25e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">field_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3bdb1b8" class="outline-4">
<h4 id="org3bdb1b8">closure_p</h4>
<div class="outline-text-4" id="text-org3bdb1b8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">closure_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == tagging (env, <span style="color: #CC9393;">"closure-t"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd5530a4" class="outline-4">
<h4 id="orgd5530a4">field_jo_t::exe</h4>
<div class="outline-text-4" id="text-orgd5530a4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">field_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
    env.obj_stack.pop ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = obj-&gt;obj_map.find (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != obj-&gt;obj_map.end ()) {
        env.obj_stack.push (it-&gt;second);
        <span style="color: #F0DFAF; font-weight: bold;">return</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = box_of_tag (env, obj-&gt;tag);
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (box-&gt;empty_p) {
            cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : field_jo_t::exe"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
                 &lt;&lt; <span style="color: #CC9393;">"  unknown field : "</span> &lt;&lt; <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name &lt;&lt; <span style="color: #CC9393;">"\n"</span>
                 &lt;&lt; <span style="color: #CC9393;">"  empty box"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
            exit (1);
        }
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = box-&gt;obj-&gt;obj_map.find (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name);
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != box-&gt;obj-&gt;obj_map.end ()) {
            <span style="color: #F0DFAF; font-weight: bold;">if</span> (closure_p (env, it-&gt;second)) {
                env.obj_stack.push (obj);
            }
            env.obj_stack.push (it-&gt;second);
            <span style="color: #F0DFAF; font-weight: bold;">return</span>;
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> {
            cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : field_jo_t::exe"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
                 &lt;&lt; <span style="color: #CC9393;">"  unknown field : "</span> &lt;&lt; <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name &lt;&lt; <span style="color: #CC9393;">"\n"</span>
                 &lt;&lt; <span style="color: #CC9393;">"  fail to find it in both object and type"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
            exit (1);
        }
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgded0a1f" class="outline-4">
<h4 id="orgded0a1f">field_jo_t::repr</h4>
<div class="outline-text-4" id="text-orgded0a1f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">field_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"."</span> + <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org52c9236" class="outline-3">
<h3 id="org52c9236">apply_jo</h3>
<div class="outline-text-3" id="text-org52c9236">
</div><div id="outline-container-org244e8f9" class="outline-4">
<h4 id="org244e8f9">apply_jo_t</h4>
<div class="outline-text-4" id="text-org244e8f9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">apply_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>;
    <span style="color: #93E0E3;">apply_jo_t</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>);
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbb867" class="outline-4">
<h4 id="orgbb867">apply_jo_t::apply_jo_t</h4>
<div class="outline-text-4" id="text-orgbb867">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">apply_jo_t</span>::
<span style="color: #93E0E3;">apply_jo_t</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;arity = arity;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeb801fb" class="outline-4">
<h4 id="orgeb801fb">apply_jo_t::copy</h4>
<div class="outline-text-4" id="text-orgeb801fb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">apply_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;arity);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge09b6a7" class="outline-4">
<h4 id="orge09b6a7">apply_jo_t::exe</h4>
<div class="outline-text-4" id="text-orge09b6a7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">apply_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
    env.obj_stack.pop ();
    obj-&gt;apply (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;arity);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org467d9db" class="outline-4">
<h4 id="org467d9db">apply_jo_t::repr</h4>
<div class="outline-text-4" id="text-org467d9db">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">apply_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"(apply "</span> +
        to_string (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;arity) + <span style="color: #CC9393;">")"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org804c7ea" class="outline-3">
<h3 id="org804c7ea">case_jo</h3>
<div class="outline-text-3" id="text-org804c7ea">
</div><div id="outline-container-org71346db" class="outline-4">
<h4 id="org71346db">jojo_map_t</h4>
<div class="outline-text-4" id="text-org71346db">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">jojo_map_t</span> = <span style="color: #7CB8BB;">map</span> &lt;<span style="color: #7CB8BB;">tag_t</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-org7577e13" class="outline-4">
<h4 id="org7577e13">case_jo_t</h4>
<div class="outline-text-4" id="text-org7577e13">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">case_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">jojo_map_t</span> <span style="color: #DFAF8F;">jojo_map</span>;
    <span style="color: #93E0E3;">case_jo_t</span> (<span style="color: #7CB8BB;">jojo_map_t</span> <span style="color: #DFAF8F;">jojo_map</span>);
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb1fab66" class="outline-4">
<h4 id="orgb1fab66">case_jo_t::case_jo_t</h4>
<div class="outline-text-4" id="text-orgb1fab66">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">case_jo_t</span>::
<span style="color: #93E0E3;">case_jo_t</span> (<span style="color: #7CB8BB;">jojo_map_t</span> <span style="color: #DFAF8F;">jojo_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo_map = jojo_map;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5d364dc" class="outline-4">
<h4 id="org5d364dc">case_jo_t::copy</h4>
<div class="outline-text-4" id="text-org5d364dc">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">case_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">case_jo_t</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo_map);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2addeef" class="outline-4">
<h4 id="org2addeef">case_jo_t::exe</h4>
<div class="outline-text-4" id="text-org2addeef">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">case_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
    env.obj_stack.pop ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo_map.find (obj-&gt;tag);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo_map.end ()) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">frame</span> = make_shared &lt;<span style="color: #7CB8BB;">frame_t</span>&gt; (jojo, local_scope);
        env.frame_stack.push (frame);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo_map.find (tagging (env, <span style="color: #CC9393;">"_"</span>));
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo_map.end ()) {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = it-&gt;second;
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">frame</span> = make_shared &lt;<span style="color: #7CB8BB;">frame_t</span>&gt; (jojo, local_scope);
            env.frame_stack.push (frame);
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> {
            cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : case_jo_t::exe mismatch"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
            cout &lt;&lt; <span style="color: #CC9393;">"  tag : "</span> &lt;&lt; name_of_tag (env, obj-&gt;tag) &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
            exit (1);
        }
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbbbf93e" class="outline-4">
<h4 id="orgbbbf93e"><span class="todo _todo_">[todo]</span> case_jo_t::repr</h4>
<div class="outline-text-4" id="text-orgbbbf93e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">case_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"(case)"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgacddd5" class="outline-3">
<h3 id="orgacddd5">nop_jo</h3>
<div class="outline-text-3" id="text-orgacddd5">
</div><div id="outline-container-org7317074" class="outline-4">
<h4 id="org7317074">nop_jo_t</h4>
<div class="outline-text-4" id="text-org7317074">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">nop_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org14d78b9" class="outline-4">
<h4 id="org14d78b9">nop_jo_t::copy</h4>
<div class="outline-text-4" id="text-org14d78b9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">nop_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">nop_jo_t</span> ();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf186f1c" class="outline-4">
<h4 id="orgf186f1c">nop_jo_t::exe</h4>
<div class="outline-text-4" id="text-orgf186f1c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">nop_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">do nothing</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org45e9d77" class="outline-4">
<h4 id="org45e9d77">nop_jo_t::repr</h4>
<div class="outline-text-4" id="text-org45e9d77">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">nop_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"nop"</span>;
}
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org3de76fa" class="outline-2">
<h2 id="org3de76fa">define</h2>
<div class="outline-text-2" id="text-org3de76fa">
</div><div id="outline-container-orgffeec97" class="outline-3">
<h3 id="orgffeec97">define</h3>
<div class="outline-text-3" id="text-orgffeec97">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">define</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
        <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>,
        <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.box_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.box_map.end ()) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = it-&gt;second;
        box-&gt;empty_p = <span style="color: #BFEBBF;">false</span>;
        box-&gt;obj = obj;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        env.box_map [name] = <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">box_t</span> (obj);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbbc2ac0" class="outline-3">
<h3 id="orgbbc2ac0">type_p</h3>
<div class="outline-text-3" id="text-orgbbc2ac0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">type_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == tagging (env, <span style="color: #CC9393;">"type-t"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4ed0085" class="outline-3">
<h3 id="org4ed0085">assign</h3>
<div class="outline-text-3" id="text-org4ed0085">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">assign</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
        <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">prefix</span>,
        <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>,
        <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (prefix == <span style="color: #CC9393;">""</span>) {
        define (env, name, obj);
        <span style="color: #F0DFAF; font-weight: bold;">return</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.box_map.find (prefix + <span style="color: #CC9393;">"-t"</span>);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.box_map.end ()) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = it-&gt;second;
        assert (<span style="color: #F0DFAF; font-weight: bold;">!</span> box-&gt;empty_p);
        assert (type_p (env, box-&gt;obj));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">type</span> = static_pointer_cast &lt;type_o&gt; (box-&gt;obj);
        type-&gt;obj_map [name] = obj;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : assign fail"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  unknown prefix : "</span> &lt;&lt; prefix &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc0cecf7" class="outline-3">
<h3 id="orgc0cecf7">sig_t</h3>
<div class="outline-text-3" id="text-orgc0cecf7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">sig_t</span> = name_vector_t;
</pre>
</div>
</div>
</div>

<div id="outline-container-org82c887" class="outline-3">
<h3 id="org82c887">name_of_sig</h3>
<div class="outline-text-3" id="text-org82c887">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_t</span>
<span style="color: #93E0E3;">name_of_sig</span> (<span style="color: #7CB8BB;">sig_t</span> &amp;<span style="color: #DFAF8F;">sig</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> sig [0];
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge7d8536" class="outline-3">
<h3 id="orge7d8536">name_vector_of_sig</h3>
<div class="outline-text-3" id="text-orge7d8536">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_vector_t</span>
<span style="color: #93E0E3;">name_vector_of_sig</span> (<span style="color: #7CB8BB;">sig_t</span> &amp;<span style="color: #DFAF8F;">sig</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = name_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = sig.begin () + 1;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = sig.end ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++) {
        name_vector.push_back (*it);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> name_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2e45cc3" class="outline-3">
<h3 id="org2e45cc3">define_prim</h3>
<div class="outline-text-3" id="text-org2e45cc3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">define_prim</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">sig</span>, <span style="color: #7CB8BB;">prim_fn</span> <span style="color: #DFAF8F;">fn</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = name_of_sig (sig);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = name_vector_of_sig (sig);
    define (env, name, make_shared &lt;prim_o&gt;
            (env, name_vector, fn, <span style="color: #7CB8BB;">obj_map_t</span> ()));
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgac16cde" class="outline-2">
<h2 id="orgac16cde"><b>test</b></h2>
<div class="outline-text-2" id="text-orgac16cde">
</div><div id="outline-container-org5fc9ab" class="outline-3">
<h3 id="org5fc9ab">new_frame_from_jojo</h3>
<div class="outline-text-3" id="text-org5fc9ab">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">frame_t</span>&gt;
<span style="color: #93E0E3;">new_frame_from_jojo</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">frame_t</span>&gt;
        (jojo, <span style="color: #7CB8BB;">local_scope_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcc6e6ce" class="outline-3">
<h3 id="orgcc6e6ce">new_frame_from_jo_vector</h3>
<div class="outline-text-3" id="text-orgcc6e6ce">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">frame_t</span>&gt;
<span style="color: #93E0E3;">new_frame_from_jo_vector</span> (<span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">frame_t</span>&gt;
        (jojo, <span style="color: #7CB8BB;">local_scope_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org80b6ded" class="outline-3">
<h3 id="org80b6ded">assert</h3>
<div class="outline-text-3" id="text-org80b6ded">
</div><div id="outline-container-org633ceb0" class="outline-4">
<h4 id="org633ceb0">assert_pop_eq</h4>
<div class="outline-text-4" id="text-org633ceb0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">assert_pop_eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = env.obj_stack.top ();
    assert (obj-&gt;equal (env, that));
    env.obj_stack.pop ();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7eeb669" class="outline-4">
<h4 id="org7eeb669">assert_tos_eq</h4>
<div class="outline-text-4" id="text-org7eeb669">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">assert_tos_eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = env.obj_stack.top ();
    assert (obj-&gt;equal (env, that));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdbe9488" class="outline-4">
<h4 id="orgdbe9488">assert_stack_size</h4>
<div class="outline-text-4" id="text-orgdbe9488">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">assert_stack_size</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">size</span>)
{
    assert (env.obj_stack.size () == size);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1ebf580" class="outline-3">
<h3 id="org1ebf580"><span class="todo _todo_">[todo]</span> import_test</h3>
<div class="outline-text-3" id="text-org1ebf580">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">import_test</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4d8435b" class="outline-2">
<h2 id="org4d8435b"><b>bool</b></h2>
<div class="outline-text-2" id="text-org4d8435b">
</div><div id="outline-container-org5515246" class="outline-3">
<h3 id="org5515246">true_c</h3>
<div class="outline-text-3" id="text-org5515246">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">true_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
   <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;data_o&gt;
       (env,
        tagging (env, <span style="color: #CC9393;">"true-t"</span>),
        <span style="color: #7CB8BB;">obj_map_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7a70376" class="outline-3">
<h3 id="org7a70376">false_c</h3>
<div class="outline-text-3" id="text-org7a70376">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">false_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
   <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;data_o&gt;
       (env,
        tagging (env, <span style="color: #CC9393;">"false-t"</span>),
        <span style="color: #7CB8BB;">obj_map_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4ae2885" class="outline-3">
<h3 id="org4ae2885">jj_true_c</h3>
<div class="outline-text-3" id="text-org4ae2885">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">jj_true_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
   <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;data_o&gt;
       (env,
        tagging (env, <span style="color: #CC9393;">"true-t"</span>),
        <span style="color: #7CB8BB;">obj_map_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8cf85f2" class="outline-3">
<h3 id="org8cf85f2">jj_false_c</h3>
<div class="outline-text-3" id="text-org8cf85f2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">jj_false_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
   <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;data_o&gt;
       (env,
        tagging (env, <span style="color: #CC9393;">"false-t"</span>),
        <span style="color: #7CB8BB;">obj_map_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org473621f" class="outline-3">
<h3 id="org473621f">import_bool</h3>
<div class="outline-text-3" id="text-org473621f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_bool</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define (env, <span style="color: #CC9393;">"true-c"</span>, jj_true_c (env));
    define (env, <span style="color: #CC9393;">"false-c"</span>, jj_false_c (env));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdd47dca" class="outline-3">
<h3 id="orgdd47dca">test_bool</h3>
<div class="outline-text-3" id="text-orgdd47dca">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_bool</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    import_bool (env);

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"true-c"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"false-c"</span>)),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">env.double_report ();</span>

    {
        env.run ();
        assert_stack_size (env, 2);
        assert_pop_eq (env, jj_false_c (env));
        assert_pop_eq (env, jj_true_c (env));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7c85ed2" class="outline-2">
<h2 id="org7c85ed2"><b>list</b></h2>
<div class="outline-text-2" id="text-org7c85ed2">
</div><div id="outline-container-orge502e6a" class="outline-3">
<h3 id="orge502e6a">null_c</h3>
<div class="outline-text-3" id="text-orge502e6a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">null_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
   <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;data_o&gt;
       (env,
        tagging (env, <span style="color: #CC9393;">"null-t"</span>),
        <span style="color: #7CB8BB;">obj_map_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6738be9" class="outline-3">
<h3 id="org6738be9">cons_c</h3>
<div class="outline-text-3" id="text-org6738be9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">cons_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
        <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">car</span>,
        <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">cdr</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = obj_map_t ();
    obj_map [<span style="color: #CC9393;">"car"</span>] = car;
    obj_map [<span style="color: #CC9393;">"cdr"</span>] = cdr;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;data_o&gt;
        (env,
         tagging (env, <span style="color: #CC9393;">"cons-t"</span>),
         obj_map);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge2ec674" class="outline-3">
<h3 id="orge2ec674">cons_p</h3>
<div class="outline-text-3" id="text-orge2ec674">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">cons_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == tagging (env, <span style="color: #CC9393;">"cons-t"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org590b3f5" class="outline-3">
<h3 id="org590b3f5">car</h3>
<div class="outline-text-3" id="text-org590b3f5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">car</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">cons</span>)
{
    assert (cons_p (env, cons));
    <span style="color: #F0DFAF; font-weight: bold;">return</span> cons-&gt;obj_map [<span style="color: #CC9393;">"car"</span>];
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org759e442" class="outline-3">
<h3 id="org759e442">cdr</h3>
<div class="outline-text-3" id="text-org759e442">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">cdr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">cons</span>)
{
    assert (cons_p (env, cons));
    <span style="color: #F0DFAF; font-weight: bold;">return</span> cons-&gt;obj_map [<span style="color: #CC9393;">"cdr"</span>];
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4ed37d6" class="outline-3">
<h3 id="org4ed37d6">null_p</h3>
<div class="outline-text-3" id="text-org4ed37d6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">null_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == tagging (env, <span style="color: #CC9393;">"null-t"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb39e113" class="outline-3">
<h3 id="orgb39e113">list_p</h3>
<div class="outline-text-3" id="text-orgb39e113">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">list_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> null_p (env, a)
        || cons_p (env, a);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfb5a383" class="outline-3">
<h3 id="orgfb5a383">list_length</h3>
<div class="outline-text-3" id="text-orgfb5a383">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">size_t</span>
<span style="color: #93E0E3;">list_length</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">l</span>)
{
    assert (list_p (env, l));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">length</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> null_p (env, l)) {
        length++;
        l = cdr (env, l);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> length;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6e6354f" class="outline-3">
<h3 id="org6e6354f">jj_null_c</h3>
<div class="outline-text-3" id="text-org6e6354f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">jj_null_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
   <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;data_o&gt;
       (env,
        tagging (env, <span style="color: #CC9393;">"null-t"</span>),
        <span style="color: #7CB8BB;">obj_map_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org226315c" class="outline-3">
<h3 id="org226315c">jj_cons_c</h3>
<div class="outline-text-3" id="text-org226315c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;data_cons_o&gt;
<span style="color: #93E0E3;">jj_cons_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;data_cons_o&gt;
        (env,
         tagging (env, <span style="color: #CC9393;">"cons-t"</span>),
         name_vector_t ({ <span style="color: #CC9393;">"car"</span>, <span style="color: #CC9393;">"cdr"</span> }),
         <span style="color: #7CB8BB;">obj_map_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfff4e83" class="outline-3">
<h3 id="orgfff4e83">import_list</h3>
<div class="outline-text-3" id="text-orgfff4e83">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define (env, <span style="color: #CC9393;">"null-c"</span>, jj_null_c (env));
    define (env, <span style="color: #CC9393;">"cons-c"</span>, jj_cons_c (env));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3954d55" class="outline-3">
<h3 id="org3954d55">test_list</h3>
<div class="outline-text-3" id="text-org3954d55">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_list</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    import_list (env);

    define (env, <span style="color: #CC9393;">"s1"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"cons-c"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (2),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #CC9393;">"cdr"</span>),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">env.double_report ();</span>

    {
        env.run ();
        assert_stack_size (env, 1);
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org167fc6c" class="outline-2">
<h2 id="org167fc6c"><b>str</b></h2>
<div class="outline-text-2" id="text-org167fc6c">
</div><div id="outline-container-orge214752" class="outline-3">
<h3 id="orge214752">str_p</h3>
<div class="outline-text-3" id="text-orge214752">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">str_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == tagging (env, <span style="color: #CC9393;">"str-t"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org85f45ac" class="outline-3">
<h3 id="org85f45ac">jj_str_print</h3>
<div class="outline-text-3" id="text-org85f45ac">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_str_print_sig</span> = { <span style="color: #CC9393;">"str-print"</span>, <span style="color: #CC9393;">"str"</span> };
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- str-t -&gt;</span>
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_str_print</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = obj_map [<span style="color: #CC9393;">"str"</span>];
    assert (str_p (env, obj));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = static_pointer_cast &lt;str_o&gt; (obj);
    cout &lt;&lt; str-&gt;str;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7d6d3bd" class="outline-3">
<h3 id="org7d6d3bd">import_str</h3>
<div class="outline-text-3" id="text-org7d6d3bd">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_str</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_prim (env,
                 jj_str_print_sig,
                 jj_str_print);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1b60258" class="outline-3">
<h3 id="org1b60258"><span class="todo _todo_">[todo]</span> test_str</h3>
<div class="outline-text-3" id="text-org1b60258">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_str</span> ()
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgaba9e22" class="outline-2">
<h2 id="orgaba9e22"><b>vect</b></h2>
<div class="outline-text-2" id="text-orgaba9e22">
</div><div id="outline-container-orgf820da9" class="outline-3">
<h3 id="orgf820da9">obj_vect_t</h3>
<div class="outline-text-3" id="text-orgf820da9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">obj_vect_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-org3b4f0b9" class="outline-3">
<h3 id="org3b4f0b9">vect_o</h3>
<div class="outline-text-3" id="text-org3b4f0b9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">vect_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">obj_vect_t</span> <span style="color: #DFAF8F;">vect</span>;
    <span style="color: #93E0E3;">vect_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_vect_t</span> <span style="color: #DFAF8F;">vect</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org7d012fa" class="outline-3">
<h3 id="org7d012fa">vect_o::vect_o</h3>
<div class="outline-text-3" id="text-org7d012fa">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">vect_o</span>::<span style="color: #93E0E3;">vect_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;&gt; <span style="color: #DFAF8F;">vect</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = tagging (env, <span style="color: #CC9393;">"vect-t"</span>);
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;vect = vect;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org73d67b0" class="outline-3">
<h3 id="org73d67b0">obj_equal</h3>
<div class="outline-text-3" id="text-org73d67b0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">obj_equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
           <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; &amp;<span style="color: #DFAF8F;">lhs</span>,
           <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; &amp;<span style="color: #DFAF8F;">rhs</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> lhs-&gt;equal (env, rhs);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7256af2" class="outline-3">
<h3 id="org7256af2">vect_equal</h3>
<div class="outline-text-3" id="text-org7256af2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">vect_equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
            <span style="color: #7CB8BB;">obj_vect_t</span> &amp;<span style="color: #DFAF8F;">lhs</span>,
            <span style="color: #7CB8BB;">obj_vect_t</span> &amp;<span style="color: #DFAF8F;">rhs</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lhs.size () != rhs.size ()) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = lhs.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">index</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (index &lt; size) {
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> obj_equal (env, lhs [index], rhs [index]))
            <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
        index++;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6a78daa" class="outline-3">
<h3 id="org6a78daa">vect_o::equal</h3>
<div class="outline-text-3" id="text-org6a78daa">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">vect_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;vect_o&gt; (obj);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> vect_equal (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;vect, that-&gt;vect);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org29d3e33" class="outline-3">
<h3 id="org29d3e33">vect_o::repr</h3>
<div class="outline-text-3" id="text-org29d3e33">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">vect_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"["</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">obj</span>: <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;vect) {
        repr += obj-&gt;repr (env);
        repr += <span style="color: #CC9393;">" "</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> repr.empty ()) repr.pop_back ();
    repr += <span style="color: #CC9393;">"]"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc1ad047" class="outline-3">
<h3 id="orgc1ad047">vect_p</h3>
<div class="outline-text-3" id="text-orgc1ad047">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">vect_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == tagging (env, <span style="color: #CC9393;">"vect-t"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge3bfb97" class="outline-3">
<h3 id="orge3bfb97">list_to_vect</h3>
<div class="outline-text-3" id="text-orge3bfb97">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;vect_o&gt;
<span style="color: #93E0E3;">list_to_vect</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">l</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">vect</span> = obj_vect_t ();
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> null_p (env, l)) {
        vect.push_back (car (env, l));
        l = cdr (env, l);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;vect_o&gt; (env, vect);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc0f0a07" class="outline-3">
<h3 id="orgc0f0a07">jj_list_to_vect</h3>
<div class="outline-text-3" id="text-orgc0f0a07">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_list_to_vect_sig</span> = { <span style="color: #CC9393;">"list-to-vect"</span>, <span style="color: #CC9393;">"list"</span> };
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- (list-t t) -&gt; (vect-t t)</span>
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_list_to_vect</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    env.obj_stack.push (list_to_vect (env, obj_map [<span style="color: #CC9393;">"list"</span>]));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9a13cd4" class="outline-3">
<h3 id="org9a13cd4">vect_to_list</h3>
<div class="outline-text-3" id="text-org9a13cd4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">vect_to_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;vect_o&gt; <span style="color: #DFAF8F;">v</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">vect</span> = v-&gt;vect;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">result</span> = null_c (env);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = vect.rbegin ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = vect.rend ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++)
        result = cons_c (env, *it, result);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> result;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org31cb3a3" class="outline-3">
<h3 id="org31cb3a3">jj_vect_to_list</h3>
<div class="outline-text-3" id="text-org31cb3a3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_vect_to_list_sig</span> = { <span style="color: #CC9393;">"vect-to-list"</span>, <span style="color: #CC9393;">"vect"</span> };
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- (vect-t t) -&gt; (list-t t)</span>
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_vect_to_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = obj_map [<span style="color: #CC9393;">"vect"</span>];
    assert (vect_p (env, obj));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">vect</span> = static_pointer_cast &lt;vect_o&gt; (obj);
    env.obj_stack.push (vect_to_list (env, vect));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org401cbe1" class="outline-3">
<h3 id="org401cbe1">import_vect</h3>
<div class="outline-text-3" id="text-org401cbe1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_vect</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_prim (env,
                 jj_list_to_vect_sig,
                 jj_list_to_vect);
    define_prim (env,
                 jj_vect_to_list_sig,
                 jj_vect_to_list);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org72559f3" class="outline-3">
<h3 id="org72559f3">test_vect</h3>
<div class="outline-text-3" id="text-org72559f3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_vect</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    import_list (env);
    import_vect (env);

    define (env, <span style="color: #CC9393;">"s1"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"null-c"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"cons-c"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (2),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"cons-c"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (2),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"list-to-vect"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"vect-to-list"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #CC9393;">"cdr"</span>),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #CC9393;">"car"</span>),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">env.double_report ();</span>

    {
        env.run ();
        assert_stack_size (env, 1);
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8599d70" class="outline-2">
<h2 id="org8599d70"><b>dict</b></h2>
<div class="outline-text-2" id="text-org8599d70">
</div><div id="outline-container-org3c29362" class="outline-3">
<h3 id="org3c29362"><span class="todo _todo_">[todo]</span> import_dict</h3>
<div class="outline-text-3" id="text-org3c29362">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_dict</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{

}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgad090c6" class="outline-3">
<h3 id="orgad090c6"><span class="todo _todo_">[todo]</span> test_dict</h3>
<div class="outline-text-3" id="text-orgad090c6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_dict</span> ()
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3713eda" class="outline-2">
<h2 id="org3713eda"><b>sexp</b></h2>
<div class="outline-text-2" id="text-org3713eda">
</div><div id="outline-container-org74e29be" class="outline-3">
<h3 id="org74e29be">string_vector_t</h3>
<div class="outline-text-3" id="text-org74e29be">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">string_vector_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">string</span>&gt; ;
</pre>
</div>
</div>
</div>

<div id="outline-container-org72813e5" class="outline-3">
<h3 id="org72813e5">space_char_p</h3>
<div class="outline-text-3" id="text-org72813e5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">space_char_p</span> (<span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> (c == <span style="color: #DCDCCC; background-color: #3F3F3F;">' </span><span style="color: #D0BF8F; font-weight: bold;">'</span>  ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'\n</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'\t</span><span style="color: #D0BF8F; font-weight: bold;">'</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org31efe76" class="outline-3">
<h3 id="org31efe76">delimiter_char_p</h3>
<div class="outline-text-3" id="text-org31efe76">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">delimiter_char_p</span> (<span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> (c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'(</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">')</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'[</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">']</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'{</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'}</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">',</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">';</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'`</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'\''</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org92f190c" class="outline-3">
<h3 id="org92f190c">string_from_char</h3>
<div class="outline-text-3" id="text-org92f190c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">string_from_char</span> (<span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span> = <span style="color: #CC9393;">""</span>;
    str.push_back (c);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> str;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6313743" class="outline-3">
<h3 id="org6313743">doublequote_char_p</h3>
<div class="outline-text-3" id="text-org6313743">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">doublequote_char_p</span> (<span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'"</span><span style="color: #D0BF8F; font-weight: bold;">'</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org69d0c9b" class="outline-3">
<h3 id="org69d0c9b">find_word_length</h3>
<div class="outline-text-3" id="text-org69d0c9b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">size_t</span> <span style="color: #93E0E3;">find_word_length</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">code</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">begin</span>)
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">length</span> = code.length ();
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span> = begin;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #BFEBBF;">true</span>) {
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (index == length)
            <span style="color: #F0DFAF; font-weight: bold;">return</span> index - begin;
        <span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span> = code [index];
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (space_char_p (c) <span style="color: #F0DFAF; font-weight: bold;">or</span>
            doublequote_char_p (c) <span style="color: #F0DFAF; font-weight: bold;">or</span>
            delimiter_char_p (c))
            <span style="color: #F0DFAF; font-weight: bold;">return</span> index - begin;
        index++;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7633ce5" class="outline-3">
<h3 id="org7633ce5">scan_word_vector</h3>
<div class="outline-text-3" id="text-org7633ce5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string_vector_t</span>
<span style="color: #93E0E3;">scan_word_vector</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">code</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">string_vector</span> = string_vector_t ();
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">i</span> = 0;
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">length</span> = code.length ();
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (i &lt; length) {
        <span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span> = code [i];
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (space_char_p (c)) i++;
        <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (delimiter_char_p (c)) {
            string_vector.push_back (string_from_char (c));
            i++;
        }
        <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">else if (doublequote_char_p (c)) {</span>
        <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">}</span>
        <span style="color: #F0DFAF; font-weight: bold;">else</span> {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word_length</span> = find_word_length (code, i);
            <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">word</span> = code.substr (i, word_length);
            string_vector.push_back (word);
            i += word_length;
        }
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> string_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb389da7" class="outline-3">
<h3 id="orgb389da7">string_vector_to_string_list</h3>
<div class="outline-text-3" id="text-orgb389da7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">string_vector_to_string_list</span>
(<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">string_vector_t</span> &amp;<span style="color: #DFAF8F;">string_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = string_vector.rbegin ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = string_vector.rend ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">collect</span> = null_c (env);
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = make_shared &lt;str_o&gt; (env, *it);
        collect = cons_c (env, obj, collect);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> collect;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgda5de75" class="outline-3">
<h3 id="orgda5de75"><span class="todo _note_">[note]</span> about literal in quote</h3>
<div class="outline-text-3" id="text-orgda5de75">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">( )</td>
<td class="org-left">list-t</td>
</tr>

<tr>
<td class="org-left">[ ]</td>
<td class="org-left">vect-t</td>
</tr>

<tr>
<td class="org-left">{ }</td>
<td class="org-left">dict-t</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgc2e50e2" class="outline-3">
<h3 id="orgc2e50e2">scan_word_list</h3>
<div class="outline-text-3" id="text-orgc2e50e2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">scan_word_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;str_o&gt; <span style="color: #DFAF8F;">code</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word_vector</span> = scan_word_vector (code-&gt;str);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> string_vector_to_string_list
        (env, word_vector);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb447c72" class="outline-3">
<h3 id="orgb447c72">bar_word_p</h3>
<div class="outline-text-3" id="text-orgb447c72">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">bar_word_p</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">word</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> word == <span style="color: #CC9393;">"("</span>
        || word == <span style="color: #CC9393;">"["</span>
        || word == <span style="color: #CC9393;">"{"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge164228" class="outline-3">
<h3 id="orge164228">ket_word_p</h3>
<div class="outline-text-3" id="text-orge164228">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">ket_word_p</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">word</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> word == <span style="color: #CC9393;">")"</span>
        || word == <span style="color: #CC9393;">"]"</span>
        || word == <span style="color: #CC9393;">"}"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3036794" class="outline-3">
<h3 id="org3036794">quote_word_p</h3>
<div class="outline-text-3" id="text-org3036794">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">quote_word_p</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">word</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> word == <span style="color: #CC9393;">"'"</span>
        || word == <span style="color: #CC9393;">"`"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org771cdf3" class="outline-3">
<h3 id="org771cdf3">bar_word_to_ket_word</h3>
<div class="outline-text-3" id="text-org771cdf3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">bar_word_to_ket_word</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">bar</span>)
{
    assert (bar_word_p (bar));
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (bar == <span style="color: #CC9393;">"("</span>) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">")"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (bar == <span style="color: #CC9393;">"["</span>) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"]"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (bar == <span style="color: #CC9393;">"{"</span>) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"}"</span>;
    cout &lt;&lt; <span style="color: #CC9393;">"bar_word_to_ket_word fail\n"</span>;
    exit (1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org608f35" class="outline-3">
<h3 id="org608f35">word_list_head_with_bar_ket_counter</h3>
<div class="outline-text-3" id="text-org608f35">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">word_list_head_with_bar_ket_counter</span>
(<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
 <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">word_list</span>,
 <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">bar</span>,
 <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">ket</span>,
 <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">counter</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (counter == 0)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> null_c (env);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt;
        (car (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word</span> = head-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == bar)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c
            (env, head, word_list_head_with_bar_ket_counter
             (env,
              cdr (env, word_list),
              bar, ket, counter + 1));
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == ket)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c
            (env, head, word_list_head_with_bar_ket_counter
             (env,
              cdr (env, word_list),
              bar, ket, counter - 1));
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c
            (env, head, word_list_head_with_bar_ket_counter
             (env,
              cdr (env, word_list),
              bar, ket, counter));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org472f4ca" class="outline-3">
<h3 id="org472f4ca">word_list_head</h3>
<div class="outline-text-3" id="text-org472f4ca">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">word_list_head</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">word_list</span>)
{
    assert (cons_p (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt;
        (car (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word</span> = head-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (bar_word_p (word)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bar</span> = word;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">ket</span> = bar_word_to_ket_word (word);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c
            (env, head, word_list_head_with_bar_ket_counter
             (env,
              cdr (env, word_list),
              bar, ket, 1));
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (env, head, null_c (env));
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5ff848f" class="outline-3">
<h3 id="org5ff848f">word_list_rest_with_bar_ket_counter</h3>
<div class="outline-text-3" id="text-org5ff848f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">word_list_rest_with_bar_ket_counter</span>
(<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
 <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">word_list</span>,
 <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">bar</span>,
 <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">ket</span>,
 <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">counter</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (counter == 0)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> word_list;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt;
        (car (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word</span> = head-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == bar)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> word_list_rest_with_bar_ket_counter
            (env,
             cdr (env, word_list),
             bar, ket, counter + 1);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == ket)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> word_list_rest_with_bar_ket_counter
            (env,
             cdr (env, word_list),
             bar, ket, counter - 1);
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> word_list_rest_with_bar_ket_counter
            (env,
             cdr (env, word_list),
             bar, ket, counter);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org94976d1" class="outline-3">
<h3 id="org94976d1">word_list_rest</h3>
<div class="outline-text-3" id="text-org94976d1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">word_list_rest</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">word_list</span>)
{
    assert (cons_p (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt;
        (car (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word</span> = head-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (bar_word_p (word)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bar</span> = word;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">ket</span> = bar_word_to_ket_word (word);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> word_list_rest_with_bar_ket_counter
            (env,
             cdr (env, word_list),
             bar, ket, 1);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cdr (env, word_list);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc85ae7f" class="outline-3">
<h3 id="orgc85ae7f">word_list_drop_ket</h3>
<div class="outline-text-3" id="text-orgc85ae7f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">word_list_drop_ket</span>
(<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
 <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">word_list</span>,
 <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">ket</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, word_list);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, word_list);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, rest))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> null_c (env);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">cdr_rest</span> = cdr (env, rest);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">car_rest</span> = static_pointer_cast &lt;str_o&gt; (car (env, rest));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word</span> = car_rest-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, cdr_rest)) {
        assert (word == ket);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (env, head, null_c (env));
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (env, head,
                       word_list_drop_ket (env, rest, ket));
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1f160a" class="outline-3">
<h3 id="org1f160a">parse_sexp</h3>
<div class="outline-text-3" id="text-org1f160a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">parse_sexp_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">word_list</span>);

<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">parse_sexp</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">word_list</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt;
        (car (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word</span> = head-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, word_list);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == <span style="color: #CC9393;">"("</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> parse_sexp_list
            (env, word_list_drop_ket (env, rest, <span style="color: #CC9393;">")"</span>));
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == <span style="color: #CC9393;">"["</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> list_to_vect
            (env, parse_sexp_list
             (env, word_list_drop_ket (env, rest, <span style="color: #CC9393;">"]"</span>)));
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == <span style="color: #CC9393;">"'"</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"quote"</span>),
                       cons_c (env,
                               parse_sexp (env, rest),
                               null_c (env)));
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == <span style="color: #CC9393;">"`"</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"partquote"</span>),
                       cons_c (env,
                               parse_sexp (env, rest),
                               null_c (env)));
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> head;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd0cdb94" class="outline-3">
<h3 id="orgd0cdb94">parse_sexp_list</h3>
<div class="outline-text-3" id="text-orgd0cdb94">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">parse_sexp_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">word_list</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, word_list))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> word_list;
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c
            (env,
             parse_sexp (env, word_list_head (env, word_list)),
             parse_sexp_list (env, word_list_rest (env, word_list)));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb8cda1c" class="outline-3">
<h3 id="orgb8cda1c">sexp_repr</h3>
<div class="outline-text-3" id="text-orgb8cda1c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">sexp_list_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>);

<span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">sexp_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, a)) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"()"</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (cons_p (env, a)) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"("</span> + sexp_list_repr (env, a) + <span style="color: #CC9393;">")"</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (vect_p (env, a)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">v</span> = static_pointer_cast &lt;vect_o&gt; (a);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">l</span> = vect_to_list (env, v);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"["</span> + sexp_list_repr (env, l) + <span style="color: #CC9393;">"]"</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = static_pointer_cast &lt;str_o&gt; (a);
        assert (str-&gt;tag == tagging (env, <span style="color: #CC9393;">"str-t"</span>));
        <span style="color: #F0DFAF; font-weight: bold;">return</span> str-&gt;str;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9163534" class="outline-3">
<h3 id="org9163534">sexp_list_repr</h3>
<div class="outline-text-3" id="text-org9163534">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">sexp_list_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp_list</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, sexp_list))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">""</span>;
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, cdr (env, sexp_list)))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> sexp_repr (env, car (env, sexp_list));
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span>
            sexp_repr (env, car (env, sexp_list)) + <span style="color: #CC9393;">" "</span> +
            sexp_list_repr (env, cdr (env, sexp_list));
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org72f6ba3" class="outline-3">
<h3 id="org72f6ba3">jj_scan_word_list</h3>
<div class="outline-text-3" id="text-org72f6ba3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_scan_word_list_sig</span> = { <span style="color: #CC9393;">"scan-word-list"</span>, <span style="color: #CC9393;">"code"</span> };
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- str-t -&gt; (list-t str-t)</span>
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_scan_word_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = obj_map [<span style="color: #CC9393;">"code"</span>];
    assert (str_p (env, obj));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">code</span> = static_pointer_cast &lt;str_o&gt; (obj);
    env.obj_stack.push (scan_word_list (env, code));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfff5197" class="outline-3">
<h3 id="orgfff5197">jj_parse_sexp</h3>
<div class="outline-text-3" id="text-orgfff5197">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_parse_sexp_sig</span> = { <span style="color: #CC9393;">"parse-sexp"</span>, <span style="color: #CC9393;">"word-list"</span> };
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- (list-t str-t) -&gt; sexp-t</span>
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_parse_sexp</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    env.obj_stack.push (parse_sexp (env, obj_map [<span style="color: #CC9393;">"word-list"</span>]));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga36b091" class="outline-3">
<h3 id="orga36b091">jj_parse_sexp_list</h3>
<div class="outline-text-3" id="text-orga36b091">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_parse_sexp_list_sig</span> = { <span style="color: #CC9393;">"parse-sexp-list"</span>, <span style="color: #CC9393;">"word-list"</span> };
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- (list-t str-t) -&gt; (list-t sexp-t)</span>
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_parse_sexp_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    env.obj_stack.push (parse_sexp_list (env, obj_map [<span style="color: #CC9393;">"word-list"</span>]));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org407d64b" class="outline-3">
<h3 id="org407d64b">jj_sexp_repr</h3>
<div class="outline-text-3" id="text-org407d64b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_sexp_repr_sig</span> = { <span style="color: #CC9393;">"sexp-repr"</span>, <span style="color: #CC9393;">"sexp"</span> };
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- sexp-t -&gt;</span>
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_sexp_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = sexp_repr (env, obj_map [<span style="color: #CC9393;">"sexp"</span>]);
    env.obj_stack.push (make_shared &lt;str_o&gt; (env, str));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd89238f" class="outline-3">
<h3 id="orgd89238f">jj_sexp_list_repr</h3>
<div class="outline-text-3" id="text-orgd89238f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_sexp_list_repr_sig</span> = { <span style="color: #CC9393;">"sexp-list-repr"</span>, <span style="color: #CC9393;">"sexp-list"</span> };
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- (list-t sexp-t) -&gt;</span>
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_sexp_list_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = sexp_list_repr (env, obj_map [<span style="color: #CC9393;">"sexp-list"</span>]);
    env.obj_stack.push (make_shared &lt;str_o&gt; (env, str));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5f3a922" class="outline-3">
<h3 id="org5f3a922">import_sexp</h3>
<div class="outline-text-3" id="text-org5f3a922">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_sexp</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_prim (env,
                 jj_scan_word_list_sig,
                 jj_scan_word_list);
    define_prim (env,
                 jj_parse_sexp_list_sig,
                 jj_parse_sexp_list);
    define_prim (env,
                 jj_parse_sexp_sig,
                 jj_parse_sexp);
    define_prim (env,
                 jj_sexp_repr_sig,
                 jj_sexp_repr);
    define_prim (env,
                 jj_sexp_list_repr_sig,
                 jj_sexp_list_repr);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5798d6e" class="outline-3">
<h3 id="org5798d6e">test_sexp_scan</h3>
<div class="outline-text-3" id="text-org5798d6e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_sexp_scan</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">code</span> = <span style="color: #CC9393;">"(cons-c &lt;car&gt; &lt;cdr&gt;)"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">string_vector</span> = scan_word_vector (code);
    assert (string_vector.size () == 5);
    assert (string_vector [0] == <span style="color: #CC9393;">"("</span>);
    assert (string_vector [1] == <span style="color: #CC9393;">"cons-c"</span>);
    assert (string_vector [2] == <span style="color: #CC9393;">"&lt;car&gt;"</span>);
    assert (string_vector [3] == <span style="color: #CC9393;">"&lt;cdr&gt;"</span>);
    assert (string_vector [4] == <span style="color: #CC9393;">")"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org48675e2" class="outline-3">
<h3 id="org48675e2">test_sexp_list</h3>
<div class="outline-text-3" id="text-org48675e2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_sexp_list</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    import_sexp (env);
    import_str (env);

    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">code</span> =
        <span style="color: #CC9393;">"(cons-c &lt;car&gt; &lt;cdr&gt;)"</span>
        <span style="color: #CC9393;">"(cons-c (cons-c &lt;car&gt; &lt;cdr&gt;) (cons-c &lt;car&gt; &lt;cdr&gt;))"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word_list</span> = scan_word_list
        (env, make_shared &lt;str_o&gt; (env, code));
    env.obj_stack.push (word_list);

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"parse-sexp-list"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"sexp-list-repr"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"str-print"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">env.double_report ();</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org252cd32" class="outline-3">
<h3 id="org252cd32">test_sexp_vect</h3>
<div class="outline-text-3" id="text-org252cd32">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_sexp_vect</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    import_sexp (env);
    import_str (env);

    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">code</span> = <span style="color: #CC9393;">"[a b c]"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word_list</span> = scan_word_list
        (env, make_shared &lt;str_o&gt; (env, code));
    env.obj_stack.push (word_list);

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"parse-sexp"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"sexp-repr"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"str-print"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">{</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">}</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga46c3d4" class="outline-3">
<h3 id="orga46c3d4">test_sexp</h3>
<div class="outline-text-3" id="text-orga46c3d4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_sexp</span> ()
{
    test_sexp_scan ();
    test_sexp_list ();
    test_sexp_vect ();
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org93460ea" class="outline-2">
<h2 id="org93460ea"><b>top-keyword</b></h2>
<div class="outline-text-2" id="text-org93460ea">
</div><div id="outline-container-orgbef78aa" class="outline-3">
<h3 id="orgbef78aa">top_keyword_fn</h3>
<div class="outline-text-3" id="text-orgbef78aa">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">top_keyword_fn</span> = <span style="color: #7CB8BB;">function</span>
    &lt;<span style="color: #7CB8BB;">void</span> (<span style="color: #7CB8BB;">env_t</span> &amp;, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;)&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf6a29db" class="outline-3">
<h3 id="orgf6a29db">top_keyword_o</h3>
<div class="outline-text-3" id="text-orgf6a29db">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">top_keyword_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">top_keyword_fn</span> <span style="color: #DFAF8F;">fn</span>;
    <span style="color: #93E0E3;">top_keyword_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">top_keyword_fn</span> <span style="color: #DFAF8F;">fn</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdc06520" class="outline-3">
<h3 id="orgdc06520">top_keyword_o::top_keyword_o</h3>
<div class="outline-text-3" id="text-orgdc06520">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">top_keyword_o</span>::
<span style="color: #93E0E3;">top_keyword_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">top_keyword_fn</span> <span style="color: #DFAF8F;">fn</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = tagging (env, <span style="color: #CC9393;">"top-keyword-t"</span>);
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;fn = fn;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org70b842d" class="outline-3">
<h3 id="org70b842d">top_keyword_o::equal</h3>
<div class="outline-text-3" id="text-org70b842d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">top_keyword_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">this</span> != obj.get ();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb4e1b56" class="outline-3">
<h3 id="orgb4e1b56">top_keyword_p</h3>
<div class="outline-text-3" id="text-orgb4e1b56">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">top_keyword_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == tagging (env, <span style="color: #CC9393;">"top-keyword-t"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc40f6cd" class="outline-3">
<h3 id="orgc40f6cd">define_top_keyword</h3>
<div class="outline-text-3" id="text-orgc40f6cd">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">define_top_keyword</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>, <span style="color: #7CB8BB;">top_keyword_fn</span> <span style="color: #DFAF8F;">fn</span>)
{
    define (env, name, make_shared &lt;top_keyword_o&gt; (env, fn));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1240977" class="outline-3">
<h3 id="org1240977">import_top_keyword</h3>
<div class="outline-text-3" id="text-org1240977">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_top_keyword</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgeab0ef9" class="outline-2">
<h2 id="orgeab0ef9"><b>keyword</b></h2>
<div class="outline-text-2" id="text-orgeab0ef9">
</div><div id="outline-container-orga094834" class="outline-3">
<h3 id="orga094834">local_ref_map_t</h3>
<div class="outline-text-3" id="text-orga094834">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">local_ref_map_t</span> = <span style="color: #7CB8BB;">map</span> &lt;<span style="color: #7CB8BB;">name_t</span>, <span style="color: #7CB8BB;">local_ref_jo_t</span>&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-orga66315b" class="outline-3">
<h3 id="orga66315b">local_ref_map_extend</h3>
<div class="outline-text-3" id="text-orga66315b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">local_ref_map_t</span>
<span style="color: #93E0E3;">local_ref_map_extend</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                      <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">old_local_ref_map</span>,
                      <span style="color: #7CB8BB;">name_vector_t</span> &amp;<span style="color: #DFAF8F;">name_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_ref_map</span> = local_ref_map_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: old_local_ref_map) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = kv.first;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">old_local_ref_jo</span> = kv.second;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_ref_jo</span> = local_ref_jo_t
            (old_local_ref_jo.level + 1,
             old_local_ref_jo.index);
        local_ref_map.insert (make_pair (name, local_ref_jo));
    }
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">index</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = name_vector.size ();
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (index &lt; size) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = name_vector [index];
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_ref_jo</span> = local_ref_jo_t (0, index);
        local_ref_map.insert (make_pair (name, local_ref_jo));
        index++;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> local_ref_map;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org539e586" class="outline-3">
<h3 id="org539e586">keyword_fn</h3>
<div class="outline-text-3" id="text-org539e586">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">keyword_fn</span> = <span style="color: #7CB8BB;">function</span>
    &lt;<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
     (<span style="color: #7CB8BB;">env_t</span> &amp;,
      <span style="color: #DFAF8F;">local_ref_map_t</span> &amp;,
      <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;)&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc4a8fb6" class="outline-3">
<h3 id="orgc4a8fb6">keyword_o</h3>
<div class="outline-text-3" id="text-orgc4a8fb6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">keyword_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">keyword_fn</span> <span style="color: #DFAF8F;">fn</span>;
    <span style="color: #93E0E3;">keyword_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">keyword_fn</span> <span style="color: #DFAF8F;">fn</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgce10674" class="outline-3">
<h3 id="orgce10674">keyword_o::keyword_o</h3>
<div class="outline-text-3" id="text-orgce10674">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">keyword_o</span>::
<span style="color: #93E0E3;">keyword_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">keyword_fn</span> <span style="color: #DFAF8F;">fn</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = tagging (env, <span style="color: #CC9393;">"keyword-t"</span>);
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;fn = fn;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1f4c8c3" class="outline-3">
<h3 id="org1f4c8c3">keyword_o::equal</h3>
<div class="outline-text-3" id="text-org1f4c8c3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">keyword_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">this</span> != obj.get ();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org82c6e7a" class="outline-3">
<h3 id="org82c6e7a">keyword_p</h3>
<div class="outline-text-3" id="text-org82c6e7a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">keyword_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == tagging (env, <span style="color: #CC9393;">"keyword-t"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgea92f53" class="outline-3">
<h3 id="orgea92f53">define_keyword</h3>
<div class="outline-text-3" id="text-orgea92f53">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">define_keyword</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>, <span style="color: #7CB8BB;">keyword_fn</span> <span style="color: #DFAF8F;">fn</span>)
{
    define (env, name, make_shared &lt;keyword_o&gt; (env, fn));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb069ee3" class="outline-3">
<h3 id="orgb069ee3">obj_vect_to_name_vector</h3>
<div class="outline-text-3" id="text-orgb069ee3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_vector_t</span>
<span style="color: #93E0E3;">obj_vect_to_name_vector</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_vect_t</span> &amp;<span style="color: #DFAF8F;">obj_vect</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = name_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">obj</span>: obj_vect) {
        assert (str_p (env, obj));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = static_pointer_cast &lt;str_o&gt; (obj);
        name_vector.push_back (str-&gt;str);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> name_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org85e6d8e" class="outline-3">
<h3 id="org85e6d8e">import_keyword</h3>
<div class="outline-text-3" id="text-org85e6d8e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_keyword</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org998c8d7" class="outline-2">
<h2 id="org998c8d7"><span class="todo _todo_">[todo]</span> <b>macro</b></h2>
</div>

<div id="outline-container-org2d9b9c5" class="outline-2">
<h2 id="org2d9b9c5"><b>compile</b></h2>
<div class="outline-text-2" id="text-org2d9b9c5">
</div><div id="outline-container-orgceac846" class="outline-3">
<h3 id="orgceac846">keyword_sexp_p</h3>
<div class="outline-text-3" id="text-orgceac846">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">keyword_sexp_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, sexp)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> str_p (env, (car (env, sexp)))) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt; (car (env, sexp));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = head-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.box_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.box_map.end ()) {
        <span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (box-&gt;empty_p) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (keyword_p (env, box-&gt;obj)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
        <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7f5cab7" class="outline-3">
<h3 id="org7f5cab7">get_keyword_fn</h3>
<div class="outline-text-3" id="text-org7f5cab7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">keyword_fn</span>
<span style="color: #93E0E3;">get_keyword_fn</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.box_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.box_map.end ()) {
        <span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (box-&gt;empty_p) {
            cout &lt;&lt; <span style="color: #CC9393;">"- fatal error: get_keyword_fn fail\n"</span>;
            exit (1);
        }
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (keyword_p (env, box-&gt;obj)) {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">keyword</span> = static_pointer_cast &lt;keyword_o&gt;
                (box-&gt;obj);
            <span style="color: #F0DFAF; font-weight: bold;">return</span> keyword-&gt;fn;
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> {
            cout &lt;&lt; <span style="color: #CC9393;">"- fatal error: get_keyword_fn fail\n"</span>;
            exit (1);
        };
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error: get_keyword_fn fail\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgae5a3dd" class="outline-3">
<h3 id="orgae5a3dd">jojo_append</h3>
<div class="outline-text-3" id="text-orgae5a3dd">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">jojo_append</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">ante</span>,
             <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">succ</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jo_vector</span> = jo_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span>: ante-&gt;jo_vector) jo_vector.push_back (x-&gt;copy ());
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span>: succ-&gt;jo_vector) jo_vector.push_back (x-&gt;copy ());
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3e00da1" class="outline-3">
<h3 id="org3e00da1">dot_string_p</h3>
<div class="outline-text-3" id="text-org3e00da1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">dot_string_p</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">pos</span> = str.find (<span style="color: #CC9393;">"."</span>);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> (pos != <span style="color: #BFEBBF;">string</span>::npos);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6cdeaff" class="outline-3">
<h3 id="org6cdeaff">dot_string_compile</h3>
<div class="outline-text-3" id="text-org6cdeaff">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">string_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
                <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>);

<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">dot_string_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
                    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">string_vector</span> = string_split (str, <span style="color: #DCDCCC; background-color: #3F3F3F;">'.</span><span style="color: #D0BF8F; font-weight: bold;">'</span>);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = string_compile
        (env, local_ref_map, string_vector [0]);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = string_vector.begin () + 1;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = string_vector.end ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++) {
        <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
            <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (*it),
        };
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">field_jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
        jojo = jojo_append (jojo, field_jojo);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7075f65" class="outline-3">
<h3 id="org7075f65">ref_compile</h3>
<div class="outline-text-3" id="text-org7075f65">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">ref_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
             <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
             <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jo_vector</span> = jo_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = local_ref_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != local_ref_map.end ())
        jo_vector.push_back (it-&gt;second.copy ());
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        jo_vector.push_back (<span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, name)));
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org76b6877" class="outline-3">
<h3 id="org76b6877"><span class="todo _todo_">[todo]</span> string_compile</h3>
<div class="outline-text-3" id="text-org76b6877">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">string_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
                <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (dot_string_p (str)) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> dot_string_compile (env, local_ref_map, str);
    }
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">else if (string_string_p) {</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">}</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">else if (int_string_p) {</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">}</span>
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> ref_compile (env, local_ref_map, str);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org540139" class="outline-3">
<h3 id="org540139">sexp_compile</h3>
<div class="outline-text-3" id="text-org540139">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">call_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
              <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
              <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>);

<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">sexp_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
              <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
              <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (str_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = static_pointer_cast &lt;str_o&gt; (sexp);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> string_compile (env, local_ref_map, str-&gt;str);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (keyword_sexp_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt; (car (env, sexp));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">body</span> = cdr (env, sexp);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = head-&gt;str;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">fn</span> = get_keyword_fn (env, name);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> fn (env, local_ref_map, body);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        assert (cons_p (env, sexp));
        <span style="color: #F0DFAF; font-weight: bold;">return</span> call_compile (env, local_ref_map, sexp);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org265f262" class="outline-3">
<h3 id="org265f262">sexp_list_compile</h3>
<div class="outline-text-3" id="text-org265f262">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">sexp_list_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                   <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
                   <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp_list</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (<span style="color: #DFAF8F;">jo_vector_t</span> ());
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, sexp_list))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo;
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        assert (cons_p (env, sexp_list));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head_jojo</span> = sexp_compile
            (env, local_ref_map, car (env, sexp_list));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">body_jojo</span> = sexp_list_compile
            (env, local_ref_map, cdr (env, sexp_list));
        <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo_append (head_jojo, body_jojo);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgce36c09" class="outline-3">
<h3 id="orgce36c09">dot_head_p</h3>
<div class="outline-text-3" id="text-orgce36c09">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">dot_head_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">head</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> str_p (env, head)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = static_pointer_cast &lt;str_o&gt; (head);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> dot_string_p (str-&gt;str);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org63dfa68" class="outline-3">
<h3 id="org63dfa68">call_compile</h3>
<div class="outline-text-3" id="text-org63dfa68">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">call_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
              <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
              <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, sexp);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">body</span> = cdr (env, sexp);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jo_vector</span> = jo_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (dot_head_p (env, head)) {
        jo_vector.push_back
            (<span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (list_length (env, body) + 1));
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        jo_vector.push_back
            (<span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (list_length (env, body)));
    }
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head_jojo</span> = sexp_compile (env, local_ref_map, head);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">body_jojo</span> = sexp_list_compile (env, local_ref_map, body);
    jojo = jojo_append (head_jojo, jojo);
    jojo = jojo_append (body_jojo, jojo);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9174324" class="outline-3">
<h3 id="org9174324">import_compile</h3>
<div class="outline-text-3" id="text-org9174324">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{

}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf3bba0e" class="outline-3">
<h3 id="orgf3bba0e">test_compile</h3>
<div class="outline-text-3" id="text-orgf3bba0e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_compile</span> ()
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3b15d7a" class="outline-2">
<h2 id="org3b15d7a"><b>eval</b></h2>
<div class="outline-text-2" id="text-org3b15d7a">
</div><div id="outline-container-org897f02d" class="outline-3">
<h3 id="org897f02d">top_keyword_sexp_p</h3>
<div class="outline-text-3" id="text-org897f02d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">top_keyword_sexp_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, sexp)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> str_p (env, (car (env, sexp)))) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt; (car (env, sexp));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = head-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.box_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.box_map.end ()) {
        <span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (box-&gt;empty_p) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (top_keyword_p (env, box-&gt;obj)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
        <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd0a84a9" class="outline-3">
<h3 id="orgd0a84a9">get_top_keyword_fn</h3>
<div class="outline-text-3" id="text-orgd0a84a9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">top_keyword_fn</span>
<span style="color: #93E0E3;">get_top_keyword_fn</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.box_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.box_map.end ()) {
        <span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (box-&gt;empty_p) {
            cout &lt;&lt; <span style="color: #CC9393;">"- fatal error: get_top_keyword_fn fail\n"</span>;
            exit (1);
        }
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (top_keyword_p (env, box-&gt;obj)) {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">top_keyword</span> = static_pointer_cast &lt;top_keyword_o&gt;
                (box-&gt;obj);
            <span style="color: #F0DFAF; font-weight: bold;">return</span> top_keyword-&gt;fn;
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> {
            cout &lt;&lt; <span style="color: #CC9393;">"- fatal error: get_top_keyword_fn fail\n"</span>;
            exit (1);
        };
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error: get_top_keyword_fn fail\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org61f54bc" class="outline-3">
<h3 id="org61f54bc">jojo_run</h3>
<div class="outline-text-3" id="text-org61f54bc">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">jojo_run</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">base</span> = env.frame_stack.size ();
    env.frame_stack.push (new_frame_from_jojo (jojo));
    env.run_with_base (base);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2792f16" class="outline-3">
<h3 id="org2792f16">sexp_eval</h3>
<div class="outline-text-3" id="text-org2792f16">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">sexp_eval</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (top_keyword_sexp_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt; (car (env, sexp));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">body</span> = cdr (env, sexp);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = head-&gt;str;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">fn</span> = get_top_keyword_fn (env, name);
        fn (env, body);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_ref_map</span> = local_ref_map_t ();
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = sexp_compile (env, local_ref_map, sexp);
        jojo_run (env, jojo);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org30657ad" class="outline-3">
<h3 id="org30657ad">sexp_list_eval</h3>
<div class="outline-text-3" id="text-org30657ad">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">sexp_list_eval</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp_list</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, sexp_list))
        <span style="color: #F0DFAF; font-weight: bold;">return</span>;
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        sexp_eval (env, car (env, sexp_list));
        sexp_list_eval (env, cdr (env, sexp_list));
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1dd58a0" class="outline-3">
<h3 id="org1dd58a0">code_eval</h3>
<div class="outline-text-3" id="text-org1dd58a0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">code_eval</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;str_o&gt; <span style="color: #DFAF8F;">code</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word_list</span> = scan_word_list (env, code);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sexp_list</span> = parse_sexp_list (env, word_list);
    sexp_list_eval (env, sexp_list);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5e910ff" class="outline-3">
<h3 id="org5e910ff">jj_code_eval</h3>
<div class="outline-text-3" id="text-org5e910ff">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_code_eval_sig</span> = { <span style="color: #CC9393;">"code-eval"</span>, <span style="color: #CC9393;">"code"</span> };
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_code_eval</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = obj_map [<span style="color: #CC9393;">"code"</span>];
    assert (str_p (env, obj));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">code</span> = static_pointer_cast &lt;str_o&gt; (obj);
    code_eval (env, code);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org81a775" class="outline-3">
<h3 id="org81a775">import_eval</h3>
<div class="outline-text-3" id="text-org81a775">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_eval</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_prim (env,
                 jj_code_eval_sig,
                 jj_code_eval);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga23c845" class="outline-3">
<h3 id="orga23c845"><span class="todo _todo_">[todo]</span> test_eval</h3>
<div class="outline-text-3" id="text-orga23c845">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_eval</span> ()
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8bb32ee" class="outline-2">
<h2 id="org8bb32ee"><b>syntax</b></h2>
<div class="outline-text-2" id="text-org8bb32ee">
</div><div id="outline-container-orgd6bd895" class="outline-3">
<h3 id="orgd6bd895">(= &lt;name&gt; (data &#x2026;))</h3>
<div class="outline-text-3" id="text-orgd6bd895">
</div><div id="outline-container-org869bc8" class="outline-4">
<h4 id="org869bc8"><span class="todo _note_">[note]</span> type must all be top-level</h4>
<div class="outline-text-4" id="text-org869bc8">
<ul class="org-ul">
<li><p>and (= a.b.c &#x2026;) is not handled.</p></li></ul>
</div>
</div>

<div id="outline-container-orgd3eb34e" class="outline-4">
<h4 id="orgd3eb34e">assign_data_p</h4>
<div class="outline-text-4" id="text-orgd3eb34e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">assign_data_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, body))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> str_p (env, car (env, body)))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, cdr (env, body)))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, car (env, cdr (env, body))))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> str_p (env, car (env, car (env, cdr (env, body)))))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = static_pointer_cast &lt;str_o&gt;
        (car (env, car (env, cdr (env, body))));
    <span style="color: #F0DFAF; font-weight: bold;">return</span> str-&gt;str == <span style="color: #CC9393;">"data"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfaeee3d" class="outline-4">
<h4 id="orgfaeee3d">type_name_to_data_name</h4>
<div class="outline-text-4" id="text-orgfaeee3d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_t</span>
<span style="color: #93E0E3;">type_name_to_data_name</span> (<span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">type_name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">data_name</span> = type_name;
    data_name.pop_back ();
    data_name.pop_back ();
    data_name += <span style="color: #CC9393;">"-c"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> data_name;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbaa45bb" class="outline-4">
<h4 id="orgbaa45bb">tk_assign_data</h4>
<div class="outline-text-4" id="text-orgbaa45bb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">tk_assign_data</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt; (car (env, body));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">type_name</span> = head-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">data_name</span> = type_name_to_data_name (type_name);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">type_tag</span> = tagging (env, type_name);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">data_body</span> = cdr (env, (car (env, rest)));
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, data_body)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">data</span> = make_shared &lt;data_o&gt;
            (env, type_tag, <span style="color: #7CB8BB;">obj_map_t</span> ());
        define (env, data_name, data);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">type</span> = make_shared &lt;type_o&gt;
            (env, type_tag, <span style="color: #7CB8BB;">obj_map_t</span> ());
        define (env, type_name, type);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vect</span> = list_to_vect (env, data_body);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = name_vector_t ();
        <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span>: name_vect-&gt;vect) {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = static_pointer_cast &lt;str_o&gt; (obj);
            name_vector.push_back (str-&gt;str);
        }
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">data_cons</span> = make_shared &lt;data_cons_o&gt;
            (env, type_tag, name_vector, <span style="color: #7CB8BB;">obj_map_t</span> ());
        define (env, data_name, data_cons);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">type</span> = make_shared &lt;type_o&gt;
            (env, type_tag, <span style="color: #7CB8BB;">obj_map_t</span> ());
        define (env, type_name, type);
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8aea08a" class="outline-3">
<h3 id="org8aea08a">(= (&lt;name&gt; &#x2026;) &#x2026;)</h3>
<div class="outline-text-3" id="text-org8aea08a">
</div><div id="outline-container-orgec428da" class="outline-4">
<h4 id="orgec428da">assign_lambda_sugar_p</h4>
<div class="outline-text-4" id="text-orgec428da">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">assign_lambda_sugar_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, body))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, car (env, body)))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org443b576" class="outline-4">
<h4 id="org443b576">assign_lambda_desugar</h4>
<div class="outline-text-4" id="text-org443b576">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">assign_lambda_desugar</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = car (env, head);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lambda_body</span> = cdr (env, body);
    lambda_body = cons_c
        (env,
         list_to_vect (env, cdr (env, head)),
         lambda_body);
    lambda_body = cons_c
        (env,
         make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"lambda"</span>),
         lambda_body);
    lambda_body = cons_c
        (env,
         lambda_body,
         null_c (env));
    <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (env, name, lambda_body);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgca7290e" class="outline-3">
<h3 id="orgca7290e">(= &lt;name&gt; &#x2026;)</h3>
<div class="outline-text-3" id="text-orgca7290e">
</div><div id="outline-container-orga7cf87f" class="outline-4">
<h4 id="orga7cf87f">sexp_substitute_recur</h4>
<div class="outline-text-4" id="text-orga7cf87f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">sexp_substitute_recur</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                       <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sub</span>,
                       <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (str_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = static_pointer_cast &lt;str_o&gt; (sexp);
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (str-&gt;str == <span style="color: #CC9393;">"recur"</span>)
            <span style="color: #F0DFAF; font-weight: bold;">return</span> sub;
        <span style="color: #F0DFAF; font-weight: bold;">else</span>
            <span style="color: #F0DFAF; font-weight: bold;">return</span> sexp;
    }
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (cons_p (env, sexp))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c
            (env,
             sexp_substitute_recur (env, sub, car (env, sexp)),
             sexp_substitute_recur (env, sub, cdr (env, sexp)));
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (vect_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">vect_sexp</span> = static_pointer_cast &lt;vect_o&gt; (sexp);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">list_sexp</span> = vect_to_list (env, vect_sexp);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">new_list_sexp</span> = sexp_substitute_recur (env, sub, list_sexp);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> list_to_vect (env, new_list_sexp);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> sexp;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge30d512" class="outline-4">
<h4 id="orge30d512">lambda_sexp_patch_this</h4>
<div class="outline-text-4" id="text-orge30d512">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">lambda_sexp_patch_this</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">lambda_sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">vect</span> = static_pointer_cast &lt;vect_o&gt;
        (car (env, (cdr (env, lambda_sexp))));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">vector</span> = vect-&gt;vect;
    reverse (vector.begin (),
             vector.end ());
    vector.push_back (make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"this"</span>));
    reverse (vector.begin (),
             vector.end ());
    <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (env,
                   car (env, lambda_sexp),
                   cons_c (env,
                           make_shared &lt;vect_o&gt; (env, vector),
                           cdr (env, cdr (env, lambda_sexp))));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org648f639" class="outline-4">
<h4 id="org648f639">rest_patch_this</h4>
<div class="outline-text-4" id="text-org648f639">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">rest_patch_this</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">rest</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, rest))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> rest;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sexp</span> = car (env, rest);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, sexp))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> rest;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, sexp);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> str_p (env, head))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> rest;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = static_pointer_cast &lt;str_o&gt; (head);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (str-&gt;str == <span style="color: #CC9393;">"lambda"</span>) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c
            (env,
             lambda_sexp_patch_this (env, sexp),
             cdr (env, rest));
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">return</span> rest;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbdf9113" class="outline-4">
<h4 id="orgbdf9113">tk_assign_value</h4>
<div class="outline-text-4" id="text-orgbdf9113">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">tk_assign_value</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt; (car (env, body));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = head-&gt;str;
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">prefix</span> = <span style="color: #CC9393;">""</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">string_vector</span> = string_split (name, <span style="color: #DCDCCC; background-color: #3F3F3F;">'.</span><span style="color: #D0BF8F; font-weight: bold;">'</span>);
    assert (string_vector.size () &lt;= 2);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (string_vector.size () == 2) {
        prefix = string_vector [0];
        name = string_vector [1];
        rest = rest_patch_this (env, rest);
    }
    rest = sexp_substitute_recur (env, head, rest);
    sexp_list_eval (env, rest);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
    env.obj_stack.pop ();
    assign (env, prefix, name, obj);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2cd7943" class="outline-3">
<h3 id="org2cd7943">tk_assign</h3>
<div class="outline-text-3" id="text-org2cd7943">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">tk_assign</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (assign_data_p (env, body))
        tk_assign_data (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (assign_lambda_sugar_p (env, body))
        tk_assign_value (env, assign_lambda_desugar (env, body));
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        tk_assign_value (env, body);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd64ccb7" class="outline-3">
<h3 id="orgd64ccb7">k_lambda</h3>
<div class="outline-text-3" id="text-orgd64ccb7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">k_lambda</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
          <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">old_local_ref_map</span>,
          <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vect</span> = static_pointer_cast &lt;vect_o&gt; (car (env, body));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = obj_vect_to_name_vector (env, name_vect-&gt;vect);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_ref_map</span> = local_ref_map_extend
        (env, old_local_ref_map, name_vector);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest_jojo</span> = sexp_list_compile (env, local_ref_map, rest);
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">lambda_jo_t</span> (name_vector, rest_jojo),
    };
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge553df1" class="outline-3">
<h3 id="orge553df1">case_compile</h3>
<div class="outline-text-3" id="text-orge553df1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">case_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
              <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
              <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo_map</span> = jojo_map_t ();
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> null_p (env, body)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">one</span> = car (env, body);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt; (car (env, one));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, one);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = head-&gt;str;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">tag</span> = tagging (env, name);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = sexp_list_compile (env, local_ref_map, rest);
        jojo_map.insert (make_pair (tag, jojo));
        body = cdr (env, body);
    }
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">case_jo_t</span> (jojo_map),
    };
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8063991" class="outline-3">
<h3 id="org8063991">k_case</h3>
<div class="outline-text-3" id="text-org8063991">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">k_case</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
        <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
        <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head_jojo</span> = sexp_compile (env, local_ref_map, head);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest_jojo</span> = case_compile (env, local_ref_map, rest);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo_append (head_jojo, rest_jojo);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga7615bf" class="outline-3">
<h3 id="orga7615bf">k_note</h3>
<div class="outline-text-3" id="text-orga7615bf">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">k_note</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
        <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
        <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">nop_jo_t</span> (),
    };
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb0f184e" class="outline-3">
<h3 id="orgb0f184e">import_syntax</h3>
<div class="outline-text-3" id="text-orgb0f184e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_syntax</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_top_keyword (env, <span style="color: #CC9393;">"="</span>, tk_assign);
    define_keyword (env, <span style="color: #CC9393;">"lambda"</span>, k_lambda);
    define_keyword (env, <span style="color: #CC9393;">"case"</span>, k_case);
    define_keyword (env, <span style="color: #CC9393;">"note"</span>, k_note);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org848c3ba" class="outline-3">
<h3 id="org848c3ba">test_syntax</h3>
<div class="outline-text-3" id="text-org848c3ba">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_syntax</span> ()
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org89643b9" class="outline-2">
<h2 id="org89643b9"><b>tag</b></h2>
<div class="outline-text-2" id="text-org89643b9">
</div><div id="outline-container-orga7e7988" class="outline-3">
<h3 id="orga7e7988"><span class="todo _todo_">[todo]</span> jj_get_tag</h3>
<div class="outline-text-3" id="text-orga7e7988">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">sig_t jj_get_tag_sig = { "get-tag", "obj" };</span>
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">void jj_get_tag (env_t &amp;env, obj_map_t &amp;obj_map)</span>
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">{</span>
<span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">auto obj = obj_map ["obj"];</span>
<span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.obj_stack.push (make_shared &lt;tag_o&gt; (env, obj-&gt;repr (env)));</span>
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org25fbaab" class="outline-3">
<h3 id="org25fbaab"><span class="todo _todo_">[todo]</span> import_tag</h3>
<div class="outline-text-3" id="text-org25fbaab">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_tag</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{

}
</pre>
</div>
</div>
</div>

<div id="outline-container-org60b60b2" class="outline-3">
<h3 id="org60b60b2"><span class="todo _todo_">[todo]</span> test_tag</h3>
<div class="outline-text-3" id="text-org60b60b2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_tag</span> ()
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7244efb" class="outline-2">
<h2 id="org7244efb"><b>misc</b></h2>
<div class="outline-text-2" id="text-org7244efb">
</div><div id="outline-container-org2f289e5" class="outline-3">
<h3 id="org2f289e5">jj_repr</h3>
<div class="outline-text-3" id="text-org2f289e5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_repr_sig</span> = { <span style="color: #CC9393;">"repr"</span>, <span style="color: #CC9393;">"obj"</span> };
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = obj_map [<span style="color: #CC9393;">"obj"</span>];
    env.obj_stack.push
        (make_shared &lt;str_o&gt;
         (env, obj-&gt;repr (env)));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga5005b3" class="outline-3">
<h3 id="orga5005b3">jj_print</h3>
<div class="outline-text-3" id="text-orga5005b3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_print_sig</span> = { <span style="color: #CC9393;">"print"</span>, <span style="color: #CC9393;">"obj"</span> };
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_print</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = obj_map [<span style="color: #CC9393;">"obj"</span>];
    cout &lt;&lt; obj-&gt;repr (env);
    cout &lt;&lt; flush;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3473333" class="outline-3">
<h3 id="org3473333">jj_println</h3>
<div class="outline-text-3" id="text-org3473333">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_println_sig</span> = { <span style="color: #CC9393;">"println"</span>, <span style="color: #CC9393;">"obj"</span> };
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_println</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = obj_map [<span style="color: #CC9393;">"obj"</span>];
    cout &lt;&lt; obj-&gt;repr (env) &lt;&lt; <span style="color: #CC9393;">"\n"</span> &lt;&lt; flush;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfb40751" class="outline-3">
<h3 id="orgfb40751">jj_newline</h3>
<div class="outline-text-3" id="text-orgfb40751">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_newline_sig</span> = { <span style="color: #CC9393;">"newline"</span> };
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_newline</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    cout &lt;&lt; <span style="color: #CC9393;">"\n"</span> &lt;&lt; flush;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org88c298d" class="outline-3">
<h3 id="org88c298d">jj_equal</h3>
<div class="outline-text-3" id="text-org88c298d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_equal_sig</span> = { <span style="color: #CC9393;">"equal"</span>, <span style="color: #CC9393;">"lhs"</span>, <span style="color: #CC9393;">"rhs"</span> };
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lhs</span> = obj_map [<span style="color: #CC9393;">"lhs"</span>];
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rhs</span> = obj_map [<span style="color: #CC9393;">"rhs"</span>];
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (obj_equal (env, lhs, rhs))
        env.obj_stack.push (true_c (env));
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        env.obj_stack.push (false_c (env));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge55cba0" class="outline-3">
<h3 id="orge55cba0">import_misc</h3>
<div class="outline-text-3" id="text-orge55cba0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_misc</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_prim (env,
                 jj_repr_sig,
                 jj_repr);
    define_prim (env,
                 jj_print_sig,
                 jj_print);
    define_prim (env,
                 jj_println_sig,
                 jj_println);
    define_prim (env,
                 jj_newline_sig,
                 jj_newline);
    define_prim (env,
                 jj_equal_sig,
                 jj_equal);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5d05216" class="outline-3">
<h3 id="org5d05216">test_misc</h3>
<div class="outline-text-3" id="text-org5d05216">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_misc</span> ()
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org525d8fd" class="outline-2">
<h2 id="org525d8fd">epilog</h2>
<div class="outline-text-2" id="text-org525d8fd">
</div><div id="outline-container-orge76c9c6" class="outline-3">
<h3 id="orge76c9c6">test</h3>
<div class="outline-text-3" id="text-orge76c9c6">
</div><div id="outline-container-org956a7bd" class="outline-4">
<h4 id="org956a7bd">test_step</h4>
<div class="outline-text-4" id="text-org956a7bd">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_step</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    define (env, <span style="color: #CC9393;">"s1"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    {
        env.run ();
        assert_stack_size (env, 2);
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org967b9df" class="outline-4">
<h4 id="org967b9df">test_data</h4>
<div class="outline-text-4" id="text-org967b9df">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_data</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span> = {
        {<span style="color: #CC9393;">"car"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>)},
        {<span style="color: #CC9393;">"cdr"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>)},
    };

    define (env, <span style="color: #CC9393;">"last-cry"</span>, make_shared &lt;data_o&gt;
            (env, tagging (env, <span style="color: #CC9393;">"cons-t"</span>), obj_map));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"last-cry"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #CC9393;">"car"</span>),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"last-cry"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #CC9393;">"cdr"</span>),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"last-cry"</span>)),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    {
        env.run ();

        assert_stack_size (env, 3);
        assert_pop_eq (env, make_shared &lt;data_o&gt;
                       (env,
                        tagging (env, <span style="color: #CC9393;">"cons-t"</span>),
                        obj_map));
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeaedd87" class="outline-4">
<h4 id="orgeaedd87">test_apply</h4>
<div class="outline-text-4" id="text-orgeaedd87">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_apply</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    define (env, <span style="color: #CC9393;">"s1"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">body</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">local_ref_jo_t</span> (0, 0),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">local_ref_jo_t</span> (0, 1),
    };

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">lambda_jo_t</span> ({ <span style="color: #CC9393;">"x"</span>, <span style="color: #CC9393;">"y"</span> },
                         make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (body)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (2),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">env.double_report ();</span>

    {
        env.run ();
        assert_stack_size (env, 2);
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org586089a" class="outline-4">
<h4 id="org586089a">test_lambda_curry</h4>
<div class="outline-text-4" id="text-org586089a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_lambda_curry</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    define (env, <span style="color: #CC9393;">"s1"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">body</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">local_ref_jo_t</span> (0, 0),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">local_ref_jo_t</span> (0, 1),
    };

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">lambda_jo_t</span> ({ <span style="color: #CC9393;">"x"</span>, <span style="color: #CC9393;">"y"</span> },
                         make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (body)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">{</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">}</span>

    {
        env.run ();
        assert_stack_size (env, 2);
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc58c975" class="outline-4">
<h4 id="orgc58c975">test_data_cons</h4>
<div class="outline-text-4" id="text-orgc58c975">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_data_cons</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    define (env, <span style="color: #CC9393;">"s1"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
    define (env, <span style="color: #CC9393;">"cons-c"</span>, make_shared &lt;data_cons_o&gt;
            (env,
             tagging (env, <span style="color: #CC9393;">"cons-t"</span>),
             name_vector_t ({ <span style="color: #CC9393;">"car"</span>, <span style="color: #CC9393;">"cdr"</span> }),
             <span style="color: #7CB8BB;">obj_map_t</span> ()));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"cons-c"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (2),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #CC9393;">"cdr"</span>),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">env.double_report ();</span>

    {
        env.run ();
        assert_stack_size (env, 1);
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2fcd413" class="outline-4">
<h4 id="org2fcd413">test_data_cons_curry</h4>
<div class="outline-text-4" id="text-org2fcd413">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_data_cons_curry</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    define (env, <span style="color: #CC9393;">"s1"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
    define (env, <span style="color: #CC9393;">"cons-c"</span>, make_shared &lt;data_cons_o&gt;
            (env,
             tagging (env, <span style="color: #CC9393;">"cons-t"</span>),
             name_vector_t ({ <span style="color: #CC9393;">"car"</span>, <span style="color: #CC9393;">"cdr"</span> }),
             <span style="color: #7CB8BB;">obj_map_t</span> ()));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"cons-c"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #CC9393;">"car"</span>),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">env.double_report ();</span>

    {
        env.run ();
        assert_stack_size (env, 1);
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org515d5cd" class="outline-4">
<h4 id="org515d5cd">test_prim</h4>
<div class="outline-text-4" id="text-org515d5cd">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_prim</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    define (env, <span style="color: #CC9393;">"s1"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));

    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">swap</span> =
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (obj_map [<span style="color: #CC9393;">"y"</span>]);
            env.obj_stack.push (obj_map [<span style="color: #CC9393;">"x"</span>]);
        };

    define (env, <span style="color: #CC9393;">"swap"</span>, make_shared &lt;prim_o&gt;
            (env,
             name_vector_t { <span style="color: #CC9393;">"x"</span>, <span style="color: #CC9393;">"y"</span> },
             swap,
             <span style="color: #7CB8BB;">obj_map_t</span> ()));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"swap"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (2),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"swap"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">env.double_report ();</span>

    {
        env.run ();
        assert_stack_size (env, 4);
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org178011b" class="outline-3">
<h3 id="org178011b">test_all</h3>
<div class="outline-text-3" id="text-org178011b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_all</span> ()
{
    test_step ();
    test_data ();
    test_apply ();
    test_lambda_curry ();
    test_data_cons ();
    test_data_cons_curry ();
    test_prim ();
    test_bool ();
    test_list ();
    test_str ();
    test_vect ();
    test_dict ();
    test_sexp ();
    test_eval ();
    test_syntax ();
    test_tag ();
    test_misc ();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org44defe" class="outline-3">
<h3 id="org44defe">import_all</h3>
<div class="outline-text-3" id="text-org44defe">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_all</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    import_test (env);
    import_bool (env);
    import_list (env);
    import_str (env);
    import_vect (env);
    import_dict (env);
    import_sexp (env);
    import_top_keyword (env);
    import_keyword (env);
    import_compile (env);
    import_eval (env);
    import_syntax (env);
    import_tag (env);
    import_misc (env);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3d9656f" class="outline-3">
<h3 id="org3d9656f">eval_file</h3>
<div class="outline-text-3" id="text-org3d9656f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">eval_file</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">file_name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">input_file</span> = ifstream (file_name);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">buffer</span> = stringstream ();
    buffer &lt;&lt; input_file.rdbuf ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">code</span> = make_shared &lt;str_o&gt; (env, buffer.str ());
    code_eval (env, code);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgde33491" class="outline-3">
<h3 id="orgde33491">the_story_begin</h3>
<div class="outline-text-3" id="text-orgde33491">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">the_story_begin</span> (<span style="color: #7CB8BB;">string_vector_t</span> <span style="color: #DFAF8F;">arg_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();
    import_all (env);
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">file_name</span>: arg_vector)
        eval_file (env, file_name);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb81bb8c" class="outline-3">
<h3 id="orgb81bb8c">main</h3>
<div class="outline-text-3" id="text-orgb81bb8c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">int</span>
<span style="color: #93E0E3;">main</span> (<span style="color: #7CB8BB;">int</span> <span style="color: #DFAF8F;">argc</span>, <span style="color: #7CB8BB;">char</span> **<span style="color: #DFAF8F;">argv</span>)
{
    test_all ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">arg_vector</span> = string_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">i</span> = 1; i &lt; argc; i++) {
        arg_vector.push_back (<span style="color: #7CB8BB;">string</span> (<span style="color: #DFAF8F;">argv</span>[i]));
    }
    the_story_begin (arg_vector);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> 0;
}
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2018-08-01 Wed 00:58</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
