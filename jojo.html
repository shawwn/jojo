<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2018-08-02 Thu 22:33 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>jojo</title>
<meta name="generator" content="Org-mode" />
<link rel="stylesheet" href="css/org-page.css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">jojo</h1>
<div id="table-of-contents">
<h2>overview</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org3c2ebc4">prolog</a>
<ul>
<li><a href="#orga6a37bc">include</a></li>
<li><a href="#orgbadfd4b">using</a></li>
</ul>
</li>
<li><a href="#org5ad2e1d">datatype</a>
<ul>
<li><a href="#orgc21538c">forward declaration</a></li>
<li><a href="#org9f8c235">datatype</a></li>
<li><a href="#org20ad805">obj_t</a></li>
<li><a href="#org8882752">jo_t</a></li>
<li><a href="#orgaf8c408">env_t</a></li>
<li><a href="#orgc5ec0ca">frame_t</a></li>
<li><a href="#org3a7c992">jojo_t</a></li>
<li><a href="#orgc8c6a97">box_t</a></li>
</ul>
</li>
<li><a href="#orgb3a8ca7">libjojo</a>
<ul>
<li><a href="#org58e3b66">string_split</a></li>
<li><a href="#orgc74d3b">jojo_repr</a></li>
<li><a href="#org7123fcf">name_vector_repr</a></li>
<li><a href="#org3f83ba3">bind_vector_repr</a></li>
<li><a href="#org6e8cefd">local_scope_repr</a></li>
<li><a href="#orgc17476c">number_of_obj_in_bind_vector</a></li>
<li><a href="#org12a2895">bind_vector_insert_obj</a></li>
<li><a href="#orgdad41c7">bind_vector_merge_obj_vector</a></li>
<li><a href="#org518f4be">pick_up_obj_vector</a></li>
<li><a href="#org7f19563">local_scope_extend</a></li>
<li><a href="#org95e63eb">bind_equal</a></li>
<li><a href="#org9cd8cb3">bind_vector_equal</a></li>
<li><a href="#org80d166e">local_scope_equal</a></li>
<li><a href="#orgb717b6e">obj_map_equal</a></li>
<li><a href="#orge7ebd21">obj_map_repr</a></li>
<li><a href="#org32faee">name_vector_obj_map_lack</a></li>
<li><a href="#org75a6f5b">name_vector_obj_map_arity_lack</a></li>
<li><a href="#orgd0afb36">pick_up_obj_map_and_merge</a></li>
<li><a href="#orgc5ff666">name_vector_and_obj_map_repr</a></li>
<li><a href="#org920a63b">vector_rev_ref</a></li>
<li><a href="#org6c189f5">bind_vector_from_name_vector</a></li>
<li><a href="#org3a2e933">new_frame_from_jojo</a></li>
<li><a href="#org5231034">new_frame_from_jo_vector</a></li>
<li><a href="#org4d1bf9">obj_equal</a></li>
<li><a href="#org56ac85e">about predicate</a>
<ul>
<li><a href="#org8f2b292">closure_p</a></li>
<li><a href="#orgffdcaa">type_p</a></li>
</ul>
</li>
<li><a href="#orgb6ab95d">about assert</a>
<ul>
<li><a href="#orge93919e">assert_pop_eq</a></li>
<li><a href="#org48b8676">assert_tos_eq</a></li>
<li><a href="#org35c8d24">assert_stack_size</a></li>
</ul>
</li>
<li><a href="#orgff8ca1a">define</a></li>
<li><a href="#org709eeb8">sig_t</a></li>
<li><a href="#orgea95cc6">name_of_sig</a></li>
<li><a href="#orgddc81eb">name_vector_of_sig</a></li>
</ul>
</li>
<li><a href="#orge1278e0">obj</a>
<ul>
<li><a href="#org859c20b">obj_t::~obj_t</a></li>
<li><a href="#org9768a95">obj_t::repr</a></li>
<li><a href="#orgb049f46">obj_t::equal</a></li>
<li><a href="#orgeb0f84">obj_t::apply</a></li>
</ul>
</li>
<li><a href="#org45f990d">env</a>
<ul>
<li><a href="#orga9281c1">frame</a>
<ul>
<li><a href="#org65e6d53">frame_t::frame_t</a></li>
<li><a href="#org8e57e0f">jojo_print</a></li>
<li><a href="#org7dc89a2">jojo_print_with_index</a></li>
<li><a href="#org462129">frame_report</a></li>
</ul>
</li>
<li><a href="#org49064fb">box</a>
<ul>
<li><a href="#org3dc1ecb">box_t::box_t</a></li>
<li><a href="#org95914c9">boxing</a></li>
<li><a href="#org8646580">name_of_box</a></li>
</ul>
</li>
<li><a href="#orgd776b7f">env_t::step</a></li>
<li><a href="#org4822bcd">env_t::run</a></li>
<li><a href="#org1a2fb57">env_t::box_map_report</a></li>
<li><a href="#org399f1c4">env_t::frame_stack_report</a></li>
<li><a href="#org3121036">env_t::obj_stack_report</a></li>
<li><a href="#orgf68e649">env_t::report</a></li>
<li><a href="#orgf7b0d1">env_t::run_with_base</a></li>
<li><a href="#org6afe983">env_t::double_report</a></li>
<li><a href="#orgd478426">env_t::step_and_report</a></li>
</ul>
</li>
<li><a href="#org3bc9696">closure</a>
<ul>
<li><a href="#orgb76c3a5">closure_o</a></li>
<li><a href="#org47e7384">closure_o::apply</a></li>
<li><a href="#orgc28b0a5">closure_o::closure_o</a></li>
<li><a href="#org2d3b76a">closure_o::equal</a></li>
<li><a href="#org7c3c6f9">closure_o::repr</a></li>
</ul>
</li>
<li><a href="#orgd7d8f20">data</a>
<ul>
<li><a href="#orgcbbec96">data_o</a></li>
<li><a href="#orgb577b36">data_o::data_o</a></li>
<li><a href="#org1b5f596">data_o::equal</a></li>
<li><a href="#orge7a7432">data_o::repr</a></li>
</ul>
</li>
<li><a href="#org24cb43c">data_cons</a>
<ul>
<li><a href="#orgcd94edb">data_cons_o</a></li>
<li><a href="#org6f8f44c">data_cons_o::data_cons_o</a></li>
<li><a href="#org46b0246">data_cons_o::apply</a></li>
<li><a href="#orgd693ee8">data_cons_o::equal</a></li>
<li><a href="#org9908529">data_cons_o::repr</a></li>
</ul>
</li>
<li><a href="#orga18fb8e">prim</a>
<ul>
<li><a href="#org5b8f4ad">prim_fn</a></li>
<li><a href="#orgb8ead37">prim_o</a></li>
<li><a href="#org193bb4a">prim_o::prim_o</a></li>
<li><a href="#org3f592db">prim_o::repr</a></li>
<li><a href="#org62217b3">prim_o::equal</a></li>
<li><a href="#orgd64be8f">prim_o::apply</a></li>
<li><a href="#orgbecb000">define_prim</a></li>
</ul>
</li>
<li><a href="#orgb2d2638">type</a>
<ul>
<li><a href="#orgab546f3">type_o</a></li>
<li><a href="#org318dfb4">type_o::type_o</a></li>
<li><a href="#org5479472">type_o::repr</a></li>
<li><a href="#org1826aee">type_o::equal</a></li>
<li><a href="#org76213c6">assign</a></li>
<li><a href="#org82f19a6">tag_name_p</a></li>
<li><a href="#orgce2fd7e">define_type</a></li>
<li><a href="#org4fb6a38">jj_typeof</a></li>
<li><a href="#org3c4d0b0">import_type</a></li>
<li><a href="#orgd45546f">test_type</a></li>
</ul>
</li>
<li><a href="#orgab9d6fd">jojo</a>
<ul>
<li><a href="#org28594df">jojo_t::jojo_t</a></li>
<li><a href="#org5dd74ed">jojo_t::~jojo_t</a></li>
</ul>
</li>
<li><a href="#orgc406b3a">jo</a>
<ul>
<li><a href="#orga54dbd5">jo_t::copy</a></li>
<li><a href="#orgc795804">jo_t::~jo_t</a></li>
<li><a href="#org172306a">jo_t::exe</a></li>
<li><a href="#org3fc1ade">jo_t::repr</a></li>
</ul>
</li>
<li><a href="#org471143f">about jo</a>
<ul>
<li><a href="#org8ccf4ed">ref_jo</a>
<ul>
<li><a href="#org6e42ec0">ref_jo_t</a></li>
<li><a href="#orgacaefeb">ref_jo_t::ref_jo_t</a></li>
<li><a href="#orge14dda8">ref_jo_t::copy</a></li>
<li><a href="#org3a65082">ref_jo_t::exe</a></li>
<li><a href="#orge81ec3d">ref_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#orge918777">local_ref_jo</a>
<ul>
<li><a href="#orgdc692f">local_ref_jo_t</a></li>
<li><a href="#org2940b7c">local_ref_jo_t::local_ref_jo_t</a></li>
<li><a href="#org47876ab">local_ref_jo_t::copy</a></li>
<li><a href="#orgb15a81f">local_ref_jo_t::exe</a></li>
<li><a href="#orgabef51a">local_ref_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#orgbd09d56">field_jo</a>
<ul>
<li><a href="#org25f393e">field_jo_t</a></li>
<li><a href="#org1512c90">field_jo_t::field_jo_t</a></li>
<li><a href="#org5ccd218">field_jo_t::copy</a></li>
<li><a href="#orge1361cc">field_jo_t::exe</a></li>
<li><a href="#org83088c2">field_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#orgbbd1ddf">apply_jo</a>
<ul>
<li><a href="#orga60c034">apply_jo_t</a></li>
<li><a href="#org14e3b7b">apply_jo_t::apply_jo_t</a></li>
<li><a href="#org6d1369f">apply_jo_t::copy</a></li>
<li><a href="#orgfaa7dab">apply_jo_t::exe</a></li>
<li><a href="#orgb51e498">apply_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#org5813fab">lit_jo</a>
<ul>
<li><a href="#orgff54235">lit_jo_t</a></li>
<li><a href="#orgf083c89">lit_jo_t::lit_jo_t</a></li>
<li><a href="#org69112f3">lit_jo_t::copy</a></li>
<li><a href="#org6f73443">lit_jo_t::exe</a></li>
<li><a href="#orgd395f8a">lit_jo_t::repr</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org65cd5db">bool</a>
<ul>
<li><a href="#org6221517">true_c</a></li>
<li><a href="#org636f37a">true_p</a></li>
<li><a href="#org684c63d">false_c</a></li>
<li><a href="#org827ff6d">false_p</a></li>
<li><a href="#orgf73464a">jj_true_c</a></li>
<li><a href="#orgc4d4127">jj_false_c</a></li>
<li><a href="#org213d35e">import_bool</a></li>
<li><a href="#orgbf6e675">test_bool</a></li>
</ul>
</li>
<li><a href="#orgd718699">int</a>
<ul>
<li><a href="#org47772ff">int_o</a></li>
<li><a href="#orgd29770">int_o::int_o</a></li>
<li><a href="#orga4c7d48">int_o::repr</a></li>
<li><a href="#org1507a18">int_o::equal</a></li>
<li><a href="#orgc431a0d">int_p</a></li>
<li><a href="#orgff210e4">import_int</a></li>
<li><a href="#org2631c9d">test_int</a></li>
</ul>
</li>
<li><a href="#orga763253">str</a>
<ul>
<li><a href="#org74e8d0b">str_o</a></li>
<li><a href="#org7b7a5d">str_o::str_o</a></li>
<li><a href="#org6ece8da">str_o::repr</a></li>
<li><a href="#org4c5774e">str_o::equal</a></li>
<li><a href="#org3b8d2a2">str_p</a></li>
<li><a href="#orgccdde0c">jj_str_print</a></li>
<li><a href="#orge356188">import_str</a></li>
<li><a href="#orgbdf687b">test_str</a></li>
</ul>
</li>
<li><a href="#org1143286">list</a>
<ul>
<li><a href="#org559d465">null_c</a></li>
<li><a href="#org75ef2d8">cons_c</a></li>
<li><a href="#org69e06ea">cons_p</a></li>
<li><a href="#org9e91ff7">car</a></li>
<li><a href="#orga3d7fe">cdr</a></li>
<li><a href="#orgd083734">null_p</a></li>
<li><a href="#orge75ee37">list_p</a></li>
<li><a href="#orgc0f9e81">list_length</a></li>
<li><a href="#orge65de3">jj_null_c</a></li>
<li><a href="#org9f77c37">jj_cons_c</a></li>
<li><a href="#org51faefc">import_list</a></li>
<li><a href="#orgd560d20">test_list</a></li>
</ul>
</li>
<li><a href="#org42fa0e7">vect</a>
<ul>
<li><a href="#orgba3b67e">vect_o</a></li>
<li><a href="#org55ec7be">collect_vect_jo</a>
<ul>
<li><a href="#orgb4470e4">collect_vect_jo_t</a></li>
<li><a href="#org7c8ffab">collect_vect_jo_t::collect_vect_jo_t</a></li>
<li><a href="#org79d5951">collect_vect_jo_t::copy</a></li>
<li><a href="#org60c55cb">collect_vect_jo_t::exe</a></li>
<li><a href="#org8360a17">collect_vect_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#orgf762f6">vect_o::vect_o</a></li>
<li><a href="#org47412c7">vect_equal</a></li>
<li><a href="#org7e0221c">vect_o::equal</a></li>
<li><a href="#orgc6f14d0">vect_o::repr</a></li>
<li><a href="#org37cc405">vect_p</a></li>
<li><a href="#org9208e8c">list_to_vect</a></li>
<li><a href="#org362ea37">jj_list_to_vect</a></li>
<li><a href="#orgc6e7bf3">vect_to_list</a></li>
<li><a href="#org7bb134f">jj_vect_to_list</a></li>
<li><a href="#org34fd1cf">import_vect</a></li>
<li><a href="#orgd52a41a">test_vect</a></li>
</ul>
</li>
<li><a href="#orgceb9dd1">dict</a>
<ul>
<li><a href="#orga67243b">dict_o</a></li>
<li><a href="#org777165b">collect_dict_jo</a>
<ul>
<li><a href="#org7263d81">collect_dict_jo_t</a></li>
<li><a href="#org1980286">collect_dict_jo_t::collect_dict_jo_t</a></li>
<li><a href="#orga70fe61">collect_dict_jo_t::copy</a></li>
<li><a href="#orgc8cea1b">collect_dict_jo_t::exe</a></li>
<li><a href="#org497a15f">collect_dict_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#org9ae42a7">dict_o::dict_o</a></li>
<li><a href="#org73e32e1">dict_o::equal</a></li>
<li><a href="#orga92ec16">dict_o::repr</a></li>
<li><a href="#org13de79a">dict_p</a></li>
<li><a href="#org1de9c14">list_to_dict</a></li>
<li><a href="#orgb2b0b51">dict_to_list</a></li>
<li><a href="#org3d4b318">import_dict</a></li>
<li><a href="#orge8dfd19">test_dict</a></li>
</ul>
</li>
<li><a href="#org315aa4b">sexp</a>
<ul>
<li><a href="#org58623b7">string_vector_t</a></li>
<li><a href="#org1256af8">space_char_p</a></li>
<li><a href="#org7f9596f">delimiter_char_p</a></li>
<li><a href="#org6050700">string_from_char</a></li>
<li><a href="#org1688425">doublequote_char_p</a></li>
<li><a href="#org9220ddb">find_word_length</a></li>
<li><a href="#orga9bfeda">find_string_length</a></li>
<li><a href="#orgdfd7cb1">scan_word_vector</a></li>
<li><a href="#org53728b6"><span class="todo _note_">[note]</span> about literal in quote</a></li>
<li><a href="#org6fd70cf">word_vector_to_word_list &#x2013; drop `,`</a></li>
<li><a href="#org5a7167e">scan_word_list</a></li>
<li><a href="#orga66c200">bar_word_p</a></li>
<li><a href="#org60feb28">ket_word_p</a></li>
<li><a href="#orgebce040">quote_word_p</a></li>
<li><a href="#org5fec5b2">bar_word_to_ket_word</a></li>
<li><a href="#orgf731d23">word_list_head_with_bar_ket_counter</a></li>
<li><a href="#org32e8361">word_list_head</a></li>
<li><a href="#org443191a">word_list_rest_with_bar_ket_counter</a></li>
<li><a href="#org72ef851">word_list_rest</a></li>
<li><a href="#org2c4dbdd">word_list_drop_ket</a></li>
<li><a href="#org43669c4">parse_sexp</a></li>
<li><a href="#org3cee19d">parse_sexp_list</a></li>
<li><a href="#orgf1a604d">sexp_repr</a></li>
<li><a href="#org232e09b">sexp_list_repr</a></li>
<li><a href="#org316f4fe">jj_scan_word_list</a></li>
<li><a href="#org22bf412">jj_parse_sexp</a></li>
<li><a href="#org9813406">jj_parse_sexp_list</a></li>
<li><a href="#org3d34cac">jj_sexp_repr</a></li>
<li><a href="#org9f16379">jj_sexp_list_repr</a></li>
<li><a href="#orgb148beb">import_sexp</a></li>
<li><a href="#orgf4e1355">test_sexp_scan</a></li>
<li><a href="#orgb88bbbe">test_sexp_list</a></li>
<li><a href="#org6b881">test_sexp_vect</a></li>
<li><a href="#orgf824da6">test_sexp</a></li>
</ul>
</li>
<li><a href="#orgc0fdf71">top_keyword</a>
<ul>
<li><a href="#orgb5bb400">top_keyword_fn</a></li>
<li><a href="#org56d23c8">top_keyword_o</a></li>
<li><a href="#org6f12f35">top_keyword_o::top_keyword_o</a></li>
<li><a href="#org9be13ff">top_keyword_o::equal</a></li>
<li><a href="#org20ec94c">top_keyword_p</a></li>
<li><a href="#org819947f">define_top_keyword</a></li>
<li><a href="#org2216a7d">import_top_keyword</a></li>
</ul>
</li>
<li><a href="#org75d5ea3">keyword</a>
<ul>
<li><a href="#org93cbd5e">local_ref_map_t</a></li>
<li><a href="#orga2180df">local_ref_map_extend</a></li>
<li><a href="#org1e239b6">keyword_fn</a></li>
<li><a href="#org21082a6">keyword_o</a></li>
<li><a href="#org5b02329">keyword_o::keyword_o</a></li>
<li><a href="#org11617cc">keyword_o::equal</a></li>
<li><a href="#orgb5b0e92">keyword_p</a></li>
<li><a href="#org2933319">define_keyword</a></li>
<li><a href="#orgb613082">obj_vector_to_name_vector</a></li>
<li><a href="#org78c7439">import_keyword</a></li>
</ul>
</li>
<li><a href="#org3132e53">macro</a></li>
<li><a href="#org2ef71f8">compile</a>
<ul>
<li><a href="#org126a741">keyword_sexp_p</a></li>
<li><a href="#orgfc09014">get_keyword_fn</a></li>
<li><a href="#org7a13a02">jojo_append</a></li>
<li><a href="#orgc6aa44c">dot_string_p</a></li>
<li><a href="#org5244903">dot_string_compile</a></li>
<li><a href="#org5d348b">ref_compile</a></li>
<li><a href="#orgbe1d5f6">string_string_p</a></li>
<li><a href="#org92b95d6">string_string_compile</a></li>
<li><a href="#org429f843">key_string_p</a></li>
<li><a href="#orgf0f4fe3">key_string_compile</a></li>
<li><a href="#orge580e09">int_string_p</a></li>
<li><a href="#orgd344379">int_string_compile</a></li>
<li><a href="#orgfc40b4f">string_compile</a></li>
<li><a href="#orge497c25">vect_compile</a></li>
<li><a href="#orgd31e7f1">dict_compile</a></li>
<li><a href="#org3583b48">sexp_compile</a></li>
<li><a href="#orgc1634a1">sexp_list_compile</a></li>
<li><a href="#orgc300e7">dot_head_p</a></li>
<li><a href="#org4d11a50">call_compile</a></li>
<li><a href="#org2c07df7">import_compile</a></li>
<li><a href="#org6b2c8f6">test_compile</a></li>
</ul>
</li>
<li><a href="#org5689622">eval</a>
<ul>
<li><a href="#orgc6b4046">top_keyword_sexp_p</a></li>
<li><a href="#org760d6b3">get_top_keyword_fn</a></li>
<li><a href="#orgf2eed98">jojo_run</a></li>
<li><a href="#org55986de">sexp_eval</a></li>
<li><a href="#org51b6c94">sexp_list_eval</a></li>
<li><a href="#orgb877908">top_sexp_eval</a></li>
<li><a href="#org48fd3db">top_sexp_list_eval</a></li>
<li><a href="#org249b0dd">code_eval</a></li>
<li><a href="#org82f4ba0">import_eval</a></li>
<li><a href="#orgc12b46c"><span class="todo _todo_">[todo]</span> test_eval</a></li>
</ul>
</li>
<li><a href="#org973fdb8">syntax</a>
<ul>
<li><a href="#org2ffc207">(=)</a>
<ul>
<li><a href="#org3798d10">(= &lt;name&gt; (data &#x2026;))</a>
<ul>
<li><a href="#org7a6fa60"><span class="todo _note_">[note]</span> type must all be top-level</a></li>
<li><a href="#org2fdc8eb">assign_data_p</a></li>
<li><a href="#orgea2eb84">type_name_to_data_name</a></li>
<li><a href="#org1798338">tk_assign_data</a></li>
</ul>
</li>
<li><a href="#org2efd557">(= (&lt;name&gt; &#x2026;) &#x2026;)</a>
<ul>
<li><a href="#orgeac741a">assign_lambda_sugar_p</a></li>
<li><a href="#org786f943">assign_lambda_desugar</a></li>
</ul>
</li>
<li><a href="#org3edd4f3">(= &lt;name&gt; &#x2026;)</a>
<ul>
<li><a href="#orgf785bfe">sexp_substitute_recur</a></li>
<li><a href="#orgfde5153">lambda_sexp_patch_this</a></li>
<li><a href="#org4c4e577">rest_patch_this</a></li>
<li><a href="#org609df3e">tk_assign_value</a></li>
</ul>
</li>
<li><a href="#org30fb4ce">tk_assign</a></li>
</ul>
</li>
<li><a href="#orgf4f59d6">(lambda)</a>
<ul>
<li><a href="#org4e78521">lambda_jo</a>
<ul>
<li><a href="#org8176cea">lambda_jo_t</a></li>
<li><a href="#orgfa78af7">lambda_jo_t::lambda_jo_t</a></li>
<li><a href="#org6785cf6">lambda_jo_t::copy</a></li>
<li><a href="#orgf6977e4">lambda_jo_t::exe</a></li>
<li><a href="#org19287c7">lambda_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#orgcb6e8db">lambda_patch_drop</a></li>
<li><a href="#org8708273">k_lambda</a></li>
</ul>
</li>
<li><a href="#org98ed669">(case)</a>
<ul>
<li><a href="#org77d82f0">case_jo</a>
<ul>
<li><a href="#orgf89ae7a">case_jo_t</a></li>
<li><a href="#org2dc3566">case_jo_t::case_jo_t</a></li>
<li><a href="#org7b928a6">case_jo_t::has_default_jojo_p</a></li>
<li><a href="#org494833">case_jo_t::copy</a></li>
<li><a href="#org27f87ca">case_jo_t::exe</a></li>
<li><a href="#org3c02cb8"><span class="todo _todo_">[todo]</span> case_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#org1315050">case_compile</a></li>
<li><a href="#org3cb37ab">k_case</a></li>
</ul>
</li>
<li><a href="#orgb89d06e">(quote)</a>
<ul>
<li><a href="#org475e032">sexp_literalize</a>
<ul>
<li><a href="#orgcca59fc">forward declaration</a></li>
<li><a href="#org8b08ae4">str_sexp_literalize</a></li>
<li><a href="#org7c55f27">vect_sexp_literalize</a></li>
<li><a href="#orgfb2eba9">dict_sexp_literalize</a></li>
<li><a href="#org1c2899d">sexp_literalize</a></li>
</ul>
</li>
<li><a href="#orgcbd85ee">k_quote</a></li>
</ul>
</li>
<li><a href="#org2490b38">(note)</a>
<ul>
<li><a href="#orgaf6c055">k_note</a></li>
</ul>
</li>
<li><a href="#org1717501">(assert)</a>
<ul>
<li><a href="#org1a7fb92">assert_jo</a>
<ul>
<li><a href="#org81efcc3">assert_jo_t</a></li>
<li><a href="#org4f71ea1">assert_jo_t::assert_jo_t</a></li>
<li><a href="#org647db81">assert_jo_t::copy</a></li>
<li><a href="#orgea9ba14">assert_jo_t::exe</a></li>
<li><a href="#org90120da"><span class="todo _todo_">[todo]</span> assert_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#org91a4a24">k_assert</a></li>
</ul>
</li>
<li><a href="#org2f7d40d">import_syntax</a></li>
<li><a href="#orgdc1b7fd">test_syntax</a></li>
</ul>
</li>
<li><a href="#orga60586d">stack</a>
<ul>
<li><a href="#org7a843ca">jj_drop</a></li>
<li><a href="#org1ede7ea">import_stack</a></li>
<li><a href="#org7a5e5a8">test_stack</a></li>
</ul>
</li>
<li><a href="#orgd987f3c">misc</a>
<ul>
<li><a href="#org936ec6">jj_repr</a></li>
<li><a href="#org3972de1">jj_print</a></li>
<li><a href="#orgc61618">jj_println</a></li>
<li><a href="#org6dad9d9">jj_nl</a></li>
<li><a href="#org8db41dc">jj_equal</a></li>
<li><a href="#org472b5ca">jj_env_report</a></li>
<li><a href="#org1a2c1de">import_misc</a></li>
<li><a href="#orgf8fb9c4">test_misc</a></li>
</ul>
</li>
<li><a href="#org3eaa923">epilog</a>
<ul>
<li><a href="#orgef7c1ba">test</a>
<ul>
<li><a href="#org90cba6b">test_step</a></li>
<li><a href="#org62995f">test_data</a></li>
<li><a href="#orgceef064">test_apply</a></li>
<li><a href="#org21cb9e8">test_lambda_curry</a></li>
<li><a href="#org27bca42">test_data_cons</a></li>
<li><a href="#orgd2deaa5">test_data_cons_curry</a></li>
<li><a href="#org7165cd1">test_prim</a></li>
</ul>
</li>
<li><a href="#org5882a90">test_all</a></li>
<li><a href="#org4feaa95">import_all</a></li>
<li><a href="#org2b58d76">eval_file</a></li>
<li><a href="#org13ef82a">the_story_begin</a></li>
<li><a href="#orge428383">main</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org3c2ebc4" class="outline-2">
<h2 id="org3c2ebc4">prolog</h2>
<div class="outline-text-2" id="text-org3c2ebc4">
</div><div id="outline-container-orga6a37bc" class="outline-3">
<h3 id="orga6a37bc">include</h3>
<div class="outline-text-3" id="text-orga6a37bc">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;iostream&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;fstream&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;sstream&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;algorithm&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;functional&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;cassert&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;memory&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;vector&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;array&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;map&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;set&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;stack&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbadfd4b" class="outline-3">
<h3 id="orgbadfd4b">using</h3>
<div class="outline-text-3" id="text-orgbadfd4b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #F0DFAF; font-weight: bold;">namespace</span> <span style="color: #BFEBBF;">std</span>;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5ad2e1d" class="outline-2">
<h2 id="org5ad2e1d">datatype</h2>
<div class="outline-text-2" id="text-org5ad2e1d">
</div><div id="outline-container-orgc21538c" class="outline-3">
<h3 id="orgc21538c">forward declaration</h3>
<div class="outline-text-3" id="text-orgc21538c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">env_t</span>;
<span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">jojo_t</span>;
<span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">box_t</span>;
<span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">frame_t</span>;
<span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">obj_t</span>;
<span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">jo_t</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org9f8c235" class="outline-3">
<h3 id="org9f8c235">datatype</h3>
<div class="outline-text-3" id="text-org9f8c235">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">name_t</span> = string;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">name_vector_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">name_t</span>&gt;;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">bind_t</span> = <span style="color: #7CB8BB;">pair</span> &lt;<span style="color: #7CB8BB;">name_t</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;&gt;;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">bind_vector_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">bind_t</span>&gt;; <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">index from end</span>
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">local_scope_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">bind_vector_t</span>&gt;; <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">index from end</span>
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">jo_vector_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">jo_t</span> *&gt;;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">tag_t</span> = string;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">obj_map_t</span> = <span style="color: #7CB8BB;">map</span> &lt;<span style="color: #7CB8BB;">name_t</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;&gt;;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">obj_vector_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;&gt;;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">box_map_t</span> = <span style="color: #7CB8BB;">map</span> &lt;<span style="color: #7CB8BB;">name_t</span>, <span style="color: #7CB8BB;">box_t</span> *&gt;;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">obj_stack_t</span> = <span style="color: #7CB8BB;">stack</span> &lt;<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;&gt;;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">frame_stack_t</span> = <span style="color: #7CB8BB;">stack</span> &lt;<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">frame_t</span>&gt;&gt;;
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">jojo_map_t</span> = <span style="color: #7CB8BB;">map</span> &lt;<span style="color: #7CB8BB;">tag_t</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-org20ad805" class="outline-3">
<h3 id="org20ad805">obj_t</h3>
<div class="outline-text-3" id="text-org20ad805">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag</span>;
    <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>;
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> ~<span style="color: #93E0E3;">obj_t</span> ();
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org8882752" class="outline-3">
<h3 id="org8882752">jo_t</h3>
<div class="outline-text-3" id="text-org8882752">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> ~<span style="color: #93E0E3;">jo_t</span> ();
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaf8c408" class="outline-3">
<h3 id="orgaf8c408">env_t</h3>
<div class="outline-text-3" id="text-orgaf8c408">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">env_t</span>
{
    <span style="color: #7CB8BB;">box_map_t</span> <span style="color: #DFAF8F;">box_map</span>;
    <span style="color: #7CB8BB;">obj_stack_t</span> <span style="color: #DFAF8F;">obj_stack</span>;
    <span style="color: #7CB8BB;">frame_stack_t</span> <span style="color: #DFAF8F;">frame_stack</span>;
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">step</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">run</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">box_map_report</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">frame_stack_report</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">obj_stack_report</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">report</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">run_with_base</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">base</span>);
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">double_report</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">step_and_report</span> ();
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc5ec0ca" class="outline-3">
<h3 id="orgc5ec0ca">frame_t</h3>
<div class="outline-text-3" id="text-orgc5ec0ca">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">frame_t</span>
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span>;
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>;
    <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>;
    <span style="color: #93E0E3;">frame_t</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>, <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org3a7c992" class="outline-3">
<h3 id="org3a7c992">jojo_t</h3>
<div class="outline-text-3" id="text-org3a7c992">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">jojo_t</span>
{
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span>;
    <span style="color: #93E0E3;">jojo_t</span> (<span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span>);
    ~<span style="color: #93E0E3;">jojo_t</span> ();
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc8c6a97" class="outline-3">
<h3 id="orgc8c6a97">box_t</h3>
<div class="outline-text-3" id="text-orgc8c6a97">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">box_t</span>
{
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>;
    <span style="color: #7CB8BB;">bool</span> <span style="color: #DFAF8F;">empty_p</span>;
    <span style="color: #93E0E3;">box_t</span> ();
    <span style="color: #93E0E3;">box_t</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
};
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb3a8ca7" class="outline-2">
<h2 id="orgb3a8ca7">libjojo</h2>
<div class="outline-text-2" id="text-orgb3a8ca7">
</div><div id="outline-container-org58e3b66" class="outline-3">
<h3 id="org58e3b66">string_split</h3>
<div class="outline-text-3" id="text-org58e3b66">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">template</span> &lt;<span style="color: #F0DFAF; font-weight: bold;">typename</span> <span style="color: #7CB8BB;">Out</span>&gt;
<span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">string_split</span> (<span style="color: #F0DFAF; font-weight: bold;">const</span> <span style="color: #7CB8BB;">string</span> &amp;<span style="color: #DFAF8F;">s</span>, <span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">delim</span>, <span style="color: #7CB8BB;">Out</span> <span style="color: #DFAF8F;">result</span>)
{
    <span style="color: #7CB8BB;">stringstream</span> <span style="color: #DFAF8F;">ss</span> (s);
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">item</span>;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (getline (ss, item, delim)) {
        *(result++) = item;
    }
}

<span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">string</span>&gt;
<span style="color: #93E0E3;">string_split</span> (<span style="color: #F0DFAF; font-weight: bold;">const</span> <span style="color: #7CB8BB;">string</span> &amp;<span style="color: #DFAF8F;">s</span>, <span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">delim</span>)
{
    <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">string</span>&gt; <span style="color: #DFAF8F;">elems</span>;
    string_split (s, delim, back_inserter (elems));
    <span style="color: #F0DFAF; font-weight: bold;">return</span> elems;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc74d3b" class="outline-3">
<h3 id="orgc74d3b">jojo_repr</h3>
<div class="outline-text-3" id="text-orgc74d3b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">jojo_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>)
{
    assert (jojo-&gt;jo_vector.size () != 0);
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">jo</span>: jojo-&gt;jo_vector) {
        repr += jo-&gt;repr (env);
        repr += <span style="color: #CC9393;">" "</span>;
    }
    repr.pop_back ();
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7123fcf" class="outline-3">
<h3 id="org7123fcf">name_vector_repr</h3>
<div class="outline-text-3" id="text-org7123fcf">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">name_vector_repr</span> (<span style="color: #7CB8BB;">name_vector_t</span> &amp;<span style="color: #DFAF8F;">name_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (name_vector.size () == 0) {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"["</span>;
        repr += <span style="color: #CC9393;">"]"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"["</span>;
        <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span>: name_vector) {
            repr += name;
            repr += <span style="color: #CC9393;">" "</span>;
        }
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> repr.empty ()) repr.pop_back ();
        repr += <span style="color: #CC9393;">"]"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3f83ba3" class="outline-3">
<h3 id="org3f83ba3">bind_vector_repr</h3>
<div class="outline-text-3" id="text-org3f83ba3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">bind_vector_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">bind_vector_t</span> <span style="color: #DFAF8F;">bind_vector</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = bind_vector.rbegin ();
         it != bind_vector.rend ();
         it++) {
        repr += <span style="color: #CC9393;">"("</span>;
        repr += to_string (distance (bind_vector.rbegin (), it));
        repr += <span style="color: #CC9393;">" "</span>;
        repr += it-&gt;first;
        repr += <span style="color: #CC9393;">" = "</span>;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (obj == <span style="color: #BFEBBF;">nullptr</span>)
            repr += <span style="color: #CC9393;">"_"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">else</span>
            repr += obj-&gt;repr (env);
        repr += <span style="color: #CC9393;">") "</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6e8cefd" class="outline-3">
<h3 id="org6e8cefd">local_scope_repr</h3>
<div class="outline-text-3" id="text-org6e8cefd">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">local_scope_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
    repr += <span style="color: #CC9393;">"  - ["</span>;
    repr += to_string (local_scope.size ());
    repr += <span style="color: #CC9393;">"] "</span>;
    repr += <span style="color: #CC9393;">"local_scope - "</span>;
    repr += <span style="color: #CC9393;">"\n"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = local_scope.rbegin ();
         it != local_scope.rend ();
         it++) {
        repr += <span style="color: #CC9393;">"    "</span>;
        repr += to_string (distance (local_scope.rbegin (), it));
        repr += <span style="color: #CC9393;">" "</span>;
        repr += bind_vector_repr (env, *it);
        repr += <span style="color: #CC9393;">"\n"</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc17476c" class="outline-3">
<h3 id="orgc17476c">number_of_obj_in_bind_vector</h3>
<div class="outline-text-3" id="text-orgc17476c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">size_t</span>
<span style="color: #93E0E3;">number_of_obj_in_bind_vector</span> (<span style="color: #7CB8BB;">bind_vector_t</span> &amp;<span style="color: #DFAF8F;">bind_vector</span>)
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">sum</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = bind_vector.begin ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = bind_vector.end ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++)
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (it-&gt;second)
            sum++;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> sum;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org12a2895" class="outline-3">
<h3 id="org12a2895">bind_vector_insert_obj</h3>
<div class="outline-text-3" id="text-org12a2895">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">bind_vector_insert_obj</span> (<span style="color: #7CB8BB;">bind_vector_t</span> &amp;<span style="color: #DFAF8F;">bind_vector</span>,
                        <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = bind_vector.rbegin ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = bind_vector.rend ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++) {
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (it-&gt;second == <span style="color: #BFEBBF;">nullptr</span>) {
            it-&gt;second = obj;
            <span style="color: #F0DFAF; font-weight: bold;">return</span>;
        }
    }
    cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : bind_vector_insert_obj"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
         &lt;&lt; <span style="color: #CC9393;">"  the bind_vector is filled"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    exit (1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdad41c7" class="outline-3">
<h3 id="orgdad41c7">bind_vector_merge_obj_vector</h3>
<div class="outline-text-3" id="text-orgdad41c7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bind_vector_t</span>
<span style="color: #93E0E3;">bind_vector_merge_obj_vector</span> (<span style="color: #7CB8BB;">bind_vector_t</span> &amp;<span style="color: #DFAF8F;">old_bind_vector</span>,
                              <span style="color: #7CB8BB;">obj_vector_t</span> &amp;<span style="color: #DFAF8F;">obj_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bind_vector</span> = old_bind_vector;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span>: obj_vector)
        bind_vector_insert_obj (bind_vector, obj);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> bind_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org518f4be" class="outline-3">
<h3 id="org518f4be">pick_up_obj_vector</h3>
<div class="outline-text-3" id="text-org518f4be">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">obj_vector_t</span>
<span style="color: #93E0E3;">pick_up_obj_vector</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">counter</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_vector</span> = obj_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (counter &gt; 0) {
        counter--;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
        obj_vector.push_back (obj);
        env.obj_stack.pop ();
    }
    reverse (obj_vector.begin (),
             obj_vector.end ());
    <span style="color: #F0DFAF; font-weight: bold;">return</span> obj_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7f19563" class="outline-3">
<h3 id="org7f19563">local_scope_extend</h3>
<div class="outline-text-3" id="text-org7f19563">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">local_scope_t</span>
<span style="color: #93E0E3;">local_scope_extend</span> (<span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">old_local_scope</span>,
                    <span style="color: #7CB8BB;">bind_vector_t</span> <span style="color: #DFAF8F;">bind_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_scope</span> = old_local_scope;
    local_scope.push_back (bind_vector);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> local_scope;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org95e63eb" class="outline-3">
<h3 id="org95e63eb">bind_equal</h3>
<div class="outline-text-3" id="text-org95e63eb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">bind_equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
            <span style="color: #7CB8BB;">bind_t</span> &amp;<span style="color: #DFAF8F;">lhs</span>,
            <span style="color: #7CB8BB;">bind_t</span> &amp;<span style="color: #DFAF8F;">rhs</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lhs.first != rhs.first) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> lhs.second-&gt;equal (env, rhs.second);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9cd8cb3" class="outline-3">
<h3 id="org9cd8cb3">bind_vector_equal</h3>
<div class="outline-text-3" id="text-org9cd8cb3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">bind_vector_equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                   <span style="color: #7CB8BB;">bind_vector_t</span> &amp;<span style="color: #DFAF8F;">lhs</span>,
                   <span style="color: #7CB8BB;">bind_vector_t</span> &amp;<span style="color: #DFAF8F;">rhs</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lhs.size () != rhs.size ()) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = lhs.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">index</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (index &lt; size) {
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> bind_equal (env, lhs [index], rhs [index]))
            <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
        index++;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org80d166e" class="outline-3">
<h3 id="org80d166e">local_scope_equal</h3>
<div class="outline-text-3" id="text-org80d166e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">local_scope_equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                   <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">lhs</span>,
                   <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">rhs</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lhs.size () != rhs.size ()) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = lhs.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">index</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (index &lt; size) {
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> bind_vector_equal (env, lhs [index], rhs [index]))
            <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
        index++;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb717b6e" class="outline-3">
<h3 id="orgb717b6e">obj_map_equal</h3>
<div class="outline-text-3" id="text-orgb717b6e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">obj_map_equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">lhs</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">rhs</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lhs.size () != rhs.size ()) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: lhs) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = kv.first;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = rhs.find (name);
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (it == rhs.end ()) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> kv.second-&gt;equal (env, it-&gt;second)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge7ebd21" class="outline-3">
<h3 id="orge7ebd21">obj_map_repr</h3>
<div class="outline-text-3" id="text-orge7ebd21">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">obj_map_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: obj_map) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = kv.first;
        repr += name;
        repr += <span style="color: #CC9393;">" = "</span>;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = kv.second;
        repr += obj-&gt;repr (env);
        repr += <span style="color: #CC9393;">" "</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> repr.empty ()) repr.pop_back ();
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org32faee" class="outline-3">
<h3 id="org32faee">name_vector_obj_map_lack</h3>
<div class="outline-text-3" id="text-org32faee">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_vector_t</span>
<span style="color: #93E0E3;">name_vector_obj_map_lack</span> (<span style="color: #7CB8BB;">name_vector_t</span> &amp;<span style="color: #DFAF8F;">old_name_vector</span>,
                          <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = name_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span>: old_name_vector) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = obj_map.find (name);
        <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">not found == lack</span>
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (it == obj_map.end ())
            name_vector.push_back (name);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> name_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org75a6f5b" class="outline-3">
<h3 id="org75a6f5b">name_vector_obj_map_arity_lack</h3>
<div class="outline-text-3" id="text-org75a6f5b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_vector_t</span>
<span style="color: #93E0E3;">name_vector_obj_map_arity_lack</span> (<span style="color: #7CB8BB;">name_vector_t</span> &amp;<span style="color: #DFAF8F;">old_name_vector</span>,
                                <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>,
                                <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = name_vector_obj_map_lack
        (old_name_vector, obj_map);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack</span> = name_vector.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">counter</span> = lack - arity;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (counter &gt; 0) {
        counter--;
        name_vector.pop_back ();
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> name_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd0afb36" class="outline-3">
<h3 id="orgd0afb36">pick_up_obj_map_and_merge</h3>
<div class="outline-text-3" id="text-orgd0afb36">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">obj_map_t</span>
<span style="color: #93E0E3;">pick_up_obj_map_and_merge</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                           <span style="color: #7CB8BB;">name_vector_t</span> &amp;<span style="color: #DFAF8F;">lack_name_vector</span>,
                           <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">old_obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = old_obj_map;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = lack_name_vector.rbegin ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = lack_name_vector.rend ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++) {
        <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span> = *it;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
        env.obj_stack.pop ();
        obj_map [name] = obj;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> obj_map;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc5ff666" class="outline-3">
<h3 id="orgc5ff666">name_vector_and_obj_map_repr</h3>
<div class="outline-text-3" id="text-orgc5ff666">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">name_vector_and_obj_map_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                              <span style="color: #7CB8BB;">name_vector_t</span> &amp;<span style="color: #DFAF8F;">name_vector</span>,
                              <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">name</span>: name_vector) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = obj_map.find (name);
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (it == obj_map.end ()) {
            repr += name;
            repr += <span style="color: #CC9393;">" = _ "</span>;
        }
    }
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: obj_map) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = kv.first;
        repr += name;
        repr += <span style="color: #CC9393;">" = "</span>;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = kv.second;
        repr += obj-&gt;repr (env);
        repr += <span style="color: #CC9393;">" "</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> repr.empty ()) repr.pop_back ();
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org920a63b" class="outline-3">
<h3 id="org920a63b">vector_rev_ref</h3>
<div class="outline-text-3" id="text-org920a63b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">template</span> &lt;<span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">T</span>&gt;
<span style="color: #7CB8BB;">T</span>
<span style="color: #93E0E3;">vector_rev_ref</span> (<span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">T</span>&gt; <span style="color: #DFAF8F;">vect</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">rev_index</span>)
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">size</span> = vect.size ();
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span> = size - rev_index - 1;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> vect [index];
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6c189f5" class="outline-3">
<h3 id="org6c189f5">bind_vector_from_name_vector</h3>
<div class="outline-text-3" id="text-org6c189f5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bind_vector_t</span>
<span style="color: #93E0E3;">bind_vector_from_name_vector</span> (<span style="color: #7CB8BB;">name_vector_t</span> &amp;<span style="color: #DFAF8F;">name_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bind_vector</span> = bind_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = name_vector.begin ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = name_vector.end ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++)
        bind_vector.push_back (make_pair (*it, <span style="color: #BFEBBF;">nullptr</span>));
    <span style="color: #F0DFAF; font-weight: bold;">return</span> bind_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3a2e933" class="outline-3">
<h3 id="org3a2e933">new_frame_from_jojo</h3>
<div class="outline-text-3" id="text-org3a2e933">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">frame_t</span>&gt;
<span style="color: #93E0E3;">new_frame_from_jojo</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">frame_t</span>&gt;
        (jojo, <span style="color: #7CB8BB;">local_scope_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5231034" class="outline-3">
<h3 id="org5231034">new_frame_from_jo_vector</h3>
<div class="outline-text-3" id="text-org5231034">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">frame_t</span>&gt;
<span style="color: #93E0E3;">new_frame_from_jo_vector</span> (<span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">frame_t</span>&gt;
        (jojo, <span style="color: #7CB8BB;">local_scope_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4d1bf9" class="outline-3">
<h3 id="org4d1bf9">obj_equal</h3>
<div class="outline-text-3" id="text-org4d1bf9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">obj_equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
           <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; &amp;<span style="color: #DFAF8F;">lhs</span>,
           <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; &amp;<span style="color: #DFAF8F;">rhs</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> lhs-&gt;equal (env, rhs);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org56ac85e" class="outline-3">
<h3 id="org56ac85e">about predicate</h3>
<div class="outline-text-3" id="text-org56ac85e">
</div><div id="outline-container-org8f2b292" class="outline-4">
<h4 id="org8f2b292">closure_p</h4>
<div class="outline-text-4" id="text-org8f2b292">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">closure_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == <span style="color: #CC9393;">"closure-t"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgffdcaa" class="outline-4">
<h4 id="orgffdcaa">type_p</h4>
<div class="outline-text-4" id="text-orgffdcaa">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">type_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == <span style="color: #CC9393;">"type-t"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb6ab95d" class="outline-3">
<h3 id="orgb6ab95d">about assert</h3>
<div class="outline-text-3" id="text-orgb6ab95d">
</div><div id="outline-container-orge93919e" class="outline-4">
<h4 id="orge93919e">assert_pop_eq</h4>
<div class="outline-text-4" id="text-orge93919e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">assert_pop_eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = env.obj_stack.top ();
    assert (obj-&gt;equal (env, that));
    env.obj_stack.pop ();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org48b8676" class="outline-4">
<h4 id="org48b8676">assert_tos_eq</h4>
<div class="outline-text-4" id="text-org48b8676">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">assert_tos_eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = env.obj_stack.top ();
    assert (obj-&gt;equal (env, that));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org35c8d24" class="outline-4">
<h4 id="org35c8d24">assert_stack_size</h4>
<div class="outline-text-4" id="text-org35c8d24">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">assert_stack_size</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">size</span>)
{
    assert (env.obj_stack.size () == size);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgff8ca1a" class="outline-3">
<h3 id="orgff8ca1a">define</h3>
<div class="outline-text-3" id="text-orgff8ca1a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">define</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
        <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>,
        <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.box_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.box_map.end ()) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = it-&gt;second;
        box-&gt;empty_p = <span style="color: #BFEBBF;">false</span>;
        box-&gt;obj = obj;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        env.box_map [name] = <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">box_t</span> (obj);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org709eeb8" class="outline-3">
<h3 id="org709eeb8">sig_t</h3>
<div class="outline-text-3" id="text-org709eeb8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">sig_t</span> = name_vector_t;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgea95cc6" class="outline-3">
<h3 id="orgea95cc6">name_of_sig</h3>
<div class="outline-text-3" id="text-orgea95cc6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_t</span>
<span style="color: #93E0E3;">name_of_sig</span> (<span style="color: #7CB8BB;">sig_t</span> &amp;<span style="color: #DFAF8F;">sig</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> sig [0];
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgddc81eb" class="outline-3">
<h3 id="orgddc81eb">name_vector_of_sig</h3>
<div class="outline-text-3" id="text-orgddc81eb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_vector_t</span>
<span style="color: #93E0E3;">name_vector_of_sig</span> (<span style="color: #7CB8BB;">sig_t</span> &amp;<span style="color: #DFAF8F;">sig</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = name_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = sig.begin () + 1;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = sig.end ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++) {
        name_vector.push_back (*it);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> name_vector;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge1278e0" class="outline-2">
<h2 id="orge1278e0">obj</h2>
<div class="outline-text-2" id="text-orge1278e0">
</div><div id="outline-container-org859c20b" class="outline-3">
<h3 id="org859c20b">obj_t::~obj_t</h3>
<div class="outline-text-3" id="text-org859c20b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">obj_t</span>::~<span style="color: #93E0E3;">obj_t</span> ()
{
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">all classes that will be derived from</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">should have a virtual or protected destructor,</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">otherwise deleting an instance via a pointer</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">to a base class results in undefined behavior.</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9768a95" class="outline-3">
<h3 id="org9768a95">obj_t::repr</h3>
<div class="outline-text-3" id="text-org9768a95">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">obj_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"#&lt;"</span> + <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag + <span style="color: #CC9393;">"&gt;"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb049f46" class="outline-3">
<h3 id="orgb049f46">obj_t::equal</h3>
<div class="outline-text-3" id="text-orgb049f46">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">obj_t</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : obj_t::equal"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  equal is not implemented for  : "</span>
             &lt;&lt; obj-&gt;tag &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeb0f84" class="outline-3">
<h3 id="orgeb0f84">obj_t::apply</h3>
<div class="outline-text-3" id="text-orgeb0f84">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">obj_t</span>::<span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>)
{
    cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : applying non applicable object"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    exit (1);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org45f990d" class="outline-2">
<h2 id="org45f990d">env</h2>
<div class="outline-text-2" id="text-org45f990d">
</div><div id="outline-container-orga9281c1" class="outline-3">
<h3 id="orga9281c1">frame</h3>
<div class="outline-text-3" id="text-orga9281c1">
</div><div id="outline-container-org65e6d53" class="outline-4">
<h4 id="org65e6d53">frame_t::frame_t</h4>
<div class="outline-text-4" id="text-org65e6d53">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">frame_t</span>::<span style="color: #93E0E3;">frame_t</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>,
                  <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;index = 0;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo = jojo;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;local_scope = local_scope;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8e57e0f" class="outline-4">
<h4 id="org8e57e0f">jojo_print</h4>
<div class="outline-text-4" id="text-org8e57e0f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">jojo_print</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">jo</span>: jojo-&gt;jo_vector) {
        cout &lt;&lt; jo-&gt;repr (env)
             &lt;&lt; <span style="color: #CC9393;">" "</span>;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7dc89a2" class="outline-4">
<h4 id="org7dc89a2">jojo_print_with_index</h4>
<div class="outline-text-4" id="text-org7dc89a2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">jojo_print_with_index</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                       <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>,
                       <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = jojo-&gt;jo_vector.begin ();
         it != jojo-&gt;jo_vector.end ();
         it++) {
        <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">it_index</span> = it - jojo-&gt;jo_vector.begin ();
        <span style="color: #7CB8BB;">jo_t</span> *<span style="color: #DFAF8F;">jo</span> = *it;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (index == it_index) {
            cout &lt;&lt; <span style="color: #CC9393;">"-&gt;&gt; "</span> &lt;&lt; jo-&gt;repr (env) &lt;&lt; <span style="color: #CC9393;">" "</span>;
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> {
            cout &lt;&lt; jo-&gt;repr (env) &lt;&lt; <span style="color: #CC9393;">" "</span>;
        }
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org462129" class="outline-4">
<h4 id="org462129">frame_report</h4>
<div class="outline-text-4" id="text-org462129">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">frame_report</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">frame_t</span>&gt; <span style="color: #DFAF8F;">frame</span>)
{
    cout &lt;&lt; <span style="color: #CC9393;">"  - ["</span> &lt;&lt; frame-&gt;index+1
         &lt;&lt; <span style="color: #CC9393;">"/"</span> &lt;&lt; frame-&gt;jojo-&gt;jo_vector.size ()
         &lt;&lt; <span style="color: #CC9393;">"] "</span>;
    jojo_print_with_index (env, frame-&gt;jojo, frame-&gt;index);
    cout &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    cout &lt;&lt; local_scope_repr (env, frame-&gt;local_scope);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org49064fb" class="outline-3">
<h3 id="org49064fb">box</h3>
<div class="outline-text-3" id="text-org49064fb">
</div><div id="outline-container-org3dc1ecb" class="outline-4">
<h4 id="org3dc1ecb">box_t::box_t</h4>
<div class="outline-text-4" id="text-org3dc1ecb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">box_t</span>::<span style="color: #93E0E3;">box_t</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;empty_p = <span style="color: #BFEBBF;">true</span>;
}

<span style="color: #BFEBBF;">box_t</span>::<span style="color: #93E0E3;">box_t</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;empty_p = <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj = obj;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org95914c9" class="outline-4">
<h4 id="org95914c9">boxing</h4>
<div class="outline-text-4" id="text-org95914c9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">box_t</span> *
<span style="color: #93E0E3;">boxing</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.box_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.box_map.end ()) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> box;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">box_t</span> ();
        env.box_map [name] = box;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> box;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8646580" class="outline-4">
<h4 id="org8646580">name_of_box</h4>
<div class="outline-text-4" id="text-org8646580">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_t</span>
<span style="color: #93E0E3;">name_of_box</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: env.box_map) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = kv.first;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (kv.second == box) {
            <span style="color: #F0DFAF; font-weight: bold;">return</span> name;
        }
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"#non-name"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd776b7f" class="outline-3">
<h3 id="orgd776b7f">env_t::step</h3>
<div class="outline-text-3" id="text-orgd776b7f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">step</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">frame</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;frame_stack.top ();
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">size</span> = frame-&gt;jojo-&gt;jo_vector.size ();
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">it is assumed that jojo in frame are not empty</span>
    assert (size != 0);
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span> = frame-&gt;index;
    frame-&gt;index++;
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">handle proper tail call</span>
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (index+1 == size) <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;frame_stack.pop ();
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">since the last frame might be drop,</span>
    <span style="color: #5F7F5F;">//   </span><span style="color: #7F9F7F;">we pass last local_scope as an extra argument.</span>
    frame-&gt;jojo-&gt;jo_vector[index]-&gt;exe (*<span style="color: #F0DFAF; font-weight: bold;">this</span>, frame-&gt;local_scope);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4822bcd" class="outline-3">
<h3 id="org4822bcd">env_t::run</h3>
<div class="outline-text-3" id="text-org4822bcd">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">run</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span><span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;frame_stack.empty ()) {
        <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;step ();
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1a2fb57" class="outline-3">
<h3 id="org1a2fb57">env_t::box_map_report</h3>
<div class="outline-text-3" id="text-org1a2fb57">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">box_map_report</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">env</span> = *<span style="color: #F0DFAF; font-weight: bold;">this</span>;
    cout &lt;&lt; <span style="color: #CC9393;">"- ["</span> &lt;&lt; env.box_map.size () &lt;&lt; <span style="color: #CC9393;">"] "</span>
         &lt;&lt; <span style="color: #CC9393;">"box_map - "</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: env.box_map) {
        cout &lt;&lt; <span style="color: #CC9393;">"  "</span> &lt;&lt; kv.first &lt;&lt; <span style="color: #CC9393;">" = "</span>;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = kv.second;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (box-&gt;empty_p)
            cout &lt;&lt; <span style="color: #CC9393;">"_"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">else</span>
            cout &lt;&lt; box-&gt;obj-&gt;repr (env);
        cout &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org399f1c4" class="outline-3">
<h3 id="org399f1c4">env_t::frame_stack_report</h3>
<div class="outline-text-3" id="text-org399f1c4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">frame_stack_report</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">env</span> = *<span style="color: #F0DFAF; font-weight: bold;">this</span>;
    cout &lt;&lt; <span style="color: #CC9393;">"- ["</span> &lt;&lt; env.frame_stack.size () &lt;&lt; <span style="color: #CC9393;">"] "</span>
         &lt;&lt; <span style="color: #CC9393;">"frame_stack - "</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    <span style="color: #7CB8BB;">frame_stack_t</span> <span style="color: #DFAF8F;">frame_stack</span> = env.frame_stack;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> frame_stack.empty ()) {
       <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">frame</span> = frame_stack.top ();
       frame_report (env, frame);
       frame_stack.pop ();
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3121036" class="outline-3">
<h3 id="org3121036">env_t::obj_stack_report</h3>
<div class="outline-text-3" id="text-org3121036">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">obj_stack_report</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">env</span> = *<span style="color: #F0DFAF; font-weight: bold;">this</span>;
    cout &lt;&lt; <span style="color: #CC9393;">"- ["</span> &lt;&lt; env.obj_stack.size () &lt;&lt; <span style="color: #CC9393;">"] "</span>
         &lt;&lt; <span style="color: #CC9393;">"obj_stack - "</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_stack</span> = env.obj_stack;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> obj_stack.empty ()) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = obj_stack.top ();
        cout &lt;&lt; <span style="color: #CC9393;">"  "</span>;
        cout &lt;&lt; obj-&gt;repr (env);
        cout &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        obj_stack.pop ();
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf68e649" class="outline-3">
<h3 id="orgf68e649">env_t::report</h3>
<div class="outline-text-3" id="text-orgf68e649">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">report</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;box_map_report ();
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;frame_stack_report ();
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_stack_report ();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf7b0d1" class="outline-3">
<h3 id="orgf7b0d1">env_t::run_with_base</h3>
<div class="outline-text-3" id="text-orgf7b0d1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">run_with_base</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">base</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;frame_stack.size () &gt; base) {
        <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;step ();
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6afe983" class="outline-3">
<h3 id="org6afe983">env_t::double_report</h3>
<div class="outline-text-3" id="text-org6afe983">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">double_report</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;report ();
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;run ();
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;report ();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd478426" class="outline-3">
<h3 id="orgd478426">env_t::step_and_report</h3>
<div class="outline-text-3" id="text-orgd478426">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">step_and_report</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;step ();
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;report ();
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3bc9696" class="outline-2">
<h2 id="org3bc9696">closure</h2>
<div class="outline-text-2" id="text-org3bc9696">
</div><div id="outline-container-orgb76c3a5" class="outline-3">
<h3 id="orgb76c3a5">closure_o</h3>
<div class="outline-text-3" id="text-orgb76c3a5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">closure_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>;
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>;
    <span style="color: #7CB8BB;">bind_vector_t</span> <span style="color: #DFAF8F;">bind_vector</span>;
    <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>;
    <span style="color: #93E0E3;">closure_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
               <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
               <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>,
               <span style="color: #7CB8BB;">bind_vector_t</span> <span style="color: #DFAF8F;">bind_vector</span>,
               <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org47e7384" class="outline-3">
<h3 id="org47e7384">closure_o::apply</h3>
<div class="outline-text-3" id="text-org47e7384">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">closure_o</span>::<span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">have</span> = number_of_obj_in_bind_vector (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;bind_vector);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack</span> = size - have;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lack == arity) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_vector</span> = pick_up_obj_vector
            (env, arity);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bind_vector</span> = bind_vector_merge_obj_vector
             (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;bind_vector, obj_vector);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_scope</span> = local_scope_extend
            (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;local_scope, bind_vector);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">frame</span> = make_shared &lt;<span style="color: #7CB8BB;">frame_t</span>&gt;
            (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo, local_scope);
        env.frame_stack.push (frame);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (arity &lt; lack) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_vector</span> = pick_up_obj_vector
            (env, arity);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bind_vector</span> = bind_vector_merge_obj_vector
            (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;bind_vector, obj_vector);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">closure</span> = make_shared &lt;closure_o&gt;
            (env,
             <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector,
             <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo,
             bind_vector,
             <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;local_scope);
        env.obj_stack.push (closure);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : closure_o::apply"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  over-arity apply"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  arity &gt; lack"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  arity : "</span> &lt;&lt; arity &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  lack : "</span> &lt;&lt; lack &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc28b0a5" class="outline-3">
<h3 id="orgc28b0a5">closure_o::closure_o</h3>
<div class="outline-text-3" id="text-orgc28b0a5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">closure_o</span>::
<span style="color: #93E0E3;">closure_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
           <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
           <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>,
           <span style="color: #7CB8BB;">bind_vector_t</span> <span style="color: #DFAF8F;">bind_vector</span>,
           <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = <span style="color: #CC9393;">"closure-t"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector = name_vector;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo = jojo;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;bind_vector = bind_vector;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;local_scope = local_scope;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2d3b76a" class="outline-3">
<h3 id="org2d3b76a">closure_o::equal</h3>
<div class="outline-text-3" id="text-org2d3b76a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">closure_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">raw pointers must be equal first</span>
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span> != obj.get ()) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;closure_o&gt; (obj);
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">then scopes</span>
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (local_scope_equal
        (env,
         <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;local_scope,
         that-&gt;local_scope)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">then bindings</span>
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (bind_vector_equal
        (env,
         <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;bind_vector,
         that-&gt;bind_vector)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7c3c6f9" class="outline-3">
<h3 id="org7c3c6f9">closure_o::repr</h3>
<div class="outline-text-3" id="text-org7c3c6f9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">closure_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"(closure "</span>;
    repr += name_vector_repr (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector);
    repr += <span style="color: #CC9393;">" "</span>;
    repr += jojo_repr (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo);
    repr += <span style="color: #CC9393;">"\n"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_scope</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;local_scope;
    local_scope.push_back (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;bind_vector);
    repr += local_scope_repr (env, local_scope);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> repr.empty ()) repr.pop_back ();
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> repr.empty ()) repr.pop_back ();
    repr += <span style="color: #CC9393;">")"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd7d8f20" class="outline-2">
<h2 id="orgd7d8f20">data</h2>
<div class="outline-text-2" id="text-orgd7d8f20">
</div><div id="outline-container-orgcbbec96" class="outline-3">
<h3 id="orgcbbec96">data_o</h3>
<div class="outline-text-3" id="text-orgcbbec96">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">data_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #93E0E3;">data_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
            <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag</span>,
            <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb577b36" class="outline-3">
<h3 id="orgb577b36">data_o::data_o</h3>
<div class="outline-text-3" id="text-orgb577b36">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">data_o</span>::
<span style="color: #93E0E3;">data_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
        <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag</span>,
        <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = tag;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map = obj_map;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1b5f596" class="outline-3">
<h3 id="org1b5f596">data_o::equal</h3>
<div class="outline-text-3" id="text-org1b5f596">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">data_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;data_o&gt; (obj);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> obj_map_equal (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map, that-&gt;obj_map);

}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge7a7432" class="outline-3">
<h3 id="orge7a7432">data_o::repr</h3>
<div class="outline-text-3" id="text-orge7a7432">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">data_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map.size () == 0) {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
        repr += <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag;
        repr.pop_back ();
        repr.pop_back ();
        repr += <span style="color: #CC9393;">"-c"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"("</span>;
        repr += <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag;
        repr.pop_back ();
        repr.pop_back ();
        repr += <span style="color: #CC9393;">"-c "</span>;
        repr += obj_map_repr (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        repr += <span style="color: #CC9393;">")"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org24cb43c" class="outline-2">
<h2 id="org24cb43c">data_cons</h2>
<div class="outline-text-2" id="text-org24cb43c">
</div><div id="outline-container-orgcd94edb" class="outline-3">
<h3 id="orgcd94edb">data_cons_o</h3>
<div class="outline-text-3" id="text-orgcd94edb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">data_cons_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">type_tag</span>;
    <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>;
    <span style="color: #93E0E3;">data_cons_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                 <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">type_tag</span>,
                 <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
                 <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>);
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org6f8f44c" class="outline-3">
<h3 id="org6f8f44c">data_cons_o::data_cons_o</h3>
<div class="outline-text-3" id="text-org6f8f44c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">data_cons_o</span>::
<span style="color: #93E0E3;">data_cons_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
             <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">type_tag</span>,
             <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
             <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = <span style="color: #CC9393;">"data-cons-t"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;type_tag = type_tag;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector = name_vector;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map = obj_map;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org46b0246" class="outline-3">
<h3 id="org46b0246">data_cons_o::apply</h3>
<div class="outline-text-3" id="text-org46b0246">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">data_cons_o</span>::<span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">have</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack</span> = size - have;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lack == arity) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack_name_vector</span> = name_vector_obj_map_lack
            (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = pick_up_obj_map_and_merge
            (env, lack_name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">data</span> = make_shared &lt;data_o&gt;
            (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;type_tag, obj_map);
        env.obj_stack.push (data);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (arity &lt; lack) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack_name_vector</span> = name_vector_obj_map_arity_lack
            (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map, arity);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = pick_up_obj_map_and_merge
            (env, lack_name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">data_cons</span> = make_shared &lt;data_cons_o&gt;
            (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;type_tag, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, obj_map);
        env.obj_stack.push (data_cons);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : data_cons_o::apply"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  over-arity apply"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  arity &gt; lack"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  arity : "</span> &lt;&lt; arity &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  lack : "</span> &lt;&lt; lack &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd693ee8" class="outline-3">
<h3 id="orgd693ee8">data_cons_o::equal</h3>
<div class="outline-text-3" id="text-orgd693ee8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">data_cons_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;data_cons_o&gt; (obj);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;type_tag != that-&gt;type_tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> obj_map_equal (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map, that-&gt;obj_map);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9908529" class="outline-3">
<h3 id="org9908529">data_cons_o::repr</h3>
<div class="outline-text-3" id="text-org9908529">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">data_cons_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector.size () == 0) {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
        repr += <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;type_tag;
        repr.pop_back ();
        repr.pop_back ();
        repr += <span style="color: #CC9393;">"-c"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"("</span>;
        repr += <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;type_tag;
        repr.pop_back ();
        repr.pop_back ();
        repr += <span style="color: #CC9393;">"-c "</span>;
        repr += name_vector_and_obj_map_repr
            (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        repr += <span style="color: #CC9393;">")"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga18fb8e" class="outline-2">
<h2 id="orga18fb8e">prim</h2>
<div class="outline-text-2" id="text-orga18fb8e">
</div><div id="outline-container-org5b8f4ad" class="outline-3">
<h3 id="org5b8f4ad">prim_fn</h3>
<div class="outline-text-3" id="text-org5b8f4ad">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">prim_fn</span> = <span style="color: #7CB8BB;">function</span>
    &lt;<span style="color: #7CB8BB;">void</span> (<span style="color: #7CB8BB;">env_t</span> &amp;, <span style="color: #7CB8BB;">obj_map_t</span> &amp;)&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb8ead37" class="outline-3">
<h3 id="orgb8ead37">prim_o</h3>
<div class="outline-text-3" id="text-orgb8ead37">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">prim_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>;
    <span style="color: #7CB8BB;">prim_fn</span> <span style="color: #DFAF8F;">fn</span>;
    <span style="color: #93E0E3;">prim_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
            <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
            <span style="color: #7CB8BB;">prim_fn</span> <span style="color: #DFAF8F;">fn</span>,
            <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org193bb4a" class="outline-3">
<h3 id="org193bb4a">prim_o::prim_o</h3>
<div class="outline-text-3" id="text-org193bb4a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">prim_o</span>::<span style="color: #93E0E3;">prim_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
                <span style="color: #7CB8BB;">prim_fn</span> <span style="color: #DFAF8F;">fn</span>,
                <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = <span style="color: #CC9393;">"prim-t"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector = name_vector;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;fn = fn;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map = obj_map;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3f592db" class="outline-3">
<h3 id="org3f592db">prim_o::repr</h3>
<div class="outline-text-3" id="text-org3f592db">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">prim_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector.size () == 0) {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"(prim)"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"(prim "</span>;
        repr += name_vector_and_obj_map_repr
            (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        repr += <span style="color: #CC9393;">")"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org62217b3" class="outline-3">
<h3 id="org62217b3">prim_o::equal</h3>
<div class="outline-text-3" id="text-org62217b3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span> <span style="color: #BFEBBF;">prim_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;prim_o&gt; (obj);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span> != obj.get ()) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> obj_map_equal (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map, that-&gt;obj_map);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd64be8f" class="outline-3">
<h3 id="orgd64be8f">prim_o::apply</h3>
<div class="outline-text-3" id="text-orgd64be8f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span> <span style="color: #BFEBBF;">prim_o</span>::<span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">have</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack</span> = size - have;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lack == arity) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack_name_vector</span> = name_vector_obj_map_lack
            (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = pick_up_obj_map_and_merge
            (env, lack_name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;fn (env, obj_map);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (arity &lt; lack) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack_name_vector</span> = name_vector_obj_map_arity_lack
            (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map, arity);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = pick_up_obj_map_and_merge
            (env, lack_name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">prim</span> = make_shared &lt;prim_o&gt;
            (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;fn, obj_map);
        env.obj_stack.push (prim);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : prim_o::apply"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  over-arity apply"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  arity &gt; lack"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  arity : "</span> &lt;&lt; arity &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  lack : "</span> &lt;&lt; lack &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbecb000" class="outline-3">
<h3 id="orgbecb000">define_prim</h3>
<div class="outline-text-3" id="text-orgbecb000">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">define_prim</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">sig</span>, <span style="color: #7CB8BB;">prim_fn</span> <span style="color: #DFAF8F;">fn</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = name_of_sig (sig);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = name_vector_of_sig (sig);
    define (env, name, make_shared &lt;prim_o&gt;
            (env, name_vector, fn, <span style="color: #7CB8BB;">obj_map_t</span> ()));
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb2d2638" class="outline-2">
<h2 id="orgb2d2638">type</h2>
<div class="outline-text-2" id="text-orgb2d2638">
</div><div id="outline-container-orgab546f3" class="outline-3">
<h3 id="orgab546f3">type_o</h3>
<div class="outline-text-3" id="text-orgab546f3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">type_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">type_tag</span>;
    <span style="color: #93E0E3;">type_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
            <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">type_tag</span>,
            <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org318dfb4" class="outline-3">
<h3 id="org318dfb4">type_o::type_o</h3>
<div class="outline-text-3" id="text-org318dfb4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">type_o</span>::<span style="color: #93E0E3;">type_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">type_tag</span>,
                <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = <span style="color: #CC9393;">"type-t"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;type_tag = type_tag;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map = obj_map;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5479472" class="outline-3">
<h3 id="org5479472">type_o::repr</h3>
<div class="outline-text-3" id="text-org5479472">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">type_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;type_tag;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1826aee" class="outline-3">
<h3 id="org1826aee">type_o::equal</h3>
<div class="outline-text-3" id="text-org1826aee">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">type_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;type_o&gt; (obj);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;type_tag != that-&gt;type_tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org76213c6" class="outline-3">
<h3 id="org76213c6">assign</h3>
<div class="outline-text-3" id="text-org76213c6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">assign</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
        <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">prefix</span>,
        <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>,
        <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (prefix == <span style="color: #CC9393;">""</span>) {
        define (env, name, obj);
        <span style="color: #F0DFAF; font-weight: bold;">return</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.box_map.find (prefix + <span style="color: #CC9393;">"-t"</span>);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.box_map.end ()) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = it-&gt;second;
        assert (<span style="color: #F0DFAF; font-weight: bold;">!</span> box-&gt;empty_p);
        assert (type_p (env, box-&gt;obj));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">type</span> = static_pointer_cast &lt;type_o&gt; (box-&gt;obj);
        type-&gt;obj_map [name] = obj;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : assign fail"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  unknown prefix : "</span> &lt;&lt; prefix &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org82f19a6" class="outline-3">
<h3 id="org82f19a6">tag_name_p</h3>
<div class="outline-text-3" id="text-org82f19a6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">tag_name_p</span> (<span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = name.size ();
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (size &lt; 3) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (name [size - 1] != <span style="color: #DCDCCC; background-color: #3F3F3F;">'t</span><span style="color: #D0BF8F; font-weight: bold;">'</span>) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (name [size - 2] != <span style="color: #DCDCCC; background-color: #3F3F3F;">'-</span><span style="color: #D0BF8F; font-weight: bold;">'</span>) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgce2fd7e" class="outline-3">
<h3 id="orgce2fd7e">define_type</h3>
<div class="outline-text-3" id="text-orgce2fd7e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">define_type</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    define (env, name, make_shared &lt;type_o&gt;
            (env, name, <span style="color: #7CB8BB;">obj_map_t</span> ()));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4fb6a38" class="outline-3">
<h3 id="org4fb6a38">jj_typeof</h3>
<div class="outline-text-3" id="text-org4fb6a38">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_typeof_sig</span> = { <span style="color: #CC9393;">"typeof"</span>, <span style="color: #CC9393;">"obj"</span> };
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_typeof</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = obj_map [<span style="color: #CC9393;">"obj"</span>];
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it_box</span> = env.box_map.find (obj-&gt;tag);
    assert (it_box != env.box_map.end ());
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = it_box-&gt;second;
    env.obj_stack.push (box-&gt;obj);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3c4d0b0" class="outline-3">
<h3 id="org3c4d0b0">import_type</h3>
<div class="outline-text-3" id="text-org3c4d0b0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_type</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_type (env, <span style="color: #CC9393;">"type-t"</span>);
    define_prim (env,
                 jj_typeof_sig,
                 jj_typeof);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd45546f" class="outline-3">
<h3 id="orgd45546f">test_type</h3>
<div class="outline-text-3" id="text-orgd45546f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_type</span> ()
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgab9d6fd" class="outline-2">
<h2 id="orgab9d6fd">jojo</h2>
<div class="outline-text-2" id="text-orgab9d6fd">
</div><div id="outline-container-org28594df" class="outline-3">
<h3 id="org28594df">jojo_t::jojo_t</h3>
<div class="outline-text-3" id="text-org28594df">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">jojo_t</span>::
<span style="color: #93E0E3;">jojo_t</span> (<span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jo_vector = jo_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5dd74ed" class="outline-3">
<h3 id="org5dd74ed">jojo_t::~jojo_t</h3>
<div class="outline-text-3" id="text-org5dd74ed">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">jojo_t</span>::
~<span style="color: #93E0E3;">jojo_t</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #7CB8BB;">jo_t</span> *<span style="color: #DFAF8F;">jo_ptr</span>: <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jo_vector)
        <span style="color: #F0DFAF; font-weight: bold;">delete</span> jo_ptr;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc406b3a" class="outline-2">
<h2 id="orgc406b3a">jo</h2>
<div class="outline-text-2" id="text-orgc406b3a">
</div><div id="outline-container-orga54dbd5" class="outline-3">
<h3 id="orga54dbd5">jo_t::copy</h3>
<div class="outline-text-3" id="text-orga54dbd5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : jo_t::copy unknown jo"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    exit (1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc795804" class="outline-3">
<h3 id="orgc795804">jo_t::~jo_t</h3>
<div class="outline-text-3" id="text-orgc795804">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">jo_t</span>::~<span style="color: #93E0E3;">jo_t</span> ()
{
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">all classes that will be derived from</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">should have a virtual or protected destructor,</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">otherwise deleting an instance via a pointer</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">to a base class results in undefined behavior.</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org172306a" class="outline-3">
<h3 id="org172306a">jo_t::exe</h3>
<div class="outline-text-3" id="text-org172306a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : unknown jo"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    exit (1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3fc1ade" class="outline-3">
<h3 id="org3fc1ade">jo_t::repr</h3>
<div class="outline-text-3" id="text-org3fc1ade">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"#&lt;unknown-jo&gt;"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org471143f" class="outline-2">
<h2 id="org471143f">about jo</h2>
<div class="outline-text-2" id="text-org471143f">
</div><div id="outline-container-org8ccf4ed" class="outline-3">
<h3 id="org8ccf4ed">ref_jo</h3>
<div class="outline-text-3" id="text-org8ccf4ed">
</div><div id="outline-container-org6e42ec0" class="outline-4">
<h4 id="org6e42ec0">ref_jo_t</h4>
<div class="outline-text-4" id="text-org6e42ec0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">ref_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span>;
    <span style="color: #93E0E3;">ref_jo_t</span> (<span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span>);
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgacaefeb" class="outline-4">
<h4 id="orgacaefeb">ref_jo_t::ref_jo_t</h4>
<div class="outline-text-4" id="text-orgacaefeb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">ref_jo_t</span>::<span style="color: #93E0E3;">ref_jo_t</span> (<span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;box = box;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge14dda8" class="outline-4">
<h4 id="orge14dda8">ref_jo_t::copy</h4>
<div class="outline-text-4" id="text-orge14dda8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">ref_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;box);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3a65082" class="outline-4">
<h4 id="org3a65082">ref_jo_t::exe</h4>
<div class="outline-text-4" id="text-org3a65082">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">ref_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;box-&gt;empty_p) {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : ref_jo_t::exe fail"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  undefined name : "</span>
             &lt;&lt; name_of_box (env, box) &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        env.obj_stack.push (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;box-&gt;obj);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge81ec3d" class="outline-4">
<h4 id="orge81ec3d">ref_jo_t::repr</h4>
<div class="outline-text-4" id="text-orge81ec3d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">ref_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> name_of_box (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;box);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge918777" class="outline-3">
<h3 id="orge918777">local_ref_jo</h3>
<div class="outline-text-3" id="text-orge918777">
</div><div id="outline-container-orgdc692f" class="outline-4">
<h4 id="orgdc692f">local_ref_jo_t</h4>
<div class="outline-text-4" id="text-orgdc692f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">local_ref_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">level</span>;
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span>;
    <span style="color: #93E0E3;">local_ref_jo_t</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">level</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span>);
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org2940b7c" class="outline-4">
<h4 id="org2940b7c">local_ref_jo_t::local_ref_jo_t</h4>
<div class="outline-text-4" id="text-org2940b7c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">local_ref_jo_t</span>::
<span style="color: #93E0E3;">local_ref_jo_t</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">level</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;level = level;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;index = index;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org47876ab" class="outline-4">
<h4 id="org47876ab">local_ref_jo_t::copy</h4>
<div class="outline-text-4" id="text-org47876ab">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">local_ref_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">local_ref_jo_t</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;level, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;index);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb15a81f" class="outline-4">
<h4 id="orgb15a81f">local_ref_jo_t::exe</h4>
<div class="outline-text-4" id="text-orgb15a81f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">local_ref_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">this is the only place where</span>
    <span style="color: #5F7F5F;">//   </span><span style="color: #7F9F7F;">the local_scope in the arg of exe is uesd.</span>
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bind_vector</span> =
        vector_rev_ref (local_scope, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;level);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bind</span> =
        vector_rev_ref (bind_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;index);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = bind.second;
    env.obj_stack.push (obj);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgabef51a" class="outline-4">
<h4 id="orgabef51a">local_ref_jo_t::repr</h4>
<div class="outline-text-4" id="text-orgabef51a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">local_ref_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"local."</span> +
        to_string (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;level) + <span style="color: #CC9393;">"."</span> +
        to_string (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;index);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgbd09d56" class="outline-3">
<h3 id="orgbd09d56">field_jo</h3>
<div class="outline-text-3" id="text-orgbd09d56">
</div><div id="outline-container-org25f393e" class="outline-4">
<h4 id="org25f393e">field_jo_t</h4>
<div class="outline-text-4" id="text-org25f393e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">field_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>;
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #93E0E3;">field_jo_t</span> (<span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>);
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org1512c90" class="outline-4">
<h4 id="org1512c90">field_jo_t::field_jo_t</h4>
<div class="outline-text-4" id="text-org1512c90">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">field_jo_t</span>::<span style="color: #93E0E3;">field_jo_t</span> (<span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name = name;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5ccd218" class="outline-4">
<h4 id="org5ccd218">field_jo_t::copy</h4>
<div class="outline-text-4" id="text-org5ccd218">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">field_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge1361cc" class="outline-4">
<h4 id="orge1361cc">field_jo_t::exe</h4>
<div class="outline-text-4" id="text-orge1361cc">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">field_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
    env.obj_stack.pop ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = obj-&gt;obj_map.find (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != obj-&gt;obj_map.end ()) {
        env.obj_stack.push (it-&gt;second);
        <span style="color: #F0DFAF; font-weight: bold;">return</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it_box</span> = env.box_map.find (obj-&gt;tag);
        assert (it_box != env.box_map.end ());
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = it_box-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = box-&gt;obj-&gt;obj_map.find (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name);
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != box-&gt;obj-&gt;obj_map.end ()) {
            <span style="color: #F0DFAF; font-weight: bold;">if</span> (closure_p (env, it-&gt;second)) {
                env.obj_stack.push (obj);
            }
            env.obj_stack.push (it-&gt;second);
            <span style="color: #F0DFAF; font-weight: bold;">return</span>;
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> {
            cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : field_jo_t::exe"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
                 &lt;&lt; <span style="color: #CC9393;">"  unknown field : "</span> &lt;&lt; <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name &lt;&lt; <span style="color: #CC9393;">"\n"</span>
                 &lt;&lt; <span style="color: #CC9393;">"  fail to find it in both object and type"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
            exit (1);
        }
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org83088c2" class="outline-4">
<h4 id="org83088c2">field_jo_t::repr</h4>
<div class="outline-text-4" id="text-org83088c2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">field_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"."</span> + <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgbbd1ddf" class="outline-3">
<h3 id="orgbbd1ddf">apply_jo</h3>
<div class="outline-text-3" id="text-orgbbd1ddf">
</div><div id="outline-container-orga60c034" class="outline-4">
<h4 id="orga60c034">apply_jo_t</h4>
<div class="outline-text-4" id="text-orga60c034">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">apply_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>;
    <span style="color: #93E0E3;">apply_jo_t</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>);
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org14e3b7b" class="outline-4">
<h4 id="org14e3b7b">apply_jo_t::apply_jo_t</h4>
<div class="outline-text-4" id="text-org14e3b7b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">apply_jo_t</span>::
<span style="color: #93E0E3;">apply_jo_t</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;arity = arity;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6d1369f" class="outline-4">
<h4 id="org6d1369f">apply_jo_t::copy</h4>
<div class="outline-text-4" id="text-org6d1369f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">apply_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;arity);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfaa7dab" class="outline-4">
<h4 id="orgfaa7dab">apply_jo_t::exe</h4>
<div class="outline-text-4" id="text-orgfaa7dab">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">apply_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
    env.obj_stack.pop ();
    obj-&gt;apply (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;arity);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb51e498" class="outline-4">
<h4 id="orgb51e498">apply_jo_t::repr</h4>
<div class="outline-text-4" id="text-orgb51e498">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">apply_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"(apply "</span> +
        to_string (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;arity) + <span style="color: #CC9393;">")"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5813fab" class="outline-3">
<h3 id="org5813fab">lit_jo</h3>
<div class="outline-text-3" id="text-org5813fab">
</div><div id="outline-container-orgff54235" class="outline-4">
<h4 id="orgff54235">lit_jo_t</h4>
<div class="outline-text-4" id="text-orgff54235">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">lit_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>;
    <span style="color: #93E0E3;">lit_jo_t</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf083c89" class="outline-4">
<h4 id="orgf083c89">lit_jo_t::lit_jo_t</h4>
<div class="outline-text-4" id="text-orgf083c89">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">lit_jo_t</span>::
<span style="color: #93E0E3;">lit_jo_t</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj = obj;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org69112f3" class="outline-4">
<h4 id="org69112f3">lit_jo_t::copy</h4>
<div class="outline-text-4" id="text-org69112f3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">lit_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">lit_jo_t</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6f73443" class="outline-4">
<h4 id="org6f73443">lit_jo_t::exe</h4>
<div class="outline-text-4" id="text-org6f73443">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">lit_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    env.obj_stack.push (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd395f8a" class="outline-4">
<h4 id="orgd395f8a">lit_jo_t::repr</h4>
<div class="outline-text-4" id="text-orgd395f8a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">lit_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj-&gt;repr (env);
}
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org65cd5db" class="outline-2">
<h2 id="org65cd5db">bool</h2>
<div class="outline-text-2" id="text-org65cd5db">
</div><div id="outline-container-org6221517" class="outline-3">
<h3 id="org6221517">true_c</h3>
<div class="outline-text-3" id="text-org6221517">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">true_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
   <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;data_o&gt;
       (env,
        <span style="color: #CC9393;">"true-t"</span>,
        <span style="color: #7CB8BB;">obj_map_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org636f37a" class="outline-3">
<h3 id="org636f37a">true_p</h3>
<div class="outline-text-3" id="text-org636f37a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">true_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == <span style="color: #CC9393;">"true-t"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org684c63d" class="outline-3">
<h3 id="org684c63d">false_c</h3>
<div class="outline-text-3" id="text-org684c63d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">false_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
   <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;data_o&gt;
       (env,
        <span style="color: #CC9393;">"false-t"</span>,
        <span style="color: #7CB8BB;">obj_map_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org827ff6d" class="outline-3">
<h3 id="org827ff6d">false_p</h3>
<div class="outline-text-3" id="text-org827ff6d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">false_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == <span style="color: #CC9393;">"false-t"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf73464a" class="outline-3">
<h3 id="orgf73464a">jj_true_c</h3>
<div class="outline-text-3" id="text-orgf73464a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">jj_true_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
   <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;data_o&gt;
       (env,
        <span style="color: #CC9393;">"true-t"</span>,
        <span style="color: #7CB8BB;">obj_map_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc4d4127" class="outline-3">
<h3 id="orgc4d4127">jj_false_c</h3>
<div class="outline-text-3" id="text-orgc4d4127">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">jj_false_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
   <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;data_o&gt;
       (env,
        <span style="color: #CC9393;">"false-t"</span>,
        <span style="color: #7CB8BB;">obj_map_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org213d35e" class="outline-3">
<h3 id="org213d35e">import_bool</h3>
<div class="outline-text-3" id="text-org213d35e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_bool</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_type (env, <span style="color: #CC9393;">"true-t"</span>);
    define_type (env, <span style="color: #CC9393;">"false-t"</span>);
    define (env, <span style="color: #CC9393;">"true-c"</span>, jj_true_c (env));
    define (env, <span style="color: #CC9393;">"false-c"</span>, jj_false_c (env));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbf6e675" class="outline-3">
<h3 id="orgbf6e675">test_bool</h3>
<div class="outline-text-3" id="text-orgbf6e675">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_bool</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    import_bool (env);

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"true-c"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"false-c"</span>)),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">env.double_report ();</span>

    {
        env.run ();
        assert_stack_size (env, 2);
        assert_pop_eq (env, jj_false_c (env));
        assert_pop_eq (env, jj_true_c (env));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd718699" class="outline-2">
<h2 id="orgd718699">int</h2>
<div class="outline-text-2" id="text-orgd718699">
</div><div id="outline-container-org47772ff" class="outline-3">
<h3 id="org47772ff">int_o</h3>
<div class="outline-text-3" id="text-org47772ff">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">int_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">int</span> <span style="color: #DFAF8F;">i</span>;
    <span style="color: #93E0E3;">int_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">int</span> <span style="color: #DFAF8F;">i</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd29770" class="outline-3">
<h3 id="orgd29770">int_o::int_o</h3>
<div class="outline-text-3" id="text-orgd29770">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">int_o</span>::<span style="color: #93E0E3;">int_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">int</span> <span style="color: #DFAF8F;">i</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = <span style="color: #CC9393;">"int-t"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;i = i;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga4c7d48" class="outline-3">
<h3 id="orga4c7d48">int_o::repr</h3>
<div class="outline-text-3" id="text-orga4c7d48">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">int_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> to_string (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;i);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1507a18" class="outline-3">
<h3 id="org1507a18">int_o::equal</h3>
<div class="outline-text-3" id="text-org1507a18">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">int_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;int_o&gt; (obj);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;i == that-&gt;i);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc431a0d" class="outline-3">
<h3 id="orgc431a0d">int_p</h3>
<div class="outline-text-3" id="text-orgc431a0d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">int_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == <span style="color: #CC9393;">"int-t"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgff210e4" class="outline-3">
<h3 id="orgff210e4">import_int</h3>
<div class="outline-text-3" id="text-orgff210e4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_int</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_type (env, <span style="color: #CC9393;">"int-t"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2631c9d" class="outline-3">
<h3 id="org2631c9d">test_int</h3>
<div class="outline-text-3" id="text-org2631c9d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_int</span> ()
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga763253" class="outline-2">
<h2 id="orga763253">str</h2>
<div class="outline-text-2" id="text-orga763253">
</div><div id="outline-container-org74e8d0b" class="outline-3">
<h3 id="org74e8d0b">str_o</h3>
<div class="outline-text-3" id="text-org74e8d0b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">str_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>;
    <span style="color: #93E0E3;">str_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org7b7a5d" class="outline-3">
<h3 id="org7b7a5d">str_o::str_o</h3>
<div class="outline-text-3" id="text-org7b7a5d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">str_o</span>::<span style="color: #93E0E3;">str_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = <span style="color: #CC9393;">"str-t"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;str = str;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6ece8da" class="outline-3">
<h3 id="org6ece8da">str_o::repr</h3>
<div class="outline-text-3" id="text-org6ece8da">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">str_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"\""</span> + <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;str + <span style="color: #CC9393;">"\""</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4c5774e" class="outline-3">
<h3 id="org4c5774e">str_o::equal</h3>
<div class="outline-text-3" id="text-org4c5774e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">str_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;str_o&gt; (obj);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;str == that-&gt;str);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3b8d2a2" class="outline-3">
<h3 id="org3b8d2a2">str_p</h3>
<div class="outline-text-3" id="text-org3b8d2a2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">str_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == <span style="color: #CC9393;">"str-t"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgccdde0c" class="outline-3">
<h3 id="orgccdde0c">jj_str_print</h3>
<div class="outline-text-3" id="text-orgccdde0c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_str_print_sig</span> = { <span style="color: #CC9393;">"str-print"</span>, <span style="color: #CC9393;">"str"</span> };
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- str-t -&gt;</span>
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_str_print</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = obj_map [<span style="color: #CC9393;">"str"</span>];
    assert (str_p (env, obj));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = static_pointer_cast &lt;str_o&gt; (obj);
    cout &lt;&lt; str-&gt;str;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge356188" class="outline-3">
<h3 id="orge356188">import_str</h3>
<div class="outline-text-3" id="text-orge356188">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_str</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_type (env, <span style="color: #CC9393;">"str-t"</span>);
    define_prim (env,
                 jj_str_print_sig,
                 jj_str_print);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbdf687b" class="outline-3">
<h3 id="orgbdf687b">test_str</h3>
<div class="outline-text-3" id="text-orgbdf687b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_str</span> ()
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1143286" class="outline-2">
<h2 id="org1143286">list</h2>
<div class="outline-text-2" id="text-org1143286">
</div><div id="outline-container-org559d465" class="outline-3">
<h3 id="org559d465">null_c</h3>
<div class="outline-text-3" id="text-org559d465">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">null_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
   <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;data_o&gt;
       (env,
        <span style="color: #CC9393;">"null-t"</span>,
        <span style="color: #7CB8BB;">obj_map_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org75ef2d8" class="outline-3">
<h3 id="org75ef2d8">cons_c</h3>
<div class="outline-text-3" id="text-org75ef2d8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">cons_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
        <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">car</span>,
        <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">cdr</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = obj_map_t ();
    obj_map [<span style="color: #CC9393;">"car"</span>] = car;
    obj_map [<span style="color: #CC9393;">"cdr"</span>] = cdr;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;data_o&gt;
        (env,
         <span style="color: #CC9393;">"cons-t"</span>,
         obj_map);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org69e06ea" class="outline-3">
<h3 id="org69e06ea">cons_p</h3>
<div class="outline-text-3" id="text-org69e06ea">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">cons_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == <span style="color: #CC9393;">"cons-t"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9e91ff7" class="outline-3">
<h3 id="org9e91ff7">car</h3>
<div class="outline-text-3" id="text-org9e91ff7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">car</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">cons</span>)
{
    assert (cons_p (env, cons));
    <span style="color: #F0DFAF; font-weight: bold;">return</span> cons-&gt;obj_map [<span style="color: #CC9393;">"car"</span>];
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga3d7fe" class="outline-3">
<h3 id="orga3d7fe">cdr</h3>
<div class="outline-text-3" id="text-orga3d7fe">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">cdr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">cons</span>)
{
    assert (cons_p (env, cons));
    <span style="color: #F0DFAF; font-weight: bold;">return</span> cons-&gt;obj_map [<span style="color: #CC9393;">"cdr"</span>];
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd083734" class="outline-3">
<h3 id="orgd083734">null_p</h3>
<div class="outline-text-3" id="text-orgd083734">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">null_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == <span style="color: #CC9393;">"null-t"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge75ee37" class="outline-3">
<h3 id="orge75ee37">list_p</h3>
<div class="outline-text-3" id="text-orge75ee37">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">list_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> null_p (env, a)
        || cons_p (env, a);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc0f9e81" class="outline-3">
<h3 id="orgc0f9e81">list_length</h3>
<div class="outline-text-3" id="text-orgc0f9e81">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">size_t</span>
<span style="color: #93E0E3;">list_length</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">l</span>)
{
    assert (list_p (env, l));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">length</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> null_p (env, l)) {
        length++;
        l = cdr (env, l);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> length;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge65de3" class="outline-3">
<h3 id="orge65de3">jj_null_c</h3>
<div class="outline-text-3" id="text-orge65de3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">jj_null_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
   <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;data_o&gt;
       (env,
        <span style="color: #CC9393;">"null-t"</span>,
        <span style="color: #7CB8BB;">obj_map_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9f77c37" class="outline-3">
<h3 id="org9f77c37">jj_cons_c</h3>
<div class="outline-text-3" id="text-org9f77c37">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;data_cons_o&gt;
<span style="color: #93E0E3;">jj_cons_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;data_cons_o&gt;
        (env,
         <span style="color: #CC9393;">"cons-t"</span>,
         name_vector_t ({ <span style="color: #CC9393;">"car"</span>, <span style="color: #CC9393;">"cdr"</span> }),
         <span style="color: #7CB8BB;">obj_map_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org51faefc" class="outline-3">
<h3 id="org51faefc">import_list</h3>
<div class="outline-text-3" id="text-org51faefc">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_type (env, <span style="color: #CC9393;">"null-t"</span>);
    define_type (env, <span style="color: #CC9393;">"cons-t"</span>);
    define (env, <span style="color: #CC9393;">"null-c"</span>, jj_null_c (env));
    define (env, <span style="color: #CC9393;">"cons-c"</span>, jj_cons_c (env));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd560d20" class="outline-3">
<h3 id="orgd560d20">test_list</h3>
<div class="outline-text-3" id="text-orgd560d20">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_list</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    import_list (env);

    define (env, <span style="color: #CC9393;">"s1"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"cons-c"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (2),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #CC9393;">"cdr"</span>),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">env.double_report ();</span>

    {
        env.run ();
        assert_stack_size (env, 1);
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org42fa0e7" class="outline-2">
<h2 id="org42fa0e7">vect</h2>
<div class="outline-text-2" id="text-org42fa0e7">
</div><div id="outline-container-orgba3b67e" class="outline-3">
<h3 id="orgba3b67e">vect_o</h3>
<div class="outline-text-3" id="text-orgba3b67e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">vect_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">obj_vector_t</span> <span style="color: #DFAF8F;">obj_vector</span>;
    <span style="color: #93E0E3;">vect_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_vector_t</span> <span style="color: #DFAF8F;">obj_vector</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org55ec7be" class="outline-3">
<h3 id="org55ec7be">collect_vect_jo</h3>
<div class="outline-text-3" id="text-org55ec7be">
</div><div id="outline-container-orgb4470e4" class="outline-4">
<h4 id="orgb4470e4">collect_vect_jo_t</h4>
<div class="outline-text-4" id="text-orgb4470e4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">collect_vect_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">counter</span>;
    <span style="color: #93E0E3;">collect_vect_jo_t</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">counter</span>);
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org7c8ffab" class="outline-4">
<h4 id="org7c8ffab">collect_vect_jo_t::collect_vect_jo_t</h4>
<div class="outline-text-4" id="text-org7c8ffab">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">collect_vect_jo_t</span>::
<span style="color: #93E0E3;">collect_vect_jo_t</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">counter</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;counter = counter;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org79d5951" class="outline-4">
<h4 id="org79d5951">collect_vect_jo_t::copy</h4>
<div class="outline-text-4" id="text-org79d5951">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">collect_vect_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">collect_vect_jo_t</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;counter);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org60c55cb" class="outline-4">
<h4 id="org60c55cb">collect_vect_jo_t::exe</h4>
<div class="outline-text-4" id="text-org60c55cb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">collect_vect_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">index</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_vector</span> = obj_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (index &lt; <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;counter) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
        env.obj_stack.pop ();
        obj_vector.push_back (obj);
        index++;
    }
    reverse (obj_vector.begin (),
             obj_vector.end ());
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">vect</span> = make_shared &lt;vect_o&gt; (env, obj_vector);
    env.obj_stack.push (vect);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8360a17" class="outline-4">
<h4 id="org8360a17">collect_vect_jo_t::repr</h4>
<div class="outline-text-4" id="text-org8360a17">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">collect_vect_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"(collect-vect "</span> + to_string (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;counter) + <span style="color: #CC9393;">")"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf762f6" class="outline-3">
<h3 id="orgf762f6">vect_o::vect_o</h3>
<div class="outline-text-3" id="text-orgf762f6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">vect_o</span>::<span style="color: #93E0E3;">vect_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_vector_t</span> <span style="color: #DFAF8F;">obj_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = <span style="color: #CC9393;">"vect-t"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_vector = obj_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org47412c7" class="outline-3">
<h3 id="org47412c7">vect_equal</h3>
<div class="outline-text-3" id="text-org47412c7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">vect_equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
            <span style="color: #7CB8BB;">obj_vector_t</span> &amp;<span style="color: #DFAF8F;">lhs</span>,
            <span style="color: #7CB8BB;">obj_vector_t</span> &amp;<span style="color: #DFAF8F;">rhs</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lhs.size () != rhs.size ()) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = lhs.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">index</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (index &lt; size) {
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> obj_equal (env, lhs [index], rhs [index]))
            <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
        index++;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7e0221c" class="outline-3">
<h3 id="org7e0221c">vect_o::equal</h3>
<div class="outline-text-3" id="text-org7e0221c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">vect_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;vect_o&gt; (obj);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> vect_equal (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_vector, that-&gt;obj_vector);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc6f14d0" class="outline-3">
<h3 id="orgc6f14d0">vect_o::repr</h3>
<div class="outline-text-3" id="text-orgc6f14d0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">vect_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"["</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">obj</span>: <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_vector) {
        repr += obj-&gt;repr (env);
        repr += <span style="color: #CC9393;">" "</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> repr.empty ()) repr.pop_back ();
    repr += <span style="color: #CC9393;">"]"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org37cc405" class="outline-3">
<h3 id="org37cc405">vect_p</h3>
<div class="outline-text-3" id="text-org37cc405">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">vect_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == <span style="color: #CC9393;">"vect-t"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9208e8c" class="outline-3">
<h3 id="org9208e8c">list_to_vect</h3>
<div class="outline-text-3" id="text-org9208e8c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;vect_o&gt;
<span style="color: #93E0E3;">list_to_vect</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">l</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_vector</span> = obj_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (cons_p (env, l)) {
        obj_vector.push_back (car (env, l));
        l = cdr (env, l);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;vect_o&gt; (env, obj_vector);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org362ea37" class="outline-3">
<h3 id="org362ea37">jj_list_to_vect</h3>
<div class="outline-text-3" id="text-org362ea37">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_list_to_vect_sig</span> = { <span style="color: #CC9393;">"list-to-vect"</span>, <span style="color: #CC9393;">"list"</span> };
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- (list-t t) -&gt; (vect-t t)</span>
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_list_to_vect</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    env.obj_stack.push (list_to_vect (env, obj_map [<span style="color: #CC9393;">"list"</span>]));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc6e7bf3" class="outline-3">
<h3 id="orgc6e7bf3">vect_to_list</h3>
<div class="outline-text-3" id="text-orgc6e7bf3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">vect_to_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;vect_o&gt; <span style="color: #DFAF8F;">vect</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_vector</span> = vect-&gt;obj_vector;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">result</span> = null_c (env);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = obj_vector.rbegin ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = obj_vector.rend ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++)
        result = cons_c (env, *it, result);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> result;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7bb134f" class="outline-3">
<h3 id="org7bb134f">jj_vect_to_list</h3>
<div class="outline-text-3" id="text-org7bb134f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_vect_to_list_sig</span> = { <span style="color: #CC9393;">"vect-to-list"</span>, <span style="color: #CC9393;">"vect"</span> };
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- (vect-t t) -&gt; (list-t t)</span>
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_vect_to_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = obj_map [<span style="color: #CC9393;">"vect"</span>];
    assert (vect_p (env, obj));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">vect</span> = static_pointer_cast &lt;vect_o&gt; (obj);
    env.obj_stack.push (vect_to_list (env, vect));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org34fd1cf" class="outline-3">
<h3 id="org34fd1cf">import_vect</h3>
<div class="outline-text-3" id="text-org34fd1cf">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_vect</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_type (env, <span style="color: #CC9393;">"vect-t"</span>);
    define_prim (env,
                 jj_list_to_vect_sig,
                 jj_list_to_vect);
    define_prim (env,
                 jj_vect_to_list_sig,
                 jj_vect_to_list);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd52a41a" class="outline-3">
<h3 id="orgd52a41a">test_vect</h3>
<div class="outline-text-3" id="text-orgd52a41a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_vect</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    import_list (env);
    import_vect (env);

    define (env, <span style="color: #CC9393;">"s1"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"null-c"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"cons-c"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (2),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"cons-c"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (2),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"list-to-vect"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"vect-to-list"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #CC9393;">"cdr"</span>),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #CC9393;">"car"</span>),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">env.double_report ();</span>

    {
        env.run ();
        assert_stack_size (env, 1);
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgceb9dd1" class="outline-2">
<h2 id="orgceb9dd1">dict</h2>
<div class="outline-text-2" id="text-orgceb9dd1">
</div><div id="outline-container-orga67243b" class="outline-3">
<h3 id="orga67243b">dict_o</h3>
<div class="outline-text-3" id="text-orga67243b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">dict_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #93E0E3;">dict_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org777165b" class="outline-3">
<h3 id="org777165b">collect_dict_jo</h3>
<div class="outline-text-3" id="text-org777165b">
</div><div id="outline-container-org7263d81" class="outline-4">
<h4 id="org7263d81">collect_dict_jo_t</h4>
<div class="outline-text-4" id="text-org7263d81">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">collect_dict_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">counter</span>;
    <span style="color: #93E0E3;">collect_dict_jo_t</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">counter</span>);
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org1980286" class="outline-4">
<h4 id="org1980286">collect_dict_jo_t::collect_dict_jo_t</h4>
<div class="outline-text-4" id="text-org1980286">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">collect_dict_jo_t</span>::
<span style="color: #93E0E3;">collect_dict_jo_t</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">counter</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;counter = counter;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga70fe61" class="outline-4">
<h4 id="orga70fe61">collect_dict_jo_t::copy</h4>
<div class="outline-text-4" id="text-orga70fe61">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">collect_dict_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">collect_dict_jo_t</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;counter);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc8cea1b" class="outline-4">
<h4 id="orgc8cea1b">collect_dict_jo_t::exe</h4>
<div class="outline-text-4" id="text-orgc8cea1b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">collect_dict_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">index</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = obj_map_t ();
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (index &lt; <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;counter) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
        env.obj_stack.pop ();
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = env.obj_stack.top ();
        env.obj_stack.pop ();
        assert (str_p (env, str));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">key</span> = static_pointer_cast &lt;str_o&gt; (str);
        obj_map [key-&gt;str] = obj;
        index++;
    }
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">dict</span> = make_shared &lt;dict_o&gt; (env, obj_map);
    env.obj_stack.push (dict);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org497a15f" class="outline-4">
<h4 id="org497a15f">collect_dict_jo_t::repr</h4>
<div class="outline-text-4" id="text-org497a15f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">collect_dict_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"(collect-dict "</span> + to_string (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;counter) + <span style="color: #CC9393;">")"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9ae42a7" class="outline-3">
<h3 id="org9ae42a7">dict_o::dict_o</h3>
<div class="outline-text-3" id="text-org9ae42a7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">dict_o</span>::<span style="color: #93E0E3;">dict_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = <span style="color: #CC9393;">"dict-t"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map = obj_map;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org73e32e1" class="outline-3">
<h3 id="org73e32e1">dict_o::equal</h3>
<div class="outline-text-3" id="text-org73e32e1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">dict_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;dict_o&gt; (obj);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> obj_map_equal (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map, that-&gt;obj_map);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga92ec16" class="outline-3">
<h3 id="orga92ec16">dict_o::repr</h3>
<div class="outline-text-3" id="text-orga92ec16">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">dict_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"{"</span>;
    repr += obj_map_repr (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
    repr += <span style="color: #CC9393;">"}"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org13de79a" class="outline-3">
<h3 id="org13de79a">dict_p</h3>
<div class="outline-text-3" id="text-org13de79a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">dict_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == <span style="color: #CC9393;">"dict-t"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1de9c14" class="outline-3">
<h3 id="org1de9c14">list_to_dict</h3>
<div class="outline-text-3" id="text-org1de9c14">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;dict_o&gt;
<span style="color: #93E0E3;">list_to_dict</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">l</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = obj_map_t ();
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (cons_p (env, l)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, l);
        assert (str_p (env, head));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">key</span> = static_pointer_cast &lt;str_o&gt; (head);
        assert (cons_p (env, cdr (env, l)));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = car (env, cdr (env, l));
        obj_map [key-&gt;str] = obj;
        l = cdr (env, cdr (env, l));
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;dict_o&gt; (env, obj_map);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb2b0b51" class="outline-3">
<h3 id="orgb2b0b51">dict_to_list</h3>
<div class="outline-text-3" id="text-orgb2b0b51">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">dict_to_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;dict_o&gt; <span style="color: #DFAF8F;">dict</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">result</span> = null_c (env);
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: dict-&gt;obj_map) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = make_shared &lt;str_o&gt; (env, kv.first);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = kv.second;
        result = cons_c (env, obj, result);
        result = cons_c (env, str, result);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> result;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3d4b318" class="outline-3">
<h3 id="org3d4b318">import_dict</h3>
<div class="outline-text-3" id="text-org3d4b318">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_dict</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_type (env, <span style="color: #CC9393;">"dict-t"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge8dfd19" class="outline-3">
<h3 id="orge8dfd19">test_dict</h3>
<div class="outline-text-3" id="text-orge8dfd19">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_dict</span> ()
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org315aa4b" class="outline-2">
<h2 id="org315aa4b">sexp</h2>
<div class="outline-text-2" id="text-org315aa4b">
</div><div id="outline-container-org58623b7" class="outline-3">
<h3 id="org58623b7">string_vector_t</h3>
<div class="outline-text-3" id="text-org58623b7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">string_vector_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">string</span>&gt; ;
</pre>
</div>
</div>
</div>

<div id="outline-container-org1256af8" class="outline-3">
<h3 id="org1256af8">space_char_p</h3>
<div class="outline-text-3" id="text-org1256af8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">space_char_p</span> (<span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> (c == <span style="color: #DCDCCC; background-color: #3F3F3F;">' </span><span style="color: #D0BF8F; font-weight: bold;">'</span>  ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'\n</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'\t</span><span style="color: #D0BF8F; font-weight: bold;">'</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7f9596f" class="outline-3">
<h3 id="org7f9596f">delimiter_char_p</h3>
<div class="outline-text-3" id="text-org7f9596f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">delimiter_char_p</span> (<span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> (c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'(</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">')</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'[</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">']</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'{</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'}</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">',</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">';</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'`</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'\''</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6050700" class="outline-3">
<h3 id="org6050700">string_from_char</h3>
<div class="outline-text-3" id="text-org6050700">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">string_from_char</span> (<span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span> = <span style="color: #CC9393;">""</span>;
    str.push_back (c);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> str;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1688425" class="outline-3">
<h3 id="org1688425">doublequote_char_p</h3>
<div class="outline-text-3" id="text-org1688425">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">doublequote_char_p</span> (<span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'"</span><span style="color: #D0BF8F; font-weight: bold;">'</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9220ddb" class="outline-3">
<h3 id="org9220ddb">find_word_length</h3>
<div class="outline-text-3" id="text-org9220ddb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">size_t</span> <span style="color: #93E0E3;">find_word_length</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">code</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">begin</span>)
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">length</span> = code.length ();
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span> = begin;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #BFEBBF;">true</span>) {
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (index == length)
            <span style="color: #F0DFAF; font-weight: bold;">return</span> index - begin;
        <span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span> = code [index];
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (space_char_p (c) <span style="color: #F0DFAF; font-weight: bold;">or</span>
            doublequote_char_p (c) <span style="color: #F0DFAF; font-weight: bold;">or</span>
            delimiter_char_p (c))
            <span style="color: #F0DFAF; font-weight: bold;">return</span> index - begin;
        index++;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga9bfeda" class="outline-3">
<h3 id="orga9bfeda">find_string_length</h3>
<div class="outline-text-3" id="text-orga9bfeda">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">size_t</span> <span style="color: #93E0E3;">find_string_length</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">code</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">begin</span>)
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">length</span> = code.length ();
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span> = begin + 1;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #BFEBBF;">true</span>) {
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (index == length) {
            cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : find_string_length"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
            cout &lt;&lt; <span style="color: #CC9393;">"  doublequote mismatch"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
            exit (1);
        }
        <span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span> = code [index];
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (doublequote_char_p (c))
            <span style="color: #F0DFAF; font-weight: bold;">return</span> index - begin + 1;
        index++;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdfd7cb1" class="outline-3">
<h3 id="orgdfd7cb1">scan_word_vector</h3>
<div class="outline-text-3" id="text-orgdfd7cb1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string_vector_t</span>
<span style="color: #93E0E3;">scan_word_vector</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">code</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">string_vector</span> = string_vector_t ();
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">i</span> = 0;
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">length</span> = code.length ();
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (i &lt; length) {
        <span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span> = code [i];
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (space_char_p (c)) i++;
        <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (delimiter_char_p (c)) {
            string_vector.push_back (string_from_char (c));
            i++;
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (doublequote_char_p (c)) {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">string_length</span> = find_string_length (code, i);
            <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span> = code.substr (i, string_length);
            string_vector.push_back (str);
            i += string_length;
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word_length</span> = find_word_length (code, i);
            <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">word</span> = code.substr (i, word_length);
            string_vector.push_back (word);
            i += word_length;
        }
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> string_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org53728b6" class="outline-3">
<h3 id="org53728b6"><span class="todo _note_">[note]</span> about literal in quote</h3>
<div class="outline-text-3" id="text-org53728b6">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">( )</td>
<td class="org-left">list-t</td>
</tr>

<tr>
<td class="org-left">[ ]</td>
<td class="org-left">vect-t</td>
</tr>

<tr>
<td class="org-left">{ }</td>
<td class="org-left">dict-t</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org6fd70cf" class="outline-3">
<h3 id="org6fd70cf">word_vector_to_word_list &#x2013; drop `,`</h3>
<div class="outline-text-3" id="text-org6fd70cf">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">word_vector_to_word_list</span>
(<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">string_vector_t</span> &amp;<span style="color: #DFAF8F;">word_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = word_vector.rbegin ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = word_vector.rend ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">collect</span> = null_c (env);
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word</span> = *it;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (word != <span style="color: #CC9393;">","</span>) {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = make_shared &lt;str_o&gt; (env, word);
            collect = cons_c (env, obj, collect);
        }
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> collect;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5a7167e" class="outline-3">
<h3 id="org5a7167e">scan_word_list</h3>
<div class="outline-text-3" id="text-org5a7167e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">scan_word_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;str_o&gt; <span style="color: #DFAF8F;">code</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word_vector</span> = scan_word_vector (code-&gt;str);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> word_vector_to_word_list
        (env, word_vector);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga66c200" class="outline-3">
<h3 id="orga66c200">bar_word_p</h3>
<div class="outline-text-3" id="text-orga66c200">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">bar_word_p</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">word</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> word == <span style="color: #CC9393;">"("</span>
        || word == <span style="color: #CC9393;">"["</span>
        || word == <span style="color: #CC9393;">"{"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org60feb28" class="outline-3">
<h3 id="org60feb28">ket_word_p</h3>
<div class="outline-text-3" id="text-org60feb28">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">ket_word_p</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">word</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> word == <span style="color: #CC9393;">")"</span>
        || word == <span style="color: #CC9393;">"]"</span>
        || word == <span style="color: #CC9393;">"}"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgebce040" class="outline-3">
<h3 id="orgebce040">quote_word_p</h3>
<div class="outline-text-3" id="text-orgebce040">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">quote_word_p</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">word</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> word == <span style="color: #CC9393;">"'"</span>
        || word == <span style="color: #CC9393;">"`"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5fec5b2" class="outline-3">
<h3 id="org5fec5b2">bar_word_to_ket_word</h3>
<div class="outline-text-3" id="text-org5fec5b2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">bar_word_to_ket_word</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">bar</span>)
{
    assert (bar_word_p (bar));
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (bar == <span style="color: #CC9393;">"("</span>) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">")"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (bar == <span style="color: #CC9393;">"["</span>) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"]"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (bar == <span style="color: #CC9393;">"{"</span>) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"}"</span>;
    cout &lt;&lt; <span style="color: #CC9393;">"bar_word_to_ket_word fail\n"</span>;
    exit (1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf731d23" class="outline-3">
<h3 id="orgf731d23">word_list_head_with_bar_ket_counter</h3>
<div class="outline-text-3" id="text-orgf731d23">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">word_list_head_with_bar_ket_counter</span>
(<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
 <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">word_list</span>,
 <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">bar</span>,
 <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">ket</span>,
 <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">counter</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (counter == 0)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> null_c (env);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt;
        (car (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word</span> = head-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == bar)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c
            (env, head, word_list_head_with_bar_ket_counter
             (env,
              cdr (env, word_list),
              bar, ket, counter + 1));
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == ket)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c
            (env, head, word_list_head_with_bar_ket_counter
             (env,
              cdr (env, word_list),
              bar, ket, counter - 1));
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c
            (env, head, word_list_head_with_bar_ket_counter
             (env,
              cdr (env, word_list),
              bar, ket, counter));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org32e8361" class="outline-3">
<h3 id="org32e8361">word_list_head</h3>
<div class="outline-text-3" id="text-org32e8361">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">word_list_head</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">word_list</span>)
{
    assert (cons_p (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt;
        (car (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word</span> = head-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (bar_word_p (word)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bar</span> = word;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">ket</span> = bar_word_to_ket_word (word);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c
            (env, head, word_list_head_with_bar_ket_counter
             (env,
              cdr (env, word_list),
              bar, ket, 1));
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (quote_word_p (word))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (env, head,
                       word_list_head (env, cdr (env, word_list)));
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (env, head, null_c (env));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org443191a" class="outline-3">
<h3 id="org443191a">word_list_rest_with_bar_ket_counter</h3>
<div class="outline-text-3" id="text-org443191a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">word_list_rest_with_bar_ket_counter</span>
(<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
 <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">word_list</span>,
 <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">bar</span>,
 <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">ket</span>,
 <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">counter</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (counter == 0)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> word_list;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt;
        (car (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word</span> = head-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == bar)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> word_list_rest_with_bar_ket_counter
            (env,
             cdr (env, word_list),
             bar, ket, counter + 1);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == ket)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> word_list_rest_with_bar_ket_counter
            (env,
             cdr (env, word_list),
             bar, ket, counter - 1);
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> word_list_rest_with_bar_ket_counter
            (env,
             cdr (env, word_list),
             bar, ket, counter);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org72ef851" class="outline-3">
<h3 id="org72ef851">word_list_rest</h3>
<div class="outline-text-3" id="text-org72ef851">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">word_list_rest</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">word_list</span>)
{
    assert (cons_p (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt;
        (car (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word</span> = head-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (bar_word_p (word)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bar</span> = word;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">ket</span> = bar_word_to_ket_word (word);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> word_list_rest_with_bar_ket_counter
            (env,
             cdr (env, word_list),
             bar, ket, 1);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (quote_word_p (word))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> word_list_rest (env, cdr (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cdr (env, word_list);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2c4dbdd" class="outline-3">
<h3 id="org2c4dbdd">word_list_drop_ket</h3>
<div class="outline-text-3" id="text-org2c4dbdd">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">word_list_drop_ket</span>
(<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
 <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">word_list</span>,
 <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">ket</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, word_list);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, word_list);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, rest))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> null_c (env);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">cdr_rest</span> = cdr (env, rest);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">car_rest</span> = static_pointer_cast &lt;str_o&gt; (car (env, rest));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word</span> = car_rest-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, cdr_rest)) {
        assert (word == ket);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (env, head, null_c (env));
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (env, head,
                       word_list_drop_ket (env, rest, ket));
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org43669c4" class="outline-3">
<h3 id="org43669c4">parse_sexp</h3>
<div class="outline-text-3" id="text-org43669c4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">parse_sexp_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">word_list</span>);

<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">parse_sexp</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">word_list</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt;
        (car (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word</span> = head-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, word_list);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == <span style="color: #CC9393;">"("</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> parse_sexp_list
            (env, word_list_drop_ket (env, rest, <span style="color: #CC9393;">")"</span>));
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == <span style="color: #CC9393;">"["</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> list_to_vect
            (env, parse_sexp_list
             (env, word_list_drop_ket (env, rest, <span style="color: #CC9393;">"]"</span>)));
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == <span style="color: #CC9393;">"{"</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> list_to_dict
            (env, parse_sexp_list
             (env, word_list_drop_ket (env, rest, <span style="color: #CC9393;">"}"</span>)));
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == <span style="color: #CC9393;">"'"</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"quote"</span>),
                       cons_c (env, parse_sexp (env, rest),
                               null_c (env)));
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == <span style="color: #CC9393;">"`"</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"partquote"</span>),
                       cons_c (env, parse_sexp (env, rest),
                               null_c (env)));
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> head;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3cee19d" class="outline-3">
<h3 id="org3cee19d">parse_sexp_list</h3>
<div class="outline-text-3" id="text-org3cee19d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">parse_sexp_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">word_list</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, word_list))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> word_list;
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c
            (env,
             parse_sexp (env, word_list_head (env, word_list)),
             parse_sexp_list (env, word_list_rest (env, word_list)));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf1a604d" class="outline-3">
<h3 id="orgf1a604d">sexp_repr</h3>
<div class="outline-text-3" id="text-orgf1a604d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">sexp_list_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>);

<span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">sexp_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, a)) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"()"</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (cons_p (env, a)) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"("</span> + sexp_list_repr (env, a) + <span style="color: #CC9393;">")"</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (vect_p (env, a)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">v</span> = static_pointer_cast &lt;vect_o&gt; (a);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">l</span> = vect_to_list (env, v);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"["</span> + sexp_list_repr (env, l) + <span style="color: #CC9393;">"]"</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (dict_p (env, a)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">d</span> = static_pointer_cast &lt;dict_o&gt; (a);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">l</span> = dict_to_list (env, d);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"{"</span> + sexp_list_repr (env, l) + <span style="color: #CC9393;">"}"</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        assert (str_p (env, a));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = static_pointer_cast &lt;str_o&gt; (a);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> str-&gt;str;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org232e09b" class="outline-3">
<h3 id="org232e09b">sexp_list_repr</h3>
<div class="outline-text-3" id="text-org232e09b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">sexp_list_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp_list</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, sexp_list))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">""</span>;
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, cdr (env, sexp_list)))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> sexp_repr (env, car (env, sexp_list));
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span>
            sexp_repr (env, car (env, sexp_list)) + <span style="color: #CC9393;">" "</span> +
            sexp_list_repr (env, cdr (env, sexp_list));
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org316f4fe" class="outline-3">
<h3 id="org316f4fe">jj_scan_word_list</h3>
<div class="outline-text-3" id="text-org316f4fe">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_scan_word_list_sig</span> = { <span style="color: #CC9393;">"scan-word-list"</span>, <span style="color: #CC9393;">"code"</span> };
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- str-t -&gt; (list-t str-t)</span>
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_scan_word_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = obj_map [<span style="color: #CC9393;">"code"</span>];
    assert (str_p (env, obj));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">code</span> = static_pointer_cast &lt;str_o&gt; (obj);
    env.obj_stack.push (scan_word_list (env, code));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org22bf412" class="outline-3">
<h3 id="org22bf412">jj_parse_sexp</h3>
<div class="outline-text-3" id="text-org22bf412">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_parse_sexp_sig</span> = { <span style="color: #CC9393;">"parse-sexp"</span>, <span style="color: #CC9393;">"word-list"</span> };
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- (list-t str-t) -&gt; sexp-t</span>
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_parse_sexp</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    env.obj_stack.push (parse_sexp (env, obj_map [<span style="color: #CC9393;">"word-list"</span>]));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9813406" class="outline-3">
<h3 id="org9813406">jj_parse_sexp_list</h3>
<div class="outline-text-3" id="text-org9813406">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_parse_sexp_list_sig</span> = { <span style="color: #CC9393;">"parse-sexp-list"</span>, <span style="color: #CC9393;">"word-list"</span> };
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- (list-t str-t) -&gt; (list-t sexp-t)</span>
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_parse_sexp_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    env.obj_stack.push (parse_sexp_list (env, obj_map [<span style="color: #CC9393;">"word-list"</span>]));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3d34cac" class="outline-3">
<h3 id="org3d34cac">jj_sexp_repr</h3>
<div class="outline-text-3" id="text-org3d34cac">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_sexp_repr_sig</span> = { <span style="color: #CC9393;">"sexp-repr"</span>, <span style="color: #CC9393;">"sexp"</span> };
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- sexp-t -&gt;</span>
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_sexp_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = sexp_repr (env, obj_map [<span style="color: #CC9393;">"sexp"</span>]);
    env.obj_stack.push (make_shared &lt;str_o&gt; (env, str));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9f16379" class="outline-3">
<h3 id="org9f16379">jj_sexp_list_repr</h3>
<div class="outline-text-3" id="text-org9f16379">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_sexp_list_repr_sig</span> = { <span style="color: #CC9393;">"sexp-list-repr"</span>, <span style="color: #CC9393;">"sexp-list"</span> };
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- (list-t sexp-t) -&gt;</span>
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_sexp_list_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = sexp_list_repr (env, obj_map [<span style="color: #CC9393;">"sexp-list"</span>]);
    env.obj_stack.push (make_shared &lt;str_o&gt; (env, str));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb148beb" class="outline-3">
<h3 id="orgb148beb">import_sexp</h3>
<div class="outline-text-3" id="text-orgb148beb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_sexp</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_prim (env,
                 jj_scan_word_list_sig,
                 jj_scan_word_list);
    define_prim (env,
                 jj_parse_sexp_list_sig,
                 jj_parse_sexp_list);
    define_prim (env,
                 jj_parse_sexp_sig,
                 jj_parse_sexp);
    define_prim (env,
                 jj_sexp_repr_sig,
                 jj_sexp_repr);
    define_prim (env,
                 jj_sexp_list_repr_sig,
                 jj_sexp_list_repr);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf4e1355" class="outline-3">
<h3 id="orgf4e1355">test_sexp_scan</h3>
<div class="outline-text-3" id="text-orgf4e1355">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_sexp_scan</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">code</span> = <span style="color: #CC9393;">"(cons-c &lt;car&gt; &lt;cdr&gt;)"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">string_vector</span> = scan_word_vector (code);
    assert (string_vector.size () == 5);
    assert (string_vector [0] == <span style="color: #CC9393;">"("</span>);
    assert (string_vector [1] == <span style="color: #CC9393;">"cons-c"</span>);
    assert (string_vector [2] == <span style="color: #CC9393;">"&lt;car&gt;"</span>);
    assert (string_vector [3] == <span style="color: #CC9393;">"&lt;cdr&gt;"</span>);
    assert (string_vector [4] == <span style="color: #CC9393;">")"</span>);

    {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">code</span> = <span style="color: #CC9393;">"\"123\""</span>;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">string_vector</span> = scan_word_vector (code);
        assert (string_vector.size () == 1);
        assert (string_vector [0] == <span style="color: #CC9393;">"\"123\""</span>);
    }

}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb88bbbe" class="outline-3">
<h3 id="orgb88bbbe">test_sexp_list</h3>
<div class="outline-text-3" id="text-orgb88bbbe">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_sexp_list</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    import_sexp (env);
    import_str (env);

    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">code</span> =
        <span style="color: #CC9393;">"(cons-c &lt;car&gt; &lt;cdr&gt;)"</span>
        <span style="color: #CC9393;">"(cons-c (cons-c &lt;car&gt; &lt;cdr&gt;) (cons-c &lt;car&gt; &lt;cdr&gt;))"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word_list</span> = scan_word_list
        (env, make_shared &lt;str_o&gt; (env, code));
    env.obj_stack.push (word_list);

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"parse-sexp-list"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"sexp-list-repr"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"str-print"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">env.double_report ();</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6b881" class="outline-3">
<h3 id="org6b881">test_sexp_vect</h3>
<div class="outline-text-3" id="text-org6b881">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_sexp_vect</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    import_sexp (env);
    import_str (env);

    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">code</span> = <span style="color: #CC9393;">"[a b c]"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word_list</span> = scan_word_list
        (env, make_shared &lt;str_o&gt; (env, code));
    env.obj_stack.push (word_list);

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"parse-sexp"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"sexp-repr"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"str-print"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">{</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">}</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf824da6" class="outline-3">
<h3 id="orgf824da6">test_sexp</h3>
<div class="outline-text-3" id="text-orgf824da6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_sexp</span> ()
{
    test_sexp_scan ();
    test_sexp_list ();
    test_sexp_vect ();
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc0fdf71" class="outline-2">
<h2 id="orgc0fdf71">top_keyword</h2>
<div class="outline-text-2" id="text-orgc0fdf71">
</div><div id="outline-container-orgb5bb400" class="outline-3">
<h3 id="orgb5bb400">top_keyword_fn</h3>
<div class="outline-text-3" id="text-orgb5bb400">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">top_keyword_fn</span> = <span style="color: #7CB8BB;">function</span>
    &lt;<span style="color: #7CB8BB;">void</span> (<span style="color: #7CB8BB;">env_t</span> &amp;, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;)&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-org56d23c8" class="outline-3">
<h3 id="org56d23c8">top_keyword_o</h3>
<div class="outline-text-3" id="text-org56d23c8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">top_keyword_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">top_keyword_fn</span> <span style="color: #DFAF8F;">fn</span>;
    <span style="color: #93E0E3;">top_keyword_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">top_keyword_fn</span> <span style="color: #DFAF8F;">fn</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org6f12f35" class="outline-3">
<h3 id="org6f12f35">top_keyword_o::top_keyword_o</h3>
<div class="outline-text-3" id="text-org6f12f35">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">top_keyword_o</span>::
<span style="color: #93E0E3;">top_keyword_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">top_keyword_fn</span> <span style="color: #DFAF8F;">fn</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = <span style="color: #CC9393;">"top-keyword-t"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;fn = fn;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9be13ff" class="outline-3">
<h3 id="org9be13ff">top_keyword_o::equal</h3>
<div class="outline-text-3" id="text-org9be13ff">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">top_keyword_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">this</span> != obj.get ();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org20ec94c" class="outline-3">
<h3 id="org20ec94c">top_keyword_p</h3>
<div class="outline-text-3" id="text-org20ec94c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">top_keyword_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == <span style="color: #CC9393;">"top-keyword-t"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org819947f" class="outline-3">
<h3 id="org819947f">define_top_keyword</h3>
<div class="outline-text-3" id="text-org819947f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">define_top_keyword</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>, <span style="color: #7CB8BB;">top_keyword_fn</span> <span style="color: #DFAF8F;">fn</span>)
{
    define (env, name, make_shared &lt;top_keyword_o&gt; (env, fn));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2216a7d" class="outline-3">
<h3 id="org2216a7d">import_top_keyword</h3>
<div class="outline-text-3" id="text-org2216a7d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_top_keyword</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_type (env, <span style="color: #CC9393;">"top-keyword-t"</span>);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org75d5ea3" class="outline-2">
<h2 id="org75d5ea3">keyword</h2>
<div class="outline-text-2" id="text-org75d5ea3">
</div><div id="outline-container-org93cbd5e" class="outline-3">
<h3 id="org93cbd5e">local_ref_map_t</h3>
<div class="outline-text-3" id="text-org93cbd5e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">local_ref_map_t</span> = <span style="color: #7CB8BB;">map</span> &lt;<span style="color: #7CB8BB;">name_t</span>, <span style="color: #7CB8BB;">local_ref_jo_t</span>&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-orga2180df" class="outline-3">
<h3 id="orga2180df">local_ref_map_extend</h3>
<div class="outline-text-3" id="text-orga2180df">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">local_ref_map_t</span>
<span style="color: #93E0E3;">local_ref_map_extend</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                      <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">old_local_ref_map</span>,
                      <span style="color: #7CB8BB;">name_vector_t</span> &amp;<span style="color: #DFAF8F;">name_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_ref_map</span> = local_ref_map_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: old_local_ref_map) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = kv.first;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">old_local_ref_jo</span> = kv.second;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_ref_jo</span> = local_ref_jo_t
            (old_local_ref_jo.level + 1,
             old_local_ref_jo.index);
        local_ref_map.insert (make_pair (name, local_ref_jo));
    }
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">index</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = name_vector.size ();
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (index &lt; size) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = name_vector [index];
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_ref_jo</span> = local_ref_jo_t (0, index);
        local_ref_map.insert (make_pair (name, local_ref_jo));
        index++;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> local_ref_map;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1e239b6" class="outline-3">
<h3 id="org1e239b6">keyword_fn</h3>
<div class="outline-text-3" id="text-org1e239b6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">keyword_fn</span> = <span style="color: #7CB8BB;">function</span>
    &lt;<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
     (<span style="color: #7CB8BB;">env_t</span> &amp;,
      <span style="color: #DFAF8F;">local_ref_map_t</span> &amp;,
      <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;)&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-org21082a6" class="outline-3">
<h3 id="org21082a6">keyword_o</h3>
<div class="outline-text-3" id="text-org21082a6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">keyword_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">keyword_fn</span> <span style="color: #DFAF8F;">fn</span>;
    <span style="color: #93E0E3;">keyword_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">keyword_fn</span> <span style="color: #DFAF8F;">fn</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org5b02329" class="outline-3">
<h3 id="org5b02329">keyword_o::keyword_o</h3>
<div class="outline-text-3" id="text-org5b02329">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">keyword_o</span>::
<span style="color: #93E0E3;">keyword_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">keyword_fn</span> <span style="color: #DFAF8F;">fn</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = <span style="color: #CC9393;">"keyword-t"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;fn = fn;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org11617cc" class="outline-3">
<h3 id="org11617cc">keyword_o::equal</h3>
<div class="outline-text-3" id="text-org11617cc">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">keyword_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">this</span> != obj.get ();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb5b0e92" class="outline-3">
<h3 id="orgb5b0e92">keyword_p</h3>
<div class="outline-text-3" id="text-orgb5b0e92">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">keyword_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == <span style="color: #CC9393;">"keyword-t"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2933319" class="outline-3">
<h3 id="org2933319">define_keyword</h3>
<div class="outline-text-3" id="text-org2933319">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">define_keyword</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>, <span style="color: #7CB8BB;">keyword_fn</span> <span style="color: #DFAF8F;">fn</span>)
{
    define (env, name, make_shared &lt;keyword_o&gt; (env, fn));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb613082" class="outline-3">
<h3 id="orgb613082">obj_vector_to_name_vector</h3>
<div class="outline-text-3" id="text-orgb613082">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_vector_t</span>
<span style="color: #93E0E3;">obj_vector_to_name_vector</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_vector_t</span> &amp;<span style="color: #DFAF8F;">obj_vect</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = name_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">obj</span>: obj_vect) {
        assert (str_p (env, obj));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = static_pointer_cast &lt;str_o&gt; (obj);
        name_vector.push_back (str-&gt;str);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> name_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org78c7439" class="outline-3">
<h3 id="org78c7439">import_keyword</h3>
<div class="outline-text-3" id="text-org78c7439">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_keyword</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_type (env, <span style="color: #CC9393;">"keyword-t"</span>);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3132e53" class="outline-2">
<h2 id="org3132e53">macro</h2>
</div>

<div id="outline-container-org2ef71f8" class="outline-2">
<h2 id="org2ef71f8">compile</h2>
<div class="outline-text-2" id="text-org2ef71f8">
</div><div id="outline-container-org126a741" class="outline-3">
<h3 id="org126a741">keyword_sexp_p</h3>
<div class="outline-text-3" id="text-org126a741">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">keyword_sexp_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, sexp)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> str_p (env, (car (env, sexp)))) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt; (car (env, sexp));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = head-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.box_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.box_map.end ()) {
        <span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (box-&gt;empty_p) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (keyword_p (env, box-&gt;obj)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
        <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfc09014" class="outline-3">
<h3 id="orgfc09014">get_keyword_fn</h3>
<div class="outline-text-3" id="text-orgfc09014">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">keyword_fn</span>
<span style="color: #93E0E3;">get_keyword_fn</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.box_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.box_map.end ()) {
        <span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (box-&gt;empty_p) {
            cout &lt;&lt; <span style="color: #CC9393;">"- fatal error: get_keyword_fn fail\n"</span>;
            exit (1);
        }
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (keyword_p (env, box-&gt;obj)) {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">keyword</span> = static_pointer_cast &lt;keyword_o&gt;
                (box-&gt;obj);
            <span style="color: #F0DFAF; font-weight: bold;">return</span> keyword-&gt;fn;
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> {
            cout &lt;&lt; <span style="color: #CC9393;">"- fatal error: get_keyword_fn fail\n"</span>;
            exit (1);
        };
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error: get_keyword_fn fail\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7a13a02" class="outline-3">
<h3 id="org7a13a02">jojo_append</h3>
<div class="outline-text-3" id="text-org7a13a02">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">jojo_append</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">ante</span>,
             <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">succ</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jo_vector</span> = jo_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span>: ante-&gt;jo_vector) jo_vector.push_back (x-&gt;copy ());
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span>: succ-&gt;jo_vector) jo_vector.push_back (x-&gt;copy ());
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc6aa44c" class="outline-3">
<h3 id="orgc6aa44c">dot_string_p</h3>
<div class="outline-text-3" id="text-orgc6aa44c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">dot_string_p</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">pos</span> = str.find (<span style="color: #CC9393;">"."</span>);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> (pos != <span style="color: #BFEBBF;">string</span>::npos);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5244903" class="outline-3">
<h3 id="org5244903">dot_string_compile</h3>
<div class="outline-text-3" id="text-org5244903">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">string_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
                <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>);

<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">dot_string_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
                    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">string_vector</span> = string_split (str, <span style="color: #DCDCCC; background-color: #3F3F3F;">'.</span><span style="color: #D0BF8F; font-weight: bold;">'</span>);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = string_compile
        (env, local_ref_map, string_vector [0]);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = string_vector.begin () + 1;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = string_vector.end ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++) {
        <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
            <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (*it),
        };
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">field_jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
        jojo = jojo_append (jojo, field_jojo);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5d348b" class="outline-3">
<h3 id="org5d348b">ref_compile</h3>
<div class="outline-text-3" id="text-org5d348b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">ref_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
             <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
             <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jo_vector</span> = jo_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = local_ref_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != local_ref_map.end ())
        jo_vector.push_back (it-&gt;second.copy ());
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        jo_vector.push_back (<span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, name)));
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbe1d5f6" class="outline-3">
<h3 id="orgbe1d5f6">string_string_p</h3>
<div class="outline-text-3" id="text-orgbe1d5f6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">string_string_p</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = str.size ();
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (size &lt; 2) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (str [0] != <span style="color: #DCDCCC; background-color: #3F3F3F;">'"</span><span style="color: #D0BF8F; font-weight: bold;">'</span>) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (str [size-1] != <span style="color: #DCDCCC; background-color: #3F3F3F;">'"</span><span style="color: #D0BF8F; font-weight: bold;">'</span>) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org92b95d6" class="outline-3">
<h3 id="org92b95d6">string_string_compile</h3>
<div class="outline-text-3" id="text-org92b95d6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">string_string_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                       <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
                       <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = str.size () - 2;
    str = str.substr (1, size);
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">lit_jo_t</span> (make_shared &lt;str_o&gt; (env, str)),
    };
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org429f843" class="outline-3">
<h3 id="org429f843">key_string_p</h3>
<div class="outline-text-3" id="text-org429f843">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">key_string_p</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = str.size ();
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (size &lt; 2) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (str [size-1] != <span style="color: #DCDCCC; background-color: #3F3F3F;">':</span><span style="color: #D0BF8F; font-weight: bold;">'</span>) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf0f4fe3" class="outline-3">
<h3 id="orgf0f4fe3">key_string_compile</h3>
<div class="outline-text-3" id="text-orgf0f4fe3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">key_string_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
                    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = str.size () - 1;
    str = str.substr (0, size);
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">lit_jo_t</span> (make_shared &lt;str_o&gt; (env, str)),
    };
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge580e09" class="outline-3">
<h3 id="orge580e09">int_string_p</h3>
<div class="outline-text-3" id="text-orge580e09">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">int_string_p</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = str.size ();
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (size &lt; 1) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (str [0] == <span style="color: #DCDCCC; background-color: #3F3F3F;">'-</span><span style="color: #D0BF8F; font-weight: bold;">'</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> int_string_p (str.substr (1, size - 1));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">pos</span> = str.find_first_not_of (<span style="color: #CC9393;">"0123456789"</span>);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> pos == <span style="color: #BFEBBF;">string</span>::npos;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd344379" class="outline-3">
<h3 id="orgd344379">int_string_compile</h3>
<div class="outline-text-3" id="text-orgd344379">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">int_string_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
                    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">i</span> = stoi (str);
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">lit_jo_t</span> (make_shared &lt;int_o&gt; (env, i)),
    };
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfc40b4f" class="outline-3">
<h3 id="orgfc40b4f">string_compile</h3>
<div class="outline-text-3" id="text-orgfc40b4f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">string_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
                <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (dot_string_p (str))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> dot_string_compile (env, local_ref_map, str);
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (string_string_p (str))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> string_string_compile (env, local_ref_map, str);
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (key_string_p (str))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> key_string_compile (env, local_ref_map, str);
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (int_string_p (str))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> int_string_compile (env, local_ref_map, str);
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> ref_compile (env, local_ref_map, str);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge497c25" class="outline-3">
<h3 id="orge497c25">vect_compile</h3>
<div class="outline-text-3" id="text-orge497c25">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">sexp_list_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                   <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
                   <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp_list</span>);

<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">vect_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
              <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
              <span style="color: #7CB8BB;">shared_ptr</span> &lt;vect_o&gt; <span style="color: #DFAF8F;">vect</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sexp_list</span> = vect_to_list (env, vect);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = sexp_list_compile
        (env, local_ref_map, sexp_list);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">counter</span> = list_length (env, sexp_list);
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">collect_vect_jo_t</span> (counter),
    };
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">ending_jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo_append (jojo, ending_jojo);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd31e7f1" class="outline-3">
<h3 id="orgd31e7f1">dict_compile</h3>
<div class="outline-text-3" id="text-orgd31e7f1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">dict_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
              <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
              <span style="color: #7CB8BB;">shared_ptr</span> &lt;dict_o&gt; <span style="color: #DFAF8F;">dict</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sexp_list</span> = dict_to_list (env, dict);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = sexp_list_compile
        (env, local_ref_map, sexp_list);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">counter</span> = list_length (env, sexp_list);
    counter = counter / 2;
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">collect_dict_jo_t</span> (counter),
    };
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">ending_jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo_append (jojo, ending_jojo);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3583b48" class="outline-3">
<h3 id="org3583b48">sexp_compile</h3>
<div class="outline-text-3" id="text-org3583b48">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">call_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
              <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
              <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>);

<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">sexp_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
              <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
              <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (str_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = static_pointer_cast &lt;str_o&gt; (sexp);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> string_compile (env, local_ref_map, str-&gt;str);
    }
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (vect_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">vect</span> = static_pointer_cast &lt;vect_o&gt; (sexp);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> vect_compile (env, local_ref_map, vect);
    }
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (dict_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">dict</span> = static_pointer_cast &lt;dict_o&gt; (sexp);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> dict_compile (env, local_ref_map, dict);
    }
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (keyword_sexp_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt; (car (env, sexp));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">body</span> = cdr (env, sexp);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = head-&gt;str;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">fn</span> = get_keyword_fn (env, name);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> fn (env, local_ref_map, body);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        assert (cons_p (env, sexp));
        <span style="color: #F0DFAF; font-weight: bold;">return</span> call_compile (env, local_ref_map, sexp);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc1634a1" class="outline-3">
<h3 id="orgc1634a1">sexp_list_compile</h3>
<div class="outline-text-3" id="text-orgc1634a1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">sexp_list_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                   <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
                   <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp_list</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (<span style="color: #DFAF8F;">jo_vector_t</span> ());
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, sexp_list))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo;
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        assert (cons_p (env, sexp_list));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head_jojo</span> = sexp_compile
            (env, local_ref_map, car (env, sexp_list));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">body_jojo</span> = sexp_list_compile
            (env, local_ref_map, cdr (env, sexp_list));
        <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo_append (head_jojo, body_jojo);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc300e7" class="outline-3">
<h3 id="orgc300e7">dot_head_p</h3>
<div class="outline-text-3" id="text-orgc300e7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">dot_head_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">head</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> str_p (env, head)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = static_pointer_cast &lt;str_o&gt; (head);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> dot_string_p (str-&gt;str);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4d11a50" class="outline-3">
<h3 id="org4d11a50">call_compile</h3>
<div class="outline-text-3" id="text-org4d11a50">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">call_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
              <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
              <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, sexp);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">body</span> = cdr (env, sexp);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jo_vector</span> = jo_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (dot_head_p (env, head)) {
        jo_vector.push_back
            (<span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (list_length (env, body) + 1));
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        jo_vector.push_back
            (<span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (list_length (env, body)));
    }
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head_jojo</span> = sexp_compile (env, local_ref_map, head);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">body_jojo</span> = sexp_list_compile (env, local_ref_map, body);
    jojo = jojo_append (head_jojo, jojo);
    jojo = jojo_append (body_jojo, jojo);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2c07df7" class="outline-3">
<h3 id="org2c07df7">import_compile</h3>
<div class="outline-text-3" id="text-org2c07df7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{

}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6b2c8f6" class="outline-3">
<h3 id="org6b2c8f6">test_compile</h3>
<div class="outline-text-3" id="text-org6b2c8f6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_compile</span> ()
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5689622" class="outline-2">
<h2 id="org5689622">eval</h2>
<div class="outline-text-2" id="text-org5689622">
</div><div id="outline-container-orgc6b4046" class="outline-3">
<h3 id="orgc6b4046">top_keyword_sexp_p</h3>
<div class="outline-text-3" id="text-orgc6b4046">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">top_keyword_sexp_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, sexp)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> str_p (env, (car (env, sexp)))) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt; (car (env, sexp));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = head-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.box_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.box_map.end ()) {
        <span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (box-&gt;empty_p) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (top_keyword_p (env, box-&gt;obj)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
        <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org760d6b3" class="outline-3">
<h3 id="org760d6b3">get_top_keyword_fn</h3>
<div class="outline-text-3" id="text-org760d6b3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">top_keyword_fn</span>
<span style="color: #93E0E3;">get_top_keyword_fn</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.box_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.box_map.end ()) {
        <span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (box-&gt;empty_p) {
            cout &lt;&lt; <span style="color: #CC9393;">"- fatal error: get_top_keyword_fn fail\n"</span>;
            exit (1);
        }
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (top_keyword_p (env, box-&gt;obj)) {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">top_keyword</span> = static_pointer_cast &lt;top_keyword_o&gt;
                (box-&gt;obj);
            <span style="color: #F0DFAF; font-weight: bold;">return</span> top_keyword-&gt;fn;
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> {
            cout &lt;&lt; <span style="color: #CC9393;">"- fatal error: get_top_keyword_fn fail\n"</span>;
            exit (1);
        };
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error: get_top_keyword_fn fail\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf2eed98" class="outline-3">
<h3 id="orgf2eed98">jojo_run</h3>
<div class="outline-text-3" id="text-orgf2eed98">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">jojo_run</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">base</span> = env.frame_stack.size ();
    env.frame_stack.push (new_frame_from_jojo (jojo));
    env.run_with_base (base);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org55986de" class="outline-3">
<h3 id="org55986de">sexp_eval</h3>
<div class="outline-text-3" id="text-org55986de">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">sexp_eval</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (top_keyword_sexp_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt; (car (env, sexp));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">body</span> = cdr (env, sexp);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = head-&gt;str;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">fn</span> = get_top_keyword_fn (env, name);
        fn (env, body);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_ref_map</span> = local_ref_map_t ();
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = sexp_compile (env, local_ref_map, sexp);
        jojo_run (env, jojo);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org51b6c94" class="outline-3">
<h3 id="org51b6c94">sexp_list_eval</h3>
<div class="outline-text-3" id="text-org51b6c94">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">sexp_list_eval</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp_list</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, sexp_list))
        <span style="color: #F0DFAF; font-weight: bold;">return</span>;
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        sexp_eval (env, car (env, sexp_list));
        sexp_list_eval (env, cdr (env, sexp_list));
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb877908" class="outline-3">
<h3 id="orgb877908">top_sexp_eval</h3>
<div class="outline-text-3" id="text-orgb877908">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">top_sexp_eval</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (top_keyword_sexp_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt; (car (env, sexp));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">body</span> = cdr (env, sexp);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = head-&gt;str;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">fn</span> = get_top_keyword_fn (env, name);
        fn (env, body);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_ref_map</span> = local_ref_map_t ();
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = sexp_compile (env, local_ref_map, sexp);
        jojo_run (env, jojo);
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> env.obj_stack.empty ())
            env.obj_stack.pop ();
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org48fd3db" class="outline-3">
<h3 id="org48fd3db">top_sexp_list_eval</h3>
<div class="outline-text-3" id="text-org48fd3db">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">top_sexp_list_eval</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp_list</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, sexp_list))
        <span style="color: #F0DFAF; font-weight: bold;">return</span>;
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        top_sexp_eval (env, car (env, sexp_list));
        top_sexp_list_eval (env, cdr (env, sexp_list));
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org249b0dd" class="outline-3">
<h3 id="org249b0dd">code_eval</h3>
<div class="outline-text-3" id="text-org249b0dd">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">code_eval</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;str_o&gt; <span style="color: #DFAF8F;">code</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word_list</span> = scan_word_list (env, code);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sexp_list</span> = parse_sexp_list (env, word_list);
    top_sexp_list_eval (env, sexp_list);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org82f4ba0" class="outline-3">
<h3 id="org82f4ba0">import_eval</h3>
<div class="outline-text-3" id="text-org82f4ba0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_eval</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{

}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc12b46c" class="outline-3">
<h3 id="orgc12b46c"><span class="todo _todo_">[todo]</span> test_eval</h3>
<div class="outline-text-3" id="text-orgc12b46c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_eval</span> ()
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org973fdb8" class="outline-2">
<h2 id="org973fdb8">syntax</h2>
<div class="outline-text-2" id="text-org973fdb8">
</div><div id="outline-container-org2ffc207" class="outline-3">
<h3 id="org2ffc207">(=)</h3>
<div class="outline-text-3" id="text-org2ffc207">
</div><div id="outline-container-org3798d10" class="outline-4">
<h4 id="org3798d10">(= &lt;name&gt; (data &#x2026;))</h4>
<div class="outline-text-4" id="text-org3798d10">
</div><div id="outline-container-org7a6fa60" class="outline-5">
<h5 id="org7a6fa60"><span class="todo _note_">[note]</span> type must all be top-level</h5>
<div class="outline-text-5" id="text-org7a6fa60">
<ul class="org-ul">
<li><p>and (= a.b.c &#x2026;) is not handled.</p></li></ul>
</div>
</div>

<div id="outline-container-org2fdc8eb" class="outline-5">
<h5 id="org2fdc8eb">assign_data_p</h5>
<div class="outline-text-5" id="text-org2fdc8eb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">assign_data_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, body))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> str_p (env, car (env, body)))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, cdr (env, body)))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, car (env, cdr (env, body))))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> str_p (env, car (env, car (env, cdr (env, body)))))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = static_pointer_cast &lt;str_o&gt;
        (car (env, car (env, cdr (env, body))));
    <span style="color: #F0DFAF; font-weight: bold;">return</span> str-&gt;str == <span style="color: #CC9393;">"data"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgea2eb84" class="outline-5">
<h5 id="orgea2eb84">type_name_to_data_name</h5>
<div class="outline-text-5" id="text-orgea2eb84">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_t</span>
<span style="color: #93E0E3;">type_name_to_data_name</span> (<span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">type_name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">data_name</span> = type_name;
    data_name.pop_back ();
    data_name.pop_back ();
    data_name += <span style="color: #CC9393;">"-c"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> data_name;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1798338" class="outline-5">
<h5 id="org1798338">tk_assign_data</h5>
<div class="outline-text-5" id="text-org1798338">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">tk_assign_data</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt; (car (env, body));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">type_name</span> = head-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">data_name</span> = type_name_to_data_name (type_name);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">type_tag</span> = type_name;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">data_body</span> = cdr (env, (car (env, rest)));
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, data_body)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">data</span> = make_shared &lt;data_o&gt;
            (env, type_tag, <span style="color: #7CB8BB;">obj_map_t</span> ());
        define (env, data_name, data);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">type</span> = make_shared &lt;type_o&gt;
            (env, type_tag, <span style="color: #7CB8BB;">obj_map_t</span> ());
        define (env, type_name, type);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vect</span> = list_to_vect (env, data_body);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = name_vector_t ();
        <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span>: name_vect-&gt;obj_vector) {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = static_pointer_cast &lt;str_o&gt; (obj);
            name_vector.push_back (str-&gt;str);
        }
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">data_cons</span> = make_shared &lt;data_cons_o&gt;
            (env, type_tag, name_vector, <span style="color: #7CB8BB;">obj_map_t</span> ());
        define (env, data_name, data_cons);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">type</span> = make_shared &lt;type_o&gt;
            (env, type_tag, <span style="color: #7CB8BB;">obj_map_t</span> ());
        define (env, type_name, type);
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2efd557" class="outline-4">
<h4 id="org2efd557">(= (&lt;name&gt; &#x2026;) &#x2026;)</h4>
<div class="outline-text-4" id="text-org2efd557">
</div><div id="outline-container-orgeac741a" class="outline-5">
<h5 id="orgeac741a">assign_lambda_sugar_p</h5>
<div class="outline-text-5" id="text-orgeac741a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">assign_lambda_sugar_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, body))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, car (env, body)))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org786f943" class="outline-5">
<h5 id="org786f943">assign_lambda_desugar</h5>
<div class="outline-text-5" id="text-org786f943">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">assign_lambda_desugar</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = car (env, head);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lambda_body</span> = cdr (env, body);
    lambda_body = cons_c
        (env,
         list_to_vect (env, cdr (env, head)),
         lambda_body);
    lambda_body = cons_c
        (env,
         make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"lambda"</span>),
         lambda_body);
    lambda_body = cons_c
        (env,
         lambda_body,
         null_c (env));
    <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (env, name, lambda_body);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3edd4f3" class="outline-4">
<h4 id="org3edd4f3">(= &lt;name&gt; &#x2026;)</h4>
<div class="outline-text-4" id="text-org3edd4f3">
</div><div id="outline-container-orgf785bfe" class="outline-5">
<h5 id="orgf785bfe">sexp_substitute_recur</h5>
<div class="outline-text-5" id="text-orgf785bfe">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">sexp_substitute_recur</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                       <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sub</span>,
                       <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (str_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = static_pointer_cast &lt;str_o&gt; (sexp);
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (str-&gt;str == <span style="color: #CC9393;">"recur"</span>)
            <span style="color: #F0DFAF; font-weight: bold;">return</span> sub;
        <span style="color: #F0DFAF; font-weight: bold;">else</span>
            <span style="color: #F0DFAF; font-weight: bold;">return</span> sexp;
    }
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (cons_p (env, sexp))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c
            (env,
             sexp_substitute_recur (env, sub, car (env, sexp)),
             sexp_substitute_recur (env, sub, cdr (env, sexp)));
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (vect_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">vect_sexp</span> = static_pointer_cast &lt;vect_o&gt; (sexp);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">list_sexp</span> = vect_to_list (env, vect_sexp);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">new_list_sexp</span> = sexp_substitute_recur (env, sub, list_sexp);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> list_to_vect (env, new_list_sexp);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> sexp;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfde5153" class="outline-5">
<h5 id="orgfde5153">lambda_sexp_patch_this</h5>
<div class="outline-text-5" id="text-orgfde5153">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">lambda_sexp_patch_this</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">lambda_sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">vect</span> = static_pointer_cast &lt;vect_o&gt;
        (car (env, (cdr (env, lambda_sexp))));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">vector</span> = vect-&gt;obj_vector;
    reverse (vector.begin (),
             vector.end ());
    vector.push_back (make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"this"</span>));
    reverse (vector.begin (),
             vector.end ());
    <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (env,
                   car (env, lambda_sexp),
                   cons_c (env,
                           make_shared &lt;vect_o&gt; (env, vector),
                           cdr (env, cdr (env, lambda_sexp))));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4c4e577" class="outline-5">
<h5 id="org4c4e577">rest_patch_this</h5>
<div class="outline-text-5" id="text-org4c4e577">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">rest_patch_this</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">rest</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, rest))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> rest;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sexp</span> = car (env, rest);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, sexp))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> rest;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, sexp);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> str_p (env, head))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> rest;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = static_pointer_cast &lt;str_o&gt; (head);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (str-&gt;str == <span style="color: #CC9393;">"lambda"</span>) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c
            (env,
             lambda_sexp_patch_this (env, sexp),
             cdr (env, rest));
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">return</span> rest;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org609df3e" class="outline-5">
<h5 id="org609df3e">tk_assign_value</h5>
<div class="outline-text-5" id="text-org609df3e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">tk_assign_value</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt; (car (env, body));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = head-&gt;str;
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">prefix</span> = <span style="color: #CC9393;">""</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">string_vector</span> = string_split (name, <span style="color: #DCDCCC; background-color: #3F3F3F;">'.</span><span style="color: #D0BF8F; font-weight: bold;">'</span>);
    assert (string_vector.size () &lt;= 2);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (string_vector.size () == 2) {
        prefix = string_vector [0];
        name = string_vector [1];
        rest = rest_patch_this (env, rest);
    }
    rest = sexp_substitute_recur (env, head, rest);
    sexp_list_eval (env, rest);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
    env.obj_stack.pop ();
    assign (env, prefix, name, obj);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org30fb4ce" class="outline-4">
<h4 id="org30fb4ce">tk_assign</h4>
<div class="outline-text-4" id="text-org30fb4ce">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">tk_assign</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (assign_data_p (env, body))
        tk_assign_data (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (assign_lambda_sugar_p (env, body))
        tk_assign_value (env, assign_lambda_desugar (env, body));
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        tk_assign_value (env, body);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf4f59d6" class="outline-3">
<h3 id="orgf4f59d6">(lambda)</h3>
<div class="outline-text-3" id="text-orgf4f59d6">
</div><div id="outline-container-org4e78521" class="outline-4">
<h4 id="org4e78521">lambda_jo</h4>
<div class="outline-text-4" id="text-org4e78521">
</div><div id="outline-container-org8176cea" class="outline-5">
<h5 id="org8176cea">lambda_jo_t</h5>
<div class="outline-text-5" id="text-org8176cea">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">lambda_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>;
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>;
    <span style="color: #93E0E3;">lambda_jo_t</span> (<span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
                 <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>);
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfa78af7" class="outline-5">
<h5 id="orgfa78af7">lambda_jo_t::lambda_jo_t</h5>
<div class="outline-text-5" id="text-orgfa78af7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">lambda_jo_t</span>::
<span style="color: #93E0E3;">lambda_jo_t</span> (<span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
             <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector = name_vector;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo = jojo;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6785cf6" class="outline-5">
<h5 id="org6785cf6">lambda_jo_t::copy</h5>
<div class="outline-text-5" id="text-org6785cf6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">lambda_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">lambda_jo_t</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf6977e4" class="outline-5">
<h5 id="orgf6977e4">lambda_jo_t::exe</h5>
<div class="outline-text-5" id="text-orgf6977e4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">lambda_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">closure</span> = make_shared &lt;closure_o&gt;
        (env,
         <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector,
         <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo,
         bind_vector_from_name_vector (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector),
         local_scope);
    env.obj_stack.push (closure);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org19287c7" class="outline-5">
<h5 id="org19287c7">lambda_jo_t::repr</h5>
<div class="outline-text-5" id="text-org19287c7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">lambda_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"(lambda "</span> +
        name_vector_repr (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector) +
        <span style="color: #CC9393;">" "</span> +
        jojo_repr (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo) +
        <span style="color: #CC9393;">")"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgcb6e8db" class="outline-4">
<h4 id="orgcb6e8db">lambda_patch_drop</h4>
<div class="outline-text-4" id="text-orgcb6e8db">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">lambda_patch_drop</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp_list</span>)
{
    assert (cons_p (env, sexp_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, sexp_list);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, sexp_list);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, rest)) <span style="color: #F0DFAF; font-weight: bold;">return</span> sexp_list;
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">drop</span> = cons_c
            (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"drop"</span>),
             null_c (env));
        sexp_list = lambda_patch_drop (env, rest);
        sexp_list = cons_c (env, drop, sexp_list);
        sexp_list = cons_c (env, head, sexp_list);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> sexp_list;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8708273" class="outline-4">
<h4 id="org8708273">k_lambda</h4>
<div class="outline-text-4" id="text-org8708273">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">k_lambda</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
          <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">old_local_ref_map</span>,
          <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vect</span> = static_pointer_cast &lt;vect_o&gt; (car (env, body));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = obj_vector_to_name_vector
        (env, name_vect-&gt;obj_vector);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_ref_map</span> = local_ref_map_extend
        (env, old_local_ref_map, name_vector);
    rest = lambda_patch_drop (env, rest);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest_jojo</span> = sexp_list_compile
        (env, local_ref_map, rest);
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">lambda_jo_t</span> (name_vector, rest_jojo),
    };
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org98ed669" class="outline-3">
<h3 id="org98ed669">(case)</h3>
<div class="outline-text-3" id="text-org98ed669">
</div><div id="outline-container-org77d82f0" class="outline-4">
<h4 id="org77d82f0">case_jo</h4>
<div class="outline-text-4" id="text-org77d82f0">
</div><div id="outline-container-orgf89ae7a" class="outline-5">
<h5 id="orgf89ae7a">case_jo_t</h5>
<div class="outline-text-5" id="text-orgf89ae7a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">case_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">jojo_map_t</span> <span style="color: #DFAF8F;">jojo_map</span>;
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">default_jojo</span>;
    <span style="color: #93E0E3;">case_jo_t</span> (<span style="color: #7CB8BB;">jojo_map_t</span> <span style="color: #DFAF8F;">jojo_map</span>);
    <span style="color: #93E0E3;">case_jo_t</span> (<span style="color: #7CB8BB;">jojo_map_t</span> <span style="color: #DFAF8F;">jojo_map</span>,
               <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">default_jojo</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">has_default_jojo_p</span> ();
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org2dc3566" class="outline-5">
<h5 id="org2dc3566">case_jo_t::case_jo_t</h5>
<div class="outline-text-5" id="text-org2dc3566">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">case_jo_t</span>::
<span style="color: #93E0E3;">case_jo_t</span> (<span style="color: #7CB8BB;">jojo_map_t</span> <span style="color: #DFAF8F;">jojo_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo_map = jojo_map;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;default_jojo = <span style="color: #BFEBBF;">nullptr</span>;
}

<span style="color: #BFEBBF;">case_jo_t</span>::
<span style="color: #93E0E3;">case_jo_t</span> (<span style="color: #7CB8BB;">jojo_map_t</span> <span style="color: #DFAF8F;">jojo_map</span>,
           <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">default_jojo</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo_map = jojo_map;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;default_jojo = default_jojo;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7b928a6" class="outline-5">
<h5 id="org7b928a6">case_jo_t::has_default_jojo_p</h5>
<div class="outline-text-5" id="text-org7b928a6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">case_jo_t</span>::<span style="color: #93E0E3;">has_default_jojo_p</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;default_jojo != <span style="color: #BFEBBF;">nullptr</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org494833" class="outline-5">
<h5 id="org494833">case_jo_t::copy</h5>
<div class="outline-text-5" id="text-org494833">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">case_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">case_jo_t</span>
        (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo_map,
         <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;default_jojo);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org27f87ca" class="outline-5">
<h5 id="org27f87ca">case_jo_t::exe</h5>
<div class="outline-text-5" id="text-org27f87ca">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">case_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
    env.obj_stack.pop ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo_map.find (obj-&gt;tag);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo_map.end ()) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">frame</span> = make_shared &lt;<span style="color: #7CB8BB;">frame_t</span>&gt; (jojo, local_scope);
        env.frame_stack.push (frame);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;has_default_jojo_p ()) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;default_jojo;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">frame</span> = make_shared &lt;<span style="color: #7CB8BB;">frame_t</span>&gt; (jojo, local_scope);
        env.frame_stack.push (frame);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : case_jo_t::exe mismatch"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  tag : "</span> &lt;&lt; obj-&gt;tag &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }

}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3c02cb8" class="outline-5">
<h5 id="org3c02cb8"><span class="todo _todo_">[todo]</span> case_jo_t::repr</h5>
<div class="outline-text-5" id="text-org3c02cb8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">case_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"(case)"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1315050" class="outline-4">
<h4 id="org1315050">case_compile</h4>
<div class="outline-text-4" id="text-org1315050">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">case_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
              <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
              <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo_map</span> = jojo_map_t ();
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">default_jojo</span> = <span style="color: #BFEBBF;">nullptr</span>;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> null_p (env, body)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">one</span> = car (env, body);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt; (car (env, one));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, one);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = head-&gt;str;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (name == <span style="color: #CC9393;">"_"</span>) {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = sexp_list_compile (env, local_ref_map, rest);
            body = cdr (env, body);
            default_jojo = jojo;
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">tag</span> = name;
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = sexp_list_compile (env, local_ref_map, rest);
            jojo_map.insert (make_pair (tag, jojo));
            body = cdr (env, body);
        }
    }
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">case_jo_t</span> (jojo_map, default_jojo),
    };
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3cb37ab" class="outline-4">
<h4 id="org3cb37ab">k_case</h4>
<div class="outline-text-4" id="text-org3cb37ab">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">k_case</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
        <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
        <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head_jojo</span> = sexp_compile (env, local_ref_map, head);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest_jojo</span> = case_compile (env, local_ref_map, rest);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo_append (head_jojo, rest_jojo);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb89d06e" class="outline-3">
<h3 id="orgb89d06e">(quote)</h3>
<div class="outline-text-3" id="text-orgb89d06e">
</div><div id="outline-container-org475e032" class="outline-4">
<h4 id="org475e032">sexp_literalize</h4>
<div class="outline-text-4" id="text-org475e032">
</div><div id="outline-container-orgcca59fc" class="outline-5">
<h5 id="orgcca59fc">forward declaration</h5>
<div class="outline-text-5" id="text-orgcca59fc">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">sexp_literalize</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>);
</pre>
</div>
</div>
</div>

<div id="outline-container-org8b08ae4" class="outline-5">
<h5 id="org8b08ae4">str_sexp_literalize</h5>
<div class="outline-text-5" id="text-org8b08ae4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">str_sexp_literalize</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;str_o&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = sexp-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (int_string_p (str)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">i</span> = stoi (str);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;int_o&gt; (env, i);
    }
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (string_string_p (str)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = str.size () - 2;
        str = str.substr (1, size);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;str_o&gt; (env, str);
    }
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (key_string_p (str)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = str.size () - 1;
        str = str.substr (0, size);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;str_o&gt; (env, str);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> sexp;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7c55f27" class="outline-5">
<h5 id="org7c55f27">vect_sexp_literalize</h5>
<div class="outline-text-5" id="text-org7c55f27">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">vect_sexp_literalize</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;vect_o&gt; <span style="color: #DFAF8F;">vect</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_vector</span> = obj_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">sexp</span>: vect-&gt;obj_vector) {
        obj_vector.push_back (sexp_literalize (env, sexp));
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;vect_o&gt; (env, obj_vector);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfb2eba9" class="outline-5">
<h5 id="orgfb2eba9">dict_sexp_literalize</h5>
<div class="outline-text-5" id="text-orgfb2eba9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">dict_sexp_literalize</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;dict_o&gt; <span style="color: #DFAF8F;">dict</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = obj_map_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: dict-&gt;obj_map) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">key</span> = kv.first;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sexp</span> = kv.second;
        obj_map.insert
            (make_pair (key, sexp_literalize (env, sexp)));
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;dict_o&gt; (env, obj_map);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1c2899d" class="outline-5">
<h5 id="org1c2899d">sexp_literalize</h5>
<div class="outline-text-5" id="text-org1c2899d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">sexp_literalize</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (str_p (env, sexp))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> str_sexp_literalize
            (env, static_pointer_cast &lt;str_o&gt; (sexp));
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (vect_p (env, sexp))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> vect_sexp_literalize
            (env, static_pointer_cast &lt;vect_o&gt; (sexp));
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (dict_p (env, sexp))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> dict_sexp_literalize
            (env, static_pointer_cast &lt;dict_o&gt; (sexp));
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, sexp))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> sexp;
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        assert (cons_p (env, sexp));
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c
            (env,
             sexp_literalize (env, car (env, sexp)),
             sexp_literalize (env, cdr (env, sexp)));
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgcbd85ee" class="outline-4">
<h4 id="orgcbd85ee">k_quote</h4>
<div class="outline-text-4" id="text-orgcbd85ee">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">k_quote</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
         <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
         <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    assert (cons_p (env, body));
    assert (null_p (env, cdr (env, body)));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sexp</span> = car (env, body);
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">lit_jo_t</span> (sexp_literalize (env, sexp)),
    };
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2490b38" class="outline-3">
<h3 id="org2490b38">(note)</h3>
<div class="outline-text-3" id="text-org2490b38">
</div><div id="outline-container-orgaf6c055" class="outline-4">
<h4 id="orgaf6c055">k_note</h4>
<div class="outline-text-4" id="text-orgaf6c055">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">k_note</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
        <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
        <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    body = cons_c (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"note"</span>),
                   body);
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">lit_jo_t</span> (body),
    };
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1717501" class="outline-3">
<h3 id="org1717501">(assert)</h3>
<div class="outline-text-3" id="text-org1717501">
</div><div id="outline-container-org1a7fb92" class="outline-4">
<h4 id="org1a7fb92">assert_jo</h4>
<div class="outline-text-4" id="text-org1a7fb92">
</div><div id="outline-container-org81efcc3" class="outline-5">
<h5 id="org81efcc3">assert_jo_t</h5>
<div class="outline-text-5" id="text-org81efcc3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">assert_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>;
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>;
    <span style="color: #93E0E3;">assert_jo_t</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>,
                 <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>);
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org4f71ea1" class="outline-5">
<h5 id="org4f71ea1">assert_jo_t::assert_jo_t</h5>
<div class="outline-text-5" id="text-org4f71ea1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">assert_jo_t</span>::
<span style="color: #93E0E3;">assert_jo_t</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>,
             <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;body = body;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo = jojo;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org647db81" class="outline-5">
<h5 id="org647db81">assert_jo_t::copy</h5>
<div class="outline-text-5" id="text-org647db81">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">assert_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">assert_jo_t</span>
        (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;body,
         <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgea9ba14" class="outline-5">
<h5 id="orgea9ba14">assert_jo_t::exe</h5>
<div class="outline-text-5" id="text-orgea9ba14">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">true_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>);

<span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">sexp_list_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>);

<span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">assert_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">base</span> = env.frame_stack.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">frame</span> = make_shared &lt;<span style="color: #7CB8BB;">frame_t</span>&gt; (jojo, local_scope);
    env.frame_stack.push (frame);
    env.run_with_base (base);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">result</span> = env.obj_stack.top ();
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (true_p (env, result)) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        env.frame_stack_report ();
        env.obj_stack_report ();
        cout &lt;&lt; <span style="color: #CC9393;">"- assert fail : "</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        cout &lt;&lt; <span style="color: #CC9393;">"  "</span> &lt;&lt; sexp_list_repr (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;body) &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org90120da" class="outline-5">
<h5 id="org90120da"><span class="todo _todo_">[todo]</span> assert_jo_t::repr</h5>
<div class="outline-text-5" id="text-org90120da">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">assert_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"(assert)"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org91a4a24" class="outline-4">
<h4 id="org91a4a24">k_assert</h4>
<div class="outline-text-4" id="text-org91a4a24">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">k_assert</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
          <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
          <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = sexp_list_compile (env, local_ref_map, body);
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">new assert_jo_t (sexp_literalize (env, body), jojo),</span>
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">assert_jo_t</span> (body, jojo),
    };
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2f7d40d" class="outline-3">
<h3 id="org2f7d40d">import_syntax</h3>
<div class="outline-text-3" id="text-org2f7d40d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_syntax</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_top_keyword (env, <span style="color: #CC9393;">"="</span>, tk_assign);
    define_keyword (env, <span style="color: #CC9393;">"lambda"</span>, k_lambda);
    define_keyword (env, <span style="color: #CC9393;">"case"</span>, k_case);
    define_keyword (env, <span style="color: #CC9393;">"quote"</span>, k_quote);
    define_keyword (env, <span style="color: #CC9393;">"note"</span>, k_note);
    define_keyword (env, <span style="color: #CC9393;">"assert"</span>, k_assert);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdc1b7fd" class="outline-3">
<h3 id="orgdc1b7fd">test_syntax</h3>
<div class="outline-text-3" id="text-orgdc1b7fd">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_syntax</span> ()
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga60586d" class="outline-2">
<h2 id="orga60586d">stack</h2>
<div class="outline-text-2" id="text-orga60586d">
</div><div id="outline-container-org7a843ca" class="outline-3">
<h3 id="org7a843ca">jj_drop</h3>
<div class="outline-text-3" id="text-org7a843ca">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_drop_sig</span> = { <span style="color: #CC9393;">"drop"</span> };
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_drop</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    env.obj_stack.pop ();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1ede7ea" class="outline-3">
<h3 id="org1ede7ea">import_stack</h3>
<div class="outline-text-3" id="text-org1ede7ea">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_stack</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_prim (env,
                 jj_drop_sig,
                 jj_drop);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7a5e5a8" class="outline-3">
<h3 id="org7a5e5a8">test_stack</h3>
<div class="outline-text-3" id="text-org7a5e5a8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_stack</span> ()
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd987f3c" class="outline-2">
<h2 id="orgd987f3c">misc</h2>
<div class="outline-text-2" id="text-orgd987f3c">
</div><div id="outline-container-org936ec6" class="outline-3">
<h3 id="org936ec6">jj_repr</h3>
<div class="outline-text-3" id="text-org936ec6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_repr_sig</span> = { <span style="color: #CC9393;">"repr"</span>, <span style="color: #CC9393;">"obj"</span> };
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = obj_map [<span style="color: #CC9393;">"obj"</span>];
    env.obj_stack.push
        (make_shared &lt;str_o&gt;
         (env, obj-&gt;repr (env)));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3972de1" class="outline-3">
<h3 id="org3972de1">jj_print</h3>
<div class="outline-text-3" id="text-org3972de1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_print_sig</span> = { <span style="color: #CC9393;">"print"</span>, <span style="color: #CC9393;">"obj"</span> };
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_print</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = obj_map [<span style="color: #CC9393;">"obj"</span>];
    cout &lt;&lt; obj-&gt;repr (env) &lt;&lt; flush;
    env.obj_stack.push (obj);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc61618" class="outline-3">
<h3 id="orgc61618">jj_println</h3>
<div class="outline-text-3" id="text-orgc61618">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_println_sig</span> = { <span style="color: #CC9393;">"println"</span>, <span style="color: #CC9393;">"obj"</span> };
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_println</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = obj_map [<span style="color: #CC9393;">"obj"</span>];
    cout &lt;&lt; obj-&gt;repr (env) &lt;&lt; <span style="color: #CC9393;">"\n"</span> &lt;&lt; flush;
    env.obj_stack.push (obj);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6dad9d9" class="outline-3">
<h3 id="org6dad9d9">jj_nl</h3>
<div class="outline-text-3" id="text-org6dad9d9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_nl_sig</span> = { <span style="color: #CC9393;">"nl"</span> };
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_nl</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    cout &lt;&lt; <span style="color: #CC9393;">"\n"</span> &lt;&lt; flush;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">nl</span> = make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"\n"</span>);
    env.obj_stack.push (nl);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8db41dc" class="outline-3">
<h3 id="org8db41dc">jj_equal</h3>
<div class="outline-text-3" id="text-org8db41dc">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_equal_sig</span> = { <span style="color: #CC9393;">"equal"</span>, <span style="color: #CC9393;">"lhs"</span>, <span style="color: #CC9393;">"rhs"</span> };
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lhs</span> = obj_map [<span style="color: #CC9393;">"lhs"</span>];
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rhs</span> = obj_map [<span style="color: #CC9393;">"rhs"</span>];
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (obj_equal (env, lhs, rhs))
        env.obj_stack.push (true_c (env));
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        env.obj_stack.push (false_c (env));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org472b5ca" class="outline-3">
<h3 id="org472b5ca">jj_env_report</h3>
<div class="outline-text-3" id="text-org472b5ca">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_env_report_sig</span> = { <span style="color: #CC9393;">"env-report"</span> };
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_env_report</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    env.report ();
    env.obj_stack.push (true_c (env));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1a2c1de" class="outline-3">
<h3 id="org1a2c1de">import_misc</h3>
<div class="outline-text-3" id="text-org1a2c1de">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_misc</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_type (env, <span style="color: #CC9393;">"closure-t"</span>);
    define_type (env, <span style="color: #CC9393;">"data-cons-t"</span>);
    define_type (env, <span style="color: #CC9393;">"prim-t"</span>);
    define_prim (env,
                 jj_repr_sig,
                 jj_repr);
    define_prim (env,
                 jj_print_sig,
                 jj_print);
    define_prim (env,
                 jj_println_sig,
                 jj_println);
    define_prim (env,
                 jj_nl_sig,
                 jj_nl);
    define_prim (env,
                 jj_equal_sig,
                 jj_equal);
    define_prim (env,
                 jj_env_report_sig,
                 jj_env_report);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf8fb9c4" class="outline-3">
<h3 id="orgf8fb9c4">test_misc</h3>
<div class="outline-text-3" id="text-orgf8fb9c4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_misc</span> ()
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3eaa923" class="outline-2">
<h2 id="org3eaa923">epilog</h2>
<div class="outline-text-2" id="text-org3eaa923">
</div><div id="outline-container-orgef7c1ba" class="outline-3">
<h3 id="orgef7c1ba">test</h3>
<div class="outline-text-3" id="text-orgef7c1ba">
</div><div id="outline-container-org90cba6b" class="outline-4">
<h4 id="org90cba6b">test_step</h4>
<div class="outline-text-4" id="text-org90cba6b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_step</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    define (env, <span style="color: #CC9393;">"s1"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    {
        env.run ();
        assert_stack_size (env, 2);
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org62995f" class="outline-4">
<h4 id="org62995f">test_data</h4>
<div class="outline-text-4" id="text-org62995f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_data</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span> = {
        {<span style="color: #CC9393;">"car"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>)},
        {<span style="color: #CC9393;">"cdr"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>)},
    };

    define (env, <span style="color: #CC9393;">"last-cry"</span>, make_shared &lt;data_o&gt;
            (env, <span style="color: #CC9393;">"cons-t"</span>, obj_map));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"last-cry"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #CC9393;">"car"</span>),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"last-cry"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #CC9393;">"cdr"</span>),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"last-cry"</span>)),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    {
        env.run ();

        assert_stack_size (env, 3);
        assert_pop_eq (env, make_shared &lt;data_o&gt;
                       (env,
                        <span style="color: #CC9393;">"cons-t"</span>,
                        obj_map));
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgceef064" class="outline-4">
<h4 id="orgceef064">test_apply</h4>
<div class="outline-text-4" id="text-orgceef064">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_apply</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    define (env, <span style="color: #CC9393;">"s1"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">body</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">local_ref_jo_t</span> (0, 0),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">local_ref_jo_t</span> (0, 1),
    };

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">lambda_jo_t</span> ({ <span style="color: #CC9393;">"x"</span>, <span style="color: #CC9393;">"y"</span> },
                         make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (body)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (2),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">env.double_report ();</span>

    {
        env.run ();
        assert_stack_size (env, 2);
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org21cb9e8" class="outline-4">
<h4 id="org21cb9e8">test_lambda_curry</h4>
<div class="outline-text-4" id="text-org21cb9e8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_lambda_curry</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    define (env, <span style="color: #CC9393;">"s1"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">body</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">local_ref_jo_t</span> (0, 0),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">local_ref_jo_t</span> (0, 1),
    };

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">lambda_jo_t</span> ({ <span style="color: #CC9393;">"x"</span>, <span style="color: #CC9393;">"y"</span> },
                         make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (body)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">{</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">}</span>

    {
        env.run ();
        assert_stack_size (env, 2);
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org27bca42" class="outline-4">
<h4 id="org27bca42">test_data_cons</h4>
<div class="outline-text-4" id="text-org27bca42">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_data_cons</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    define (env, <span style="color: #CC9393;">"s1"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
    define (env, <span style="color: #CC9393;">"cons-c"</span>, make_shared &lt;data_cons_o&gt;
            (env,
             <span style="color: #CC9393;">"cons-t"</span>,
             name_vector_t ({ <span style="color: #CC9393;">"car"</span>, <span style="color: #CC9393;">"cdr"</span> }),
             <span style="color: #7CB8BB;">obj_map_t</span> ()));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"cons-c"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (2),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #CC9393;">"cdr"</span>),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">env.double_report ();</span>

    {
        env.run ();
        assert_stack_size (env, 1);
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd2deaa5" class="outline-4">
<h4 id="orgd2deaa5">test_data_cons_curry</h4>
<div class="outline-text-4" id="text-orgd2deaa5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_data_cons_curry</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    define (env, <span style="color: #CC9393;">"s1"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
    define (env, <span style="color: #CC9393;">"cons-c"</span>, make_shared &lt;data_cons_o&gt;
            (env,
             <span style="color: #CC9393;">"cons-t"</span>,
             name_vector_t ({ <span style="color: #CC9393;">"car"</span>, <span style="color: #CC9393;">"cdr"</span> }),
             <span style="color: #7CB8BB;">obj_map_t</span> ()));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"cons-c"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #CC9393;">"car"</span>),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">env.double_report ();</span>

    {
        env.run ();
        assert_stack_size (env, 1);
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7165cd1" class="outline-4">
<h4 id="org7165cd1">test_prim</h4>
<div class="outline-text-4" id="text-org7165cd1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_prim</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    define (env, <span style="color: #CC9393;">"s1"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));

    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">swap</span> =
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (obj_map [<span style="color: #CC9393;">"y"</span>]);
            env.obj_stack.push (obj_map [<span style="color: #CC9393;">"x"</span>]);
        };

    define (env, <span style="color: #CC9393;">"swap"</span>, make_shared &lt;prim_o&gt;
            (env,
             name_vector_t { <span style="color: #CC9393;">"x"</span>, <span style="color: #CC9393;">"y"</span> },
             swap,
             <span style="color: #7CB8BB;">obj_map_t</span> ()));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"swap"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (2),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"swap"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">env.double_report ();</span>

    {
        env.run ();
        assert_stack_size (env, 4);
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5882a90" class="outline-3">
<h3 id="org5882a90">test_all</h3>
<div class="outline-text-3" id="text-org5882a90">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_all</span> ()
{
    test_step ();
    test_data ();
    test_apply ();
    test_lambda_curry ();
    test_data_cons ();
    test_data_cons_curry ();
    test_prim ();
    test_bool ();
    test_int ();
    test_str ();
    test_list ();
    test_vect ();
    test_dict ();
    test_sexp ();
    test_eval ();
    test_syntax ();
    test_type ();
    test_stack ();
    test_misc ();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4feaa95" class="outline-3">
<h3 id="org4feaa95">import_all</h3>
<div class="outline-text-3" id="text-org4feaa95">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_all</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    import_bool (env);
    import_int (env);
    import_str (env);
    import_list (env);
    import_vect (env);
    import_dict (env);
    import_sexp (env);
    import_top_keyword (env);
    import_keyword (env);
    import_compile (env);
    import_eval (env);
    import_syntax (env);
    import_type (env);
    import_stack (env);
    import_misc (env);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2b58d76" class="outline-3">
<h3 id="org2b58d76">eval_file</h3>
<div class="outline-text-3" id="text-org2b58d76">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">eval_file</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">file_name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">input_file</span> = ifstream (file_name);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">buffer</span> = stringstream ();
    buffer &lt;&lt; input_file.rdbuf ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">code</span> = make_shared &lt;str_o&gt; (env, buffer.str ());
    code_eval (env, code);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org13ef82a" class="outline-3">
<h3 id="org13ef82a">the_story_begin</h3>
<div class="outline-text-3" id="text-org13ef82a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">the_story_begin</span> (<span style="color: #7CB8BB;">string_vector_t</span> <span style="color: #DFAF8F;">arg_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();
    import_all (env);
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">file_name</span>: arg_vector)
        eval_file (env, file_name);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge428383" class="outline-3">
<h3 id="orge428383">main</h3>
<div class="outline-text-3" id="text-orge428383">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">int</span>
<span style="color: #93E0E3;">main</span> (<span style="color: #7CB8BB;">int</span> <span style="color: #DFAF8F;">argc</span>, <span style="color: #7CB8BB;">char</span> **<span style="color: #DFAF8F;">argv</span>)
{
    test_all ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">arg_vector</span> = string_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">i</span> = 1; i &lt; argc; i++) {
        arg_vector.push_back (<span style="color: #7CB8BB;">string</span> (<span style="color: #DFAF8F;">argv</span>[i]));
    }
    the_story_begin (arg_vector);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> 0;
}
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2018-08-02 Thu 22:33</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
