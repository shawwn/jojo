<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2018-07-30 Mon 05:03 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>jojo</title>
<meta name="generator" content="Org-mode" />
<link rel="stylesheet" href="css/org-page.css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">jojo</h1>
<div id="table-of-contents">
<h2>overview</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org53018e2">prolog</a>
<ul>
<li><a href="#org22069fb">include</a></li>
<li><a href="#org9d38fa4">using</a></li>
<li><a href="#org7edc648">debug</a>
<ul>
<li><a href="#org6c45455">debug_here</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgd00ec8a">datatype</a>
<ul>
<li><a href="#org6712186">forward declaration</a></li>
<li><a href="#orgcf31be8">name_t</a></li>
<li><a href="#org5895867">name_vector_t</a></li>
<li><a href="#orgeed9024">bind_t</a></li>
<li><a href="#orgee26c95">bind_vector_t</a></li>
<li><a href="#org9b1f4a7">local_scope_t</a></li>
<li><a href="#org3b355e8">jo_vector_t</a></li>
<li><a href="#orgb176f3a">jojo_t</a></li>
<li><a href="#orgf4aba14">jo_t</a></li>
<li><a href="#org59a81a8">tag_t</a></li>
<li><a href="#orgdffa17d">tag_name_vector</a></li>
<li><a href="#org4f5d19c">tag_map</a></li>
<li><a href="#orgb920782">obj_t</a></li>
<li><a href="#org2ed661f">obj_map_t</a></li>
<li><a href="#org4ff4b52">obj_vector_t</a></li>
<li><a href="#org49e6172">frame_t</a></li>
<li><a href="#orgc7535b3">box_t</a></li>
<li><a href="#orga97723d">box_map_t</a></li>
<li><a href="#org5ab12c0">obj_stack_t</a></li>
<li><a href="#orgb384139">frame_stack_t</a></li>
<li><a href="#org6227959">env_t</a></li>
</ul>
</li>
<li><a href="#orgfc1ad70">jojo</a>
<ul>
<li><a href="#orgaa08c5e">jojo_repr</a></li>
<li><a href="#orgf934821">jojo_print</a></li>
<li><a href="#org30dbd5a">jojo_print_with_index</a></li>
</ul>
</li>
<li><a href="#org4356f43">name_vector</a>
<ul>
<li><a href="#org5802027">name_vector_repr</a></li>
</ul>
</li>
<li><a href="#orgaa1ffdd">obj</a>
<ul>
<li><a href="#org7950673">tag</a>
<ul>
<li><a href="#org1205614">tagging</a></li>
<li><a href="#org94b6d27">name_of_tag</a></li>
</ul>
</li>
<li><a href="#org8b7cc59">local</a>
<ul>
<li><a href="#org8249b16">bind_vector_repr</a></li>
<li><a href="#org464ee22">local_scope_repr</a></li>
</ul>
</li>
<li><a href="#orga05754c">obj</a>
<ul>
<li><a href="#org9a5f698">obj_t::~obj_t</a></li>
<li><a href="#org53fbb5c">obj_t::repr</a></li>
<li><a href="#orgf72c92a">obj_t::equal</a></li>
<li><a href="#orgcd5a9f0">obj_t::apply</a></li>
</ul>
</li>
<li><a href="#org5c01b35">closure</a>
<ul>
<li><a href="#org3966ad7">number_of_obj_in_bind_vector</a></li>
<li><a href="#org669b8af">closure_o</a></li>
<li><a href="#org724e3a">closure_o::closure_o</a></li>
<li><a href="#org25e974c">bind_vector_insert_obj</a></li>
<li><a href="#orgd7ed62e">bind_vector_merge_obj_vector</a></li>
<li><a href="#orgedafa68">pick_up_obj_vector</a></li>
<li><a href="#org4f57596">local_scope_extend</a></li>
<li><a href="#org60a4d49">closure_o::apply</a></li>
<li><a href="#org331999e">bind_equal</a></li>
<li><a href="#orgffb3e6d">bind_vector_equal</a></li>
<li><a href="#orge6a01fc">local_scope_equal</a></li>
<li><a href="#org97d5321">closure_o::equal</a></li>
<li><a href="#orgb8420f5">closure_o::repr</a></li>
</ul>
</li>
<li><a href="#org3e91807">string</a>
<ul>
<li><a href="#orgb27c126">str_o</a></li>
<li><a href="#orga88191f">str_o::str_o</a></li>
<li><a href="#org4314391">str_o::repr</a></li>
<li><a href="#org454b9fb">str_o::equal</a></li>
</ul>
</li>
<li><a href="#org1be15ce">data</a>
<ul>
<li><a href="#org3e127bc">data_o</a></li>
<li><a href="#orgf9b1b0f">data_o::data_o</a></li>
<li><a href="#org5f737d">obj_map_equal</a></li>
<li><a href="#orga01da0b">data_o::equal</a></li>
<li><a href="#orgdf56b11">obj_map_repr</a></li>
<li><a href="#orga28892">data_o::repr</a></li>
</ul>
</li>
<li><a href="#orgf98fca6">data_cons</a>
<ul>
<li><a href="#org4294c6">data_cons_o</a></li>
<li><a href="#orgbdeff09">data_cons_o::data_cons_o</a></li>
<li><a href="#org6c653e6">name_vector_obj_map_lack</a></li>
<li><a href="#org705a315">name_vector_obj_map_arity_lack</a></li>
<li><a href="#org8cf4cb3">pick_up_obj_map_and_merge</a></li>
<li><a href="#org203127e">data_cons_o::apply</a></li>
<li><a href="#orga4c1f86">data_cons_o::equal</a></li>
<li><a href="#org1f0b95b">name_vector_and_obj_map_repr</a></li>
<li><a href="#org7bc3004">data_cons_o::repr</a></li>
</ul>
</li>
<li><a href="#orga8b6f7c">prim</a>
<ul>
<li><a href="#orgc8f4c4a">prim_fn</a></li>
<li><a href="#orgc7a9d8d">prim_o</a></li>
<li><a href="#org91056e0">prim_o::prim_o</a></li>
<li><a href="#org8d607e">prim_o::repr</a></li>
<li><a href="#org6bf10b">prim_o::equal</a></li>
<li><a href="#org96ac699">prim_o::apply</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org6f0011f">env</a>
<ul>
<li><a href="#orgb3154d4">frame</a>
<ul>
<li><a href="#orgcbe63aa">frame_t::frame_t</a></li>
<li><a href="#org9fed137">frame_report</a></li>
</ul>
</li>
<li><a href="#orgd0067d2">box</a>
<ul>
<li><a href="#orgebfe1e">box_t::box_t</a></li>
<li><a href="#org30ccfa1">boxing</a></li>
</ul>
</li>
<li><a href="#orge3bf9d0">box_map</a>
<ul>
<li><a href="#org22758a2">box_map_report</a></li>
<li><a href="#org2edf46c">name_of_box</a></li>
</ul>
</li>
<li><a href="#orgdcd8bf3">obj_stack</a>
<ul>
<li><a href="#org7f76e3d">frame_stack_report</a></li>
</ul>
</li>
<li><a href="#orgca9b9b2">frame_stack</a>
<ul>
<li><a href="#orgcaddc82">obj_stack_report</a></li>
</ul>
</li>
<li><a href="#orge52f0ee">env_t::step</a></li>
<li><a href="#orgc3b8a9e">env_t::run</a></li>
<li><a href="#orgfdf04bb">env_t::report</a></li>
<li><a href="#org22ea319">env_t::run_with_base</a></li>
<li><a href="#orgd301567">env_t::double_report</a></li>
<li><a href="#org72ee82b">env_t::step_and_report</a></li>
</ul>
</li>
<li><a href="#orga49e62e">jo</a>
<ul>
<li><a href="#org248b168">jojo</a>
<ul>
<li><a href="#orge960ae4">jojo_t::jojo_t</a></li>
<li><a href="#org792a760">jojo_t::~jojo_t</a></li>
</ul>
</li>
<li><a href="#org4b272a4">jo</a>
<ul>
<li><a href="#orga510aa7">jo_t::copy</a></li>
<li><a href="#orga83cc51">jo_t::~jo_t</a></li>
<li><a href="#org48f6bb9">jo_t::exe</a></li>
<li><a href="#org31a75ab">jo_t::repr</a></li>
</ul>
</li>
<li><a href="#orged4bcd8">ref_jo</a>
<ul>
<li><a href="#orgc481b3c">ref_jo_t</a></li>
<li><a href="#org1d54c12">ref_jo_t::ref_jo_t</a></li>
<li><a href="#orgb3354f7">ref_jo_t::copy</a></li>
<li><a href="#org13d6dd2">ref_jo_t::exe</a></li>
<li><a href="#org417bbbd">ref_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#org8c56019">local_ref_jo</a>
<ul>
<li><a href="#orgdf5a725">local_ref_jo_t</a></li>
<li><a href="#org958a3ce">local_ref_jo_t::local_ref_jo_t</a></li>
<li><a href="#orga6c4720">local_ref_jo_t::copy</a></li>
<li><a href="#org85cc5cd">vector_rev_ref</a></li>
<li><a href="#org24f997c">local_ref_jo_t::exe</a></li>
<li><a href="#orgd3cef80">local_ref_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#org724d9bf">lambda_jo</a>
<ul>
<li><a href="#orge1aaad8">lambda_jo_t</a></li>
<li><a href="#org38ffa77">lambda_jo_t::lambda_jo_t</a></li>
<li><a href="#org6f9d780">lambda_jo_t::copy</a></li>
<li><a href="#orgd6cd342">bind_vector_from_name_vector</a></li>
<li><a href="#org453461c">lambda_jo_t::exe</a></li>
<li><a href="#orga2dfb4b">lambda_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#orgb131588">field_jo</a>
<ul>
<li><a href="#orgf2d83a9">field_jo_t</a></li>
<li><a href="#org52d13c3">field_jo_t::field_jo_t</a></li>
<li><a href="#org2250170">field_jo_t::copy</a></li>
<li><a href="#org278caba">field_jo_t::exe</a></li>
<li><a href="#org759470">field_jo_t::repr</a></li>
</ul>
</li>
<li><a href="#orgc9e1d2b">apply_jo</a>
<ul>
<li><a href="#org443cbfd">apply_jo_t</a></li>
<li><a href="#orgba82ac9">apply_jo_t::apply_jo_t</a></li>
<li><a href="#org7774920">apply_jo_t::copy</a></li>
<li><a href="#org55c5517">apply_jo_t::exe</a></li>
<li><a href="#org653373d">apply_jo_t::repr</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org282d290">define</a>
<ul>
<li><a href="#orgfacf26c">define</a></li>
<li><a href="#orge137e42">sig_t</a></li>
<li><a href="#org7805157">name_of_sig</a></li>
<li><a href="#orge7185e5">name_vector_of_sig</a></li>
<li><a href="#org3758e53">define_prim</a></li>
</ul>
</li>
<li><a href="#org4e5306a"><b>test</b></a>
<ul>
<li><a href="#orgba0dfa4">new_frame_from_jojo</a></li>
<li><a href="#org4d27e87">new_frame_from_jo_vector</a></li>
<li><a href="#org14f68e4">assert</a>
<ul>
<li><a href="#org701765">assert_pop_eq</a></li>
<li><a href="#org46025d">assert_tos_eq</a></li>
<li><a href="#org51fd94d">assert_stack_size</a></li>
</ul>
</li>
<li><a href="#org6b30aaa"><span class="todo _todo_">[todo]</span> import_test</a></li>
</ul>
</li>
<li><a href="#org695a111"><b>bool</b></a>
<ul>
<li><a href="#org1c00d8f">true_c</a></li>
<li><a href="#org896fadb">false_c</a></li>
<li><a href="#org280de6b">jj_true_c</a></li>
<li><a href="#org4d5a94b">jj_false_c</a></li>
<li><a href="#orgf8375e4">import_bool</a></li>
<li><a href="#org8f4d699">test_bool</a></li>
</ul>
</li>
<li><a href="#orgf2811b0"><b>list</b></a>
<ul>
<li><a href="#org5a5f796">null_c</a></li>
<li><a href="#orgc198a78">cons_c</a></li>
<li><a href="#org86ae0d0">car</a></li>
<li><a href="#org3069113">cdr</a></li>
<li><a href="#org3574fe9">null_p</a></li>
<li><a href="#orge779c7e">cons_p</a></li>
<li><a href="#orgaa8fc9c">list_p</a></li>
<li><a href="#org8f12285">list_length</a></li>
<li><a href="#orgf29a4f2">jj_null_c</a></li>
<li><a href="#org9f977fe">jj_cons_c</a></li>
<li><a href="#org26668ab">import_list</a></li>
<li><a href="#orge2e262">test_list</a></li>
</ul>
</li>
<li><a href="#orgce82562"><b>str</b></a>
<ul>
<li><a href="#org27613f0">string_p</a></li>
<li><a href="#orgc3188c9">jj_str_print</a></li>
<li><a href="#orgec238f0">import_str</a></li>
<li><a href="#org215fa15"><span class="todo _todo_">[todo]</span> test_str</a></li>
</ul>
</li>
<li><a href="#org35aa2ee"><b>vect</b></a>
<ul>
<li><a href="#orge8d4fac">obj_vect_t</a></li>
<li><a href="#org28a3ffb">vect_o</a></li>
<li><a href="#org64a0a0b">vect_o::vect_o</a></li>
<li><a href="#org3d0fd73">obj_equal</a></li>
<li><a href="#org7a46d0d">vect_equal</a></li>
<li><a href="#org349578d">vect_o::equal</a></li>
<li><a href="#orgf35f4b8">vect_o::repr</a></li>
<li><a href="#org3e0431a">vect_p</a></li>
<li><a href="#orgd087826">list_to_vect</a></li>
<li><a href="#orga6cba39">jj_list_to_vect</a></li>
<li><a href="#org9e715f2">vect_to_list</a></li>
<li><a href="#orgac4bb7b">jj_vect_to_list</a></li>
<li><a href="#orgce5527e">import_vect</a></li>
<li><a href="#orgc291f89">test_vect</a></li>
</ul>
</li>
<li><a href="#org3a4bd1c"><b>dict</b></a>
<ul>
<li><a href="#org51872f"><span class="todo _todo_">[todo]</span> import_dict</a></li>
<li><a href="#org6467bf8"><span class="todo _todo_">[todo]</span> test_dict</a></li>
</ul>
</li>
<li><a href="#org8a014a7"><b>sexp</b></a>
<ul>
<li><a href="#org911e63a">string_vector_t</a></li>
<li><a href="#orgc567072">space_char_p</a></li>
<li><a href="#orgbbad0bf">delimiter_char_p</a></li>
<li><a href="#orgf926821">string_from_char</a></li>
<li><a href="#org63b27db">doublequote_char_p</a></li>
<li><a href="#org12607de">find_word_length</a></li>
<li><a href="#org8b0d058">scan_word_vector</a></li>
<li><a href="#orgb06a540">string_vector_to_string_list</a></li>
<li><a href="#org1570d70"><span class="todo _note_">[note]</span> about literal in quote</a></li>
<li><a href="#org9b7b07c">scan_word_list</a></li>
<li><a href="#org59febe">bar_word_p</a></li>
<li><a href="#orgbb70e93">ket_word_p</a></li>
<li><a href="#org53d0acd">quote_word_p</a></li>
<li><a href="#org31e088">bar_word_to_ket_word</a></li>
<li><a href="#orgc7aff36">word_list_head_with_bar_ket_counter</a></li>
<li><a href="#org9a946d6">word_list_head</a></li>
<li><a href="#orgd9a73a4">word_list_rest_with_bar_ket_counter</a></li>
<li><a href="#org9157cee">word_list_rest</a></li>
<li><a href="#orgd8c29aa">word_list_drop_ket</a></li>
<li><a href="#org5da2f8a">parse_sexp</a></li>
<li><a href="#orgda61e9">parse_sexp_list</a></li>
<li><a href="#orge61a5e2">sexp_repr</a></li>
<li><a href="#orgdc99a7a">sexp_list_repr</a></li>
<li><a href="#orga70162a">jj_scan_word_list</a></li>
<li><a href="#orge2fe2d9">jj_parse_sexp</a></li>
<li><a href="#orgb7442ec">jj_parse_sexp_list</a></li>
<li><a href="#org7d0a70a">jj_sexp_repr</a></li>
<li><a href="#orgdd15b98">jj_sexp_list_repr</a></li>
<li><a href="#orga258d8">import_sexp</a></li>
<li><a href="#org4e9c1d7">test_sexp_scan</a></li>
<li><a href="#orgf562edc">test_sexp_list</a></li>
<li><a href="#orgba08b">test_sexp_vect</a></li>
<li><a href="#orgf68245a">test_sexp</a></li>
</ul>
</li>
<li><a href="#orge574ba4"><b>top-keyword</b></a>
<ul>
<li><a href="#org79321c4">top_keyword_fn</a></li>
<li><a href="#org2775fb2">top_keyword_o</a></li>
<li><a href="#org2dbcb22">top_keyword_o::top_keyword_o</a></li>
<li><a href="#orge971ec5">top_keyword_o::equal</a></li>
<li><a href="#org2502eb7">top_keyword_p</a></li>
<li><a href="#orgf9c9242">define_top_keyword</a></li>
<li><a href="#orgdcc81ec">import_top_keyword</a></li>
</ul>
</li>
<li><a href="#org445b93b"><b>keyword</b></a>
<ul>
<li><a href="#org48f6729">local_ref_map_t</a></li>
<li><a href="#org303dd7c">local_ref_map_extend</a></li>
<li><a href="#orga6bef64">keyword_fn</a></li>
<li><a href="#org8f10168">keyword_o</a></li>
<li><a href="#org18955a">keyword_o::keyword_o</a></li>
<li><a href="#org9e4e16b">keyword_o::equal</a></li>
<li><a href="#orgb88c26">keyword_p</a></li>
<li><a href="#orged4a4e4">define_keyword</a></li>
<li><a href="#org4eaae39">obj_vect_to_name_vector</a></li>
<li><a href="#orgf3cb632">import_keyword</a></li>
</ul>
</li>
<li><a href="#orgc3d4a65"><span class="todo _todo_">[todo]</span> <b>macro</b></a></li>
<li><a href="#org93a9d79"><b>compile</b></a>
<ul>
<li><a href="#org2018f50">keyword_sexp_p</a></li>
<li><a href="#org2142f59">get_keyword_fn</a></li>
<li><a href="#org62db4f">jojo_append</a></li>
<li><a href="#org84be2e2">dot_string_p</a></li>
<li><a href="#org6332579"><span class="todo _todo_">[todo]</span> dot_string_compile</a></li>
<li><a href="#org88f4023">ref_compile</a></li>
<li><a href="#org2a1d9fa"><span class="todo _todo_">[todo]</span> string_compile</a></li>
<li><a href="#org2f57627">sexp_compile</a></li>
<li><a href="#org8d1a0cb">sexp_list_compile</a></li>
<li><a href="#orgd6ba301">call_compile</a></li>
<li><a href="#orgd9f8498">import_compile</a></li>
<li><a href="#orga9768f2">test_compile</a></li>
</ul>
</li>
<li><a href="#org9d0e5d1"><b>eval</b></a>
<ul>
<li><a href="#org11112ec">top_keyword_sexp_p</a></li>
<li><a href="#orga79fe5e">get_top_keyword_fn</a></li>
<li><a href="#org3e1d5c1">jojo_run</a></li>
<li><a href="#org5cb5367">sexp_eval</a></li>
<li><a href="#org5761ba2">sexp_list_eval</a></li>
<li><a href="#orgdc27bb4">code_eval</a></li>
<li><a href="#org14654f">jj_code_eval</a></li>
<li><a href="#org2233aca">import_eval</a></li>
<li><a href="#org505dee2"><span class="todo _todo_">[todo]</span> test_eval</a></li>
</ul>
</li>
<li><a href="#orgf5fe458"><b>syntax</b></a>
<ul>
<li><a href="#orgb5f1904">tk_assign</a></li>
<li><a href="#org8c93336"><span class="todo _todo_">[todo]</span> k_lambda</a></li>
<li><a href="#org8cab301">import_syntax</a></li>
<li><a href="#org95f85f9">test_syntax</a></li>
</ul>
</li>
<li><a href="#org843ed7d"><b>tag</b></a>
<ul>
<li><a href="#org77b7e41">tag</a>
<ul>
<li><a href="#org125549e">tag_o</a></li>
</ul>
</li>
<li><a href="#org17055fc"><span class="todo _todo_">[todo]</span> jj_get_tag</a></li>
<li><a href="#orgb1e9a0b"><span class="todo _todo_">[todo]</span> import_tag</a></li>
<li><a href="#orgdd3a2a9"><span class="todo _todo_">[todo]</span> test_tag</a></li>
</ul>
</li>
<li><a href="#org80af527"><b>misc</b></a>
<ul>
<li><a href="#orgf83fdab">jj_repr</a></li>
<li><a href="#org2eb7588">jj_print</a></li>
<li><a href="#org3a36d7e">jj_newline</a></li>
<li><a href="#org9206e3b">jj_equal</a></li>
<li><a href="#orgf944071">import_misc</a></li>
<li><a href="#org9b284f8">test_misc</a></li>
</ul>
</li>
<li><a href="#org9e67d21">epilog</a>
<ul>
<li><a href="#org84f2fc2">test</a>
<ul>
<li><a href="#org7923fad">test_step</a></li>
<li><a href="#orgebfc6ab">test_data</a></li>
<li><a href="#org3fa214a">test_apply</a></li>
<li><a href="#org83a0082">test_lambda_curry</a></li>
<li><a href="#org67637b6">test_data_cons</a></li>
<li><a href="#org89df80b">test_data_cons_curry</a></li>
<li><a href="#org3ef4bf4">test_prim</a></li>
</ul>
</li>
<li><a href="#org8a7c643">test_all</a></li>
<li><a href="#org2282c5e">import_all</a></li>
<li><a href="#orgeb7830">eval_file</a></li>
<li><a href="#org1742617">the_story_begin</a></li>
<li><a href="#org9ea718a">main</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org53018e2" class="outline-2">
<h2 id="org53018e2">prolog</h2>
<div class="outline-text-2" id="text-org53018e2">
</div><div id="outline-container-org22069fb" class="outline-3">
<h3 id="org22069fb">include</h3>
<div class="outline-text-3" id="text-org22069fb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;iostream&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;fstream&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;sstream&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;algorithm&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;functional&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;cassert&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;memory&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;vector&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;array&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;map&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;set&gt;</span>
<span style="color: #94BFF3;">#include</span> <span style="color: #CC9393;">&lt;stack&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9d38fa4" class="outline-3">
<h3 id="org9d38fa4">using</h3>
<div class="outline-text-3" id="text-org9d38fa4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #F0DFAF; font-weight: bold;">namespace</span> <span style="color: #BFEBBF;">std</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org7edc648" class="outline-3">
<h3 id="org7edc648">debug</h3>
<div class="outline-text-3" id="text-org7edc648">
</div><div id="outline-container-org6c45455" class="outline-4">
<h4 id="org6c45455">debug_here</h4>
<div class="outline-text-4" id="text-org6c45455">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">debug_here</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span>)
{
    cout &lt;&lt; <span style="color: #CC9393;">"HERE: "</span> &lt;&lt; index &lt;&lt; <span style="color: #CC9393;">"\n"</span>
         &lt;&lt; flush;
}
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd00ec8a" class="outline-2">
<h2 id="orgd00ec8a">datatype</h2>
<div class="outline-text-2" id="text-orgd00ec8a">
</div><div id="outline-container-org6712186" class="outline-3">
<h3 id="org6712186">forward declaration</h3>
<div class="outline-text-3" id="text-org6712186">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">env_t</span>;
<span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">obj_t</span>;
<span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">jo_t</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcf31be8" class="outline-3">
<h3 id="orgcf31be8">name_t</h3>
<div class="outline-text-3" id="text-orgcf31be8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">name_t</span> = string;
</pre>
</div>
</div>
</div>

<div id="outline-container-org5895867" class="outline-3">
<h3 id="org5895867">name_vector_t</h3>
<div class="outline-text-3" id="text-org5895867">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">name_vector_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">name_t</span>&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeed9024" class="outline-3">
<h3 id="orgeed9024">bind_t</h3>
<div class="outline-text-3" id="text-orgeed9024">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">bind_t</span> = <span style="color: #7CB8BB;">pair</span> &lt;<span style="color: #7CB8BB;">name_t</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgee26c95" class="outline-3">
<h3 id="orgee26c95">bind_vector_t</h3>
<div class="outline-text-3" id="text-orgee26c95">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">index from end</span>
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">bind_vector_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">bind_t</span>&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-org9b1f4a7" class="outline-3">
<h3 id="org9b1f4a7">local_scope_t</h3>
<div class="outline-text-3" id="text-org9b1f4a7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">index from end</span>
<span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">local_scope_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">bind_vector_t</span>&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-org3b355e8" class="outline-3">
<h3 id="org3b355e8">jo_vector_t</h3>
<div class="outline-text-3" id="text-org3b355e8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">jo_vector_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">jo_t</span> *&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb176f3a" class="outline-3">
<h3 id="orgb176f3a">jojo_t</h3>
<div class="outline-text-3" id="text-orgb176f3a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">jojo_t</span>
{
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span>;
    <span style="color: #93E0E3;">jojo_t</span> (<span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span>);
    ~<span style="color: #93E0E3;">jojo_t</span> ();
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf4aba14" class="outline-3">
<h3 id="orgf4aba14">jo_t</h3>
<div class="outline-text-3" id="text-orgf4aba14">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> ~<span style="color: #93E0E3;">jo_t</span> ();
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org59a81a8" class="outline-3">
<h3 id="org59a81a8">tag_t</h3>
<div class="outline-text-3" id="text-org59a81a8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">tag_t</span> = size_t;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdffa17d" class="outline-3">
<h3 id="orgdffa17d">tag_name_vector</h3>
<div class="outline-text-3" id="text-orgdffa17d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">tag_name_vector_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">name_t</span>&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-org4f5d19c" class="outline-3">
<h3 id="org4f5d19c">tag_map</h3>
<div class="outline-text-3" id="text-org4f5d19c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">tag_map_t</span> = <span style="color: #7CB8BB;">map</span> &lt;<span style="color: #7CB8BB;">name_t</span>, <span style="color: #7CB8BB;">tag_t</span>&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb920782" class="outline-3">
<h3 id="orgb920782">obj_t</h3>
<div class="outline-text-3" id="text-orgb920782">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag</span>;
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> ~<span style="color: #93E0E3;">obj_t</span> ();
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #F0DFAF; font-weight: bold;">virtual</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org2ed661f" class="outline-3">
<h3 id="org2ed661f">obj_map_t</h3>
<div class="outline-text-3" id="text-org2ed661f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">obj_map_t</span> = <span style="color: #7CB8BB;">map</span> &lt;<span style="color: #7CB8BB;">name_t</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-org4ff4b52" class="outline-3">
<h3 id="org4ff4b52">obj_vector_t</h3>
<div class="outline-text-3" id="text-org4ff4b52">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">obj_vector_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-org49e6172" class="outline-3">
<h3 id="org49e6172">frame_t</h3>
<div class="outline-text-3" id="text-org49e6172">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">frame_t</span>
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span>;
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>;
    <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>;
    <span style="color: #93E0E3;">frame_t</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>, <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc7535b3" class="outline-3">
<h3 id="orgc7535b3">box_t</h3>
<div class="outline-text-3" id="text-orgc7535b3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">box_t</span>
{
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>;
    <span style="color: #7CB8BB;">bool</span> <span style="color: #DFAF8F;">empty_p</span>;
    <span style="color: #93E0E3;">box_t</span> ();
    <span style="color: #93E0E3;">box_t</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orga97723d" class="outline-3">
<h3 id="orga97723d">box_map_t</h3>
<div class="outline-text-3" id="text-orga97723d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">box_map_t</span> = <span style="color: #7CB8BB;">map</span> &lt;<span style="color: #7CB8BB;">name_t</span>, <span style="color: #7CB8BB;">box_t</span> *&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-org5ab12c0" class="outline-3">
<h3 id="org5ab12c0">obj_stack_t</h3>
<div class="outline-text-3" id="text-org5ab12c0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">obj_stack_t</span> = <span style="color: #7CB8BB;">stack</span> &lt;<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb384139" class="outline-3">
<h3 id="orgb384139">frame_stack_t</h3>
<div class="outline-text-3" id="text-orgb384139">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">frame_stack_t</span> = <span style="color: #7CB8BB;">stack</span> &lt;<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">frame_t</span>&gt;&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-org6227959" class="outline-3">
<h3 id="org6227959">env_t</h3>
<div class="outline-text-3" id="text-org6227959">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">env_t</span>
{
    <span style="color: #7CB8BB;">box_map_t</span> <span style="color: #DFAF8F;">box_map</span>;
    <span style="color: #7CB8BB;">obj_stack_t</span> <span style="color: #DFAF8F;">obj_stack</span>;
    <span style="color: #7CB8BB;">frame_stack_t</span> <span style="color: #DFAF8F;">frame_stack</span>;
    <span style="color: #7CB8BB;">tag_name_vector_t</span> <span style="color: #DFAF8F;">tag_name_vector</span>;
    <span style="color: #7CB8BB;">tag_map_t</span> <span style="color: #DFAF8F;">tag_map</span>;
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">step</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">run</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">report</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">run_with_base</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">base</span>);
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">double_report</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">step_and_report</span> ();
};
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfc1ad70" class="outline-2">
<h2 id="orgfc1ad70">jojo</h2>
<div class="outline-text-2" id="text-orgfc1ad70">
</div><div id="outline-container-orgaa08c5e" class="outline-3">
<h3 id="orgaa08c5e">jojo_repr</h3>
<div class="outline-text-3" id="text-orgaa08c5e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">jojo_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>)
{
    assert (jojo-&gt;jo_vector.size () != 0);
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">jo</span>: jojo-&gt;jo_vector) {
        repr += jo-&gt;repr (env);
        repr += <span style="color: #CC9393;">" "</span>;
    }
    repr.pop_back ();
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf934821" class="outline-3">
<h3 id="orgf934821">jojo_print</h3>
<div class="outline-text-3" id="text-orgf934821">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">jojo_print</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">jo</span>: jojo-&gt;jo_vector) {
        cout &lt;&lt; jo-&gt;repr (env)
             &lt;&lt; <span style="color: #CC9393;">" "</span>;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org30dbd5a" class="outline-3">
<h3 id="org30dbd5a">jojo_print_with_index</h3>
<div class="outline-text-3" id="text-org30dbd5a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">jojo_print_with_index</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                       <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>,
                       <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = jojo-&gt;jo_vector.begin ();
         it != jojo-&gt;jo_vector.end ();
         it++) {
        <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">it_index</span> = it - jojo-&gt;jo_vector.begin ();
        <span style="color: #7CB8BB;">jo_t</span> *<span style="color: #DFAF8F;">jo</span> = *it;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (index == it_index) {
            cout &lt;&lt; <span style="color: #CC9393;">"-&gt;&gt; "</span> &lt;&lt; jo-&gt;repr (env) &lt;&lt; <span style="color: #CC9393;">" "</span>;
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> {
            cout &lt;&lt; jo-&gt;repr (env) &lt;&lt; <span style="color: #CC9393;">" "</span>;
        }
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4356f43" class="outline-2">
<h2 id="org4356f43">name_vector</h2>
<div class="outline-text-2" id="text-org4356f43">
</div><div id="outline-container-org5802027" class="outline-3">
<h3 id="org5802027">name_vector_repr</h3>
<div class="outline-text-3" id="text-org5802027">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">name_vector_repr</span> (<span style="color: #7CB8BB;">name_vector_t</span> &amp;<span style="color: #DFAF8F;">name_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (name_vector.size () == 0) {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"["</span>;
        repr += <span style="color: #CC9393;">"]"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"["</span>;
        <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span>: name_vector) {
            repr += name;
            repr += <span style="color: #CC9393;">" "</span>;
        }
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> repr.empty ()) repr.pop_back ();
        repr += <span style="color: #CC9393;">"]"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgaa1ffdd" class="outline-2">
<h2 id="orgaa1ffdd">obj</h2>
<div class="outline-text-2" id="text-orgaa1ffdd">
</div><div id="outline-container-org7950673" class="outline-3">
<h3 id="org7950673">tag</h3>
<div class="outline-text-3" id="text-org7950673">
</div><div id="outline-container-org1205614" class="outline-4">
<h4 id="org1205614">tagging</h4>
<div class="outline-text-4" id="text-org1205614">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">tag_t</span>
<span style="color: #93E0E3;">tagging</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.tag_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.tag_map.end ()) {
        <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> tag;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">tag</span> = env.tag_name_vector.size ();
        env.tag_map [name] = tag;
        env.tag_name_vector.push_back (name);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> tag;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org94b6d27" class="outline-4">
<h4 id="org94b6d27">name_of_tag</h4>
<div class="outline-text-4" id="text-org94b6d27">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_t</span>
<span style="color: #93E0E3;">name_of_tag</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> env.tag_name_vector [tag];
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8b7cc59" class="outline-3">
<h3 id="org8b7cc59">local</h3>
<div class="outline-text-3" id="text-org8b7cc59">
</div><div id="outline-container-org8249b16" class="outline-4">
<h4 id="org8249b16">bind_vector_repr</h4>
<div class="outline-text-4" id="text-org8249b16">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">bind_vector_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">bind_vector_t</span> <span style="color: #DFAF8F;">bind_vector</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = bind_vector.rbegin ();
         it != bind_vector.rend ();
         it++) {
        repr += <span style="color: #CC9393;">"("</span>;
        repr += to_string (distance (bind_vector.rbegin (), it));
        repr += <span style="color: #CC9393;">" "</span>;
        repr += it-&gt;first;
        repr += <span style="color: #CC9393;">" = "</span>;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (obj == <span style="color: #BFEBBF;">nullptr</span>)
            repr += <span style="color: #CC9393;">"_"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">else</span>
            repr += obj-&gt;repr (env);
        repr += <span style="color: #CC9393;">") "</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org464ee22" class="outline-4">
<h4 id="org464ee22">local_scope_repr</h4>
<div class="outline-text-4" id="text-org464ee22">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">local_scope_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
    repr += <span style="color: #CC9393;">"  - ["</span>;
    repr += to_string (local_scope.size ());
    repr += <span style="color: #CC9393;">"] "</span>;
    repr += <span style="color: #CC9393;">"local_scope - "</span>;
    repr += <span style="color: #CC9393;">"\n"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = local_scope.rbegin ();
         it != local_scope.rend ();
         it++) {
        repr += <span style="color: #CC9393;">"    "</span>;
        repr += to_string (distance (local_scope.rbegin (), it));
        repr += <span style="color: #CC9393;">" "</span>;
        repr += bind_vector_repr (env, *it);
        repr += <span style="color: #CC9393;">"\n"</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga05754c" class="outline-3">
<h3 id="orga05754c">obj</h3>
<div class="outline-text-3" id="text-orga05754c">
</div><div id="outline-container-org9a5f698" class="outline-4">
<h4 id="org9a5f698">obj_t::~obj_t</h4>
<div class="outline-text-4" id="text-org9a5f698">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">obj_t</span>::~<span style="color: #93E0E3;">obj_t</span> ()
{
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">all classes that will be derived from</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">should have a virtual or protected destructor,</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">otherwise deleting an instance via a pointer</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">to a base class results in undefined behavior.</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org53fbb5c" class="outline-4">
<h4 id="org53fbb5c">obj_t::repr</h4>
<div class="outline-text-4" id="text-org53fbb5c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">obj_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"#&lt;"</span> + name_of_tag (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag) + <span style="color: #CC9393;">"&gt;"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf72c92a" class="outline-4">
<h4 id="orgf72c92a">obj_t::equal</h4>
<div class="outline-text-4" id="text-orgf72c92a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">obj_t</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : obj_t::equal"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  equal is not implemented for  : "</span>
             &lt;&lt; name_of_tag (env, obj-&gt;tag) &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcd5a9f0" class="outline-4">
<h4 id="orgcd5a9f0">obj_t::apply</h4>
<div class="outline-text-4" id="text-orgcd5a9f0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">obj_t</span>::<span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>)
{
    cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : applying non applicable object"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    exit (1);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5c01b35" class="outline-3">
<h3 id="org5c01b35">closure</h3>
<div class="outline-text-3" id="text-org5c01b35">
</div><div id="outline-container-org3966ad7" class="outline-4">
<h4 id="org3966ad7">number_of_obj_in_bind_vector</h4>
<div class="outline-text-4" id="text-org3966ad7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">size_t</span>
<span style="color: #93E0E3;">number_of_obj_in_bind_vector</span> (<span style="color: #7CB8BB;">bind_vector_t</span> &amp;<span style="color: #DFAF8F;">bind_vector</span>)
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">sum</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = bind_vector.begin ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = bind_vector.end ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++)
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (it-&gt;second)
            sum++;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> sum;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org669b8af" class="outline-4">
<h4 id="org669b8af">closure_o</h4>
<div class="outline-text-4" id="text-org669b8af">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">closure_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>;
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>;
    <span style="color: #7CB8BB;">bind_vector_t</span> <span style="color: #DFAF8F;">bind_vector</span>;
    <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>;
    <span style="color: #93E0E3;">closure_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
               <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
               <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>,
               <span style="color: #7CB8BB;">bind_vector_t</span> <span style="color: #DFAF8F;">bind_vector</span>,
               <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org724e3a" class="outline-4">
<h4 id="org724e3a">closure_o::closure_o</h4>
<div class="outline-text-4" id="text-org724e3a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">closure_o</span>::
<span style="color: #93E0E3;">closure_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
           <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
           <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>,
           <span style="color: #7CB8BB;">bind_vector_t</span> <span style="color: #DFAF8F;">bind_vector</span>,
           <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = tagging (env, <span style="color: #CC9393;">"closure-t"</span>);
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector = name_vector;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo = jojo;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;bind_vector = bind_vector;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;local_scope = local_scope;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org25e974c" class="outline-4">
<h4 id="org25e974c">bind_vector_insert_obj</h4>
<div class="outline-text-4" id="text-org25e974c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">bind_vector_insert_obj</span> (<span style="color: #7CB8BB;">bind_vector_t</span> &amp;<span style="color: #DFAF8F;">bind_vector</span>,
                        <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = bind_vector.rbegin ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = bind_vector.rend ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++) {
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (it-&gt;second == <span style="color: #BFEBBF;">nullptr</span>) {
            it-&gt;second = obj;
            <span style="color: #F0DFAF; font-weight: bold;">return</span>;
        }
    }
    cout &lt;&lt; <span style="color: #CC9393;">"- fatal error ! bind_vector_insert_obj"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
         &lt;&lt; <span style="color: #CC9393;">"  the bind_vector is filled"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
         &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    exit (1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd7ed62e" class="outline-4">
<h4 id="orgd7ed62e">bind_vector_merge_obj_vector</h4>
<div class="outline-text-4" id="text-orgd7ed62e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bind_vector_t</span>
<span style="color: #93E0E3;">bind_vector_merge_obj_vector</span> (<span style="color: #7CB8BB;">bind_vector_t</span> &amp;<span style="color: #DFAF8F;">old_bind_vector</span>,
                              <span style="color: #7CB8BB;">obj_vector_t</span> &amp;<span style="color: #DFAF8F;">obj_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bind_vector</span> = old_bind_vector;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span>: obj_vector)
        bind_vector_insert_obj (bind_vector, obj);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> bind_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgedafa68" class="outline-4">
<h4 id="orgedafa68">pick_up_obj_vector</h4>
<div class="outline-text-4" id="text-orgedafa68">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">obj_vector_t</span>
<span style="color: #93E0E3;">pick_up_obj_vector</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">counter</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_vector</span> = obj_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (counter &gt; 0) {
        counter--;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
        obj_vector.push_back (obj);
        env.obj_stack.pop ();
    }
    reverse (obj_vector.begin (),
             obj_vector.end ());
    <span style="color: #F0DFAF; font-weight: bold;">return</span> obj_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4f57596" class="outline-4">
<h4 id="org4f57596">local_scope_extend</h4>
<div class="outline-text-4" id="text-org4f57596">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">local_scope_t</span>
<span style="color: #93E0E3;">local_scope_extend</span> (<span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">old_local_scope</span>,
                    <span style="color: #7CB8BB;">bind_vector_t</span> <span style="color: #DFAF8F;">bind_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_scope</span> = old_local_scope;
    local_scope.push_back (bind_vector);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> local_scope;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org60a4d49" class="outline-4">
<h4 id="org60a4d49">closure_o::apply</h4>
<div class="outline-text-4" id="text-org60a4d49">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">closure_o</span>::<span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">have</span> = number_of_obj_in_bind_vector (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;bind_vector);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack</span> = size - have;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lack == arity) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_vector</span> = pick_up_obj_vector
            (env, arity);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bind_vector</span> = bind_vector_merge_obj_vector
             (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;bind_vector, obj_vector);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_scope</span> = local_scope_extend
            (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;local_scope, bind_vector);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">frame</span> = make_shared &lt;<span style="color: #7CB8BB;">frame_t</span>&gt;
            (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo, local_scope);
        env.frame_stack.push (frame);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (arity &lt; lack) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_vector</span> = pick_up_obj_vector
            (env, arity);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bind_vector</span> = bind_vector_merge_obj_vector
            (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;bind_vector, obj_vector);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">closure</span> = make_shared &lt;closure_o&gt;
            (env,
             <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector,
             <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo,
             bind_vector,
             <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;local_scope);
        env.obj_stack.push (closure);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : closure_o::apply"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  over-arity apply"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  arity &gt; lack"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  arity : "</span> &lt;&lt; arity &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  lack : "</span> &lt;&lt; lack &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org331999e" class="outline-4">
<h4 id="org331999e">bind_equal</h4>
<div class="outline-text-4" id="text-org331999e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">bind_equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
            <span style="color: #7CB8BB;">bind_t</span> &amp;<span style="color: #DFAF8F;">lhs</span>,
            <span style="color: #7CB8BB;">bind_t</span> &amp;<span style="color: #DFAF8F;">rhs</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lhs.first != rhs.first) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> lhs.second-&gt;equal (env, rhs.second);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgffb3e6d" class="outline-4">
<h4 id="orgffb3e6d">bind_vector_equal</h4>
<div class="outline-text-4" id="text-orgffb3e6d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">bind_vector_equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                   <span style="color: #7CB8BB;">bind_vector_t</span> &amp;<span style="color: #DFAF8F;">lhs</span>,
                   <span style="color: #7CB8BB;">bind_vector_t</span> &amp;<span style="color: #DFAF8F;">rhs</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lhs.size () != rhs.size ()) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = lhs.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">index</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (index &lt; size) {
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> bind_equal (env, lhs [index], rhs [index]))
            <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
        index++;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge6a01fc" class="outline-4">
<h4 id="orge6a01fc">local_scope_equal</h4>
<div class="outline-text-4" id="text-orge6a01fc">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">local_scope_equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                   <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">lhs</span>,
                   <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">rhs</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lhs.size () != rhs.size ()) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = lhs.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">index</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (index &lt; size) {
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> bind_vector_equal (env, lhs [index], rhs [index]))
            <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
        index++;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org97d5321" class="outline-4">
<h4 id="org97d5321">closure_o::equal</h4>
<div class="outline-text-4" id="text-org97d5321">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">closure_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">raw pointers must be equal first</span>
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span> != obj.get ()) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;closure_o&gt; (obj);
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">then scopes</span>
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (local_scope_equal
        (env,
         <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;local_scope,
         that-&gt;local_scope)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">then bindings</span>
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (bind_vector_equal
        (env,
         <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;bind_vector,
         that-&gt;bind_vector)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb8420f5" class="outline-4">
<h4 id="orgb8420f5">closure_o::repr</h4>
<div class="outline-text-4" id="text-orgb8420f5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">closure_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"- closure "</span>;
    repr += name_vector_repr (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector);
    repr += <span style="color: #CC9393;">"\n"</span>;
    repr += <span style="color: #CC9393;">"  "</span>;
    repr += jojo_repr (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo);
    repr += <span style="color: #CC9393;">"\n"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_scope</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;local_scope;
    local_scope.push_back (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;bind_vector);
    repr += local_scope_repr (env, local_scope);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3e91807" class="outline-3">
<h3 id="org3e91807">string</h3>
<div class="outline-text-3" id="text-org3e91807">
</div><div id="outline-container-orgb27c126" class="outline-4">
<h4 id="orgb27c126">str_o</h4>
<div class="outline-text-4" id="text-orgb27c126">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">str_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>;
    <span style="color: #93E0E3;">str_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orga88191f" class="outline-4">
<h4 id="orga88191f">str_o::str_o</h4>
<div class="outline-text-4" id="text-orga88191f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">str_o</span>::<span style="color: #93E0E3;">str_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = tagging (env, <span style="color: #CC9393;">"str-t"</span>);
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;str = str;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4314391" class="outline-4">
<h4 id="org4314391">str_o::repr</h4>
<div class="outline-text-4" id="text-org4314391">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">str_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"\""</span> + <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;str + <span style="color: #CC9393;">"\""</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org454b9fb" class="outline-4">
<h4 id="org454b9fb">str_o::equal</h4>
<div class="outline-text-4" id="text-org454b9fb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">str_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;str_o&gt; (obj);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;str == that-&gt;str);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1be15ce" class="outline-3">
<h3 id="org1be15ce">data</h3>
<div class="outline-text-3" id="text-org1be15ce">
</div><div id="outline-container-org3e127bc" class="outline-4">
<h4 id="org3e127bc">data_o</h4>
<div class="outline-text-4" id="text-org3e127bc">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">data_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>;
    <span style="color: #93E0E3;">data_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
            <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag</span>,
            <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf9b1b0f" class="outline-4">
<h4 id="orgf9b1b0f">data_o::data_o</h4>
<div class="outline-text-4" id="text-orgf9b1b0f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">data_o</span>::
<span style="color: #93E0E3;">data_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
        <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">tag</span>,
        <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = tag;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map = obj_map;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5f737d" class="outline-4">
<h4 id="org5f737d">obj_map_equal</h4>
<div class="outline-text-4" id="text-org5f737d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">obj_map_equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">lhs</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">rhs</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lhs.size () != rhs.size ()) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: lhs) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = kv.first;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = rhs.find (name);
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (it == rhs.end ()) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> kv.second-&gt;equal (env, it-&gt;second)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga01da0b" class="outline-4">
<h4 id="orga01da0b">data_o::equal</h4>
<div class="outline-text-4" id="text-orga01da0b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">data_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;data_o&gt; (obj);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> obj_map_equal (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map, that-&gt;obj_map);

}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdf56b11" class="outline-4">
<h4 id="orgdf56b11">obj_map_repr</h4>
<div class="outline-text-4" id="text-orgdf56b11">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">obj_map_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: obj_map) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = kv.first;
        repr += name;
        repr += <span style="color: #CC9393;">" = "</span>;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = kv.second;
        repr += obj-&gt;repr (env);
        repr += <span style="color: #CC9393;">" "</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> repr.empty ()) repr.pop_back ();
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga28892" class="outline-4">
<h4 id="orga28892">data_o::repr</h4>
<div class="outline-text-4" id="text-orga28892">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">data_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map.size () == 0) {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
        repr += name_of_tag (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag);
        repr.pop_back ();
        repr.pop_back ();
        repr += <span style="color: #CC9393;">"-c"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"("</span>;
        repr += name_of_tag (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag);
        repr.pop_back ();
        repr.pop_back ();
        repr += <span style="color: #CC9393;">"-c "</span>;
        repr += obj_map_repr (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        repr += <span style="color: #CC9393;">")"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf98fca6" class="outline-3">
<h3 id="orgf98fca6">data_cons</h3>
<div class="outline-text-3" id="text-orgf98fca6">
</div><div id="outline-container-org4294c6" class="outline-4">
<h4 id="org4294c6">data_cons_o</h4>
<div class="outline-text-4" id="text-org4294c6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">data_cons_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">type_tag</span>;
    <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>;
    <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>;
    <span style="color: #93E0E3;">data_cons_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                 <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">type_tag</span>,
                 <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
                 <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>);
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbdeff09" class="outline-4">
<h4 id="orgbdeff09">data_cons_o::data_cons_o</h4>
<div class="outline-text-4" id="text-orgbdeff09">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">data_cons_o</span>::
<span style="color: #93E0E3;">data_cons_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
             <span style="color: #7CB8BB;">tag_t</span> <span style="color: #DFAF8F;">type_tag</span>,
             <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
             <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = tagging (env, <span style="color: #CC9393;">"data-cons-t"</span>);
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;type_tag = type_tag;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector = name_vector;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map = obj_map;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6c653e6" class="outline-4">
<h4 id="org6c653e6">name_vector_obj_map_lack</h4>
<div class="outline-text-4" id="text-org6c653e6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_vector_t</span>
<span style="color: #93E0E3;">name_vector_obj_map_lack</span> (<span style="color: #7CB8BB;">name_vector_t</span> &amp;<span style="color: #DFAF8F;">old_name_vector</span>,
                          <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = name_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span>: old_name_vector) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = obj_map.find (name);
        <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">not found == lack</span>
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (it == obj_map.end ())
            name_vector.push_back (name);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> name_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org705a315" class="outline-4">
<h4 id="org705a315">name_vector_obj_map_arity_lack</h4>
<div class="outline-text-4" id="text-org705a315">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_vector_t</span>
<span style="color: #93E0E3;">name_vector_obj_map_arity_lack</span> (<span style="color: #7CB8BB;">name_vector_t</span> &amp;<span style="color: #DFAF8F;">old_name_vector</span>,
                                <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>,
                                <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = name_vector_obj_map_lack
        (old_name_vector, obj_map);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack</span> = name_vector.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">counter</span> = lack - arity;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (counter &gt; 0) {
        counter--;
        name_vector.pop_back ();
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> name_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8cf4cb3" class="outline-4">
<h4 id="org8cf4cb3">pick_up_obj_map_and_merge</h4>
<div class="outline-text-4" id="text-org8cf4cb3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">obj_map_t</span>
<span style="color: #93E0E3;">pick_up_obj_map_and_merge</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                           <span style="color: #7CB8BB;">name_vector_t</span> &amp;<span style="color: #DFAF8F;">lack_name_vector</span>,
                           <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">old_obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = old_obj_map;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = lack_name_vector.rbegin ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = lack_name_vector.rend ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++) {
        <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span> = *it;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
        env.obj_stack.pop ();
        obj_map [name] = obj;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> obj_map;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org203127e" class="outline-4">
<h4 id="org203127e">data_cons_o::apply</h4>
<div class="outline-text-4" id="text-org203127e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">data_cons_o</span>::<span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">have</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack</span> = size - have;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lack == arity) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack_name_vector</span> = name_vector_obj_map_lack
            (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = pick_up_obj_map_and_merge
            (env, lack_name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">data</span> = make_shared &lt;data_o&gt;
            (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;type_tag, obj_map);
        env.obj_stack.push (data);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (arity &lt; lack) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack_name_vector</span> = name_vector_obj_map_arity_lack
            (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map, arity);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = pick_up_obj_map_and_merge
            (env, lack_name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">data_cons</span> = make_shared &lt;data_cons_o&gt;
            (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;type_tag, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, obj_map);
        env.obj_stack.push (data_cons);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : data_cons_o::apply"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  over-arity apply"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  arity &gt; lack"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  arity : "</span> &lt;&lt; arity &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  lack : "</span> &lt;&lt; lack &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga4c1f86" class="outline-4">
<h4 id="orga4c1f86">data_cons_o::equal</h4>
<div class="outline-text-4" id="text-orga4c1f86">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">data_cons_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;data_cons_o&gt; (obj);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;type_tag != that-&gt;type_tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> obj_map_equal (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map, that-&gt;obj_map);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1f0b95b" class="outline-4">
<h4 id="org1f0b95b">name_vector_and_obj_map_repr</h4>
<div class="outline-text-4" id="text-org1f0b95b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">name_vector_and_obj_map_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                              <span style="color: #7CB8BB;">name_vector_t</span> &amp;<span style="color: #DFAF8F;">name_vector</span>,
                              <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">name</span>: name_vector) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = obj_map.find (name);
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (it == obj_map.end ()) {
            repr += name;
            repr += <span style="color: #CC9393;">" = _ "</span>;
        }
    }
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: obj_map) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = kv.first;
        repr += name;
        repr += <span style="color: #CC9393;">" = "</span>;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = kv.second;
        repr += obj-&gt;repr (env);
        repr += <span style="color: #CC9393;">" "</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> repr.empty ()) repr.pop_back ();
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7bc3004" class="outline-4">
<h4 id="org7bc3004">data_cons_o::repr</h4>
<div class="outline-text-4" id="text-org7bc3004">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">data_cons_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector.size () == 0) {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">""</span>;
        repr += name_of_tag (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;type_tag);
        repr.pop_back ();
        repr.pop_back ();
        repr += <span style="color: #CC9393;">"-c"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"("</span>;
        repr += name_of_tag (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;type_tag);
        repr.pop_back ();
        repr.pop_back ();
        repr += <span style="color: #CC9393;">"-c "</span>;
        repr += name_vector_and_obj_map_repr
            (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        repr += <span style="color: #CC9393;">")"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga8b6f7c" class="outline-3">
<h3 id="orga8b6f7c">prim</h3>
<div class="outline-text-3" id="text-orga8b6f7c">
</div><div id="outline-container-orgc8f4c4a" class="outline-4">
<h4 id="orgc8f4c4a">prim_fn</h4>
<div class="outline-text-4" id="text-orgc8f4c4a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">prim_fn</span> = <span style="color: #7CB8BB;">function</span>
    &lt;<span style="color: #7CB8BB;">void</span> (<span style="color: #7CB8BB;">env_t</span> &amp;, <span style="color: #7CB8BB;">obj_map_t</span> &amp;)&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc7a9d8d" class="outline-4">
<h4 id="orgc7a9d8d">prim_o</h4>
<div class="outline-text-4" id="text-orgc7a9d8d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">prim_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>;
    <span style="color: #7CB8BB;">prim_fn</span> <span style="color: #DFAF8F;">fn</span>;
    <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>;
    <span style="color: #93E0E3;">prim_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
            <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
            <span style="color: #7CB8BB;">prim_fn</span> <span style="color: #DFAF8F;">fn</span>,
            <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org91056e0" class="outline-4">
<h4 id="org91056e0">prim_o::prim_o</h4>
<div class="outline-text-4" id="text-org91056e0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">prim_o</span>::<span style="color: #93E0E3;">prim_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
                <span style="color: #7CB8BB;">prim_fn</span> <span style="color: #DFAF8F;">fn</span>,
                <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = tagging (env, <span style="color: #CC9393;">"prim-t"</span>);
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector = name_vector;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;fn = fn;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map = obj_map;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8d607e" class="outline-4">
<h4 id="org8d607e">prim_o::repr</h4>
<div class="outline-text-4" id="text-org8d607e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">prim_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector.size () == 0) {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"(prim)"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"(prim "</span>;
        repr += name_vector_and_obj_map_repr
            (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        repr += <span style="color: #CC9393;">")"</span>;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6bf10b" class="outline-4">
<h4 id="org6bf10b">prim_o::equal</h4>
<div class="outline-text-4" id="text-org6bf10b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span> <span style="color: #BFEBBF;">prim_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;prim_o&gt; (obj);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span> != obj.get ()) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> obj_map_equal (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map, that-&gt;obj_map);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org96ac699" class="outline-4">
<h4 id="org96ac699">prim_o::apply</h4>
<div class="outline-text-4" id="text-org96ac699">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span> <span style="color: #BFEBBF;">prim_o</span>::<span style="color: #93E0E3;">apply</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">have</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack</span> = size - have;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lack == arity) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack_name_vector</span> = name_vector_obj_map_lack
            (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = pick_up_obj_map_and_merge
            (env, lack_name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;fn (env, obj_map);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (arity &lt; lack) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lack_name_vector</span> = name_vector_obj_map_arity_lack
            (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map, arity);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = pick_up_obj_map_and_merge
            (env, lack_name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj_map);
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">prim</span> = make_shared &lt;prim_o&gt;
            (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;fn, obj_map);
        env.obj_stack.push (prim);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : prim_o::apply"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  over-arity apply"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  arity &gt; lack"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  arity : "</span> &lt;&lt; arity &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"  lack : "</span> &lt;&lt; lack &lt;&lt; <span style="color: #CC9393;">"\n"</span>
             &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org6f0011f" class="outline-2">
<h2 id="org6f0011f">env</h2>
<div class="outline-text-2" id="text-org6f0011f">
</div><div id="outline-container-orgb3154d4" class="outline-3">
<h3 id="orgb3154d4">frame</h3>
<div class="outline-text-3" id="text-orgb3154d4">
</div><div id="outline-container-orgcbe63aa" class="outline-4">
<h4 id="orgcbe63aa">frame_t::frame_t</h4>
<div class="outline-text-4" id="text-orgcbe63aa">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">frame_t</span>::<span style="color: #93E0E3;">frame_t</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>,
                  <span style="color: #7CB8BB;">local_scope_t</span> <span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;index = 0;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo = jojo;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;local_scope = local_scope;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9fed137" class="outline-4">
<h4 id="org9fed137">frame_report</h4>
<div class="outline-text-4" id="text-org9fed137">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">frame_report</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">frame_t</span>&gt; <span style="color: #DFAF8F;">frame</span>)
{
    cout &lt;&lt; <span style="color: #CC9393;">"  - ["</span> &lt;&lt; frame-&gt;index+1
         &lt;&lt; <span style="color: #CC9393;">"/"</span> &lt;&lt; frame-&gt;jojo-&gt;jo_vector.size ()
         &lt;&lt; <span style="color: #CC9393;">"] "</span>;
    jojo_print_with_index (env, frame-&gt;jojo, frame-&gt;index);
    cout &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    cout &lt;&lt; local_scope_repr (env, frame-&gt;local_scope);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd0067d2" class="outline-3">
<h3 id="orgd0067d2">box</h3>
<div class="outline-text-3" id="text-orgd0067d2">
</div><div id="outline-container-orgebfe1e" class="outline-4">
<h4 id="orgebfe1e">box_t::box_t</h4>
<div class="outline-text-4" id="text-orgebfe1e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">box_t</span>::<span style="color: #93E0E3;">box_t</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;empty_p = <span style="color: #BFEBBF;">true</span>;
}

<span style="color: #BFEBBF;">box_t</span>::<span style="color: #93E0E3;">box_t</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;empty_p = <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;obj = obj;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org30ccfa1" class="outline-4">
<h4 id="org30ccfa1">boxing</h4>
<div class="outline-text-4" id="text-org30ccfa1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">box_t</span> *
<span style="color: #93E0E3;">boxing</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.box_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.box_map.end ())
        <span style="color: #F0DFAF; font-weight: bold;">return</span> it-&gt;second;
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">box_t</span> ();
        env.box_map [name] = box;
        <span style="color: #F0DFAF; font-weight: bold;">return</span> box;
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge3bf9d0" class="outline-3">
<h3 id="orge3bf9d0">box_map</h3>
<div class="outline-text-3" id="text-orge3bf9d0">
</div><div id="outline-container-org22758a2" class="outline-4">
<h4 id="org22758a2">box_map_report</h4>
<div class="outline-text-4" id="text-org22758a2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">box_map_report</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    cout &lt;&lt; <span style="color: #CC9393;">"- ["</span> &lt;&lt; env.box_map.size () &lt;&lt; <span style="color: #CC9393;">"] "</span>
         &lt;&lt; <span style="color: #CC9393;">"box_map - "</span>
         &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: env.box_map) {
        cout &lt;&lt; <span style="color: #CC9393;">"  "</span> &lt;&lt; kv.first &lt;&lt; <span style="color: #CC9393;">" = "</span>;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">box</span> = kv.second;
        cout &lt;&lt; box-&gt;obj-&gt;repr (env);
        cout &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2edf46c" class="outline-4">
<h4 id="org2edf46c">name_of_box</h4>
<div class="outline-text-4" id="text-org2edf46c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_t</span>
<span style="color: #93E0E3;">name_of_box</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: env.box_map) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = kv.first;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (kv.second == box) {
            <span style="color: #F0DFAF; font-weight: bold;">return</span> name;
        }
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"#non-name"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgdcd8bf3" class="outline-3">
<h3 id="orgdcd8bf3">obj_stack</h3>
<div class="outline-text-3" id="text-orgdcd8bf3">
</div><div id="outline-container-org7f76e3d" class="outline-4">
<h4 id="org7f76e3d">frame_stack_report</h4>
<div class="outline-text-4" id="text-org7f76e3d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">frame_stack_report</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    cout &lt;&lt; <span style="color: #CC9393;">"- ["</span> &lt;&lt; env.frame_stack.size () &lt;&lt; <span style="color: #CC9393;">"] "</span>
         &lt;&lt; <span style="color: #CC9393;">"frame_stack - "</span>
         &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    <span style="color: #7CB8BB;">frame_stack_t</span> <span style="color: #DFAF8F;">frame_stack</span> = env.frame_stack;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> frame_stack.empty ()) {
       <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">frame</span> = frame_stack.top ();
       frame_report (env, frame);
       frame_stack.pop ();
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgca9b9b2" class="outline-3">
<h3 id="orgca9b9b2">frame_stack</h3>
<div class="outline-text-3" id="text-orgca9b9b2">
</div><div id="outline-container-orgcaddc82" class="outline-4">
<h4 id="orgcaddc82">obj_stack_report</h4>
<div class="outline-text-4" id="text-orgcaddc82">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">obj_stack_report</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    cout &lt;&lt; <span style="color: #CC9393;">"- ["</span> &lt;&lt; env.obj_stack.size () &lt;&lt; <span style="color: #CC9393;">"] "</span>
         &lt;&lt; <span style="color: #CC9393;">"obj_stack - "</span>
         &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_stack</span> = env.obj_stack;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> obj_stack.empty ()) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = obj_stack.top ();
        cout &lt;&lt; <span style="color: #CC9393;">"  "</span>;
        cout &lt;&lt; obj-&gt;repr (env);
        cout &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
        obj_stack.pop ();
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge52f0ee" class="outline-3">
<h3 id="orge52f0ee">env_t::step</h3>
<div class="outline-text-3" id="text-orge52f0ee">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">step</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">frame</span> = <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;frame_stack.top ();
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">size</span> = frame-&gt;jojo-&gt;jo_vector.size ();
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">it is assumed that jojo in frame are not empty</span>
    assert (size != 0);
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span> = frame-&gt;index;
    frame-&gt;index++;
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">handle proper tail call</span>
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (index+1 == size) <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;frame_stack.pop ();
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">since the last frame might be drop,</span>
    <span style="color: #5F7F5F;">//   </span><span style="color: #7F9F7F;">we pass last local_scope as an extra argument.</span>
    frame-&gt;jojo-&gt;jo_vector[index]-&gt;exe (*<span style="color: #F0DFAF; font-weight: bold;">this</span>, frame-&gt;local_scope);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc3b8a9e" class="outline-3">
<h3 id="orgc3b8a9e">env_t::run</h3>
<div class="outline-text-3" id="text-orgc3b8a9e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">run</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span><span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;frame_stack.empty ()) {
        <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;step ();
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfdf04bb" class="outline-3">
<h3 id="orgfdf04bb">env_t::report</h3>
<div class="outline-text-3" id="text-orgfdf04bb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">report</span> ()
{
    box_map_report (*<span style="color: #F0DFAF; font-weight: bold;">this</span>);
    frame_stack_report (*<span style="color: #F0DFAF; font-weight: bold;">this</span>);
    obj_stack_report (*<span style="color: #F0DFAF; font-weight: bold;">this</span>);
    cout &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org22ea319" class="outline-3">
<h3 id="org22ea319">env_t::run_with_base</h3>
<div class="outline-text-3" id="text-org22ea319">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">run_with_base</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">base</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;frame_stack.size () &gt; base) {
        <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;step ();
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd301567" class="outline-3">
<h3 id="orgd301567">env_t::double_report</h3>
<div class="outline-text-3" id="text-orgd301567">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">double_report</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;report ();
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;run ();
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;report ();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org72ee82b" class="outline-3">
<h3 id="org72ee82b">env_t::step_and_report</h3>
<div class="outline-text-3" id="text-org72ee82b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">env_t</span>::<span style="color: #93E0E3;">step_and_report</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;step ();
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;report ();
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga49e62e" class="outline-2">
<h2 id="orga49e62e">jo</h2>
<div class="outline-text-2" id="text-orga49e62e">
</div><div id="outline-container-org248b168" class="outline-3">
<h3 id="org248b168">jojo</h3>
<div class="outline-text-3" id="text-org248b168">
</div><div id="outline-container-orge960ae4" class="outline-4">
<h4 id="orge960ae4">jojo_t::jojo_t</h4>
<div class="outline-text-4" id="text-orge960ae4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">jojo_t</span>::
<span style="color: #93E0E3;">jojo_t</span> (<span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jo_vector = jo_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org792a760" class="outline-4">
<h4 id="org792a760">jojo_t::~jojo_t</h4>
<div class="outline-text-4" id="text-org792a760">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">jojo_t</span>::
~<span style="color: #93E0E3;">jojo_t</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #7CB8BB;">jo_t</span> *<span style="color: #DFAF8F;">jo_ptr</span>: <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jo_vector)
        <span style="color: #F0DFAF; font-weight: bold;">delete</span> jo_ptr;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4b272a4" class="outline-3">
<h3 id="org4b272a4">jo</h3>
<div class="outline-text-3" id="text-org4b272a4">
</div><div id="outline-container-orga510aa7" class="outline-4">
<h4 id="orga510aa7">jo_t::copy</h4>
<div class="outline-text-4" id="text-orga510aa7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : jo_t::copy unknown jo"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    exit (1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga83cc51" class="outline-4">
<h4 id="orga83cc51">jo_t::~jo_t</h4>
<div class="outline-text-4" id="text-orga83cc51">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">jo_t</span>::~<span style="color: #93E0E3;">jo_t</span> ()
{
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">all classes that will be derived from</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">should have a virtual or protected destructor,</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">otherwise deleting an instance via a pointer</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">to a base class results in undefined behavior.</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org48f6bb9" class="outline-4">
<h4 id="org48f6bb9">jo_t::exe</h4>
<div class="outline-text-4" id="text-org48f6bb9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    cout &lt;&lt; <span style="color: #CC9393;">"- fatal error : unknown jo"</span> &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    exit (1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org31a75ab" class="outline-4">
<h4 id="org31a75ab">jo_t::repr</h4>
<div class="outline-text-4" id="text-org31a75ab">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"(unknown)"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orged4bcd8" class="outline-3">
<h3 id="orged4bcd8">ref_jo</h3>
<div class="outline-text-3" id="text-orged4bcd8">
</div><div id="outline-container-orgc481b3c" class="outline-4">
<h4 id="orgc481b3c">ref_jo_t</h4>
<div class="outline-text-4" id="text-orgc481b3c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">ref_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span>;
    <span style="color: #93E0E3;">ref_jo_t</span> (<span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span>);
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org1d54c12" class="outline-4">
<h4 id="org1d54c12">ref_jo_t::ref_jo_t</h4>
<div class="outline-text-4" id="text-org1d54c12">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">ref_jo_t</span>::<span style="color: #93E0E3;">ref_jo_t</span> (<span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;box = box;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb3354f7" class="outline-4">
<h4 id="orgb3354f7">ref_jo_t::copy</h4>
<div class="outline-text-4" id="text-orgb3354f7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">ref_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;box);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org13d6dd2" class="outline-4">
<h4 id="org13d6dd2">ref_jo_t::exe</h4>
<div class="outline-text-4" id="text-org13d6dd2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">ref_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    assert (<span style="color: #F0DFAF; font-weight: bold;">!</span> <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;box-&gt;empty_p);
    env.obj_stack.push (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;box-&gt;obj);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org417bbbd" class="outline-4">
<h4 id="org417bbbd">ref_jo_t::repr</h4>
<div class="outline-text-4" id="text-org417bbbd">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">ref_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> name_of_box (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;box);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8c56019" class="outline-3">
<h3 id="org8c56019">local_ref_jo</h3>
<div class="outline-text-3" id="text-org8c56019">
</div><div id="outline-container-orgdf5a725" class="outline-4">
<h4 id="orgdf5a725">local_ref_jo_t</h4>
<div class="outline-text-4" id="text-orgdf5a725">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">local_ref_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">level</span>;
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span>;
    <span style="color: #93E0E3;">local_ref_jo_t</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">level</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span>);
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org958a3ce" class="outline-4">
<h4 id="org958a3ce">local_ref_jo_t::local_ref_jo_t</h4>
<div class="outline-text-4" id="text-org958a3ce">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">local_ref_jo_t</span>::
<span style="color: #93E0E3;">local_ref_jo_t</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">level</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;level = level;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;index = index;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga6c4720" class="outline-4">
<h4 id="orga6c4720">local_ref_jo_t::copy</h4>
<div class="outline-text-4" id="text-orga6c4720">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">local_ref_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">local_ref_jo_t</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;level, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;index);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org85cc5cd" class="outline-4">
<h4 id="org85cc5cd">vector_rev_ref</h4>
<div class="outline-text-4" id="text-org85cc5cd">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">template</span> &lt;<span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">T</span>&gt;
<span style="color: #7CB8BB;">T</span>
<span style="color: #93E0E3;">vector_rev_ref</span> (<span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">T</span>&gt; <span style="color: #DFAF8F;">vect</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">rev_index</span>)
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">size</span> = vect.size ();
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span> = size - rev_index - 1;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> vect [index];
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org24f997c" class="outline-4">
<h4 id="org24f997c">local_ref_jo_t::exe</h4>
<div class="outline-text-4" id="text-org24f997c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">local_ref_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">this is the only place where</span>
    <span style="color: #5F7F5F;">//   </span><span style="color: #7F9F7F;">the local_scope in the arg of exe is uesd.</span>
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bind_vector</span> =
        vector_rev_ref (local_scope, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;level);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bind</span> =
        vector_rev_ref (bind_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;index);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = bind.second;
    env.obj_stack.push (obj);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd3cef80" class="outline-4">
<h4 id="orgd3cef80">local_ref_jo_t::repr</h4>
<div class="outline-text-4" id="text-orgd3cef80">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">local_ref_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"local."</span> +
        to_string (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;level) + <span style="color: #CC9393;">"."</span> +
        to_string (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;index);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org724d9bf" class="outline-3">
<h3 id="org724d9bf">lambda_jo</h3>
<div class="outline-text-3" id="text-org724d9bf">
</div><div id="outline-container-orge1aaad8" class="outline-4">
<h4 id="orge1aaad8">lambda_jo_t</h4>
<div class="outline-text-4" id="text-orge1aaad8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">lambda_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>;
    <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>;
    <span style="color: #93E0E3;">lambda_jo_t</span> (<span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
                 <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>);
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org38ffa77" class="outline-4">
<h4 id="org38ffa77">lambda_jo_t::lambda_jo_t</h4>
<div class="outline-text-4" id="text-org38ffa77">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">lambda_jo_t</span>::
<span style="color: #93E0E3;">lambda_jo_t</span> (<span style="color: #7CB8BB;">name_vector_t</span> <span style="color: #DFAF8F;">name_vector</span>,
             <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector = name_vector;
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo = jojo;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6f9d780" class="outline-4">
<h4 id="org6f9d780">lambda_jo_t::copy</h4>
<div class="outline-text-4" id="text-org6f9d780">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">lambda_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">lambda_jo_t</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd6cd342" class="outline-4">
<h4 id="orgd6cd342">bind_vector_from_name_vector</h4>
<div class="outline-text-4" id="text-orgd6cd342">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bind_vector_t</span>
<span style="color: #93E0E3;">bind_vector_from_name_vector</span> (<span style="color: #7CB8BB;">name_vector_t</span> &amp;<span style="color: #DFAF8F;">name_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bind_vector</span> = bind_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = name_vector.begin ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = name_vector.end ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++)
        bind_vector.push_back (make_pair (*it, <span style="color: #BFEBBF;">nullptr</span>));
    <span style="color: #F0DFAF; font-weight: bold;">return</span> bind_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org453461c" class="outline-4">
<h4 id="org453461c">lambda_jo_t::exe</h4>
<div class="outline-text-4" id="text-org453461c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">lambda_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">closure</span> = make_shared &lt;closure_o&gt;
        (env,
         <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector,
         <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo,
         bind_vector_from_name_vector (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector),
         local_scope);
    env.obj_stack.push (closure);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga2dfb4b" class="outline-4">
<h4 id="orga2dfb4b">lambda_jo_t::repr</h4>
<div class="outline-text-4" id="text-orga2dfb4b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">lambda_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"(lambda "</span> +
        name_vector_repr (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name_vector) +
        <span style="color: #CC9393;">" "</span> +
        jojo_repr (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;jojo) +
        <span style="color: #CC9393;">")"</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb131588" class="outline-3">
<h3 id="orgb131588">field_jo</h3>
<div class="outline-text-3" id="text-orgb131588">
</div><div id="outline-container-orgf2d83a9" class="outline-4">
<h4 id="orgf2d83a9">field_jo_t</h4>
<div class="outline-text-4" id="text-orgf2d83a9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">field_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>;
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #93E0E3;">field_jo_t</span> (<span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>);
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org52d13c3" class="outline-4">
<h4 id="org52d13c3">field_jo_t::field_jo_t</h4>
<div class="outline-text-4" id="text-org52d13c3">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">field_jo_t</span>::<span style="color: #93E0E3;">field_jo_t</span> (<span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name = name;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2250170" class="outline-4">
<h4 id="org2250170">field_jo_t::copy</h4>
<div class="outline-text-4" id="text-org2250170">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">field_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org278caba" class="outline-4">
<h4 id="org278caba">field_jo_t::exe</h4>
<div class="outline-text-4" id="text-org278caba">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">field_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
    env.obj_stack.pop ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">data</span> = static_pointer_cast &lt;data_o&gt; (obj);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = data-&gt;obj_map.find (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != data-&gt;obj_map.end ()) {
        env.obj_stack.push (it-&gt;second);
        <span style="color: #F0DFAF; font-weight: bold;">return</span>;
    }
    cout &lt;&lt; <span style="color: #CC9393;">"- fatal error ! unknown field : "</span>
         &lt;&lt; <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name
         &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
    exit (1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org759470" class="outline-4">
<h4 id="org759470">field_jo_t::repr</h4>
<div class="outline-text-4" id="text-org759470">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">field_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"."</span> + <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;name;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc9e1d2b" class="outline-3">
<h3 id="orgc9e1d2b">apply_jo</h3>
<div class="outline-text-3" id="text-orgc9e1d2b">
</div><div id="outline-container-org443cbfd" class="outline-4">
<h4 id="org443cbfd">apply_jo_t</h4>
<div class="outline-text-4" id="text-org443cbfd">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">apply_jo_t</span>: <span style="color: #7CB8BB;">jo_t</span>
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>;
    <span style="color: #93E0E3;">apply_jo_t</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>);
    <span style="color: #7CB8BB;">jo_t</span> * <span style="color: #93E0E3;">copy</span> ();
    <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgba82ac9" class="outline-4">
<h4 id="orgba82ac9">apply_jo_t::apply_jo_t</h4>
<div class="outline-text-4" id="text-orgba82ac9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">apply_jo_t</span>::
<span style="color: #93E0E3;">apply_jo_t</span> (<span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">arity</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;arity = arity;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7774920" class="outline-4">
<h4 id="org7774920">apply_jo_t::copy</h4>
<div class="outline-text-4" id="text-org7774920">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">jo_t</span> *
<span style="color: #BFEBBF;">apply_jo_t</span>::<span style="color: #93E0E3;">copy</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;arity);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org55c5517" class="outline-4">
<h4 id="org55c5517">apply_jo_t::exe</h4>
<div class="outline-text-4" id="text-org55c5517">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #BFEBBF;">apply_jo_t</span>::<span style="color: #93E0E3;">exe</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">local_scope_t</span> &amp;<span style="color: #DFAF8F;">local_scope</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
    env.obj_stack.pop ();
    obj-&gt;apply (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;arity);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org653373d" class="outline-4">
<h4 id="org653373d">apply_jo_t::repr</h4>
<div class="outline-text-4" id="text-org653373d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">apply_jo_t</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"(apply "</span> +
        to_string (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;arity) + <span style="color: #CC9393;">")"</span>;
}
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org282d290" class="outline-2">
<h2 id="org282d290">define</h2>
<div class="outline-text-2" id="text-org282d290">
</div><div id="outline-container-orgfacf26c" class="outline-3">
<h3 id="orgfacf26c">define</h3>
<div class="outline-text-3" id="text-orgfacf26c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">define</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.box_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.box_map.end ()) {
        <span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span> = it-&gt;second;
        box-&gt;empty_p = <span style="color: #BFEBBF;">false</span>;
        box-&gt;obj = obj;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        env.box_map [name] = <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">box_t</span> (obj);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge137e42" class="outline-3">
<h3 id="orge137e42">sig_t</h3>
<div class="outline-text-3" id="text-orge137e42">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">sig_t</span> = name_vector_t;
</pre>
</div>
</div>
</div>

<div id="outline-container-org7805157" class="outline-3">
<h3 id="org7805157">name_of_sig</h3>
<div class="outline-text-3" id="text-org7805157">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_t</span>
<span style="color: #93E0E3;">name_of_sig</span> (<span style="color: #7CB8BB;">sig_t</span> &amp;<span style="color: #DFAF8F;">sig</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> sig [0];
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge7185e5" class="outline-3">
<h3 id="orge7185e5">name_vector_of_sig</h3>
<div class="outline-text-3" id="text-orge7185e5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_vector_t</span>
<span style="color: #93E0E3;">name_vector_of_sig</span> (<span style="color: #7CB8BB;">sig_t</span> &amp;<span style="color: #DFAF8F;">sig</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = name_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = sig.begin () + 1;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = sig.end ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++) {
        name_vector.push_back (*it);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> name_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3758e53" class="outline-3">
<h3 id="org3758e53">define_prim</h3>
<div class="outline-text-3" id="text-org3758e53">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">define_prim</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">sig</span>, <span style="color: #7CB8BB;">prim_fn</span> <span style="color: #DFAF8F;">fn</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = name_of_sig (sig);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = name_vector_of_sig (sig);
    define (env, name, make_shared &lt;prim_o&gt;
            (env, name_vector, fn, <span style="color: #7CB8BB;">obj_map_t</span> ()));
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4e5306a" class="outline-2">
<h2 id="org4e5306a"><b>test</b></h2>
<div class="outline-text-2" id="text-org4e5306a">
</div><div id="outline-container-orgba0dfa4" class="outline-3">
<h3 id="orgba0dfa4">new_frame_from_jojo</h3>
<div class="outline-text-3" id="text-orgba0dfa4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">frame_t</span>&gt;
<span style="color: #93E0E3;">new_frame_from_jojo</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">frame_t</span>&gt;
        (jojo, <span style="color: #7CB8BB;">local_scope_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4d27e87" class="outline-3">
<h3 id="org4d27e87">new_frame_from_jo_vector</h3>
<div class="outline-text-3" id="text-org4d27e87">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">frame_t</span>&gt;
<span style="color: #93E0E3;">new_frame_from_jo_vector</span> (<span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">frame_t</span>&gt;
        (jojo, <span style="color: #7CB8BB;">local_scope_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org14f68e4" class="outline-3">
<h3 id="org14f68e4">assert</h3>
<div class="outline-text-3" id="text-org14f68e4">
</div><div id="outline-container-org701765" class="outline-4">
<h4 id="org701765">assert_pop_eq</h4>
<div class="outline-text-4" id="text-org701765">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">assert_pop_eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = env.obj_stack.top ();
    assert (obj-&gt;equal (env, that));
    env.obj_stack.pop ();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org46025d" class="outline-4">
<h4 id="org46025d">assert_tos_eq</h4>
<div class="outline-text-4" id="text-org46025d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">assert_tos_eq</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = env.obj_stack.top ();
    assert (obj-&gt;equal (env, that));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org51fd94d" class="outline-4">
<h4 id="org51fd94d">assert_stack_size</h4>
<div class="outline-text-4" id="text-org51fd94d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">assert_stack_size</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">size</span>)
{
    assert (env.obj_stack.size () == size);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6b30aaa" class="outline-3">
<h3 id="org6b30aaa"><span class="todo _todo_">[todo]</span> import_test</h3>
<div class="outline-text-3" id="text-org6b30aaa">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">import_test</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org695a111" class="outline-2">
<h2 id="org695a111"><b>bool</b></h2>
<div class="outline-text-2" id="text-org695a111">
</div><div id="outline-container-org1c00d8f" class="outline-3">
<h3 id="org1c00d8f">true_c</h3>
<div class="outline-text-3" id="text-org1c00d8f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;data_o&gt;
<span style="color: #93E0E3;">true_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
   <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;data_o&gt;
       (env,
        tagging (env, <span style="color: #CC9393;">"true-t"</span>),
        <span style="color: #7CB8BB;">obj_map_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org896fadb" class="outline-3">
<h3 id="org896fadb">false_c</h3>
<div class="outline-text-3" id="text-org896fadb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;data_o&gt;
<span style="color: #93E0E3;">false_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
   <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;data_o&gt;
       (env,
        tagging (env, <span style="color: #CC9393;">"false-t"</span>),
        <span style="color: #7CB8BB;">obj_map_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org280de6b" class="outline-3">
<h3 id="org280de6b">jj_true_c</h3>
<div class="outline-text-3" id="text-org280de6b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;data_o&gt;
<span style="color: #93E0E3;">jj_true_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
   <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;data_o&gt;
       (env,
        tagging (env, <span style="color: #CC9393;">"true-t"</span>),
        <span style="color: #7CB8BB;">obj_map_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4d5a94b" class="outline-3">
<h3 id="org4d5a94b">jj_false_c</h3>
<div class="outline-text-3" id="text-org4d5a94b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;data_o&gt;
<span style="color: #93E0E3;">jj_false_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
   <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;data_o&gt;
       (env,
        tagging (env, <span style="color: #CC9393;">"false-t"</span>),
        <span style="color: #7CB8BB;">obj_map_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf8375e4" class="outline-3">
<h3 id="orgf8375e4">import_bool</h3>
<div class="outline-text-3" id="text-orgf8375e4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_bool</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define (env, <span style="color: #CC9393;">"true-c"</span>, jj_true_c (env));
    define (env, <span style="color: #CC9393;">"false-c"</span>, jj_false_c (env));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8f4d699" class="outline-3">
<h3 id="org8f4d699">test_bool</h3>
<div class="outline-text-3" id="text-org8f4d699">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_bool</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    import_bool (env);

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"true-c"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"false-c"</span>)),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">env.double_report ();</span>

    {
        env.run ();
        assert_stack_size (env, 2);
        assert_pop_eq (env, jj_false_c (env));
        assert_pop_eq (env, jj_true_c (env));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf2811b0" class="outline-2">
<h2 id="orgf2811b0"><b>list</b></h2>
<div class="outline-text-2" id="text-orgf2811b0">
</div><div id="outline-container-org5a5f796" class="outline-3">
<h3 id="org5a5f796">null_c</h3>
<div class="outline-text-3" id="text-org5a5f796">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;data_o&gt;
<span style="color: #93E0E3;">null_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
   <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;data_o&gt;
       (env,
        tagging (env, <span style="color: #CC9393;">"null-t"</span>),
        <span style="color: #7CB8BB;">obj_map_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc198a78" class="outline-3">
<h3 id="orgc198a78">cons_c</h3>
<div class="outline-text-3" id="text-orgc198a78">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;data_o&gt;
<span style="color: #93E0E3;">cons_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
        <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">car</span>,
        <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">cdr</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj_map</span> = obj_map_t ();
    obj_map [<span style="color: #CC9393;">"car"</span>] = car;
    obj_map [<span style="color: #CC9393;">"cdr"</span>] = cdr;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;data_o&gt;
        (env,
         tagging (env, <span style="color: #CC9393;">"cons-t"</span>),
         obj_map);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org86ae0d0" class="outline-3">
<h3 id="org86ae0d0">car</h3>
<div class="outline-text-3" id="text-org86ae0d0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">car</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    assert (a-&gt;tag == tagging (env, <span style="color: #CC9393;">"cons-t"</span>));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">cons</span> = static_pointer_cast &lt;data_o&gt; (a);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> cons-&gt;obj_map [<span style="color: #CC9393;">"car"</span>];
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3069113" class="outline-3">
<h3 id="org3069113">cdr</h3>
<div class="outline-text-3" id="text-org3069113">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">cdr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    assert (a-&gt;tag == tagging (env, <span style="color: #CC9393;">"cons-t"</span>));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">cons</span> = static_pointer_cast &lt;data_o&gt; (a);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> cons-&gt;obj_map [<span style="color: #CC9393;">"cdr"</span>];
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3574fe9" class="outline-3">
<h3 id="org3574fe9">null_p</h3>
<div class="outline-text-3" id="text-org3574fe9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">null_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == tagging (env, <span style="color: #CC9393;">"null-t"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge779c7e" class="outline-3">
<h3 id="orge779c7e">cons_p</h3>
<div class="outline-text-3" id="text-orge779c7e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">cons_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == tagging (env, <span style="color: #CC9393;">"cons-t"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaa8fc9c" class="outline-3">
<h3 id="orgaa8fc9c">list_p</h3>
<div class="outline-text-3" id="text-orgaa8fc9c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">list_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> null_p (env, a)
        || cons_p (env, a);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8f12285" class="outline-3">
<h3 id="org8f12285">list_length</h3>
<div class="outline-text-3" id="text-org8f12285">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">size_t</span>
<span style="color: #93E0E3;">list_length</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">l</span>)
{
    assert (list_p (env, l));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">length</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> null_p (env, l)) {
        length++;
        l = cdr (env, l);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> length;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf29a4f2" class="outline-3">
<h3 id="orgf29a4f2">jj_null_c</h3>
<div class="outline-text-3" id="text-orgf29a4f2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;data_o&gt;
<span style="color: #93E0E3;">jj_null_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
   <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;data_o&gt;
       (env,
        tagging (env, <span style="color: #CC9393;">"null-t"</span>),
        <span style="color: #7CB8BB;">obj_map_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9f977fe" class="outline-3">
<h3 id="org9f977fe">jj_cons_c</h3>
<div class="outline-text-3" id="text-org9f977fe">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;data_cons_o&gt;
<span style="color: #93E0E3;">jj_cons_c</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;data_cons_o&gt;
        (env,
         tagging (env, <span style="color: #CC9393;">"cons-t"</span>),
         name_vector_t ({ <span style="color: #CC9393;">"car"</span>, <span style="color: #CC9393;">"cdr"</span> }),
         <span style="color: #7CB8BB;">obj_map_t</span> ());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org26668ab" class="outline-3">
<h3 id="org26668ab">import_list</h3>
<div class="outline-text-3" id="text-org26668ab">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define (env, <span style="color: #CC9393;">"null-c"</span>, jj_null_c (env));
    define (env, <span style="color: #CC9393;">"cons-c"</span>, jj_cons_c (env));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge2e262" class="outline-3">
<h3 id="orge2e262">test_list</h3>
<div class="outline-text-3" id="text-orge2e262">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_list</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    import_list (env);

    define (env, <span style="color: #CC9393;">"s1"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"cons-c"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (2),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #CC9393;">"cdr"</span>),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">env.double_report ();</span>

    {
        env.run ();
        assert_stack_size (env, 1);
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgce82562" class="outline-2">
<h2 id="orgce82562"><b>str</b></h2>
<div class="outline-text-2" id="text-orgce82562">
</div><div id="outline-container-org27613f0" class="outline-3">
<h3 id="org27613f0">string_p</h3>
<div class="outline-text-3" id="text-org27613f0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">str_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == tagging (env, <span style="color: #CC9393;">"str-t"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc3188c9" class="outline-3">
<h3 id="orgc3188c9">jj_str_print</h3>
<div class="outline-text-3" id="text-orgc3188c9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_str_print_sig</span> = { <span style="color: #CC9393;">"str-print"</span>, <span style="color: #CC9393;">"string"</span> };
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- str-t -&gt;</span>
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_str_print</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = static_pointer_cast &lt;str_o&gt; (obj_map [<span style="color: #CC9393;">"string"</span>]);
    cout &lt;&lt; str-&gt;str;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgec238f0" class="outline-3">
<h3 id="orgec238f0">import_str</h3>
<div class="outline-text-3" id="text-orgec238f0">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_str</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_prim (env,
                 jj_str_print_sig,
                 jj_str_print);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org215fa15" class="outline-3">
<h3 id="org215fa15"><span class="todo _todo_">[todo]</span> test_str</h3>
<div class="outline-text-3" id="text-org215fa15">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_str</span> ()
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org35aa2ee" class="outline-2">
<h2 id="org35aa2ee"><b>vect</b></h2>
<div class="outline-text-2" id="text-org35aa2ee">
</div><div id="outline-container-orge8d4fac" class="outline-3">
<h3 id="orge8d4fac">obj_vect_t</h3>
<div class="outline-text-3" id="text-orge8d4fac">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">obj_vect_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-org28a3ffb" class="outline-3">
<h3 id="org28a3ffb">vect_o</h3>
<div class="outline-text-3" id="text-org28a3ffb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">vect_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">obj_vect_t</span> <span style="color: #DFAF8F;">vect</span>;
    <span style="color: #93E0E3;">vect_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_vect_t</span> <span style="color: #DFAF8F;">vect</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
    <span style="color: #7CB8BB;">string</span> <span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org64a0a0b" class="outline-3">
<h3 id="org64a0a0b">vect_o::vect_o</h3>
<div class="outline-text-3" id="text-org64a0a0b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">vect_o</span>::<span style="color: #93E0E3;">vect_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;&gt; <span style="color: #DFAF8F;">vect</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = tagging (env, <span style="color: #CC9393;">"vect-t"</span>);
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;vect = vect;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3d0fd73" class="outline-3">
<h3 id="org3d0fd73">obj_equal</h3>
<div class="outline-text-3" id="text-org3d0fd73">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">obj_equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
           <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; &amp;<span style="color: #DFAF8F;">lhs</span>,
           <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; &amp;<span style="color: #DFAF8F;">rhs</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> lhs-&gt;equal (env, rhs);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7a46d0d" class="outline-3">
<h3 id="org7a46d0d">vect_equal</h3>
<div class="outline-text-3" id="text-org7a46d0d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">vect_equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
            <span style="color: #7CB8BB;">obj_vect_t</span> &amp;<span style="color: #DFAF8F;">lhs</span>,
            <span style="color: #7CB8BB;">obj_vect_t</span> &amp;<span style="color: #DFAF8F;">rhs</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (lhs.size () != rhs.size ()) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = lhs.size ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">index</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (index &lt; size) {
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> obj_equal (env, lhs [index], rhs [index]))
            <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
        index++;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org349578d" class="outline-3">
<h3 id="org349578d">vect_o::equal</h3>
<div class="outline-text-3" id="text-org349578d">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">vect_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">that</span> = static_pointer_cast &lt;vect_o&gt; (obj);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> vect_equal (env, <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;vect, that-&gt;vect);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf35f4b8" class="outline-3">
<h3 id="orgf35f4b8">vect_o::repr</h3>
<div class="outline-text-3" id="text-orgf35f4b8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #BFEBBF;">vect_o</span>::<span style="color: #93E0E3;">repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">repr</span> = <span style="color: #CC9393;">"["</span>;
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">obj</span>: <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;vect) {
        repr += obj-&gt;repr (env);
        repr += <span style="color: #CC9393;">" "</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> repr.empty ()) repr.pop_back ();
    repr += <span style="color: #CC9393;">"]"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> repr;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3e0431a" class="outline-3">
<h3 id="org3e0431a">vect_p</h3>
<div class="outline-text-3" id="text-org3e0431a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">vect_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == tagging (env, <span style="color: #CC9393;">"vect-t"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd087826" class="outline-3">
<h3 id="orgd087826">list_to_vect</h3>
<div class="outline-text-3" id="text-orgd087826">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;vect_o&gt;
<span style="color: #93E0E3;">list_to_vect</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">vect</span> = obj_vect_t ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">l</span> = static_pointer_cast &lt;data_o&gt; (a);
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> null_p (env, l)) {
        vect.push_back (car (env, l));
        l = static_pointer_cast &lt;data_o&gt;
            (cdr (env, l));
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;vect_o&gt; (env, vect);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga6cba39" class="outline-3">
<h3 id="orga6cba39">jj_list_to_vect</h3>
<div class="outline-text-3" id="text-orga6cba39">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_list_to_vect_sig</span> = { <span style="color: #CC9393;">"list-to-vect"</span>, <span style="color: #CC9393;">"list"</span> };
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- (list-t t) -&gt; (vect-t t)</span>
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_list_to_vect</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    env.obj_stack.push (list_to_vect (env, obj_map [<span style="color: #CC9393;">"list"</span>]));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9e715f2" class="outline-3">
<h3 id="org9e715f2">vect_to_list</h3>
<div class="outline-text-3" id="text-org9e715f2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;data_o&gt;
<span style="color: #93E0E3;">vect_to_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">v</span> = static_pointer_cast &lt;vect_o&gt; (a);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">vect</span> = v-&gt;vect;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">result</span> = null_c (env);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = vect.rbegin ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = vect.rend ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++)
        result = cons_c (env, *it, result);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> result;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgac4bb7b" class="outline-3">
<h3 id="orgac4bb7b">jj_vect_to_list</h3>
<div class="outline-text-3" id="text-orgac4bb7b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_vect_to_list_sig</span> = { <span style="color: #CC9393;">"vect-to-list"</span>, <span style="color: #CC9393;">"vect"</span> };
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- (vect-t t) -&gt; (list-t t)</span>
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_vect_to_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    env.obj_stack.push (vect_to_list (env, obj_map [<span style="color: #CC9393;">"vect"</span>]));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgce5527e" class="outline-3">
<h3 id="orgce5527e">import_vect</h3>
<div class="outline-text-3" id="text-orgce5527e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_vect</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_prim (env,
                 jj_list_to_vect_sig,
                 jj_list_to_vect);
    define_prim (env,
                 jj_vect_to_list_sig,
                 jj_vect_to_list);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc291f89" class="outline-3">
<h3 id="orgc291f89">test_vect</h3>
<div class="outline-text-3" id="text-orgc291f89">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_vect</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    import_list (env);
    import_vect (env);

    define (env, <span style="color: #CC9393;">"s1"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"null-c"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"cons-c"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (2),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"cons-c"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (2),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"list-to-vect"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"vect-to-list"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #CC9393;">"cdr"</span>),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #CC9393;">"car"</span>),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">env.double_report ();</span>

    {
        env.run ();
        assert_stack_size (env, 1);
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3a4bd1c" class="outline-2">
<h2 id="org3a4bd1c"><b>dict</b></h2>
<div class="outline-text-2" id="text-org3a4bd1c">
</div><div id="outline-container-org51872f" class="outline-3">
<h3 id="org51872f"><span class="todo _todo_">[todo]</span> import_dict</h3>
<div class="outline-text-3" id="text-org51872f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_dict</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{

}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6467bf8" class="outline-3">
<h3 id="org6467bf8"><span class="todo _todo_">[todo]</span> test_dict</h3>
<div class="outline-text-3" id="text-org6467bf8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_dict</span> ()
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8a014a7" class="outline-2">
<h2 id="org8a014a7"><b>sexp</b></h2>
<div class="outline-text-2" id="text-org8a014a7">
</div><div id="outline-container-org911e63a" class="outline-3">
<h3 id="org911e63a">string_vector_t</h3>
<div class="outline-text-3" id="text-org911e63a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">string_vector_t</span> = <span style="color: #7CB8BB;">vector</span> &lt;<span style="color: #7CB8BB;">string</span>&gt; ;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc567072" class="outline-3">
<h3 id="orgc567072">space_char_p</h3>
<div class="outline-text-3" id="text-orgc567072">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">space_char_p</span> (<span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> (c == <span style="color: #DCDCCC; background-color: #3F3F3F;">' </span><span style="color: #D0BF8F; font-weight: bold;">'</span>  ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'\n</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'\t</span><span style="color: #D0BF8F; font-weight: bold;">'</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbbad0bf" class="outline-3">
<h3 id="orgbbad0bf">delimiter_char_p</h3>
<div class="outline-text-3" id="text-orgbbad0bf">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">delimiter_char_p</span> (<span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> (c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'(</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">')</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'[</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">']</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'{</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'}</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">',</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">';</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'`</span><span style="color: #D0BF8F; font-weight: bold;">'</span> ||
            c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'\''</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf926821" class="outline-3">
<h3 id="orgf926821">string_from_char</h3>
<div class="outline-text-3" id="text-orgf926821">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">string_from_char</span> (<span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span>)
{
    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span> = <span style="color: #CC9393;">""</span>;
    str.push_back (c);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> str;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org63b27db" class="outline-3">
<h3 id="org63b27db">doublequote_char_p</h3>
<div class="outline-text-3" id="text-org63b27db">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">doublequote_char_p</span> (<span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> c == <span style="color: #DCDCCC; background-color: #3F3F3F;">'"</span><span style="color: #D0BF8F; font-weight: bold;">'</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org12607de" class="outline-3">
<h3 id="org12607de">find_word_length</h3>
<div class="outline-text-3" id="text-org12607de">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">size_t</span> <span style="color: #93E0E3;">find_word_length</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">code</span>, <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">begin</span>)
{
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">length</span> = code.length ();
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">index</span> = begin;
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (<span style="color: #BFEBBF;">true</span>) {
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (index == length)
            <span style="color: #F0DFAF; font-weight: bold;">return</span> index - begin;
        <span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span> = code [index];
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (space_char_p (c) <span style="color: #F0DFAF; font-weight: bold;">or</span>
            doublequote_char_p (c) <span style="color: #F0DFAF; font-weight: bold;">or</span>
            delimiter_char_p (c))
            <span style="color: #F0DFAF; font-weight: bold;">return</span> index - begin;
        index++;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8b0d058" class="outline-3">
<h3 id="org8b0d058">scan_word_vector</h3>
<div class="outline-text-3" id="text-org8b0d058">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string_vector_t</span>
<span style="color: #93E0E3;">scan_word_vector</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">code</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">string_vector</span> = string_vector_t ();
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">i</span> = 0;
    <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">length</span> = code.length ();
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (i &lt; length) {
        <span style="color: #7CB8BB;">char</span> <span style="color: #DFAF8F;">c</span> = code [i];
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (space_char_p (c)) i++;
        <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (delimiter_char_p (c)) {
            string_vector.push_back (string_from_char (c));
            i++;
        }
        <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">else if (doublequote_char_p (c)) {</span>
        <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">}</span>
        <span style="color: #F0DFAF; font-weight: bold;">else</span> {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word_length</span> = find_word_length (code, i);
            <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">word</span> = code.substr (i, word_length);
            string_vector.push_back (word);
            i += word_length;
        }
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> string_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb06a540" class="outline-3">
<h3 id="orgb06a540">string_vector_to_string_list</h3>
<div class="outline-text-3" id="text-orgb06a540">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;data_o&gt;
<span style="color: #93E0E3;">string_vector_to_string_list</span>
(<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">string_vector_t</span> &amp;<span style="color: #DFAF8F;">string_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">begin</span> = string_vector.rbegin ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">end</span> = string_vector.rend ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">collect</span> = null_c (env);
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = begin; it != end; it++) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = make_shared &lt;str_o&gt; (env, *it);
        collect = cons_c (env, obj, collect);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> collect;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1570d70" class="outline-3">
<h3 id="org1570d70"><span class="todo _note_">[note]</span> about literal in quote</h3>
<div class="outline-text-3" id="text-org1570d70">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">( )</td>
<td class="org-left">list-t</td>
</tr>

<tr>
<td class="org-left">[ ]</td>
<td class="org-left">vect-t</td>
</tr>

<tr>
<td class="org-left">{ }</td>
<td class="org-left">dict-t</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org9b7b07c" class="outline-3">
<h3 id="org9b7b07c">scan_word_list</h3>
<div class="outline-text-3" id="text-org9b7b07c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;data_o&gt;
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">scan_word_list (env_t &amp;env, shared_ptr &lt;str_o&gt; code)</span>
<span style="color: #93E0E3;">scan_word_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">code</span> = static_pointer_cast &lt;str_o&gt; (a);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word_vector</span> = scan_word_vector (code-&gt;str);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> string_vector_to_string_list
        (env, word_vector);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org59febe" class="outline-3">
<h3 id="org59febe">bar_word_p</h3>
<div class="outline-text-3" id="text-org59febe">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">bar_word_p</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">word</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> word == <span style="color: #CC9393;">"("</span>
        || word == <span style="color: #CC9393;">"["</span>
        || word == <span style="color: #CC9393;">"{"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbb70e93" class="outline-3">
<h3 id="orgbb70e93">ket_word_p</h3>
<div class="outline-text-3" id="text-orgbb70e93">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">ket_word_p</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">word</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> word == <span style="color: #CC9393;">")"</span>
        || word == <span style="color: #CC9393;">"]"</span>
        || word == <span style="color: #CC9393;">"}"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org53d0acd" class="outline-3">
<h3 id="org53d0acd">quote_word_p</h3>
<div class="outline-text-3" id="text-org53d0acd">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">quote_word_p</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">word</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> word == <span style="color: #CC9393;">"'"</span>
        || word == <span style="color: #CC9393;">"`"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org31e088" class="outline-3">
<h3 id="org31e088">bar_word_to_ket_word</h3>
<div class="outline-text-3" id="text-org31e088">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">bar_word_to_ket_word</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">bar</span>)
{
    assert (bar_word_p (bar));
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (bar == <span style="color: #CC9393;">"("</span>) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">")"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (bar == <span style="color: #CC9393;">"["</span>) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"]"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (bar == <span style="color: #CC9393;">"{"</span>) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"}"</span>;
    cout &lt;&lt; <span style="color: #CC9393;">"bar_word_to_ket_word fail\n"</span>;
    exit (1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc7aff36" class="outline-3">
<h3 id="orgc7aff36">word_list_head_with_bar_ket_counter</h3>
<div class="outline-text-3" id="text-orgc7aff36">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;data_o&gt;
<span style="color: #93E0E3;">word_list_head_with_bar_ket_counter</span>
(<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
 <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>,
 <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">bar</span>,
 <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">ket</span>,
 <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">counter</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word_list</span> = static_pointer_cast &lt;data_o&gt; (a);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (counter == 0)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> null_c (env);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt;
        (car (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word</span> = head-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == bar)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c
            (env, head, word_list_head_with_bar_ket_counter
             (env,
              cdr (env, word_list),
              bar, ket, counter + 1));
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == ket)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c
            (env, head, word_list_head_with_bar_ket_counter
             (env,
              cdr (env, word_list),
              bar, ket, counter - 1));
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c
            (env, head, word_list_head_with_bar_ket_counter
             (env,
              cdr (env, word_list),
              bar, ket, counter));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9a946d6" class="outline-3">
<h3 id="org9a946d6">word_list_head</h3>
<div class="outline-text-3" id="text-org9a946d6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;data_o&gt;
<span style="color: #93E0E3;">word_list_head</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    assert (cons_p (env, a));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word_list</span> = static_pointer_cast &lt;data_o&gt; (a);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt;
        (car (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word</span> = head-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (bar_word_p (word)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bar</span> = word;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">ket</span> = bar_word_to_ket_word (word);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c
            (env, head, word_list_head_with_bar_ket_counter
             (env,
              cdr (env, word_list),
              bar, ket, 1));
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (env, head, null_c (env));
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd9a73a4" class="outline-3">
<h3 id="orgd9a73a4">word_list_rest_with_bar_ket_counter</h3>
<div class="outline-text-3" id="text-orgd9a73a4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;data_o&gt;
<span style="color: #93E0E3;">word_list_rest_with_bar_ket_counter</span>
(<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
 <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>,
 <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">bar</span>,
 <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">ket</span>,
 <span style="color: #7CB8BB;">size_t</span> <span style="color: #DFAF8F;">counter</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word_list</span> = static_pointer_cast &lt;data_o&gt; (a);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (counter == 0)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> word_list;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt;
        (car (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word</span> = head-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == bar)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> word_list_rest_with_bar_ket_counter
            (env,
             cdr (env, word_list),
             bar, ket, counter + 1);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == ket)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> word_list_rest_with_bar_ket_counter
            (env,
             cdr (env, word_list),
             bar, ket, counter - 1);
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> word_list_rest_with_bar_ket_counter
            (env,
             cdr (env, word_list),
             bar, ket, counter);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9157cee" class="outline-3">
<h3 id="org9157cee">word_list_rest</h3>
<div class="outline-text-3" id="text-org9157cee">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;data_o&gt;
<span style="color: #93E0E3;">word_list_rest</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    assert (cons_p (env, a));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word_list</span> = static_pointer_cast &lt;data_o&gt; (a);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt;
        (car (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word</span> = head-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (bar_word_p (word)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">bar</span> = word;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">ket</span> = bar_word_to_ket_word (word);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> word_list_rest_with_bar_ket_counter
            (env,
             cdr (env, word_list),
             bar, ket, 1);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> static_pointer_cast &lt;data_o&gt;
            (cdr (env, word_list));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd8c29aa" class="outline-3">
<h3 id="orgd8c29aa">word_list_drop_ket</h3>
<div class="outline-text-3" id="text-orgd8c29aa">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;data_o&gt;
<span style="color: #93E0E3;">word_list_drop_ket</span>
(<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
 <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>,
 <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">ket</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word_list</span> = static_pointer_cast &lt;data_o&gt; (a);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, word_list);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, word_list);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, rest))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> null_c (env);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">cdr_rest</span> = cdr (env, rest);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">car_rest</span> = static_pointer_cast &lt;str_o&gt; (car (env, rest));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word</span> = car_rest-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, cdr_rest)) {
        assert (word == ket);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (env, head, null_c (env));
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (env, head,
                       word_list_drop_ket (env, rest, ket));
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5da2f8a" class="outline-3">
<h3 id="org5da2f8a">parse_sexp</h3>
<div class="outline-text-3" id="text-org5da2f8a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;data_o&gt;
<span style="color: #93E0E3;">parse_sexp_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>);

<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt;
<span style="color: #93E0E3;">parse_sexp</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word_list</span> = static_pointer_cast &lt;data_o&gt; (a);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt;
        (car (env, word_list));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word</span> = head-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, word_list);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == <span style="color: #CC9393;">"("</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> parse_sexp_list
            (env, word_list_drop_ket (env, rest, <span style="color: #CC9393;">")"</span>));
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == <span style="color: #CC9393;">"["</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> list_to_vect
            (env, parse_sexp_list
             (env, word_list_drop_ket (env, rest, <span style="color: #CC9393;">"]"</span>)));
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == <span style="color: #CC9393;">"'"</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"quote"</span>),
                       cons_c (env,
                               parse_sexp (env, rest),
                               null_c (env)));
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (word == <span style="color: #CC9393;">"`"</span>)
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"partquote"</span>),
                       cons_c (env,
                               parse_sexp (env, rest),
                               null_c (env)));
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> head;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgda61e9" class="outline-3">
<h3 id="orgda61e9">parse_sexp_list</h3>
<div class="outline-text-3" id="text-orgda61e9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;data_o&gt;
<span style="color: #93E0E3;">parse_sexp_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word_list</span> = static_pointer_cast &lt;data_o&gt; (a);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, word_list))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> word_list;
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cons_c
            (env,
             parse_sexp (env, word_list_head (env, word_list)),
             parse_sexp_list (env, word_list_rest (env, word_list)));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge61a5e2" class="outline-3">
<h3 id="orge61a5e2">sexp_repr</h3>
<div class="outline-text-3" id="text-orge61a5e2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">sexp_list_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>);

<span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">sexp_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, a)) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"()"</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (cons_p (env, a)) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"("</span> + sexp_list_repr (env, a) + <span style="color: #CC9393;">")"</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (vect_p (env, a)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">l</span> = vect_to_list (env, a);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"["</span> + sexp_list_repr (env, l) + <span style="color: #CC9393;">"]"</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = static_pointer_cast &lt;str_o&gt; (a);
        assert (str-&gt;tag == tagging (env, <span style="color: #CC9393;">"str-t"</span>));
        <span style="color: #F0DFAF; font-weight: bold;">return</span> str-&gt;str;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdc99a7a" class="outline-3">
<h3 id="orgdc99a7a">sexp_list_repr</h3>
<div class="outline-text-3" id="text-orgdc99a7a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">string</span>
<span style="color: #93E0E3;">sexp_list_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sexp_list</span> = static_pointer_cast &lt;data_o&gt; (a);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, sexp_list))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">""</span>;
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, cdr (env, sexp_list)))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> sexp_repr (env, car (env, sexp_list));
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span>
            sexp_repr (env, car (env, sexp_list)) + <span style="color: #CC9393;">" "</span> +
            sexp_list_repr (env, cdr (env, sexp_list));
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga70162a" class="outline-3">
<h3 id="orga70162a">jj_scan_word_list</h3>
<div class="outline-text-3" id="text-orga70162a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_scan_word_list_sig</span> = { <span style="color: #CC9393;">"scan-word-list"</span>, <span style="color: #CC9393;">"code"</span> };
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- str-t -&gt; (list-t str-t)</span>
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_scan_word_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    env.obj_stack.push (scan_word_list (env, obj_map [<span style="color: #CC9393;">"code"</span>]));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge2fe2d9" class="outline-3">
<h3 id="orge2fe2d9">jj_parse_sexp</h3>
<div class="outline-text-3" id="text-orge2fe2d9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_parse_sexp_sig</span> = { <span style="color: #CC9393;">"parse-sexp"</span>, <span style="color: #CC9393;">"word-list"</span> };
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- (list-t str-t) -&gt; sexp-t</span>
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_parse_sexp</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    env.obj_stack.push (parse_sexp (env, obj_map [<span style="color: #CC9393;">"word-list"</span>]));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb7442ec" class="outline-3">
<h3 id="orgb7442ec">jj_parse_sexp_list</h3>
<div class="outline-text-3" id="text-orgb7442ec">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_parse_sexp_list_sig</span> = { <span style="color: #CC9393;">"parse-sexp-list"</span>, <span style="color: #CC9393;">"word-list"</span> };
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- (list-t str-t) -&gt; (list-t sexp-t)</span>
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_parse_sexp_list</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    env.obj_stack.push (parse_sexp_list (env, obj_map [<span style="color: #CC9393;">"word-list"</span>]));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7d0a70a" class="outline-3">
<h3 id="org7d0a70a">jj_sexp_repr</h3>
<div class="outline-text-3" id="text-org7d0a70a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_sexp_repr_sig</span> = { <span style="color: #CC9393;">"sexp-repr"</span>, <span style="color: #CC9393;">"sexp"</span> };
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- sexp-t -&gt;</span>
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_sexp_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = sexp_repr (env, obj_map [<span style="color: #CC9393;">"sexp"</span>]);
    env.obj_stack.push (make_shared &lt;str_o&gt; (env, str));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdd15b98" class="outline-3">
<h3 id="orgdd15b98">jj_sexp_list_repr</h3>
<div class="outline-text-3" id="text-orgdd15b98">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_sexp_list_repr_sig</span> = { <span style="color: #CC9393;">"sexp-list-repr"</span>, <span style="color: #CC9393;">"sexp-list"</span> };
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">-- (list-t sexp-t) -&gt;</span>
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_sexp_list_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = sexp_list_repr (env, obj_map [<span style="color: #CC9393;">"sexp-list"</span>]);
    env.obj_stack.push (make_shared &lt;str_o&gt; (env, str));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga258d8" class="outline-3">
<h3 id="orga258d8">import_sexp</h3>
<div class="outline-text-3" id="text-orga258d8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_sexp</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_prim (env,
                 jj_scan_word_list_sig,
                 jj_scan_word_list);
    define_prim (env,
                 jj_parse_sexp_list_sig,
                 jj_parse_sexp_list);
    define_prim (env,
                 jj_parse_sexp_sig,
                 jj_parse_sexp);
    define_prim (env,
                 jj_sexp_repr_sig,
                 jj_sexp_repr);
    define_prim (env,
                 jj_sexp_list_repr_sig,
                 jj_sexp_list_repr);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4e9c1d7" class="outline-3">
<h3 id="org4e9c1d7">test_sexp_scan</h3>
<div class="outline-text-3" id="text-org4e9c1d7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_sexp_scan</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">code</span> = <span style="color: #CC9393;">"(cons-c &lt;car&gt; &lt;cdr&gt;)"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">string_vector</span> = scan_word_vector (code);
    assert (string_vector.size () == 5);
    assert (string_vector [0] == <span style="color: #CC9393;">"("</span>);
    assert (string_vector [1] == <span style="color: #CC9393;">"cons-c"</span>);
    assert (string_vector [2] == <span style="color: #CC9393;">"&lt;car&gt;"</span>);
    assert (string_vector [3] == <span style="color: #CC9393;">"&lt;cdr&gt;"</span>);
    assert (string_vector [4] == <span style="color: #CC9393;">")"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf562edc" class="outline-3">
<h3 id="orgf562edc">test_sexp_list</h3>
<div class="outline-text-3" id="text-orgf562edc">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_sexp_list</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    import_sexp (env);
    import_str (env);

    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">code</span> =
        <span style="color: #CC9393;">"(cons-c &lt;car&gt; &lt;cdr&gt;)"</span>
        <span style="color: #CC9393;">"(cons-c (cons-c &lt;car&gt; &lt;cdr&gt;) (cons-c &lt;car&gt; &lt;cdr&gt;))"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word_list</span> = scan_word_list
        (env, make_shared &lt;str_o&gt; (env, code));
    env.obj_stack.push (word_list);

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"parse-sexp-list"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"sexp-list-repr"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"str-print"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">env.double_report ();</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgba08b" class="outline-3">
<h3 id="orgba08b">test_sexp_vect</h3>
<div class="outline-text-3" id="text-orgba08b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_sexp_vect</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    import_sexp (env);
    import_str (env);

    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">code</span> = <span style="color: #CC9393;">"[a b c]"</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word_list</span> = scan_word_list
        (env, make_shared &lt;str_o&gt; (env, code));
    env.obj_stack.push (word_list);

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"parse-sexp"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"sexp-repr"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"str-print"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">{</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">}</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf68245a" class="outline-3">
<h3 id="orgf68245a">test_sexp</h3>
<div class="outline-text-3" id="text-orgf68245a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_sexp</span> ()
{
    test_sexp_scan ();
    test_sexp_list ();
    test_sexp_vect ();
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge574ba4" class="outline-2">
<h2 id="orge574ba4"><b>top-keyword</b></h2>
<div class="outline-text-2" id="text-orge574ba4">
</div><div id="outline-container-org79321c4" class="outline-3">
<h3 id="org79321c4">top_keyword_fn</h3>
<div class="outline-text-3" id="text-org79321c4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">top_keyword_fn</span> = <span style="color: #7CB8BB;">function</span>
    &lt;<span style="color: #7CB8BB;">void</span> (<span style="color: #7CB8BB;">env_t</span> &amp;, <span style="color: #7CB8BB;">shared_ptr</span> &lt;data_o&gt;)&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-org2775fb2" class="outline-3">
<h3 id="org2775fb2">top_keyword_o</h3>
<div class="outline-text-3" id="text-org2775fb2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">top_keyword_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">top_keyword_fn</span> <span style="color: #DFAF8F;">fn</span>;
    <span style="color: #93E0E3;">top_keyword_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">top_keyword_fn</span> <span style="color: #DFAF8F;">fn</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org2dbcb22" class="outline-3">
<h3 id="org2dbcb22">top_keyword_o::top_keyword_o</h3>
<div class="outline-text-3" id="text-org2dbcb22">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">top_keyword_o</span>::
<span style="color: #93E0E3;">top_keyword_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">top_keyword_fn</span> <span style="color: #DFAF8F;">fn</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = tagging (env, <span style="color: #CC9393;">"top-keyword-t"</span>);
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;fn = fn;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge971ec5" class="outline-3">
<h3 id="orge971ec5">top_keyword_o::equal</h3>
<div class="outline-text-3" id="text-orge971ec5">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">top_keyword_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">this</span> != obj.get ();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2502eb7" class="outline-3">
<h3 id="org2502eb7">top_keyword_p</h3>
<div class="outline-text-3" id="text-org2502eb7">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">top_keyword_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == tagging (env, <span style="color: #CC9393;">"top-keyword-t"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf9c9242" class="outline-3">
<h3 id="orgf9c9242">define_top_keyword</h3>
<div class="outline-text-3" id="text-orgf9c9242">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">define_top_keyword</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>, <span style="color: #7CB8BB;">top_keyword_fn</span> <span style="color: #DFAF8F;">fn</span>)
{
    define (env, name, make_shared &lt;top_keyword_o&gt; (env, fn));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdcc81ec" class="outline-3">
<h3 id="orgdcc81ec">import_top_keyword</h3>
<div class="outline-text-3" id="text-orgdcc81ec">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_top_keyword</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org445b93b" class="outline-2">
<h2 id="org445b93b"><b>keyword</b></h2>
<div class="outline-text-2" id="text-org445b93b">
</div><div id="outline-container-org48f6729" class="outline-3">
<h3 id="org48f6729">local_ref_map_t</h3>
<div class="outline-text-3" id="text-org48f6729">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">local_ref_map_t</span> = <span style="color: #7CB8BB;">map</span> &lt;<span style="color: #7CB8BB;">name_t</span>, <span style="color: #7CB8BB;">local_ref_jo_t</span>&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-org303dd7c" class="outline-3">
<h3 id="org303dd7c">local_ref_map_extend</h3>
<div class="outline-text-3" id="text-org303dd7c">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">local_ref_map_t</span>
<span style="color: #93E0E3;">local_ref_map_extend</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                      <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">old_local_ref_map</span>,
                      <span style="color: #7CB8BB;">name_vector_t</span> &amp;<span style="color: #DFAF8F;">name_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_ref_map</span> = local_ref_map_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">kv</span>: old_local_ref_map) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = kv.first;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">old_local_ref_jo</span> = kv.second;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_ref_jo</span> = local_ref_jo_t
            (old_local_ref_jo.level + 1,
             old_local_ref_jo.index);
        local_ref_map.insert (make_pair (name, local_ref_jo));
    }
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">index</span> = 0;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">size</span> = name_vector.size ();
    <span style="color: #F0DFAF; font-weight: bold;">while</span> (index &lt; size) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = name_vector [index];
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_ref_jo</span> = local_ref_jo_t (0, index);
        local_ref_map.insert (make_pair (name, local_ref_jo));
        index++;
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> local_ref_map;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga6bef64" class="outline-3">
<h3 id="orga6bef64">keyword_fn</h3>
<div class="outline-text-3" id="text-orga6bef64">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">using</span> <span style="color: #7CB8BB;">keyword_fn</span> = <span style="color: #7CB8BB;">function</span>
    &lt;<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
     (<span style="color: #7CB8BB;">env_t</span> &amp;,
      <span style="color: #DFAF8F;">local_ref_map_t</span> &amp;,
      <span style="color: #7CB8BB;">shared_ptr</span> &lt;data_o&gt;)&gt;;
</pre>
</div>
</div>
</div>

<div id="outline-container-org8f10168" class="outline-3">
<h3 id="org8f10168">keyword_o</h3>
<div class="outline-text-3" id="text-org8f10168">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #F0DFAF; font-weight: bold;">struct</span> <span style="color: #7CB8BB;">keyword_o</span>: <span style="color: #7CB8BB;">obj_t</span>
{
    <span style="color: #7CB8BB;">keyword_fn</span> <span style="color: #DFAF8F;">fn</span>;
    <span style="color: #93E0E3;">keyword_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">keyword_fn</span> <span style="color: #DFAF8F;">fn</span>);
    <span style="color: #7CB8BB;">bool</span> <span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>);
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org18955a" class="outline-3">
<h3 id="org18955a">keyword_o::keyword_o</h3>
<div class="outline-text-3" id="text-org18955a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #BFEBBF;">keyword_o</span>::
<span style="color: #93E0E3;">keyword_o</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">keyword_fn</span> <span style="color: #DFAF8F;">fn</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag = tagging (env, <span style="color: #CC9393;">"keyword-t"</span>);
    <span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;fn = fn;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9e4e16b" class="outline-3">
<h3 id="org9e4e16b">keyword_o::equal</h3>
<div class="outline-text-3" id="text-org9e4e16b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #BFEBBF;">keyword_o</span>::<span style="color: #93E0E3;">equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">obj</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">this</span>-&gt;tag != obj-&gt;tag) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">this</span> != obj.get ();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb88c26" class="outline-3">
<h3 id="orgb88c26">keyword_p</h3>
<div class="outline-text-3" id="text-orgb88c26">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">keyword_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">return</span> a-&gt;tag == tagging (env, <span style="color: #CC9393;">"keyword-t"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orged4a4e4" class="outline-3">
<h3 id="orged4a4e4">define_keyword</h3>
<div class="outline-text-3" id="text-orged4a4e4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">define_keyword</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>, <span style="color: #7CB8BB;">keyword_fn</span> <span style="color: #DFAF8F;">fn</span>)
{
    define (env, name, make_shared &lt;keyword_o&gt; (env, fn));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4eaae39" class="outline-3">
<h3 id="org4eaae39">obj_vect_to_name_vector</h3>
<div class="outline-text-3" id="text-org4eaae39">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">name_vector_t</span>
<span style="color: #93E0E3;">obj_vect_to_name_vector</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_vect_t</span> &amp;<span style="color: #DFAF8F;">obj_vect</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = name_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> &amp;<span style="color: #DFAF8F;">obj</span>: obj_vect) {
        assert (str_p (env, obj));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = static_pointer_cast &lt;str_o&gt; (obj);
        name_vector.push_back (str-&gt;str);
    }
    <span style="color: #F0DFAF; font-weight: bold;">return</span> name_vector;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf3cb632" class="outline-3">
<h3 id="orgf3cb632">import_keyword</h3>
<div class="outline-text-3" id="text-orgf3cb632">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_keyword</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc3d4a65" class="outline-2">
<h2 id="orgc3d4a65"><span class="todo _todo_">[todo]</span> <b>macro</b></h2>
</div>

<div id="outline-container-org93a9d79" class="outline-2">
<h2 id="org93a9d79"><b>compile</b></h2>
<div class="outline-text-2" id="text-org93a9d79">
</div><div id="outline-container-org2018f50" class="outline-3">
<h3 id="org2018f50">keyword_sexp_p</h3>
<div class="outline-text-3" id="text-org2018f50">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">keyword_sexp_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, a)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sexp</span> = static_pointer_cast &lt;data_o&gt; (a);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt; (car (env, sexp));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = head-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.box_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.box_map.end ()) {
        <span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (box-&gt;empty_p) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (keyword_p (env, box-&gt;obj)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
        <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2142f59" class="outline-3">
<h3 id="org2142f59">get_keyword_fn</h3>
<div class="outline-text-3" id="text-org2142f59">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">keyword_fn</span>
<span style="color: #93E0E3;">get_keyword_fn</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.box_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.box_map.end ()) {
        <span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (box-&gt;empty_p) {
            cout &lt;&lt; <span style="color: #CC9393;">"- fatal error: get_keyword_fn fail\n"</span>;
            exit (1);
        }
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (keyword_p (env, box-&gt;obj)) {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">keyword</span> = static_pointer_cast &lt;keyword_o&gt;
                (box-&gt;obj);
            <span style="color: #F0DFAF; font-weight: bold;">return</span> keyword-&gt;fn;
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> {
            cout &lt;&lt; <span style="color: #CC9393;">"- fatal error: get_keyword_fn fail\n"</span>;
            exit (1);
        };
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error: get_keyword_fn fail\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org62db4f" class="outline-3">
<h3 id="org62db4f">jojo_append</h3>
<div class="outline-text-3" id="text-org62db4f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">jojo_append</span> (<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">ante</span>,
             <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">succ</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jo_vector</span> = jo_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span>: ante-&gt;jo_vector) jo_vector.push_back (x-&gt;copy ());
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">x</span>: succ-&gt;jo_vector) jo_vector.push_back (x-&gt;copy ());
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org84be2e2" class="outline-3">
<h3 id="org84be2e2">dot_string_p</h3>
<div class="outline-text-3" id="text-org84be2e2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">dot_string_p</span> (<span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">pos</span> = str.find (<span style="color: #CC9393;">"."</span>);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> (pos != <span style="color: #BFEBBF;">string</span>::npos);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6332579" class="outline-3">
<h3 id="org6332579"><span class="todo _todo_">[todo]</span> dot_string_compile</h3>
<div class="outline-text-3" id="text-org6332579">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">dot_string_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                    <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
                    <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    cout &lt;&lt; <span style="color: #CC9393;">"- WIP\n"</span>;
    exit (1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org88f4023" class="outline-3">
<h3 id="org88f4023">ref_compile</h3>
<div class="outline-text-3" id="text-org88f4023">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">ref_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
             <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
             <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jo_vector</span> = jo_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = local_ref_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != local_ref_map.end ())
        jo_vector.push_back (it-&gt;second.copy ());
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        jo_vector.push_back (<span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, name)));
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2a1d9fa" class="outline-3">
<h3 id="org2a1d9fa"><span class="todo _todo_">[todo]</span> string_compile</h3>
<div class="outline-text-3" id="text-org2a1d9fa">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">string_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
                <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">str</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (dot_string_p (str)) {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> dot_string_compile (env, local_ref_map, str);
    }
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">else if (string_string_p) {</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">}</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">else if (int_string_p) {</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">}</span>
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> ref_compile (env, local_ref_map, str);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2f57627" class="outline-3">
<h3 id="org2f57627">sexp_compile</h3>
<div class="outline-text-3" id="text-org2f57627">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">call_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
              <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
              <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>);

<span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">sexp_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
              <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
              <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (str_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">str</span> = static_pointer_cast &lt;str_o&gt; (sexp);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> string_compile (env, local_ref_map, str-&gt;str);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">if</span> (keyword_sexp_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt; (car (env, sexp));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">body</span> = static_pointer_cast &lt;data_o&gt; (cdr (env, sexp));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = head-&gt;str;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">fn</span> = get_keyword_fn (env, name);
        <span style="color: #F0DFAF; font-weight: bold;">return</span> fn (env, local_ref_map, body);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        assert (cons_p (env, sexp));
        <span style="color: #F0DFAF; font-weight: bold;">return</span> call_compile (env, local_ref_map, sexp);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8d1a0cb" class="outline-3">
<h3 id="org8d1a0cb">sexp_list_compile</h3>
<div class="outline-text-3" id="text-org8d1a0cb">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">sexp_list_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
                   <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
                   <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sexp_list</span> = static_pointer_cast &lt;data_o&gt; (a);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (<span style="color: #DFAF8F;">jo_vector_t</span> ());
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, sexp_list))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo;
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        assert (cons_p (env, sexp_list));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head_jojo</span> = sexp_compile
            (env, local_ref_map, car (env, sexp_list));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">body_jojo</span> = sexp_list_compile
            (env, local_ref_map, cdr (env, sexp_list));
        <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo_append (head_jojo, body_jojo);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd6ba301" class="outline-3">
<h3 id="orgd6ba301">call_compile</h3>
<div class="outline-text-3" id="text-orgd6ba301">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">call_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
              <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">local_ref_map</span>,
              <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = car (env, sexp);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">body</span> = cdr (env, sexp);
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (list_length (env, body)),
    };
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head_jojo</span> = sexp_compile (env, local_ref_map, head);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">body_jojo</span> = sexp_list_compile (env, local_ref_map, body);
    jojo = jojo_append (head_jojo, jojo);
    jojo = jojo_append (body_jojo, jojo);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> jojo;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd9f8498" class="outline-3">
<h3 id="orgd9f8498">import_compile</h3>
<div class="outline-text-3" id="text-orgd9f8498">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_compile</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{

}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga9768f2" class="outline-3">
<h3 id="orga9768f2">test_compile</h3>
<div class="outline-text-3" id="text-orga9768f2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_compile</span> ()
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9d0e5d1" class="outline-2">
<h2 id="org9d0e5d1"><b>eval</b></h2>
<div class="outline-text-2" id="text-org9d0e5d1">
</div><div id="outline-container-org11112ec" class="outline-3">
<h3 id="org11112ec">top_keyword_sexp_p</h3>
<div class="outline-text-3" id="text-org11112ec">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">bool</span>
<span style="color: #93E0E3;">top_keyword_sexp_p</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (<span style="color: #F0DFAF; font-weight: bold;">!</span> cons_p (env, a)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sexp</span> = static_pointer_cast &lt;data_o&gt; (a);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt; (car (env, sexp));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = head-&gt;str;
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.box_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.box_map.end ()) {
        <span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (box-&gt;empty_p) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (top_keyword_p (env, box-&gt;obj)) <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">true</span>;
        <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #BFEBBF;">false</span>;
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga79fe5e" class="outline-3">
<h3 id="orga79fe5e">get_top_keyword_fn</h3>
<div class="outline-text-3" id="text-orga79fe5e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">top_keyword_fn</span>
<span style="color: #93E0E3;">get_top_keyword_fn</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">name_t</span> <span style="color: #DFAF8F;">name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">it</span> = env.box_map.find (name);
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (it != env.box_map.end ()) {
        <span style="color: #7CB8BB;">box_t</span> *<span style="color: #DFAF8F;">box</span> = it-&gt;second;
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (box-&gt;empty_p) {
            cout &lt;&lt; <span style="color: #CC9393;">"- fatal error: get_top_keyword_fn fail\n"</span>;
            exit (1);
        }
        <span style="color: #F0DFAF; font-weight: bold;">if</span> (top_keyword_p (env, box-&gt;obj)) {
            <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">top_keyword</span> = static_pointer_cast &lt;top_keyword_o&gt;
                (box-&gt;obj);
            <span style="color: #F0DFAF; font-weight: bold;">return</span> top_keyword-&gt;fn;
        }
        <span style="color: #F0DFAF; font-weight: bold;">else</span> {
            cout &lt;&lt; <span style="color: #CC9393;">"- fatal error: get_top_keyword_fn fail\n"</span>;
            exit (1);
        };
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        cout &lt;&lt; <span style="color: #CC9393;">"- fatal error: get_top_keyword_fn fail\n"</span>;
        exit (1);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3e1d5c1" class="outline-3">
<h3 id="org3e1d5c1">jojo_run</h3>
<div class="outline-text-3" id="text-org3e1d5c1">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">jojo_run</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; <span style="color: #DFAF8F;">jojo</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">base</span> = env.frame_stack.size ();
    env.frame_stack.push (new_frame_from_jojo (jojo));
    env.run_with_base (base);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5cb5367" class="outline-3">
<h3 id="org5cb5367">sexp_eval</h3>
<div class="outline-text-3" id="text-org5cb5367">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">sexp_eval</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (top_keyword_sexp_p (env, sexp)) {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt; (car (env, sexp));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">body</span> = static_pointer_cast &lt;data_o&gt; (cdr (env, sexp));
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = head-&gt;str;
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">fn</span> = get_top_keyword_fn (env, name);
        fn (env, body);
    }
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_ref_map</span> = local_ref_map_t ();
        <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">jojo</span> = sexp_compile (env, local_ref_map, sexp);
        jojo_run (env, jojo);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5761ba2" class="outline-3">
<h3 id="org5761ba2">sexp_list_eval</h3>
<div class="outline-text-3" id="text-org5761ba2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">sexp_list_eval</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">sexp_list</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (null_p (env, sexp_list))
        <span style="color: #F0DFAF; font-weight: bold;">return</span>;
    <span style="color: #F0DFAF; font-weight: bold;">else</span> {
        sexp_eval (env, car (env, sexp_list));
        sexp_list_eval (env, cdr (env, sexp_list));
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdc27bb4" class="outline-3">
<h3 id="orgdc27bb4">code_eval</h3>
<div class="outline-text-3" id="text-orgdc27bb4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">code_eval</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">obj_t</span>&gt; <span style="color: #DFAF8F;">a</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">code</span> = static_pointer_cast &lt;str_o&gt; (a);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">word_list</span> = scan_word_list (env, code);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">sexp_list</span> = parse_sexp_list (env, word_list);
    sexp_list_eval (env, sexp_list);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org14654f" class="outline-3">
<h3 id="org14654f">jj_code_eval</h3>
<div class="outline-text-3" id="text-org14654f">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_code_eval_sig</span> = { <span style="color: #CC9393;">"code-eval"</span>, <span style="color: #CC9393;">"code"</span> };
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_code_eval</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    code_eval (env, obj_map [<span style="color: #CC9393;">"code"</span>]);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2233aca" class="outline-3">
<h3 id="org2233aca">import_eval</h3>
<div class="outline-text-3" id="text-org2233aca">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_eval</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_prim (env,
                 jj_code_eval_sig,
                 jj_code_eval);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org505dee2" class="outline-3">
<h3 id="org505dee2"><span class="todo _todo_">[todo]</span> test_eval</h3>
<div class="outline-text-3" id="text-org505dee2">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_eval</span> ()
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf5fe458" class="outline-2">
<h2 id="orgf5fe458"><b>syntax</b></h2>
<div class="outline-text-2" id="text-orgf5fe458">
</div><div id="outline-container-orgb5f1904" class="outline-3">
<h3 id="orgb5f1904">tk_assign</h3>
<div class="outline-text-3" id="text-orgb5f1904">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">tk_assign</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">shared_ptr</span> &lt;data_o&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">head</span> = static_pointer_cast &lt;str_o&gt; (car (env, body));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = cdr (env, body);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name</span> = head-&gt;str;
    sexp_list_eval (env, rest);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = env.obj_stack.top ();
    env.obj_stack.pop ();
    define (env, name, obj);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8c93336" class="outline-3">
<h3 id="org8c93336"><span class="todo _todo_">[todo]</span> k_lambda</h3>
<div class="outline-text-3" id="text-org8c93336">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">shared_ptr</span> &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt;
<span style="color: #93E0E3;">k_lambda</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>,
          <span style="color: #7CB8BB;">local_ref_map_t</span> &amp;<span style="color: #DFAF8F;">old_local_ref_map</span>,
          <span style="color: #7CB8BB;">shared_ptr</span> &lt;data_o&gt; <span style="color: #DFAF8F;">body</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vect</span> = static_pointer_cast &lt;vect_o&gt; (car (env, body));
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">auto rest = static_pointer_cast &lt;data_o&gt; (cdr (env, body));</span>
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest</span> = (cdr (env, body));
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">name_vector</span> = obj_vect_to_name_vector (env, name_vect-&gt;vect);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">local_ref_map</span> = local_ref_map_extend
        (env, old_local_ref_map, name_vector);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rest_jojo</span> = sexp_list_compile (env, local_ref_map, rest);
    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">lambda_jo_t</span> (name_vector, rest_jojo),
    };
    <span style="color: #F0DFAF; font-weight: bold;">return</span> make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (jo_vector);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8cab301" class="outline-3">
<h3 id="org8cab301">import_syntax</h3>
<div class="outline-text-3" id="text-org8cab301">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_syntax</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_top_keyword (env, <span style="color: #CC9393;">"="</span>, tk_assign);
    define_keyword (env, <span style="color: #CC9393;">"lambda"</span>, k_lambda);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org95f85f9" class="outline-3">
<h3 id="org95f85f9">test_syntax</h3>
<div class="outline-text-3" id="text-org95f85f9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_syntax</span> ()
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org843ed7d" class="outline-2">
<h2 id="org843ed7d"><b>tag</b></h2>
<div class="outline-text-2" id="text-org843ed7d">
</div><div id="outline-container-org77b7e41" class="outline-3">
<h3 id="org77b7e41">tag</h3>
<div class="outline-text-3" id="text-org77b7e41">
</div><div id="outline-container-org125549e" class="outline-4">
<h4 id="org125549e">tag_o</h4>
<div class="outline-text-4" id="text-org125549e">
<div class="org-src-container">

<pre class="src src-cpp"></pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org17055fc" class="outline-3">
<h3 id="org17055fc"><span class="todo _todo_">[todo]</span> jj_get_tag</h3>
<div class="outline-text-3" id="text-org17055fc">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">sig_t jj_get_tag_sig = { "get-tag", "obj" };</span>
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">void jj_get_tag (env_t &amp;env, obj_map_t &amp;obj_map)</span>
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">{</span>
<span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">auto obj = obj_map ["obj"];</span>
<span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.obj_stack.push (make_shared &lt;tag_o&gt; (env, obj-&gt;repr (env)));</span>
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb1e9a0b" class="outline-3">
<h3 id="orgb1e9a0b"><span class="todo _todo_">[todo]</span> import_tag</h3>
<div class="outline-text-3" id="text-orgb1e9a0b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_tag</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{

}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdd3a2a9" class="outline-3">
<h3 id="orgdd3a2a9"><span class="todo _todo_">[todo]</span> test_tag</h3>
<div class="outline-text-3" id="text-orgdd3a2a9">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_tag</span> ()
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org80af527" class="outline-2">
<h2 id="org80af527"><b>misc</b></h2>
<div class="outline-text-2" id="text-org80af527">
</div><div id="outline-container-orgf83fdab" class="outline-3">
<h3 id="orgf83fdab">jj_repr</h3>
<div class="outline-text-3" id="text-orgf83fdab">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_repr_sig</span> = { <span style="color: #CC9393;">"repr"</span>, <span style="color: #CC9393;">"obj"</span> };
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_repr</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = obj_map [<span style="color: #CC9393;">"obj"</span>];
    env.obj_stack.push
        (make_shared &lt;str_o&gt;
         (env, obj-&gt;repr (env)));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2eb7588" class="outline-3">
<h3 id="org2eb7588">jj_print</h3>
<div class="outline-text-3" id="text-org2eb7588">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_print_sig</span> = { <span style="color: #CC9393;">"print"</span>, <span style="color: #CC9393;">"obj"</span> };
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_print</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">obj</span> = obj_map [<span style="color: #CC9393;">"obj"</span>];
    cout &lt;&lt; obj-&gt;repr (env);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3a36d7e" class="outline-3">
<h3 id="org3a36d7e">jj_newline</h3>
<div class="outline-text-3" id="text-org3a36d7e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_newline_sig</span> = { <span style="color: #CC9393;">"newline"</span> };
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_newline</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    cout &lt;&lt; <span style="color: #CC9393;">"\n"</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9206e3b" class="outline-3">
<h3 id="org9206e3b">jj_equal</h3>
<div class="outline-text-3" id="text-org9206e3b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">sig_t</span> <span style="color: #DFAF8F;">jj_equal_sig</span> = { <span style="color: #CC9393;">"equal"</span>, <span style="color: #CC9393;">"lhs"</span>, <span style="color: #CC9393;">"rhs"</span> };
<span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">jj_equal</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">lhs</span> = obj_map [<span style="color: #CC9393;">"lhs"</span>];
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">rhs</span> = obj_map [<span style="color: #CC9393;">"rhs"</span>];
    <span style="color: #F0DFAF; font-weight: bold;">if</span> (obj_equal (env, lhs, rhs))
        env.obj_stack.push (true_c (env));
    <span style="color: #F0DFAF; font-weight: bold;">else</span>
        env.obj_stack.push (false_c (env));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf944071" class="outline-3">
<h3 id="orgf944071">import_misc</h3>
<div class="outline-text-3" id="text-orgf944071">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_misc</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    define_prim (env,
                 jj_repr_sig,
                 jj_repr);
    define_prim (env,
                 jj_print_sig,
                 jj_print);
    define_prim (env,
                 jj_newline_sig,
                 jj_newline);
    define_prim (env,
                 jj_equal_sig,
                 jj_equal);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9b284f8" class="outline-3">
<h3 id="org9b284f8">test_misc</h3>
<div class="outline-text-3" id="text-org9b284f8">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_misc</span> ()
{

}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9e67d21" class="outline-2">
<h2 id="org9e67d21">epilog</h2>
<div class="outline-text-2" id="text-org9e67d21">
</div><div id="outline-container-org84f2fc2" class="outline-3">
<h3 id="org84f2fc2">test</h3>
<div class="outline-text-3" id="text-org84f2fc2">
</div><div id="outline-container-org7923fad" class="outline-4">
<h4 id="org7923fad">test_step</h4>
<div class="outline-text-4" id="text-org7923fad">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_step</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    define (env, <span style="color: #CC9393;">"s1"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    {
        env.run ();
        assert_stack_size (env, 2);
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgebfc6ab" class="outline-4">
<h4 id="orgebfc6ab">test_data</h4>
<div class="outline-text-4" id="text-orgebfc6ab">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_data</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    <span style="color: #7CB8BB;">obj_map_t</span> <span style="color: #DFAF8F;">obj_map</span> = {
        {<span style="color: #CC9393;">"car"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>)},
        {<span style="color: #CC9393;">"cdr"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>)},
    };

    define (env, <span style="color: #CC9393;">"last-cry"</span>, make_shared &lt;data_o&gt;
            (env, tagging (env, <span style="color: #CC9393;">"cons-t"</span>), obj_map));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"last-cry"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #CC9393;">"car"</span>),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"last-cry"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #CC9393;">"cdr"</span>),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"last-cry"</span>)),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    {
        env.run ();

        assert_stack_size (env, 3);
        assert_pop_eq (env, make_shared &lt;data_o&gt;
                       (env,
                        tagging (env, <span style="color: #CC9393;">"cons-t"</span>),
                        obj_map));
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3fa214a" class="outline-4">
<h4 id="org3fa214a">test_apply</h4>
<div class="outline-text-4" id="text-org3fa214a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_apply</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    define (env, <span style="color: #CC9393;">"s1"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">body</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">local_ref_jo_t</span> (0, 0),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">local_ref_jo_t</span> (0, 1),
    };

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">lambda_jo_t</span> ({ <span style="color: #CC9393;">"x"</span>, <span style="color: #CC9393;">"y"</span> },
                         make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (body)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (2),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">env.double_report ();</span>

    {
        env.run ();
        assert_stack_size (env, 2);
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org83a0082" class="outline-4">
<h4 id="org83a0082">test_lambda_curry</h4>
<div class="outline-text-4" id="text-org83a0082">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_lambda_curry</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    define (env, <span style="color: #CC9393;">"s1"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">body</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">local_ref_jo_t</span> (0, 0),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">local_ref_jo_t</span> (0, 1),
    };

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">lambda_jo_t</span> ({ <span style="color: #CC9393;">"x"</span>, <span style="color: #CC9393;">"y"</span> },
                         make_shared &lt;<span style="color: #7CB8BB;">jojo_t</span>&gt; (body)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">{</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">//     </span><span style="color: #7F9F7F;">env.step_and_report ();</span>
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">}</span>

    {
        env.run ();
        assert_stack_size (env, 2);
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org67637b6" class="outline-4">
<h4 id="org67637b6">test_data_cons</h4>
<div class="outline-text-4" id="text-org67637b6">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_data_cons</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    define (env, <span style="color: #CC9393;">"s1"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
    define (env, <span style="color: #CC9393;">"cons-c"</span>, make_shared &lt;data_cons_o&gt;
            (env,
             tagging (env, <span style="color: #CC9393;">"cons-t"</span>),
             name_vector_t ({ <span style="color: #CC9393;">"car"</span>, <span style="color: #CC9393;">"cdr"</span> }),
             <span style="color: #7CB8BB;">obj_map_t</span> ()));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"cons-c"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (2),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #CC9393;">"cdr"</span>),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">env.double_report ();</span>

    {
        env.run ();
        assert_stack_size (env, 1);
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org89df80b" class="outline-4">
<h4 id="org89df80b">test_data_cons_curry</h4>
<div class="outline-text-4" id="text-org89df80b">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_data_cons_curry</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    define (env, <span style="color: #CC9393;">"s1"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
    define (env, <span style="color: #CC9393;">"cons-c"</span>, make_shared &lt;data_cons_o&gt;
            (env,
             tagging (env, <span style="color: #CC9393;">"cons-t"</span>),
             name_vector_t ({ <span style="color: #CC9393;">"car"</span>, <span style="color: #CC9393;">"cdr"</span> }),
             <span style="color: #7CB8BB;">obj_map_t</span> ()));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"cons-c"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">field_jo_t</span> (<span style="color: #CC9393;">"car"</span>),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">env.double_report ();</span>

    {
        env.run ();
        assert_stack_size (env, 1);
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3ef4bf4" class="outline-4">
<h4 id="org3ef4bf4">test_prim</h4>
<div class="outline-text-4" id="text-org3ef4bf4">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_prim</span> ()
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();

    define (env, <span style="color: #CC9393;">"s1"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
    define (env, <span style="color: #CC9393;">"s2"</span>, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));

    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">swap</span> =
        [] (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">obj_map_t</span> &amp;<span style="color: #DFAF8F;">obj_map</span>)
        {
            env.obj_stack.push (obj_map [<span style="color: #CC9393;">"y"</span>]);
            env.obj_stack.push (obj_map [<span style="color: #CC9393;">"x"</span>]);
        };

    define (env, <span style="color: #CC9393;">"swap"</span>, make_shared &lt;prim_o&gt;
            (env,
             name_vector_t { <span style="color: #CC9393;">"x"</span>, <span style="color: #CC9393;">"y"</span> },
             swap,
             <span style="color: #7CB8BB;">obj_map_t</span> ()));

    <span style="color: #7CB8BB;">jo_vector_t</span> <span style="color: #DFAF8F;">jo_vector</span> = {
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"swap"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (2),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s1"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"s2"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">ref_jo_t</span> (boxing (env, <span style="color: #CC9393;">"swap"</span>)),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
        <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">apply_jo_t</span> (1),
    };

    env.frame_stack.push (new_frame_from_jo_vector (jo_vector));

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">env.double_report ();</span>

    {
        env.run ();
        assert_stack_size (env, 4);
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"bye"</span>));
        assert_pop_eq (env, make_shared &lt;str_o&gt; (env, <span style="color: #CC9393;">"world"</span>));
        assert_stack_size (env, 0);
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8a7c643" class="outline-3">
<h3 id="org8a7c643">test_all</h3>
<div class="outline-text-3" id="text-org8a7c643">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">test_all</span> ()
{
    test_step ();
    test_data ();
    test_apply ();
    test_lambda_curry ();
    test_data_cons ();
    test_data_cons_curry ();
    test_prim ();
    test_bool ();
    test_list ();
    test_str ();
    test_vect ();
    test_dict ();
    test_sexp ();
    test_eval ();
    test_syntax ();
    test_tag ();
    test_misc ();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2282c5e" class="outline-3">
<h3 id="org2282c5e">import_all</h3>
<div class="outline-text-3" id="text-org2282c5e">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">import_all</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>)
{
    import_test (env);
    import_bool (env);
    import_list (env);
    import_str (env);
    import_vect (env);
    import_dict (env);
    import_sexp (env);
    import_top_keyword (env);
    import_keyword (env);
    import_compile (env);
    import_eval (env);
    import_syntax (env);
    import_tag (env);
    import_misc (env);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeb7830" class="outline-3">
<h3 id="orgeb7830">eval_file</h3>
<div class="outline-text-3" id="text-orgeb7830">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">eval_file</span> (<span style="color: #7CB8BB;">env_t</span> &amp;<span style="color: #DFAF8F;">env</span>, <span style="color: #7CB8BB;">string</span> <span style="color: #DFAF8F;">file_name</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">input_file</span> = ifstream (file_name);
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">buffer</span> = stringstream ();
    buffer &lt;&lt; input_file.rdbuf ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">code</span> = make_shared &lt;str_o&gt; (env, buffer.str ());
    code_eval (env, code);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1742617" class="outline-3">
<h3 id="org1742617">the_story_begin</h3>
<div class="outline-text-3" id="text-org1742617">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">void</span>
<span style="color: #93E0E3;">the_story_begin</span> (<span style="color: #7CB8BB;">string_vector_t</span> <span style="color: #DFAF8F;">arg_vector</span>)
{
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">env</span> = env_t ();
    import_all (env);
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">file_name</span>: arg_vector)
        eval_file (env, file_name);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9ea718a" class="outline-3">
<h3 id="org9ea718a">main</h3>
<div class="outline-text-3" id="text-org9ea718a">
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #7CB8BB;">int</span>
<span style="color: #93E0E3;">main</span> (<span style="color: #7CB8BB;">int</span> <span style="color: #DFAF8F;">argc</span>, <span style="color: #7CB8BB;">char</span> **<span style="color: #DFAF8F;">argv</span>)
{
    test_all ();
    <span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">arg_vector</span> = string_vector_t ();
    <span style="color: #F0DFAF; font-weight: bold;">for</span> (<span style="color: #F0DFAF; font-weight: bold;">auto</span> <span style="color: #DFAF8F;">i</span> = 1; i &lt; argc; i++) {
        arg_vector.push_back (<span style="color: #7CB8BB;">string</span> (<span style="color: #DFAF8F;">argv</span>[i]));
    }
    the_story_begin (arg_vector);
    <span style="color: #F0DFAF; font-weight: bold;">return</span> 0;
}
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2018-07-30 Mon 05:03</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
